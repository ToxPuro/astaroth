const int NGHOST_VAL = 3
#include "../../../../acc-runtime/stdlib/math"
#include "../../../../acc-runtime/stdlib/derivs.h"
#include "../../../../acc-runtime/stdlib/operators.h"
#include "fieldecs.h"
#define AC_NGHOST__mod__cparam nghost__mod__cparam
//TP: nphis1 and nphis2 don't actually work. simply declared to compile the code
//
#include "var_declares.h"
Kernel twopass_solve_intermediate(){
  #include "static_var_declares.h"
  #include "df_declares.h"
  real max_hdiff = 0.0
  real ac_transformed_pencil_interdependency
  real ac_transformed_pencil_among
  real ac_transformed_pencil_by
  real ac_transformed_pencil_the
  real ac_transformed_pencil_particles_selfgrav
  real ac_transformed_pencil_module
  real3 ac_transformed_pencil_fcont[AC_n_forcing_cont_max__mod__cparam]
  real3 ac_transformed_pencil_fvisc
  real ac_transformed_pencil_diffus_total
  real ac_transformed_pencil_diffus_total2
  real ac_transformed_pencil_diffus_total3
  real ac_transformed_pencil_visc_heat
  real ac_transformed_pencil_nu
  real3 ac_transformed_pencil_gradnu
  real ac_transformed_pencil_nu_smag
  real3 ac_transformed_pencil_gnu_smag
  real ac_transformed_pencil_heat
  real ac_transformed_pencil_cool
  real ac_transformed_pencil_heatcool
  real ac_transformed_pencil_rhod[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_udropav
  real ac_transformed_pencil_rhodsum
  real3 ac_transformed_pencil_glnrhodsum
  real ac_transformed_pencil_divud[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_ood[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_od2[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_oud[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_ud2[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_udgud[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_uud[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_del2ud[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_del6ud[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_graddivud[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_advec_uud
  real ac_transformed_pencil_dustvelocity
  real ac_transformed_pencil_this
  real ac_transformed_pencil_are
  real ac_transformed_pencil_specified
  real ac_transformed_pencil_ttp
  real ac_transformed_pencil_rhop
  real3 ac_transformed_pencil_grhop
  real ac_transformed_pencil_peh
  real ac_transformed_pencil_tauascalar
  real ac_transformed_pencil_condensationrate
  real ac_transformed_pencil_watermixingratio
  real ac_transformed_pencil_particles
  real3 ac_transformed_pencil_uun
  real ac_transformed_pencil_divun
  Matrix ac_transformed_pencil_snij
  real ac_transformed_pencil_neutralvelocity
  real ac_transformed_pencil_acc
  real3 ac_transformed_pencil_gacc
  real ac_transformed_pencil_ugacc
  real ac_transformed_pencil_del2acc
  real ac_transformed_pencil_ssat
  real ac_transformed_pencil_ttc
  real3 ac_transformed_pencil_gttc
  real ac_transformed_pencil_ugttc
  real ac_transformed_pencil_del2ttc
  real ac_transformed_pencil_pscalar
  real3 ac_transformed_pencil_gg
  real ac_transformed_pencil_epot
  real3 ac_transformed_pencil_aa
  real ac_transformed_pencil_a2
  Matrix ac_transformed_pencil_aij
  real3 ac_transformed_pencil_bb
  real3 ac_transformed_pencil_bbb
  real ac_transformed_pencil_ab
  real ac_transformed_pencil_ua
  real3 ac_transformed_pencil_exa
  real3 ac_transformed_pencil_exatotal
  real ac_transformed_pencil_aps
  real ac_transformed_pencil_b2
  real ac_transformed_pencil_b21
  real ac_transformed_pencil_bf2
  Matrix ac_transformed_pencil_bij
  real3 ac_transformed_pencil_del2a
  real3 ac_transformed_pencil_graddiva
  real3 ac_transformed_pencil_jj
  real3 ac_transformed_pencil_jj_ohm
  real3 ac_transformed_pencil_
  real3 ac_transformed_pencil_curlb
  real3 ac_transformed_pencil_e3xa
  real3 ac_transformed_pencil_el
  real ac_transformed_pencil_e2
  Matrix ac_transformed_pencil_bijtilde
  Matrix ac_transformed_pencil_bij_cov_corr
  real ac_transformed_pencil_j2
  real ac_transformed_pencil_jb
  real ac_transformed_pencil_va2
  real3 ac_transformed_pencil_jxb
  real3 ac_transformed_pencil_jxbr
  real ac_transformed_pencil_jxbr2
  real ac_transformed_pencil_ub
  real ac_transformed_pencil_uj
  real ac_transformed_pencil_ob
  real3 ac_transformed_pencil_uxb
  real3 ac_transformed_pencil_uxbb
  real ac_transformed_pencil_uxb2
  real3 ac_transformed_pencil_uxj
  real ac_transformed_pencil_chibp
  real ac_transformed_pencil_beta
  real ac_transformed_pencil_beta1
  real3 ac_transformed_pencil_uga
  real3 ac_transformed_pencil_uuadvec_gaa
  real ac_transformed_pencil_djuidjbi
  real ac_transformed_pencil_jo
  real ac_transformed_pencil_stokesi
  real ac_transformed_pencil_stokesq
  real ac_transformed_pencil_stokesu
  real ac_transformed_pencil_stokesq1
  real ac_transformed_pencil_stokesu1
  real ac_transformed_pencil_ujxb
  real3 ac_transformed_pencil_oxuxb
  real3 ac_transformed_pencil_jxbxb
  real3 ac_transformed_pencil_jxbrxb
  real3 ac_transformed_pencil_gb22
  real3 ac_transformed_pencil_ugb
  real ac_transformed_pencil_ugb22
  real3 ac_transformed_pencil_bgu
  real3 ac_transformed_pencil_bgb
  real3 ac_transformed_pencil_bgbp
  real ac_transformed_pencil_ubgbp
  real3 ac_transformed_pencil_bdivu
  real3 ac_transformed_pencil_glnrhoxb
  real3 ac_transformed_pencil_del4a
  real3 ac_transformed_pencil_del6a
  real3 ac_transformed_pencil_oxj
  real ac_transformed_pencil_diva
  Matrix ac_transformed_pencil_jij
  real ac_transformed_pencil_sj
  real ac_transformed_pencil_ss12
  real ac_transformed_pencil_d6ab
  real ac_transformed_pencil_etava
  real ac_transformed_pencil_etaj
  real ac_transformed_pencil_etaj2
  real ac_transformed_pencil_etajrho
  real ac_transformed_pencil_cosjb
  real ac_transformed_pencil_jparallel
  real ac_transformed_pencil_jperp
  real ac_transformed_pencil_cosub
  real3 ac_transformed_pencil_bunit
  real3 ac_transformed_pencil_hjj
  real ac_transformed_pencil_hj2
  real ac_transformed_pencil_hjb
  real ac_transformed_pencil_coshjb
  real ac_transformed_pencil_hjparallel
  real ac_transformed_pencil_hjperp
  real ac_transformed_pencil_nu_ni1
  real ac_transformed_pencil_gamma_a2
  real ac_transformed_pencil_clight2
  real3 ac_transformed_pencil_gva
  real3 ac_transformed_pencil_vmagfric
  real3 ac_transformed_pencil_bb_sph
  real ac_transformed_pencil_advec_va2
  real ac_transformed_pencil_lam
  Matrix ac_transformed_pencil_poly
  real ac_transformed_pencil_trp
  real ac_transformed_pencil_fr
  Matrix ac_transformed_pencil_frc
  Matrix ac_transformed_pencil_u_dot_gradc
  Tensor ac_transformed_pencil_cijk
  Matrix ac_transformed_pencil_del2poly
  real3 ac_transformed_pencil_div_frc
  real3 ac_transformed_pencil_divc
  real3 ac_transformed_pencil_grad_fr
  real ac_transformed_pencil_divu
  real3 ac_transformed_pencil_oo
  real ac_transformed_pencil_o2
  real ac_transformed_pencil_ou
  real ac_transformed_pencil_oxu2
  real3 ac_transformed_pencil_oxu
  real ac_transformed_pencil_u2
  Matrix ac_transformed_pencil_uij
  real3 ac_transformed_pencil_uu
  real3 ac_transformed_pencil_curlo
  Matrix ac_transformed_pencil_sij
  real ac_transformed_pencil_sij2
  Matrix ac_transformed_pencil_uij5
  real3 ac_transformed_pencil_ugu
  real ac_transformed_pencil_ugu2
  Matrix ac_transformed_pencil_oij
  Matrix ac_transformed_pencil_d2uidxj
  Tensor ac_transformed_pencil_uijk
  real3 ac_transformed_pencil_ogu
  real ac_transformed_pencil_u3u21
  real ac_transformed_pencil_u1u32
  real ac_transformed_pencil_u2u13
  real3 ac_transformed_pencil_del2u
  real3 ac_transformed_pencil_del4u
  real3 ac_transformed_pencil_del6u
  real ac_transformed_pencil_u2u31
  real ac_transformed_pencil_u3u12
  real ac_transformed_pencil_u1u23
  real3 ac_transformed_pencil_graddivu
  real3 ac_transformed_pencil_del6u_bulk
  real3 ac_transformed_pencil_grad5divu
  real3 ac_transformed_pencil_rhougu
  real3 ac_transformed_pencil_der6u
  real3 ac_transformed_pencil_transpurho
  real ac_transformed_pencil_divu0
  Matrix ac_transformed_pencil_u0ij
  real3 ac_transformed_pencil_uu0
  real3 ac_transformed_pencil_uu_advec
  real3 ac_transformed_pencil_uuadvec_guu
  real3 ac_transformed_pencil_del6u_strict
  real3 ac_transformed_pencil_del4graddivu
  real3 ac_transformed_pencil_uu_sph
  Matrix ac_transformed_pencil_der6u_res
  real ac_transformed_pencil_lorentz
  real ac_transformed_pencil_hless
  real ac_transformed_pencil_advec_uu
  real ac_transformed_pencil_x_mn
  real ac_transformed_pencil_y_mn
  real ac_transformed_pencil_z_mn
  real ac_transformed_pencil_r_mn
  real ac_transformed_pencil_r_mn1
  real ac_transformed_pencil_phix
  real ac_transformed_pencil_phiy
  real ac_transformed_pencil_pomx
  real ac_transformed_pencil_pomy
  real ac_transformed_pencil_rcyl_mn
  real ac_transformed_pencil_rcyl_mn1
  real ac_transformed_pencil_phi_mn
  real3 ac_transformed_pencil_evr
  real3 ac_transformed_pencil_rr
  real3 ac_transformed_pencil_evth
  real ac_transformed_pencil_ugss
  real ac_transformed_pencil_ma2
  real3 ac_transformed_pencil_fpres
  real ac_transformed_pencil_uglntt
  real3 ac_transformed_pencil_sglntt
  real ac_transformed_pencil_transprhos
  real ac_transformed_pencil_dsdr
  real ac_transformed_pencil_initss
  real ac_transformed_pencil_initlnrho
  real ac_transformed_pencil_uuadvec_gss
  real ac_transformed_pencil_advec_cs2
  real ac_transformed_pencil_pointmasses
  real ac_transformed_pencil_shock
  real3 ac_transformed_pencil_gshock
  real ac_transformed_pencil_shock_perp
  real3 ac_transformed_pencil_gshock_perp
  real ac_transformed_pencil_ywater
  real ac_transformed_pencil_lambda
  real ac_transformed_pencil_chem_conc[AC_nchemspec__mod__cparam]
  real ac_transformed_pencil_nucl_rmin
  real ac_transformed_pencil_nucl_rate
  real ac_transformed_pencil_conc_satm
  real ac_transformed_pencil_ff_cond
  real ac_transformed_pencil_cosmicray
  real3 ac_transformed_pencil_sgs_force
  real ac_transformed_pencil_sgs_heat
  real3 ac_transformed_pencil_glnnd[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_gmi[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_gmd[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_gnd[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_grhod[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_ad[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_md[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_mi[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_nd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_rhod1[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_epsd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_udgmi[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_udgmd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_udglnnd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_udgnd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_glnnd2[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_sdglnnd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_del2nd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_del2rhod[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_del6nd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_del2md[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_del2mi[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_del6lnnd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_gndglnrho[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_glnndglnrho[AC_ndustspec__mod__cparam]
  real3 ac_transformed_pencil_udrop[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_udropgnd[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_fcloud
  real ac_transformed_pencil_ccondens
  real ac_transformed_pencil_ppwater
  real ac_transformed_pencil_ppsat
  real ac_transformed_pencil_ppsf[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_mu1
  real3 ac_transformed_pencil_glnrhod[AC_ndustspec__mod__cparam]
  real ac_transformed_pencil_rhodsum1
  real3 ac_transformed_pencil_grhodsum
  real ac_transformed_pencil_dustdensity
  real ac_transformed_pencil_radiation
  real ac_transformed_pencil_cv
  real ac_transformed_pencil_cv1
  real ac_transformed_pencil_cp
  real ac_transformed_pencil_cp1
  real3 ac_transformed_pencil_glncp
  real ac_transformed_pencil_dydt_reac[AC_nchemspec__mod__cparam]
  real ac_transformed_pencil_dydt_diff[AC_nchemspec__mod__cparam]
  real3 ac_transformed_pencil_glambda
  real ac_transformed_pencil_diff_penc_add[AC_nchemspec__mod__cparam]
  real ac_transformed_pencil_h0_rt[AC_nchemspec__mod__cparam]
  real ac_transformed_pencil_hhk_full[AC_nchemspec__mod__cparam]
  real3 ac_transformed_pencil_ghhk[AC_nchemspec__mod__cparam]
  real ac_transformed_pencil_s0_r[AC_nchemspec__mod__cparam]
  real ac_transformed_pencil_neutraldensity
  real ac_transformed_pencil_lnrhon
  real ac_transformed_pencil_rhon
  real ac_transformed_pencil_rhon1
  real3 ac_transformed_pencil_glnrhon
  real3 ac_transformed_pencil_grhon
  real ac_transformed_pencil_unglnrhon
  real ac_transformed_pencil_ungrhon
  real ac_transformed_pencil_del2rhon
  real ac_transformed_pencil_glnrhon2
  real ac_transformed_pencil_del6lnrhon
  real ac_transformed_pencil_del6rhon
  real3 ac_transformed_pencil_snglnrhon
  real ac_transformed_pencil_alpha
  real ac_transformed_pencil_zeta
  real ac_transformed_pencil_ss
  real3 ac_transformed_pencil_gss
  real ac_transformed_pencil_ee
  real ac_transformed_pencil_pp
  real ac_transformed_pencil_lntt
  real ac_transformed_pencil_cs2
  real ac_transformed_pencil_cp1tilde
  real3 ac_transformed_pencil_glntt
  real ac_transformed_pencil_tt
  real ac_transformed_pencil_tt1
  real3 ac_transformed_pencil_gtt
  real ac_transformed_pencil_yh
  Matrix ac_transformed_pencil_hss
  Matrix ac_transformed_pencil_hlntt
  real ac_transformed_pencil_del2ss
  real ac_transformed_pencil_del6ss
  real ac_transformed_pencil_del2lntt
  real ac_transformed_pencil_del6lntt
  real ac_transformed_pencil_gamma
  real ac_transformed_pencil_del2tt
  real ac_transformed_pencil_del6tt
  real3 ac_transformed_pencil_glnmumol
  real ac_transformed_pencil_ppvap
  real ac_transformed_pencil_csvap2
  real ac_transformed_pencil_ttb
  real ac_transformed_pencil_rho_anel
  real ac_transformed_pencil_eth
  real3 ac_transformed_pencil_geth
  real ac_transformed_pencil_del2eth
  Matrix ac_transformed_pencil_heth
  real ac_transformed_pencil_eths
  real3 ac_transformed_pencil_geths
  real3 ac_transformed_pencil_rho1gpp
  real3 ac_transformed_pencil_fsgs
  real ac_transformed_pencil_chiral
  real3 ac_transformed_pencil_bbf
  real ac_transformed_pencil_visc_heatn
  real ac_transformed_pencil_un2
  Matrix ac_transformed_pencil_unij
  real ac_transformed_pencil_snij2
  real3 ac_transformed_pencil_ungun
  real3 ac_transformed_pencil_del2un
  real3 ac_transformed_pencil_del6un
  real3 ac_transformed_pencil_graddivun
  real ac_transformed_pencil_advec_uun
  real ac_transformed_pencil_advec_csn2
  real ac_transformed_pencil_lnrho
  real ac_transformed_pencil_rho
  real ac_transformed_pencil_rho1
  real3 ac_transformed_pencil_glnrho
  real3 ac_transformed_pencil_grho
  real ac_transformed_pencil_uglnrho
  real ac_transformed_pencil_ugrho
  real ac_transformed_pencil_glnrho2
  real ac_transformed_pencil_del2lnrho
  real ac_transformed_pencil_del2rho
  real ac_transformed_pencil_del6lnrho
  real ac_transformed_pencil_del6rho
  Matrix ac_transformed_pencil_hlnrho
  real3 ac_transformed_pencil_sglnrho
  real3 ac_transformed_pencil_uij5glnrho
  real ac_transformed_pencil_transprho
  real ac_transformed_pencil_ekin
  real ac_transformed_pencil_uuadvec_glnrho
  real ac_transformed_pencil_uuadvec_grho
  real ac_transformed_pencil_rhos1
  real3 ac_transformed_pencil_glnrhos
  real ac_transformed_pencil_totenergy_rel
  real ac_transformed_pencil_divss
  real3 ac_transformed_pencil_mf_emf
  real ac_transformed_pencil_mf_emfdotb
  real3 ac_transformed_pencil_jxb_mf
  real3 ac_transformed_pencil_jxbr_mf
  real ac_transformed_pencil_chib_mf
  real ac_transformed_pencil_mf_qp
  real ac_transformed_pencil_mf_beq21
  real3 df_iuu_pencil
  bool lcommunicate
  real tmp_4_14_15_100
  real tmp2_4_14_15_100
  real3 ugu0_4_14_15_100
  real3 u0gu_4_14_15_100
  int i_4_14_15_100
  int j_4_14_15_100
  int ju_4_14_15_100
  real tmp_13_14_15_100
  real dd_13_14_15_100
  real tmp_rho_13_14_15_100
  real3 tmp3_13_14_15_100
  Matrix tmp33_13_14_15_100
  real cs201_13_14_15_100
  real outest_13_14_15_100
  int i_13_14_15_100
  int j_13_14_15_100
  int ju_13_14_15_100
  int jj_13_14_15_100
  int kk_13_14_15_100
  int jk_13_14_15_100
  int i_4_49_50_13_14_15_100
  int j_4_49_50_13_14_15_100
  real bx_5_13_14_15_100
  real by_5_13_14_15_100
  real bz_5_13_14_15_100
  real bx2_5_13_14_15_100
  real by2_5_13_14_15_100
  real bz2_5_13_14_15_100
  real detm1_5_13_14_15_100
  real tmp_20_24_25_100
  int i_20_24_25_100
  real tmp_16_20_24_25_100
  int i_16_20_24_25_100
  int j_16_20_24_25_100
  int i_23_24_25_100
  real tmp_21_23_24_25_100
  int i_21_23_24_25_100
  int j_21_23_24_25_100
  real tmp_28_29_100
  int i_28_29_100
  int j_28_29_100
  int j_35_100
  real3 tmp_66_100
  real3 tmp2_66_100
  real3 gradnu_66_100
  real3 sgradnu_66_100
  real3 gradnu_shock_66_100
  real murho1_66_100
  real zetarho1_66_100
  real mutt_66_100
  real tmp3_66_100
  real tmp4_66_100
  real pnu_shock_66_100
  real lambda_phi_66_100
  real prof_66_100
  real prof2_66_100
  real derprof_66_100
  real derprof2_66_100
  real gradnu_effective_66_100
  real fac_66_100
  real advec_hypermesh_uu_66_100
  real3 deljskl2_66_100
  real3 fvisc_nnewton2_66_100
  Matrix d_sld_flux_66_100
  int i_66_100
  int j_66_100
  int ju_66_100
  int ii_66_100
  int jj_66_100
  int kk_66_100
  int ll_66_100
  bool ldiffus_total_66_100
  bool ldiffus_total3_66_100
  real step_vector_return_value_36_38_66_100
  real step_vector_return_value_36_38_66_100
  real arg_37_38_66_100
  real der_step_return_value_37_38_66_100
  real step_vector_return_value_39_66_100
  real step_vector_return_value_39_66_100
  real step_vector_return_value_40_66_100
  real step_vector_return_value_40_66_100
  real arg_41_66_100
  real der_step_return_value_41_66_100
  real arg_42_66_100
  real der_step_return_value_42_66_100
  real step_vector_return_value_44_66_100
  real step_vector_return_value_44_66_100
  real step_vector_return_value_45_66_100
  real step_vector_return_value_45_66_100
  real arg_46_66_100
  real der_step_return_value_46_66_100
  real arg_47_66_100
  real der_step_return_value_47_66_100
  real step_vector_return_value_49_66_100
  real step_vector_return_value_49_66_100
  real step_vector_return_value_50_66_100
  real step_vector_return_value_50_66_100
  real arg_51_66_100
  real der_step_return_value_51_66_100
  real arg_52_66_100
  real der_step_return_value_52_66_100
  real step_vector_return_value_53_66_100
  real step_vector_return_value_53_66_100
  real arg_54_66_100
  real der_step_return_value_54_66_100
  int j_55_66_100
  real step_vector_return_value_56_66_100
  real step_vector_return_value_56_66_100
  real arg_57_66_100
  real der_step_return_value_57_66_100
  int j_58_66_100
  real step_vector_return_value_59_66_100
  real step_vector_return_value_59_66_100
  real arg_60_66_100
  real der_step_return_value_60_66_100
  int j_61_66_100
  real tmp_62_66_100
  int i_62_66_100
  int k1_62_66_100
  real tmp_63_66_100
  int i_63_66_100
  int k1_63_66_100
  real lomega_64_66_100
  real dlomega_dr_64_66_100
  real dlomega_dtheta_64_66_100
  real lver_64_66_100
  real lhor_64_66_100
  real dlver_dr_64_66_100
  real dlhor_dtheta_64_66_100
  real lomega_65_66_100
  real dlomega_dr_65_66_100
  real lver_65_66_100
  real dlver_dr_65_66_100
  int i_68_100
  int j_68_100
  real3 tmp_81_82_100
  real rho1_jxb_81_82_100
  real quench_81_82_100
  real stokesi_ncr_81_82_100
  real tmp1_81_82_100
  real bbgb_81_82_100
  real va2max_beta_81_82_100
  real3 b_ext_81_82_100
  real3 j_ext_81_82_100
  real c_81_82_100
  real s_81_82_100
  int i_81_82_100
  int j_81_82_100
  int ix_81_82_100
  real c_74_81_82_100
  real s_74_81_82_100
  real zprof_74_81_82_100
  real zder_74_81_82_100
  real zpostop_74_81_82_100
  real zposbot_74_81_82_100
  real step_scalar_return_value_70_74_81_82_100
  real step_scalar_return_value_71_74_81_82_100
  real arg_72_74_81_82_100
  real der_step_return_value_72_74_81_82_100
  real arg_73_74_81_82_100
  real der_step_return_value_73_74_81_82_100
  real c_75_81_82_100
  real s_75_81_82_100
  real zprof_75_81_82_100
  real zder_75_81_82_100
  real zpostop_75_81_82_100
  real zposbot_75_81_82_100
  real step_scalar_return_value_70_75_81_82_100
  real step_scalar_return_value_71_75_81_82_100
  real arg_72_75_81_82_100
  real der_step_return_value_72_75_81_82_100
  real arg_73_75_81_82_100
  real der_step_return_value_73_75_81_82_100
  real chi_diamag_78_81_82_100
  real3 gchi_diamag_78_81_82_100
  real3 bk_bki_78_81_82_100
  real3 jj_diamag_78_81_82_100
  real3 tmp_78_81_82_100
  int j_77_78_81_82_100
  real3 uu1_131
  real3 tmpv_131
  real tmp_131
  real ftot_131
  real ugu_schur_x_131
  real ugu_schur_y_131
  real ugu_schur_z_131
  Matrix puij_schur_131
  int i_131
  int j_131
  int ju_131
  real c2_105_131
  real s2_105_131
  real c2_106_131
  real s2_106_131
  real om2_106_131
  real cp2_106_131
  real cs2_106_131
  real ss2_106_131
  int i_107_131
  int j_107_131
  int k_107_131
  real3 cent_res_107_131
  real3 cori_res_107_131
  real c2_108_131
  real s2_108_131
  real c2_109_131
  real s2_109_131
  real c1_110_131
  real c2_110_131
  int i_114_131
  real reshock_113_114_131
  real fvisc2_113_114_131
  real uus_113_114_131
  real tmp_113_114_131
  real qfvisc_113_114_131
  real3 nud2uxb_113_114_131
  real3 fluxv_113_114_131
  int i_112_113_114_131
  int j_112_113_114_131
  real pdamp_122_131
  real fint_work_122_131
  real fext_work_122_131
  int i_122_131
  int j_122_131
  real step_vector_return_value_116_122_131
  real step_vector_return_value_116_122_131
  real step_vector_return_value_117_122_131
  real step_vector_return_value_117_122_131
  real step_vector_return_value_118_122_131
  real step_vector_return_value_118_122_131
  real step_vector_return_value_119_122_131
  real step_vector_return_value_119_122_131
  real step_vector_return_value_120_122_131
  real step_vector_return_value_120_122_131
  real step_vector_return_value_121_122_131
  real step_vector_return_value_121_122_131
  real local_omega_123_131
  real neg_velocity_ceiling_124_131
  int j_124_131
  real3 f_target_129_131
  int j_129_131
  int ju_129_131
  real fdiff_143
  real tmp_143
  real3 tmpv_143
  real density_rhs_143
  real advec_hypermesh_rho_143
  int j_143
  bool ldt_up_143
  int i_133_143
  real fran_136_143[2]
  real tmp_136_143
  real dlnrhodt_136_143
  real pdamp_136_143
  real fprofile_136_143
  real radius2_136_143
  real step_vector_return_value_134_136_143
  real step_vector_return_value_134_136_143
  real step_vector_return_value_135_136_143
  real step_vector_return_value_135_136_143
  real f_target_142_143
  real ztop_231
  real xi_231
  real profile_cor_231
  real tmp1_231
  int j_231
  real cubic_step_pt_return_value_145_146_231
  real xi_145_146_231
  real relshift_145_146_231
  real cubic_step_pt_return_value_145_146_231
  real3 glnthcond_155_231
  real3 glhc_155_231
  real chix_155_231
  real thdiff_155_231
  real g2_155_231
  real del2ss1_155_231
  real glnrhoglnt_155_231
  real3 gradchit_prof_155_231
  Matrix tmp_155_231
  real s2_155_231
  real c2_155_231
  real sc_155_231
  int j_155_231
  real r_mn_153_155_231
  real r_mn1_153_155_231
  int j_153_155_231
  real arg_148_153_155_231
  real der_step_return_value_148_153_155_231
  real arg_149_153_155_231
  real der_step_return_value_149_153_155_231
  real step_vector_return_value_150_153_155_231
  real step_vector_return_value_150_153_155_231
  real step_vector_return_value_151_153_155_231
  real step_vector_return_value_151_153_155_231
  bool loptest_return_value_152_153_155_231
  real r_mn_154_155_231
  real r_mn1_154_155_231
  int j_154_155_231
  real arg_148_154_155_231
  real der_step_return_value_148_154_155_231
  real arg_149_154_155_231
  real der_step_return_value_149_154_155_231
  real step_vector_return_value_150_154_155_231
  real step_vector_return_value_150_154_155_231
  real step_vector_return_value_151_154_155_231
  real step_vector_return_value_151_154_155_231
  bool loptest_return_value_152_154_155_231
  real chix_156_231
  real thdiff_156_231
  real g2_156_231
  real thdiff_157_231
  real g2_157_231
  real del2ss1_157_231
  int j_157_231
  real thdiff_159_231
  real g2_159_231
  real3 gradchit_prof_159_231
  real r_mn_158_159_231
  real r_mn1_158_159_231
  int j_158_159_231
  real arg_148_158_159_231
  real der_step_return_value_148_158_159_231
  real arg_149_158_159_231
  real der_step_return_value_149_158_159_231
  real step_vector_return_value_150_158_159_231
  real step_vector_return_value_150_158_159_231
  real step_vector_return_value_151_158_159_231
  real step_vector_return_value_151_158_159_231
  bool loptest_return_value_152_158_159_231
  real thdiff_160_231
  real g2_160_231
  real thchi_160_231
  real thdiff_161_231
  real g2_161_231
  real rhochi_161_231
  real thdiff_162_231
  real g2_162_231
  real gshockglntt_162_231
  real gshockgss_162_231
  real thdiff_165_231
  real g2_165_231
  real gshockglntt_165_231
  real gchiglntt_165_231
  real pchi_shock_165_231
  real3 gradchi_shock_165_231
  real step_vector_return_value_163_165_231
  real step_vector_return_value_163_165_231
  real arg_164_165_231
  real der_step_return_value_164_165_231
  real thdiff_166_231
  real3 gvkpara_168_231
  real3 gvkperp_168_231
  real3 tmpv_168_231
  real3 tmpv2_168_231
  real bb2_168_231
  real thdiff_168_231
  real b1_168_231
  real tmps_168_231
  real vkpara_168_231
  real vkperp_168_231
  int i_168_231
  int j_168_231
  real3 bunit_167_168_231
  real3 hhh_167_168_231
  real3 gvkperp1_167_168_231
  real3 gvkpara1_167_168_231
  real3 tmpv_167_168_231
  real abs_b_167_168_231
  real b1_167_168_231
  real del2ecr_167_168_231
  real gecr2_167_168_231
  real hhh2_167_168_231
  real quenchfactor_167_168_231
  real tmp_167_168_231
  real tmpi_167_168_231
  real tmpj_167_168_231
  real tmpk_167_168_231
  const limiter_tensordiff_167_168_231 = 3.
  int i_167_168_231
  int j_167_168_231
  int k_167_168_231
  real tau_169_231
  real cooling_169_231
  real kappa_169_231
  real a1_169_231
  real a3_169_231
  real a2_169_231
  real kappa0_169_231
  real kappa0_cgs_169_231
  real thdiff_171_231
  real g2_171_231
  real g2_chi_171_231
  real krho1_171_231
  real del2ss1_171_231
  real3 gradchit_prof_171_231
  int j_171_231
  real r_mn_170_171_231
  real r_mn1_170_171_231
  int j_170_171_231
  real arg_148_170_171_231
  real der_step_return_value_148_170_171_231
  real arg_149_170_171_231
  real der_step_return_value_149_170_171_231
  real step_vector_return_value_150_170_171_231
  real step_vector_return_value_150_170_171_231
  real step_vector_return_value_151_170_171_231
  real step_vector_return_value_151_170_171_231
  bool loptest_return_value_152_170_171_231
  real thdiff_175_231
  real thdiff1_175_231
  real g2_175_231
  real del2ss0_175_231
  real del2ss1_175_231
  real3 gradchit_prof_175_231
  real3 gradchit_prof_fluct_175_231
  int j_175_231
  real r_mn_172_175_231
  real r_mn1_172_175_231
  int j_172_175_231
  real arg_148_172_175_231
  real der_step_return_value_148_172_175_231
  real arg_149_172_175_231
  real der_step_return_value_149_172_175_231
  real step_vector_return_value_150_172_175_231
  real step_vector_return_value_150_172_175_231
  real step_vector_return_value_151_172_175_231
  real step_vector_return_value_151_172_175_231
  bool loptest_return_value_152_172_175_231
  real r_mn_173_175_231
  real r_mn1_173_175_231
  int j_173_175_231
  real arg_148_173_175_231
  real der_step_return_value_148_173_175_231
  real arg_149_173_175_231
  real der_step_return_value_149_173_175_231
  real step_vector_return_value_150_173_175_231
  real step_vector_return_value_150_173_175_231
  real step_vector_return_value_151_173_175_231
  real step_vector_return_value_151_173_175_231
  bool loptest_return_value_152_173_175_231
  real r_mn_174_175_231
  real r_mn1_174_175_231
  int j_174_175_231
  real arg_148_174_175_231
  real der_step_return_value_148_174_175_231
  real arg_149_174_175_231
  real der_step_return_value_149_174_175_231
  real step_vector_return_value_150_174_175_231
  real step_vector_return_value_150_174_175_231
  real step_vector_return_value_151_174_175_231
  real step_vector_return_value_151_174_175_231
  bool loptest_return_value_152_174_175_231
  real thdiff_176_231
  real chix_176_231
  real g2_176_231
  real del2ss1_176_231
  real3 gradnu_176_231
  int j_176_231
  real3 gvkpara_177_231
  real3 gvkperp_177_231
  real3 tmpv_177_231
  real3 tmpv2_177_231
  real bb2_177_231
  real thdiff_177_231
  real b1_177_231
  real tmps_177_231
  real vkpara_177_231
  real vkperp_177_231
  int i_177_231
  int j_177_231
  real3 bunit_167_177_231
  real3 hhh_167_177_231
  real3 gvkperp1_167_177_231
  real3 gvkpara1_167_177_231
  real3 tmpv_167_177_231
  real abs_b_167_177_231
  real b1_167_177_231
  real del2ecr_167_177_231
  real gecr2_167_177_231
  real hhh2_167_177_231
  real quenchfactor_167_177_231
  real tmp_167_177_231
  real tmpi_167_177_231
  real tmpj_167_177_231
  real tmpk_167_177_231
  const limiter_tensordiff_167_177_231 = 3.
  int i_167_177_231
  int j_167_177_231
  int k_167_177_231
  real newton_178_231
  real lnttor_178_231
  int i_178_231
  real lnq_179_231
  real rtv_cool_179_231
  real lntt_si_179_231
  real lnneni_179_231
  real delta_lntt_179_231
  real tmp_179_231
  int i_179_231
  int imax_179_231
  real unit_lnq_179_231
  const intlnt_1_179_231 = [4.605, 8.959, 9.906, 10.534, 11.283, 12.434, 13.286, 14.541, 17.51, 20.723 ]
  const lnh_1_179_231 = [ -542.398,  -228.833, -80.245, -101.314, -78.748, -53.88, -80.452, -70.758, -91.182]
  const b_1_179_231 = [     50.,      15.,      0.,      2.0,      0.,    -2.,      0., -AC_twothird__mod__cparam,    0.5 ]
  const intlnt_2_179_231 = [ 5.704,7.601 , 8.987 , 11.513 , 17.504 , 20.723, 24.0 ]
  const lnh_2_179_231 = [-102.811, -99.01, -111.296, -70.804, -90.934, -80.572 ]
  const b_2_179_231 = [    2.0,     1.5,   2.867,  -0.65,   0.5, 0.0 ]
  real cosbgt_181_231
  real gt2_181_231
  real b2_181_231
  real rhs_181_231
  real vkpara_181_231
  real vkperp_181_231
  real3 bunit_180_181_231
  real3 hhh_180_181_231
  real3 gvkperp1_180_181_231
  real3 gvkpara1_180_181_231
  real3 tmpv_180_181_231
  real abs_b_180_181_231
  real b1_180_181_231
  real del2ecr_180_181_231
  real gecr2_180_181_231
  real hhh2_180_181_231
  real quenchfactor_180_181_231
  real tmp_180_181_231
  real tmpi_180_181_231
  real tmpj_180_181_231
  real tmpk_180_181_231
  const limiter_tensordiff_180_181_231 = 3.
  int i_180_181_231
  int j_180_181_231
  int k_180_181_231
  int j_182_231
  real thdiff_182_231
  real tmp_182_231
  real thdiff_183_231
  real tmp_183_231
  real advec_hypermesh_ss_183_231
  int j_183_231
  real thdiff_184_231
  real tmp_213_231
  real heat_213_231
  real tt_drive_213_231
  real prof_213_231
  real profile_buffer_213_231
  real xi_213_231
  real rgas_213_231
  real prof_195_213_231
  real prof2_195_213_231
  real ztop_195_213_231
  real zbot_195_213_231
  real dumerfc_185_195_213_231
  real t_185_195_213_231
  real z_185_195_213_231
  real erfunc_return_value_185_195_213_231
  real dumerfc_186_195_213_231
  real t_186_195_213_231
  real z_186_195_213_231
  real erfunc_return_value_186_195_213_231
  real dumerfc_187_195_213_231
  real t_187_195_213_231
  real z_187_195_213_231
  real erfunc_return_value_187_195_213_231
  real dumerfc_188_195_213_231
  real t_188_195_213_231
  real z_188_195_213_231
  real erfunc_return_value_188_195_213_231
  real dumerfc_189_195_213_231
  real t_189_195_213_231
  real z_189_195_213_231
  real erfunc_return_value_189_195_213_231
  real dumerfc_190_195_213_231
  real t_190_195_213_231
  real z_190_195_213_231
  real erfunc_return_value_190_195_213_231
  real cubic_step_pt_return_value_191_195_213_231
  real xi_191_195_213_231
  real relshift_191_195_213_231
  real cubic_step_pt_return_value_191_195_213_231
  real cubic_step_pt_return_value_192_195_213_231
  real xi_192_195_213_231
  real relshift_192_195_213_231
  real cubic_step_pt_return_value_192_195_213_231
  real cubic_step_pt_return_value_193_195_213_231
  real xi_193_195_213_231
  real relshift_193_195_213_231
  real cubic_step_pt_return_value_193_195_213_231
  real dumerfc_194_195_213_231
  real t_194_195_213_231
  real z_194_195_213_231
  real erfunc_return_value_194_195_213_231
  real prof_196_213_231
  real ztop_196_213_231
  real prof_203_213_231
  real theta_profile_203_213_231
  real div_cool_203_213_231
  real step_vector_return_value_197_203_213_231
  real step_vector_return_value_197_203_213_231
  real step_vector_return_value_198_203_213_231
  real step_vector_return_value_198_203_213_231
  real step_vector_return_value_199_203_213_231
  real step_vector_return_value_199_203_213_231
  real step_vector_return_value_200_203_213_231
  real step_vector_return_value_200_203_213_231
  real step_vector_return_value_201_203_213_231
  real step_vector_return_value_201_203_213_231
  real step_vector_return_value_202_203_213_231
  real step_vector_return_value_202_203_213_231
  real cs2_tmp_204_213_231
  real fac_tmp_204_213_231
  real prof_206_213_231
  real step_vector_return_value_205_206_213_231
  real step_vector_return_value_205_206_213_231
  int i_207_213_231
  real rr1_211_213_231
  real tt_drive_211_213_231
  real oo_211_213_231
  real pborder_211_213_231
  int i_208_211_213_231
  real quintic_step_mn_return_value_209_211_213_231
  real xi_209_211_213_231
  real relshift_209_211_213_231
  real quintic_step_mn_return_value_209_211_213_231
  real quintic_step_mn_return_value_210_211_213_231
  real xi_210_211_213_231
  real relshift_210_211_213_231
  real quintic_step_mn_return_value_210_211_213_231
  real ztop_212_213_231
  real xi_212_213_231
  real profile_cor_212_213_231
  real newton_214_231
  real lnttor_214_231
  int i_214_231
  real lnq_215_231
  real rtv_cool_215_231
  real lntt_si_215_231
  real lnneni_215_231
  real delta_lntt_215_231
  real tmp_215_231
  int i_215_231
  int imax_215_231
  real unit_lnq_215_231
  const intlnt_1_215_231 = [4.605, 8.959, 9.906, 10.534, 11.283, 12.434, 13.286, 14.541, 17.51, 20.723 ]
  const lnh_1_215_231 = [ -542.398,  -228.833, -80.245, -101.314, -78.748, -53.88, -80.452, -70.758, -91.182]
  const b_1_215_231 = [     50.,      15.,      0.,      2.0,      0.,    -2.,      0., -AC_twothird__mod__cparam,    0.5 ]
  const intlnt_2_215_231 = [ 5.704,7.601 , 8.987 , 11.513 , 17.504 , 20.723, 24.0 ]
  const lnh_2_215_231 = [-102.811, -99.01, -111.296, -70.804, -90.934, -80.572 ]
  const b_2_215_231 = [    2.0,     1.5,   2.867,  -0.65,   0.5, 0.0 ]
  real pp_219_231
  real lnrho__216_219_231
  real ss__216_219_231
  real lntt__216_219_231
  real ee__216_219_231
  real pp__216_219_231
  real cs2__216_219_231
  real tt__216_219_231
  real rho_216_219_231
  real eth_216_219_231
  real lnrho__217_219_231
  real ss__217_219_231
  real lntt__217_219_231
  real ee__217_219_231
  real pp__217_219_231
  real cs2__217_219_231
  real tt__217_219_231
  real rho_217_219_231
  real eth_217_219_231
  real lnrho__218_219_231
  real ss__218_219_231
  real lntt__218_219_231
  real ee__218_219_231
  real pp__218_219_231
  real cs2__218_219_231
  real tt__218_219_231
  real rho_218_219_231
  real eth_218_219_231
  real scl_221_231
  real f_target_230_231
  real lnrho_init_230_231
  real ss_init_230_231
  real rho_init_230_231
  real3 ujiaj_280
  real3 gua_280
  real3 ajiuj_280
  real3 aa_xyaver_280
  real3 geta_280
  real3 uxb_upw_280
  real3 tmp2_280
  real3 dadt_280
  real3 gradeta_shock_280
  real3 aa1_280
  real3 uu1_280
  Matrix d_sld_flux_280
  real ftot_280
  real datot_280
  real peta_shock_280
  real sign_jo_280
  real tmp1_280
  real eta_mn_280
  real etass_280
  real eta_heat_280
  real vdrift_280
  real va2max_beta_280
  real del2aa_ini_280
  real tanhx2_280
  real advec_hall_280
  real advec_hypermesh_aa_280
  real eta_bb_280
  real prof_280
  real3 b_ext_280
  real tmp_280
  real eta_out1_280
  real cosalp_280
  real sinalp_280
  real hall_term__280
  const omegass_280 = 1.0
  int i_280
  int j_280
  int k_280
  int ju_280
  int ix_280
  int nphi_280
  const nxy_280 = AC_nxgrid__mod__cparam*AC_nygrid__mod__cparam
  real c_242_280
  real s_242_280
  real zprof_242_280
  real zder_242_280
  real zpostop_242_280
  real zposbot_242_280
  real step_scalar_return_value_70_242_280
  real step_scalar_return_value_71_242_280
  real arg_72_242_280
  real der_step_return_value_72_242_280
  real arg_73_242_280
  real der_step_return_value_73_242_280
  real step_vector_return_value_243_280
  real step_vector_return_value_243_280
  int l_254_280
  real tmp1_254_280
  real tmp2_254_280
  real prof0_254_280
  real prof1_254_280
  real derprof0_254_280
  real derprof1_254_280
  real step_vector_return_value_244_254_280
  real step_vector_return_value_244_254_280
  real arg_245_254_280
  real der_step_return_value_245_254_280
  real step_vector_return_value_246_254_280
  real step_vector_return_value_246_254_280
  real step_vector_return_value_247_254_280
  real step_vector_return_value_247_254_280
  real arg_248_254_280
  real der_step_return_value_248_254_280
  real arg_249_254_280
  real der_step_return_value_249_254_280
  real step_vector_return_value_250_254_280
  real step_vector_return_value_250_254_280
  real step_vector_return_value_251_254_280
  real step_vector_return_value_251_254_280
  real arg_252_254_280
  real der_step_return_value_252_254_280
  real arg_253_254_280
  real der_step_return_value_253_254_280
  real tmp_255_280
  int i_255_280
  int k1_255_280
  real prof_264_280
  real eta_r_264_280
  real d_int_264_280
  real d_ext_264_280
  real step_vector_return_value_256_264_280
  real step_vector_return_value_256_264_280
  real step_vector_return_value_257_264_280
  real step_vector_return_value_257_264_280
  real arg_258_264_280
  real der_step_return_value_258_264_280
  real arg_259_264_280
  real der_step_return_value_259_264_280
  real step_vector_return_value_260_264_280
  real step_vector_return_value_260_264_280
  real step_vector_return_value_261_264_280
  real step_vector_return_value_261_264_280
  real arg_262_264_280
  real der_step_return_value_262_264_280
  real arg_263_264_280
  real der_step_return_value_263_264_280
  real step_vector_return_value_265_280
  real step_vector_return_value_265_280
  real arg_266_280
  real der_step_return_value_266_280
  real step_vector_return_value_267_280
  real step_vector_return_value_267_280
  real arg_268_280
  real der_step_return_value_268_280
  real cubic_step_pt_return_value_270_280
  real xi_270_280
  real relshift_270_280
  real cubic_step_pt_return_value_270_280
  real del6f_upwind_271_280
  int msk_271_280
  real dumerfc_272_280
  real t_272_280
  real z_272_280
  real erfunc_return_value_272_280
  real scl_274_280
  int j_274_280
  real3 f_target_278_280
  int ju_278_280
  int j_278_280
  int k_293
  real3 gg_293
  real refac_293
  real dt1_max_loc_306
  real dt1_advec_306
  real dt1_diffus_306
  real dt1_src_306
  real dt1_preac_306
  if (AC_lanelastic__mod__cparam) {
    df_iuu_pencil = DF_UVEC
    DF_UVEC=0.0
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata && (!AC_ldt_paronly__mod__cdata)) {
    advec_cs2__mod__cdata=0.0
    maxadvec__mod__cdata=0.
    if (AC_lenergy__mod__cparam || AC_ldensity__mod__cparam || AC_lmagnetic__mod__cparam || AC_lradiation__mod__cparam || AC_lneutralvelocity__mod__cparam || AC_lcosmicray__mod__cparam ||   (AC_ltestfield_z__mod__cparam && AC_iuutest__mod__cdata>0)) {
      advec2__mod__cdata=0.
    }
    if (AC_ldensity__mod__cparam || AC_lviscosity__mod__cparam || AC_lmagnetic__mod__cparam || AC_lenergy__mod__cparam || AC_ldustvelocity__mod__cparam || AC_ldustdensity__mod__cparam) {
      advec2_hypermesh__mod__cdata=0.0
    }
    maxdiffus__mod__cdata=0.
    maxdiffus2__mod__cdata=0.
    maxdiffus3__mod__cdata=0.
    maxsrc__mod__cdata=0.
  }
  if (! AC_lcartesian_coords__mod__cdata  ||  !all(AC_lequidist__mod__cdata)) {
    if (AC_lspherical_coords__mod__cdata) {
      dline_1__mod__cdata.x = AC_dx_1__mod__cdata[vertexIdx.x]
      dline_1__mod__cdata.y = AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL] * AC_dy_1__mod__cdata[AC_m__mod__cdata-1]
      dline_1__mod__cdata.z = AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL] * AC_sin1th__mod__cdata[AC_m__mod__cdata-1] * AC_dz_1__mod__cdata[AC_n__mod__cdata-1]
    }
    else if (AC_lcylindrical_coords__mod__cdata) {
      dline_1__mod__cdata.x = AC_dx_1__mod__cdata[vertexIdx.x]
      dline_1__mod__cdata.y = AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL] * AC_dy_1__mod__cdata[AC_m__mod__cdata-1]
      dline_1__mod__cdata.z = AC_dz_1__mod__cdata[AC_n__mod__cdata-1]
    }
    else if (AC_lcartesian_coords__mod__cdata) {
      dline_1__mod__cdata.x = AC_dx_1__mod__cdata[vertexIdx.x]
      dline_1__mod__cdata.y = AC_dy_1__mod__cdata[AC_m__mod__cdata-1]
      dline_1__mod__cdata.z = AC_dz_1__mod__cdata[AC_n__mod__cdata-1]
    }
    else if (AC_lpipe_coords__mod__cdata) {
      dline_1__mod__cdata.x = AC_dx_1__mod__cdata[vertexIdx.x]
      dline_1__mod__cdata.y = AC_dy_1__mod__cdata[AC_m__mod__cdata-1]
      dline_1__mod__cdata.z = AC_dz_1__mod__cdata[AC_n__mod__cdata-1]
    }
    dxmax_pencil__mod__cdata = 0.
    if (AC_nxgrid__mod__cparam != 1) {
      dxmax_pencil__mod__cdata =     1.0 / dline_1__mod__cdata.x
    }
    if (AC_nygrid__mod__cparam != 1) {
      dxmax_pencil__mod__cdata = max(1.0 / dline_1__mod__cdata.y, dxmax_pencil__mod__cdata)
    }
    if (AC_nzgrid__mod__cparam != 1) {
      dxmax_pencil__mod__cdata = max(1.0 / dline_1__mod__cdata.z, dxmax_pencil__mod__cdata)
    }
    dxmin_pencil__mod__cdata = 0.
    if (AC_nxgrid__mod__cparam != 1) {
      dxmin_pencil__mod__cdata =     1.0 / dline_1__mod__cdata.x
    }
    if (AC_nygrid__mod__cparam != 1) {
      dxmin_pencil__mod__cdata = min(1.0 / dline_1__mod__cdata.y, dxmin_pencil__mod__cdata)
    }
    if (AC_nzgrid__mod__cparam != 1) {
      dxmin_pencil__mod__cdata = min(1.0 / dline_1__mod__cdata.z, dxmin_pencil__mod__cdata)
    }
    if (AC_lmaximal_cdtv__mod__cdata) {
      dxyz_2__mod__cdata = max(dline_1__mod__cdata.x*dline_1__mod__cdata.x, dline_1__mod__cdata.y*dline_1__mod__cdata.y, dline_1__mod__cdata.z*dline_1__mod__cdata.z)
      dxyz_4__mod__cdata = max(dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x, dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y, dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)
      dxyz_6__mod__cdata = max(dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x, dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y, dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)
    }
    else {
      dxyz_2__mod__cdata = dline_1__mod__cdata.x*dline_1__mod__cdata.x + dline_1__mod__cdata.y*dline_1__mod__cdata.y + dline_1__mod__cdata.z*dline_1__mod__cdata.z
      dxyz_4__mod__cdata = dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x + dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y + dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z
      dxyz_6__mod__cdata = dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x + dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y + dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z
    }
    dvol__mod__cdata = AC_dvol_x__mod__cdata[vertexIdx.x]*AC_dvol_y__mod__cdata[AC_m__mod__cdata-1]*AC_dvol_z__mod__cdata[AC_n__mod__cdata-1]
  }
  if (AC_lcartesian_coords__mod__cdata) {
    if (AC_lpencil__mod__cdata[AC_i_x_mn__mod__cparam-1]) {
      ac_transformed_pencil_x_mn    = AC_x__mod__cdata[vertexIdx.x]
    }
    if (AC_lpencil__mod__cdata[AC_i_y_mn__mod__cparam-1]) {
      ac_transformed_pencil_y_mn    = AC_y__mod__cdata[AC_m__mod__cdata-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_z_mn__mod__cparam-1]) {
      ac_transformed_pencil_z_mn    = AC_z__mod__cdata[AC_n__mod__cdata-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_r_mn__mod__cparam-1]) {
      ac_transformed_pencil_r_mn    = sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_rcyl_mn__mod__cparam-1]) {
      ac_transformed_pencil_rcyl_mn = sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_phi_mn__mod__cparam-1]) {
      ac_transformed_pencil_phi_mn  = atan2(AC_y__mod__cdata[AC_m__mod__cdata-1],AC_x__mod__cdata[vertexIdx.x])
    }
    if (AC_lpencil__mod__cdata[AC_i_rcyl_mn1__mod__cparam-1]) {
      ac_transformed_pencil_rcyl_mn1=1./max(ac_transformed_pencil_rcyl_mn,AC_tini__mod__cparam)
    }
    if (AC_lpencil__mod__cdata[AC_i_r_mn1__mod__cparam-1]) {
      ac_transformed_pencil_r_mn1   =1./max(ac_transformed_pencil_r_mn,AC_tini__mod__cparam)
    }
    if (AC_lpencil__mod__cdata[AC_i_pomx__mod__cparam-1]) {
      ac_transformed_pencil_pomx    = AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_rcyl_mn1
    }
    if (AC_lpencil__mod__cdata[AC_i_pomy__mod__cparam-1]) {
      ac_transformed_pencil_pomy    = AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_rcyl_mn1
    }
    if (AC_lpencil__mod__cdata[AC_i_phix__mod__cparam-1]) {
      ac_transformed_pencil_phix    =-AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_rcyl_mn1
    }
    if (AC_lpencil__mod__cdata[AC_i_phiy__mod__cparam-1]) {
      ac_transformed_pencil_phiy    = AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_rcyl_mn1
    }
  }
  else if (AC_lcylindrical_coords__mod__cdata) {
    if (AC_lpencil__mod__cdata[AC_i_x_mn__mod__cparam-1]) {
      ac_transformed_pencil_x_mn    = AC_x__mod__cdata[vertexIdx.x]*cos(AC_y__mod__cdata[AC_m__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_y_mn__mod__cparam-1]) {
      ac_transformed_pencil_y_mn    = AC_x__mod__cdata[vertexIdx.x]*sin(AC_y__mod__cdata[AC_m__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_z_mn__mod__cparam-1]) {
      ac_transformed_pencil_z_mn    = AC_z__mod__cdata[AC_n__mod__cdata-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_r_mn__mod__cparam-1]) {
      ac_transformed_pencil_r_mn    = sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_rcyl_mn__mod__cparam-1]) {
      ac_transformed_pencil_rcyl_mn = AC_x__mod__cdata[vertexIdx.x]
    }
    if (AC_lpencil__mod__cdata[AC_i_phi_mn__mod__cparam-1]) {
      ac_transformed_pencil_phi_mn  = AC_y__mod__cdata[AC_m__mod__cdata-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_rcyl_mn1__mod__cparam-1]) {
      ac_transformed_pencil_rcyl_mn1=1./max(ac_transformed_pencil_rcyl_mn,AC_tini__mod__cparam)
    }
    if (AC_lpencil__mod__cdata[AC_i_r_mn1__mod__cparam-1]) {
      ac_transformed_pencil_r_mn1   =1./max(ac_transformed_pencil_r_mn,AC_tini__mod__cparam)
    }
    if (AC_lpencil__mod__cdata[AC_i_pomx__mod__cparam-1]) {
      ac_transformed_pencil_pomx    = 1.
    }
    if (AC_lpencil__mod__cdata[AC_i_pomy__mod__cparam-1]) {
      ac_transformed_pencil_pomy    = 0.
    }
    if (AC_lpencil__mod__cdata[AC_i_phix__mod__cparam-1]) {
      ac_transformed_pencil_phix    = 0.
    }
    if (AC_lpencil__mod__cdata[AC_i_phiy__mod__cparam-1]) {
      ac_transformed_pencil_phiy    = 1.
    }
  }
  else if (AC_lspherical_coords__mod__cdata) {
    if (AC_lpencil__mod__cdata[AC_i_x_mn__mod__cparam-1]) {
      ac_transformed_pencil_x_mn    = AC_x__mod__cdata[vertexIdx.x]*sin(AC_y__mod__cdata[AC_m__mod__cdata-1])*cos(AC_z__mod__cdata[AC_n__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_y_mn__mod__cparam-1]) {
      ac_transformed_pencil_y_mn    = AC_x__mod__cdata[vertexIdx.x]*sin(AC_y__mod__cdata[AC_m__mod__cdata-1])*sin(AC_z__mod__cdata[AC_n__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_z_mn__mod__cparam-1]) {
      ac_transformed_pencil_z_mn    = AC_x__mod__cdata[vertexIdx.x]*cos(AC_y__mod__cdata[AC_m__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_r_mn__mod__cparam-1]) {
      ac_transformed_pencil_r_mn    = AC_x__mod__cdata[vertexIdx.x]
    }
    if (AC_lpencil__mod__cdata[AC_i_rcyl_mn__mod__cparam-1]) {
      ac_transformed_pencil_rcyl_mn = AC_x__mod__cdata[vertexIdx.x]*sin(AC_y__mod__cdata[AC_m__mod__cdata-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_phi_mn__mod__cparam-1]) {
      ac_transformed_pencil_phi_mn  = AC_z__mod__cdata[AC_n__mod__cdata-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_rcyl_mn1__mod__cparam-1]) {
      ac_transformed_pencil_rcyl_mn1=1./max(ac_transformed_pencil_rcyl_mn,AC_tini__mod__cparam)
    }
    if (AC_lpencil__mod__cdata[AC_i_r_mn1__mod__cparam-1]) {
      ac_transformed_pencil_r_mn1   =1./max(ac_transformed_pencil_r_mn,AC_tini__mod__cparam)
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_rr__mod__cparam-1]) {
    if (AC_lcartesian_coords__mod__cdata) {
      ac_transformed_pencil_rr.x=ac_transformed_pencil_x_mn
      ac_transformed_pencil_rr.y=ac_transformed_pencil_y_mn
      ac_transformed_pencil_rr.z=ac_transformed_pencil_z_mn
    }
    else {
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_evr__mod__cparam-1]) {
    if (AC_lcartesian_coords__mod__cdata) {
      ac_transformed_pencil_evr.x = ac_transformed_pencil_rcyl_mn*ac_transformed_pencil_r_mn1*ac_transformed_pencil_pomx
      ac_transformed_pencil_evr.y = ac_transformed_pencil_rcyl_mn*ac_transformed_pencil_r_mn1*ac_transformed_pencil_pomy
      ac_transformed_pencil_evr.z = AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1
    }
    else {
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_evth__mod__cparam-1]) {
    if (AC_lcartesian_coords__mod__cdata) {
      ac_transformed_pencil_evth.x = AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1*ac_transformed_pencil_pomx
      ac_transformed_pencil_evth.y = AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1*ac_transformed_pencil_pomy
      ac_transformed_pencil_evth.z = -ac_transformed_pencil_rcyl_mn*ac_transformed_pencil_r_mn1
    }
    else {
    }
  }
  if (AC_llinearized_hydro__mod__hydro) {
    if (AC_lpencil__mod__cdata[AC_i_uu__mod__cparam-1]) {
      ac_transformed_pencil_uu=value(F_UVEC)
    }
    if (AC_lpencil__mod__cdata[AC_i_uu0__mod__cparam-1]) {
      ac_transformed_pencil_uu0=value(F_U0VEC)
    }
    if (AC_lpencil__mod__cdata[AC_i_uij__mod__cparam-1]) {
      ac_transformed_pencil_uij = gradient_tensor((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_u0ij__mod__cparam-1]) {
      ac_transformed_pencil_u0ij = gradient_tensor((Field3){Field(AC_iuu0__mod__cdata-1), Field(AC_iuu0__mod__cdata), Field(AC_iuu0__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_divu__mod__cparam-1]) {
      ac_transformed_pencil_divu = divergence(ac_transformed_pencil_uij)
    }
    if (AC_lpencil__mod__cdata[AC_i_divu0__mod__cparam-1]) {
      ac_transformed_pencil_divu0 = divergence(ac_transformed_pencil_u0ij)
    }
    if (AC_lpencil__mod__cdata[AC_i_sij__mod__cparam-1]) {
      ac_transformed_pencil_sij = traceless_strain(ac_transformed_pencil_uij,ac_transformed_pencil_divu)
      if (AC_lshear__mod__cparam  &&  AC_lshear_rateofstrain__mod__hydro) {
        ac_transformed_pencil_sij[1-1][2-1] = ac_transformed_pencil_sij[1-1][2-1] + AC_sshear__mod__cdata
        ac_transformed_pencil_sij[2-1][1-1] = ac_transformed_pencil_sij[2-1][1-1] + AC_sshear__mod__cdata
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_oo__mod__cparam-1]) {
      ac_transformed_pencil_oo=curl(ac_transformed_pencil_uij)
    }
    if (AC_lpencil__mod__cdata[AC_i_ugu__mod__cparam-1]) {
      ac_transformed_pencil_ugu = ugu0_4_14_15_100+u0gu_4_14_15_100
    }
    if (AC_lpencil__mod__cdata[AC_i_del4u__mod__cparam-1]) {
      ac_transformed_pencil_del4u = del4((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_del6u__mod__cparam-1]) {
      ac_transformed_pencil_del6u = del6((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_del6u_strict__mod__cparam-1]) {
      ac_transformed_pencil_del6u_strict = del6_strict((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_del4graddivu__mod__cparam-1]) {
      not_implemented("del4graddiv")
    }
    if (AC_lpencil__mod__cdata[AC_i_del6u_bulk__mod__cparam-1]) {
      tmp_4_14_15_100 = der6x(Field(AC_iux__mod__cdata-1))
      ac_transformed_pencil_del6u_bulk.x=tmp_4_14_15_100
      tmp_4_14_15_100 = der6y(Field(AC_iuy__mod__cdata-1))
      ac_transformed_pencil_del6u_bulk.y=tmp_4_14_15_100
      tmp_4_14_15_100 = der6z(Field(AC_iuz__mod__cdata-1))
      ac_transformed_pencil_del6u_bulk.z=tmp_4_14_15_100
    }
    if (!AC_lcartesian_coords__mod__cdata || AC_lalways_use_gij_etc__mod__hydro) {
      if (AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1]) {
        ac_transformed_pencil_oij = bij((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1]) {
        ac_transformed_pencil_curlo=curl(ac_transformed_pencil_oij)
        ac_transformed_pencil_del2u=ac_transformed_pencil_graddivu-ac_transformed_pencil_curlo
      }
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1]) {
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_d2uidxj__mod__cparam-1]) {
      ac_transformed_pencil_d2uidxj = d2fi_dxj((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_uijk__mod__cparam-1]) {
      ac_transformed_pencil_uijk = del2fi_dxjk((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_grad5divu__mod__cparam-1]) {
      tmp_4_14_15_100=0.0
      ju_4_14_15_100=AC_iuu__mod__cdata+1-1
      tmp2_4_14_15_100 = der6x(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ju_4_14_15_100=AC_iuu__mod__cdata+2-1
      tmp2_4_14_15_100 = der5x1y(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ju_4_14_15_100=AC_iuu__mod__cdata+3-1
      tmp2_4_14_15_100 = der5x1z(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ac_transformed_pencil_grad5divu.x=tmp_4_14_15_100
      tmp_4_14_15_100=0.0
      ju_4_14_15_100=AC_iuu__mod__cdata+1-1
      tmp2_4_14_15_100 = der5y1x(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ju_4_14_15_100=AC_iuu__mod__cdata+2-1
      tmp2_4_14_15_100 = der6y(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ju_4_14_15_100=AC_iuu__mod__cdata+3-1
      tmp2_4_14_15_100 = der5y1z(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ac_transformed_pencil_grad5divu.y=tmp_4_14_15_100
      tmp_4_14_15_100=0.0
      ju_4_14_15_100=AC_iuu__mod__cdata+1-1
      tmp2_4_14_15_100 = der5z1x(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ju_4_14_15_100=AC_iuu__mod__cdata+2-1
      tmp2_4_14_15_100 = der5z1y(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ju_4_14_15_100=AC_iuu__mod__cdata+3-1
      tmp2_4_14_15_100 = der6z(Field(ju_4_14_15_100-1))
      tmp_4_14_15_100=tmp_4_14_15_100+tmp2_4_14_15_100
      ac_transformed_pencil_grad5divu.z=tmp_4_14_15_100
    }
  }
  else {
    if (AC_lpencil__mod__cdata[AC_i_uu__mod__cparam-1]) {
      if (AC_lconservative__mod__hydro) {
        tmp3_13_14_15_100=value(F_UVEC)
        if (AC_lrelativistic__mod__hydro) {
          cs201_13_14_15_100=AC_cs20__mod__equationofstate+1.
          tmp_rho_13_14_15_100=value(Field(AC_irho__mod__cdata-1))
          if (!AC_lhiggsless_old__mod__hydro && AC_lhiggsless__mod__hydro) {
            if(AC_t__mod__cdata < value(Field(AC_ihless__mod__hydro-1))) {
              tmp_rho_13_14_15_100=tmp_rho_13_14_15_100-AC_eps_hless__mod__hydro
            }
          }
          if (AC_lmagnetic__mod__cparam) {
            if (AC_full_3d__mod__hydro) {
              dd_13_14_15_100=(value(Field(AC_irho__mod__cdata-1))-0.5*AC_b_ext2__mod__magnetic)/(1.-0.25/value(Field(AC_ilorentz__mod__cdata-1)))+AC_b_ext2__mod__magnetic
              bx_5_13_14_15_100=ac_transformed_pencil_bb.x
              by_5_13_14_15_100=ac_transformed_pencil_bb.y
              bz_5_13_14_15_100=ac_transformed_pencil_bb.z
              bx2_5_13_14_15_100=bx_5_13_14_15_100*bx_5_13_14_15_100
              by2_5_13_14_15_100=by_5_13_14_15_100*by_5_13_14_15_100
              bz2_5_13_14_15_100=bz_5_13_14_15_100*bz_5_13_14_15_100
              detm1_5_13_14_15_100=1./(dd_13_14_15_100*dd_13_14_15_100*dd_13_14_15_100-dd_13_14_15_100*dd_13_14_15_100*(bx2_5_13_14_15_100+by2_5_13_14_15_100+bz2_5_13_14_15_100)+4.*bx2_5_13_14_15_100*by2_5_13_14_15_100*bz2_5_13_14_15_100)
              tmp33_13_14_15_100[1-1][1-1]=detm1_5_13_14_15_100*dd_13_14_15_100*(dd_13_14_15_100-by2_5_13_14_15_100-bz2_5_13_14_15_100)
              tmp33_13_14_15_100[2-1][2-1]=detm1_5_13_14_15_100*dd_13_14_15_100*(dd_13_14_15_100-bz2_5_13_14_15_100-bx2_5_13_14_15_100)
              tmp33_13_14_15_100[3-1][3-1]=detm1_5_13_14_15_100*dd_13_14_15_100*(dd_13_14_15_100-bx2_5_13_14_15_100-by2_5_13_14_15_100)
              tmp33_13_14_15_100[1-1][2-1]=detm1_5_13_14_15_100*bx_5_13_14_15_100*by_5_13_14_15_100*(2.*bz2_5_13_14_15_100-dd_13_14_15_100)
              tmp33_13_14_15_100[2-1][3-1]=detm1_5_13_14_15_100*by_5_13_14_15_100*bz_5_13_14_15_100*(2.*bx2_5_13_14_15_100-dd_13_14_15_100)
              tmp33_13_14_15_100[3-1][1-1]=detm1_5_13_14_15_100*bz_5_13_14_15_100*bx_5_13_14_15_100*(2.*by2_5_13_14_15_100-dd_13_14_15_100)
              tmp33_13_14_15_100[2-1][1-1]=tmp33_13_14_15_100[1-1][2-1]
              tmp33_13_14_15_100[3-1][2-1]=tmp33_13_14_15_100[2-1][3-1]
              tmp33_13_14_15_100[1-1][3-1]=tmp33_13_14_15_100[3-1][1-1]
              ac_transformed_pencil_uu = tmp33_13_14_15_100*tmp3_13_14_15_100
            }
            else {
              tmp_13_14_15_100=1./((value(Field(AC_irho__mod__cdata-1))-0.5*AC_b_ext2__mod__magnetic)/(1.-0.25/value(Field(AC_ilorentz__mod__cdata-1)))+AC_b_ext2__mod__magnetic)
              ac_transformed_pencil_uu = tmp_13_14_15_100*tmp3_13_14_15_100
            }
          }
          else {
            tmp_13_14_15_100=1./(tmp_rho_13_14_15_100/(1.-0.25/value(Field(AC_ilorentz__mod__cdata-1))))
            ac_transformed_pencil_uu = tmp_13_14_15_100*tmp3_13_14_15_100
          }
        }
        else {
          ac_transformed_pencil_rho1=1./value(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_uu = ac_transformed_pencil_rho1*tmp3_13_14_15_100
        }
      }
      else {
        ac_transformed_pencil_uu=value(F_UVEC)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_u2__mod__cparam-1]) {
      ac_transformed_pencil_u2 = dot(ac_transformed_pencil_uu,ac_transformed_pencil_uu)
    }
    if (AC_lpencil__mod__cdata[AC_i_uij__mod__cparam-1]) {
      if (AC_lvv_as_aux__mod__hydro  ||  AC_lvv_as_comaux__mod__hydro) {
        ac_transformed_pencil_uij = gradient_tensor((Field3){Field(AC_ivv__mod__cdata-1), Field(AC_ivv__mod__cdata), Field(AC_ivv__mod__cdata+1)})
      }
      else {
        ac_transformed_pencil_uij = gradient_tensor((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      if (AC_lgradu_as_aux__mod__hydro  ||  AC_lparticles_lyapunov__mod__cparam  ||  AC_lparticles_caustics__mod__cparam  ||  AC_lparticles_tetrad__mod__cparam) {
        DF_GU11 = ac_transformed_pencil_uij[1-1][1-1]
        DF_GU12 = ac_transformed_pencil_uij[1-1][2-1]
        DF_GU13 = ac_transformed_pencil_uij[1-1][3-1]
        DF_GU21 = ac_transformed_pencil_uij[2-1][1-1]
        DF_GU22 = ac_transformed_pencil_uij[2-1][2-1]
        DF_GU23 = ac_transformed_pencil_uij[2-1][3-1]
        DF_GU31 = ac_transformed_pencil_uij[3-1][1-1]
        DF_GU32 = ac_transformed_pencil_uij[3-1][2-1]
        DF_GU33 = ac_transformed_pencil_uij[3-1][3-1]
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_divu__mod__cparam-1]) {
      ac_transformed_pencil_divu = divergence(ac_transformed_pencil_uij)
    }
    if (AC_lpencil__mod__cdata[AC_i_sij__mod__cparam-1]) {
      ac_transformed_pencil_sij = traceless_strain(ac_transformed_pencil_uij,ac_transformed_pencil_divu)
      if (AC_lshear__mod__cparam  &&  AC_lshear_rateofstrain__mod__hydro) {
        ac_transformed_pencil_sij[1-1][2-1] = ac_transformed_pencil_sij[1-1][2-1] + AC_sshear__mod__cdata
        ac_transformed_pencil_sij[2-1][1-1] = ac_transformed_pencil_sij[2-1][1-1] + AC_sshear__mod__cdata
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_sij2__mod__cparam-1]) {
      ac_transformed_pencil_sij2 = multm2_sym(ac_transformed_pencil_sij)
    }
    if (AC_lpencil__mod__cdata[AC_i_uij5__mod__cparam-1]) {
      ac_transformed_pencil_uij5 = gradient5((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_oo__mod__cparam-1]) {
      if (AC_ioo__mod__cdata != 0) {
        ac_transformed_pencil_oo = value(F_OVEC)
      }
      else {
        ac_transformed_pencil_oo=curl(ac_transformed_pencil_uij)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_o2__mod__cparam-1]) {
      ac_transformed_pencil_o2 = dot(ac_transformed_pencil_oo,ac_transformed_pencil_oo)
    }
    if (AC_lpencil__mod__cdata[AC_i_ou__mod__cparam-1]) {
      ac_transformed_pencil_ou = dot(ac_transformed_pencil_oo,ac_transformed_pencil_uu)
    }
    if (AC_lpencil__mod__cdata[AC_i_oxu__mod__cparam-1]) {
      ac_transformed_pencil_oxu = cross(ac_transformed_pencil_oo,ac_transformed_pencil_uu)
    }
    if (AC_lpencil__mod__cdata[AC_i_oxu2__mod__cparam-1]) {
      ac_transformed_pencil_oxu2 = dot(ac_transformed_pencil_oxu,ac_transformed_pencil_oxu)
    }
    if (AC_lpencil__mod__cdata[AC_i_ugu__mod__cparam-1]) {
      ac_transformed_pencil_ugu = ac_transformed_pencil_uij*ac_transformed_pencil_uu
      if (AC_lupw_uu__mod__hydro) ac_transformed_pencil_ugu = ac_transformed_pencil_ugu + del6_upwd((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      if (AC_ldensity__mod__cparam) {
        if (AC_lffree__mod__density) {
          tmp_13_14_15_100=AC_profx_ffree__mod__density[vertexIdx.x-NGHOST_VAL]*AC_profy_ffree__mod__density[AC_m__mod__cdata-1]*AC_profz_ffree__mod__density[AC_n__mod__cdata-1]
          ac_transformed_pencil_ugu.x=ac_transformed_pencil_ugu.x*tmp_13_14_15_100
          ac_transformed_pencil_ugu.y=ac_transformed_pencil_ugu.y*tmp_13_14_15_100
          ac_transformed_pencil_ugu.z=ac_transformed_pencil_ugu.z*tmp_13_14_15_100
        }
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_ugu2__mod__cparam-1]) {
      ac_transformed_pencil_ugu2 = dot(ac_transformed_pencil_ugu,ac_transformed_pencil_ugu)
    }
    if (AC_lpencil__mod__cdata[AC_i_ogu__mod__cparam-1]) {
      ac_transformed_pencil_ogu = ac_transformed_pencil_uij*ac_transformed_pencil_oo
      if (AC_lupw_uu__mod__hydro) ac_transformed_pencil_ogu = ac_transformed_pencil_ogu + del6_upwd((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_u3u21__mod__cparam-1]) {
      ac_transformed_pencil_u3u21=ac_transformed_pencil_uu.z*ac_transformed_pencil_uij[2-1][1-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_u1u32__mod__cparam-1]) {
      ac_transformed_pencil_u1u32=ac_transformed_pencil_uu.x*ac_transformed_pencil_uij[3-1][2-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_u2u13__mod__cparam-1]) {
      ac_transformed_pencil_u2u13=ac_transformed_pencil_uu.y*ac_transformed_pencil_uij[1-1][3-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_u2u31__mod__cparam-1]) {
      ac_transformed_pencil_u2u31=ac_transformed_pencil_uu.y*ac_transformed_pencil_uij[3-1][1-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_u3u12__mod__cparam-1]) {
      ac_transformed_pencil_u3u12=ac_transformed_pencil_uu.z*ac_transformed_pencil_uij[1-1][2-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_u1u23__mod__cparam-1]) {
      ac_transformed_pencil_u1u23=ac_transformed_pencil_uu.x*ac_transformed_pencil_uij[2-1][3-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_del4u__mod__cparam-1]) {
      ac_transformed_pencil_del4u = del4((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_del6u__mod__cparam-1]) {
      ac_transformed_pencil_del6u = del6((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_del6u_strict__mod__cparam-1]) {
      ac_transformed_pencil_del6u_strict = del6_strict((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_del4graddivu__mod__cparam-1]) {
      not_implemented("del4graddiv")
    }
    if (AC_lpencil__mod__cdata[AC_i_del6u_bulk__mod__cparam-1]) {
      ac_transformed_pencil_del6u_bulk.x = der6x(Field(AC_iux__mod__cdata-1))
      ac_transformed_pencil_del6u_bulk.y = der6y(Field(AC_iuy__mod__cdata-1))
      ac_transformed_pencil_del6u_bulk.z = der6z(Field(AC_iuz__mod__cdata-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_der6u_res__mod__cparam-1]) {
      ju_13_14_15_100=1+AC_iuu__mod__cdata-1
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 1==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 1==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[1-1][1-1] = der6x_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 2==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 2==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[2-1][1-1] = der6y_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 3==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 3==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[3-1][1-1] = der6z_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      ju_13_14_15_100=2+AC_iuu__mod__cdata-1
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 1==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 1==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[1-1][2-1] = der6x_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 2==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 2==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[2-1][2-1] = der6y_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 3==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 3==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[3-1][2-1] = der6z_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      ju_13_14_15_100=3+AC_iuu__mod__cdata-1
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 1==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 1==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[1-1][3-1] = der6x_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 2==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 2==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[2-1][3-1] = der6y_ignore_spacing(Field(ju_13_14_15_100-1))
      }
      if (AC_lcylindrical_coords__mod__cdata && ju_13_14_15_100==AC_iuy__mod__cdata && 3==1) {
        print("not implemented der6_pencil")
      }
      else if (AC_lspherical_coords__mod__cdata && ju_13_14_15_100==AC_iuz__mod__cdata && 3==1) {
        print("not implemented der6_pencil")
      }
      else {
        ac_transformed_pencil_der6u_res[3-1][3-1] = der6z_ignore_spacing(Field(ju_13_14_15_100-1))
      }
    }
    if (!AC_lcartesian_coords__mod__cdata || AC_lalways_use_gij_etc__mod__hydro) {
      if (AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1]) {
        ac_transformed_pencil_oij = bij((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1]) {
        ac_transformed_pencil_curlo=curl(ac_transformed_pencil_oij)
        ac_transformed_pencil_del2u=ac_transformed_pencil_graddivu-ac_transformed_pencil_curlo
      }
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_del2u__mod__cparam-1]) {
        ac_transformed_pencil_del2u = laplace((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_graddivu__mod__cparam-1]) {
        ac_transformed_pencil_graddivu = gradient_of_divergence((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
      else if (AC_lpencil__mod__cdata[AC_i_curlo__mod__cparam-1]) {
        ac_transformed_pencil_curlo = curlcurl((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_d2uidxj__mod__cparam-1]) {
      ac_transformed_pencil_d2uidxj = d2fi_dxj((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_uijk__mod__cparam-1]) {
      ac_transformed_pencil_uijk = del2fi_dxjk((Field3){Field(AC_iuu__mod__cdata-1), Field(AC_iuu__mod__cdata), Field(AC_iuu__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_grad5divu__mod__cparam-1]) {
      ac_transformed_pencil_grad5divu.x = 0.0
      ju_13_14_15_100=AC_iuu__mod__cdata+1-1
      tmp_13_14_15_100 = der6x(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.x = ac_transformed_pencil_grad5divu.x + tmp_13_14_15_100
      ju_13_14_15_100=AC_iuu__mod__cdata+2-1
      tmp_13_14_15_100 = der5x1y(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.x = ac_transformed_pencil_grad5divu.x + tmp_13_14_15_100
      ju_13_14_15_100=AC_iuu__mod__cdata+3-1
      tmp_13_14_15_100 = der5x1z(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.x = ac_transformed_pencil_grad5divu.x + tmp_13_14_15_100
      ac_transformed_pencil_grad5divu.y = 0.0
      ju_13_14_15_100=AC_iuu__mod__cdata+1-1
      tmp_13_14_15_100 = der5y1x(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.y = ac_transformed_pencil_grad5divu.y + tmp_13_14_15_100
      ju_13_14_15_100=AC_iuu__mod__cdata+2-1
      tmp_13_14_15_100 = der6y(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.y = ac_transformed_pencil_grad5divu.y + tmp_13_14_15_100
      ju_13_14_15_100=AC_iuu__mod__cdata+3-1
      tmp_13_14_15_100 = der5y1z(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.y = ac_transformed_pencil_grad5divu.y + tmp_13_14_15_100
      ac_transformed_pencil_grad5divu.z = 0.0
      ju_13_14_15_100=AC_iuu__mod__cdata+1-1
      tmp_13_14_15_100 = der5z1x(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.z = ac_transformed_pencil_grad5divu.z + tmp_13_14_15_100
      ju_13_14_15_100=AC_iuu__mod__cdata+2-1
      tmp_13_14_15_100 = der5z1y(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.z = ac_transformed_pencil_grad5divu.z + tmp_13_14_15_100
      ju_13_14_15_100=AC_iuu__mod__cdata+3-1
      tmp_13_14_15_100 = der6z(Field(ju_13_14_15_100-1))
      ac_transformed_pencil_grad5divu.z = ac_transformed_pencil_grad5divu.z + tmp_13_14_15_100
    }
    if (AC_lpencil__mod__cdata[AC_i_transpurho__mod__cparam-1] && AC_ldensity_nolog__mod__cdata) {
      if (AC_lreference_state__mod__cdata) {
        ac_transformed_pencil_transpurho.x = AC_impossible__mod__cparam
        ac_transformed_pencil_transpurho.y = AC_impossible__mod__cparam
        ac_transformed_pencil_transpurho.z = AC_impossible__mod__cparam
      }
      else {
        ac_transformed_pencil_transpurho.x = AC_impossible__mod__cparam
        ac_transformed_pencil_transpurho.y = AC_impossible__mod__cparam
        ac_transformed_pencil_transpurho.z = AC_impossible__mod__cparam
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_uu_advec__mod__cparam-1]) {
      ac_transformed_pencil_uu_advec.x=ac_transformed_pencil_uu.x
      if (AC_lcylindrical_coords__mod__cdata) {
        ac_transformed_pencil_uu_advec.y=ac_transformed_pencil_uu.y-AC_uu_average_cyl__mod__hydro[vertexIdx.x][AC_n__mod__cdata-1]
        ac_transformed_pencil_uu_advec.z=ac_transformed_pencil_uu.z
      }
      else if (AC_lspherical_coords__mod__cdata) {
        ac_transformed_pencil_uu_advec.y=ac_transformed_pencil_uu.y
        ac_transformed_pencil_uu_advec.z=ac_transformed_pencil_uu.z-AC_uu_average_sph__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1]
      }
      tmp3_13_14_15_100 = ac_transformed_pencil_uij.row(1-1)
      ac_transformed_pencil_uuadvec_guu.x = dot(ac_transformed_pencil_uu_advec,tmp3_13_14_15_100)
      tmp3_13_14_15_100 = ac_transformed_pencil_uij.row(2-1)
      ac_transformed_pencil_uuadvec_guu.y = dot(ac_transformed_pencil_uu_advec,tmp3_13_14_15_100)
      tmp3_13_14_15_100 = ac_transformed_pencil_uij.row(3-1)
      ac_transformed_pencil_uuadvec_guu.z = dot(ac_transformed_pencil_uu_advec,tmp3_13_14_15_100)
      if (AC_lcylindrical_coords__mod__cdata) {
        ac_transformed_pencil_uuadvec_guu.x=ac_transformed_pencil_uuadvec_guu.x-AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL]*ac_transformed_pencil_uu.y*ac_transformed_pencil_uu.y
        ac_transformed_pencil_uuadvec_guu.y=ac_transformed_pencil_uuadvec_guu.y+AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL]*ac_transformed_pencil_uu.y*ac_transformed_pencil_uu.x
      }
      else if (AC_lspherical_coords__mod__cdata) {
        ac_transformed_pencil_uuadvec_guu.x=ac_transformed_pencil_uuadvec_guu.x-AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_uu.y*ac_transformed_pencil_uu.y+ac_transformed_pencil_uu.z*ac_transformed_pencil_uu.z)
        ac_transformed_pencil_uuadvec_guu.y=ac_transformed_pencil_uuadvec_guu.y+AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_uu.y*ac_transformed_pencil_uu.x-ac_transformed_pencil_uu.z*ac_transformed_pencil_uu.z*AC_cotth__mod__cdata[AC_m__mod__cdata-1])
        ac_transformed_pencil_uuadvec_guu.z=ac_transformed_pencil_uuadvec_guu.z+AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_uu.z*ac_transformed_pencil_uu.x+ac_transformed_pencil_uu.z*ac_transformed_pencil_uu.y*AC_cotth__mod__cdata[AC_m__mod__cdata-1])
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_uu_sph__mod__cparam-1] && AC_luu_sph_as_aux__mod__hydro) {
      ac_transformed_pencil_uu_sph=value(F_UU_SPHVEC)
    }
    if (AC_lconservative__mod__hydro) {
      if (AC_ilorentz__mod__cdata != 0) {
        ac_transformed_pencil_lorentz = value(Field(AC_ilorentz__mod__cdata-1))
      }
      if (!AC_lhiggsless_old__mod__hydro && AC_lhiggsless__mod__hydro) {
        ac_transformed_pencil_hless = value(Field(AC_ihless__mod__hydro-1))
      }
    }
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata && AC_ladvection_velocity__mod__hydro) {
    if (AC_lmaximal_cdt__mod__cdata) {
      ac_transformed_pencil_advec_uu=max(abs(ac_transformed_pencil_uu.x)*dline_1__mod__cdata.x, abs(ac_transformed_pencil_uu.y)*dline_1__mod__cdata.y, abs(ac_transformed_pencil_uu.z)*dline_1__mod__cdata.z)
    }
    else if (AC_lfargo_advection__mod__cdata) {
      ac_transformed_pencil_advec_uu=sum(abs(ac_transformed_pencil_uu_advec)*dline_1__mod__cdata)
    }
    else {
      ac_transformed_pencil_advec_uu=sum(abs(ac_transformed_pencil_uu)*dline_1__mod__cdata)
    }
    if (AC_lisotropic_advection__mod__cdata) {
      if (AC_dimensionality__mod__cparam<3) {
        ac_transformed_pencil_advec_uu=sqrt(ac_transformed_pencil_u2*dxyz_2__mod__cdata)
      }
    }
  }
  if (AC_ldensity_nolog__mod__cdata) {
    ac_transformed_pencil_rho=value(Field(AC_irho__mod__cdata-1))
    if (AC_lreference_state__mod__cdata) {
      ac_transformed_pencil_rho=ac_transformed_pencil_rho+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_rho1__mod__cparam-1]) {
      ac_transformed_pencil_rho1=1.0/ac_transformed_pencil_rho
    }
    if (AC_lpencil__mod__cdata[AC_i_lnrho__mod__cparam-1]) {
      ac_transformed_pencil_lnrho=log(ac_transformed_pencil_rho)
    }
    if (AC_lpencil__mod__cdata[AC_i_glnrho__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_grho__mod__cparam-1]) {
      ac_transformed_pencil_grho = gradient(Field(AC_irho__mod__cdata-1))
      if (AC_lreference_state__mod__cdata) {
        ac_transformed_pencil_grho.x=ac_transformed_pencil_grho.x+AC_reference_state__mod__density[vertexIdx.x][AC_iref_grho__mod__cparam-1]
      }
      if (AC_lpencil__mod__cdata[AC_i_glnrho__mod__cparam-1]) {
        ac_transformed_pencil_glnrho.x=ac_transformed_pencil_rho1*ac_transformed_pencil_grho.x
        ac_transformed_pencil_glnrho.y=ac_transformed_pencil_rho1*ac_transformed_pencil_grho.y
        ac_transformed_pencil_glnrho.z=ac_transformed_pencil_rho1*ac_transformed_pencil_grho.z
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_ugrho__mod__cparam-1]) {
      ac_transformed_pencil_ugrho = dot(ac_transformed_pencil_uu,ac_transformed_pencil_grho)
      if (AC_lupw_rho__mod__density) ac_transformed_pencil_ugrho = ac_transformed_pencil_ugrho - dot(abs(ac_transformed_pencil_uu),gradient_upwd(Field(AC_ilnrho__mod__cdata-1)))
    }
    if (AC_lpencil__mod__cdata[AC_i_glnrho2__mod__cparam-1]) {
      ac_transformed_pencil_glnrho2 = dot(ac_transformed_pencil_glnrho,ac_transformed_pencil_glnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_del2rho__mod__cparam-1]) {
      ac_transformed_pencil_del2rho = laplace(Field(AC_irho__mod__cdata-1))
      if (AC_lreference_state__mod__cdata) {
        ac_transformed_pencil_del2rho=ac_transformed_pencil_del2rho+AC_reference_state__mod__density[vertexIdx.x][AC_iref_d2rho__mod__cparam-1]
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_del2lnrho__mod__cparam-1]) {
      ac_transformed_pencil_del2lnrho=ac_transformed_pencil_rho1*ac_transformed_pencil_del2rho-ac_transformed_pencil_glnrho2
    }
    if (AC_lpencil__mod__cdata[AC_i_del6rho__mod__cparam-1]) {
      if (AC_ldiff_hyper3__mod__density) {
        ac_transformed_pencil_del6rho = del6(Field(AC_irho__mod__cdata-1))
        if (AC_lreference_state__mod__cdata) {
          ac_transformed_pencil_del6rho=ac_transformed_pencil_del6rho+AC_reference_state__mod__density[vertexIdx.x][AC_iref_d6rho__mod__cparam-1]
        }
      }
      else if (AC_ldiff_hyper3_strict__mod__density) {
        ac_transformed_pencil_del6rho=0.
        tmp_16_20_24_25_100 = der6x(Field(AC_irho__mod__cdata-1))
        ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + tmp_16_20_24_25_100
        if (1!=1) {
          tmp_16_20_24_25_100 = der6x(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        if (2!=1) {
          tmp_16_20_24_25_100 = der4x2y(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        if (3!=1) {
          tmp_16_20_24_25_100 = der4x2z(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        tmp_16_20_24_25_100 = der6y(Field(AC_irho__mod__cdata-1))
        ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + tmp_16_20_24_25_100
        if (1!=2) {
          tmp_16_20_24_25_100 = der4y2x(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        if (2!=2) {
          tmp_16_20_24_25_100 = der6y(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        if (3!=2) {
          tmp_16_20_24_25_100 = der4y2z(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        tmp_16_20_24_25_100 = der6z(Field(AC_irho__mod__cdata-1))
        ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + tmp_16_20_24_25_100
        if (1!=3) {
          tmp_16_20_24_25_100 = der4z2x(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        if (2!=3) {
          tmp_16_20_24_25_100 = der4z2y(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        if (3!=3) {
          tmp_16_20_24_25_100 = der6z(Field(AC_irho__mod__cdata-1))
          ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 3*tmp_16_20_24_25_100
        }
        tmp_16_20_24_25_100 = der2i2j2k(Field(AC_irho__mod__cdata-1))
        ac_transformed_pencil_del6rho = ac_transformed_pencil_del6rho + 6*tmp_16_20_24_25_100
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_del6lnrho__mod__cparam-1]) {
      if (AC_ldiff_hyper3lnrho__mod__density) {
      }
      else if (AC_ldiff_hyper3lnrho_strict__mod__density) {
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_sglnrho__mod__cparam-1]) {
      ac_transformed_pencil_sglnrho = ac_transformed_pencil_sij*ac_transformed_pencil_glnrho
    }
    if (AC_lpencil__mod__cdata[AC_i_uij5glnrho__mod__cparam-1]) {
      ac_transformed_pencil_uij5glnrho = ac_transformed_pencil_uij5*ac_transformed_pencil_glnrho
    }
    if (AC_lpencil__mod__cdata[AC_i_transprho__mod__cparam-1]) {
      if (AC_lreference_state__mod__cdata) {
        ac_transformed_pencil_transprho = AC_impossible__mod__cparam
      }
      else {
        ac_transformed_pencil_transprho = AC_impossible__mod__cparam
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_uuadvec_grho__mod__cparam-1]) {
      ac_transformed_pencil_uuadvec_grho = dot(ac_transformed_pencil_uu_advec,ac_transformed_pencil_grho)
      if (AC_lupw_rho__mod__density) {
        ac_transformed_pencil_uu_advec = del6_upwd(Field(AC_irho__mod__cdata-1))
        ac_transformed_pencil_uuadvec_grho = ac_transformed_pencil_uuadvec_grho - tmp_20_24_25_100
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_divss__mod__cparam-1]) {
      ac_transformed_pencil_divss = divergence((Field3){Field(AC_iux__mod__cdata-1), Field(AC_iux__mod__cdata), Field(AC_iux__mod__cdata+1)})
    }
    if (AC_lconservative__mod__hydro) {
      if (AC_lhiggsless__mod__hydro) {
        if(AC_t__mod__cdata < ac_transformed_pencil_hless) {
          ac_transformed_pencil_rho=ac_transformed_pencil_rho-AC_eps_hless__mod__hydro
        }
        ac_transformed_pencil_rho=ac_transformed_pencil_rho/(AC_fourthird__mod__cparam*ac_transformed_pencil_lorentz*(1.-0.25/ac_transformed_pencil_lorentz))
      }
      else {
        ac_transformed_pencil_rho=ac_transformed_pencil_rho/(AC_fourthird__mod__cparam*ac_transformed_pencil_lorentz*(1.-0.25/ac_transformed_pencil_lorentz))
      }
    }
  }
  else {
    ac_transformed_pencil_lnrho=value(Field(AC_ilnrho__mod__cdata-1))
    if (AC_lpencil__mod__cdata[AC_i_rho1__mod__cparam-1]) {
      ac_transformed_pencil_rho1=exp(-value(Field(AC_ilnrho__mod__cdata-1)))
    }
    if (AC_lpencil__mod__cdata[AC_i_rho__mod__cparam-1]) {
      ac_transformed_pencil_rho=1.0/ac_transformed_pencil_rho1
    }
    if (AC_lpencil__mod__cdata[AC_i_glnrho__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_grho__mod__cparam-1]) {
      ac_transformed_pencil_glnrho = gradient(Field(AC_ilnrho__mod__cdata-1))
      if (AC_lpencil__mod__cdata[AC_i_grho__mod__cparam-1]) {
        ac_transformed_pencil_grho.x=ac_transformed_pencil_rho*ac_transformed_pencil_glnrho.x
        ac_transformed_pencil_grho.y=ac_transformed_pencil_rho*ac_transformed_pencil_glnrho.y
        ac_transformed_pencil_grho.z=ac_transformed_pencil_rho*ac_transformed_pencil_glnrho.z
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_uglnrho__mod__cparam-1]) {
      if (AC_lupw_lnrho__mod__density) {
        ac_transformed_pencil_uglnrho = dot(ac_transformed_pencil_uu,ac_transformed_pencil_glnrho)
        if (AC_lupw_lnrho__mod__density) ac_transformed_pencil_uglnrho = ac_transformed_pencil_uglnrho - dot(abs(ac_transformed_pencil_uu),gradient_upwd(Field(AC_ilnrho__mod__cdata-1)))
      }
      else {
        ac_transformed_pencil_uglnrho = dot(ac_transformed_pencil_uu,ac_transformed_pencil_glnrho)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_glnrho2__mod__cparam-1]) {
      ac_transformed_pencil_glnrho2 = dot(ac_transformed_pencil_glnrho,ac_transformed_pencil_glnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_del2lnrho__mod__cparam-1]) {
      ac_transformed_pencil_del2lnrho = laplace(Field(AC_ilnrho__mod__cdata-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_del6lnrho__mod__cparam-1]) {
      if (AC_ldiff_hyper3lnrho__mod__density) {
        ac_transformed_pencil_del6lnrho = del6(Field(AC_ilnrho__mod__cdata-1))
      }
      else if (AC_ldiff_hyper3lnrho_strict__mod__density) {
        ac_transformed_pencil_del6lnrho=0.
        tmp_21_23_24_25_100 = der6x(Field(AC_ilnrho__mod__cdata-1))
        ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + tmp_21_23_24_25_100
        if (1!=1) {
          tmp_21_23_24_25_100 = der6x(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        if (2!=1) {
          tmp_21_23_24_25_100 = der4x2y(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        if (3!=1) {
          tmp_21_23_24_25_100 = der4x2z(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        tmp_21_23_24_25_100 = der6y(Field(AC_ilnrho__mod__cdata-1))
        ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + tmp_21_23_24_25_100
        if (1!=2) {
          tmp_21_23_24_25_100 = der4y2x(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        if (2!=2) {
          tmp_21_23_24_25_100 = der6y(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        if (3!=2) {
          tmp_21_23_24_25_100 = der4y2z(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        tmp_21_23_24_25_100 = der6z(Field(AC_ilnrho__mod__cdata-1))
        ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + tmp_21_23_24_25_100
        if (1!=3) {
          tmp_21_23_24_25_100 = der4z2x(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        if (2!=3) {
          tmp_21_23_24_25_100 = der4z2y(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        if (3!=3) {
          tmp_21_23_24_25_100 = der6z(Field(AC_ilnrho__mod__cdata-1))
          ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 3*tmp_21_23_24_25_100
        }
        tmp_21_23_24_25_100 = der2i2j2k(Field(AC_ilnrho__mod__cdata-1))
        ac_transformed_pencil_del6lnrho = ac_transformed_pencil_del6lnrho + 6*tmp_21_23_24_25_100
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_hlnrho__mod__cparam-1]) {
      ac_transformed_pencil_hlnrho = hessian(Field(AC_ilnrho__mod__cdata-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_sglnrho__mod__cparam-1]) {
      ac_transformed_pencil_sglnrho = ac_transformed_pencil_sij*ac_transformed_pencil_glnrho
    }
    if (AC_lpencil__mod__cdata[AC_i_uij5glnrho__mod__cparam-1]) {
      ac_transformed_pencil_uij5glnrho = ac_transformed_pencil_uij5*ac_transformed_pencil_glnrho
    }
    if (AC_lpencil__mod__cdata[AC_i_uuadvec_glnrho__mod__cparam-1]) {
      ac_transformed_pencil_uuadvec_glnrho = dot(ac_transformed_pencil_uu_advec,ac_transformed_pencil_glnrho)
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_ekin__mod__cparam-1]) {
    if (AC_lconservative__mod__hydro) {
      ac_transformed_pencil_ekin=AC_fourthird__mod__cparam*ac_transformed_pencil_rho*ac_transformed_pencil_lorentz*ac_transformed_pencil_u2
    }
    else {
      ac_transformed_pencil_ekin=0.5*ac_transformed_pencil_rho*ac_transformed_pencil_u2
    }
  }
  if (AC_lpscalar__mod__cparam) {
    if (AC_lpencil__mod__cdata[AC_i_cc__mod__cparam-1]) {
      ac_transformed_pencil_cc=1.0
    }
    if (AC_lpencil__mod__cdata[AC_i_cc1__mod__cparam-1]) {
      ac_transformed_pencil_cc1=1.0
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_cv1__mod__cparam-1]) {
    ac_transformed_pencil_cv1=AC_cv1__mod__equationofstate
  }
  if (AC_lpencil__mod__cdata[AC_i_cp1__mod__cparam-1]) {
    ac_transformed_pencil_cp1=AC_cp1__mod__equationofstate
  }
  if (AC_lpencil__mod__cdata[AC_i_cv__mod__cparam-1]) {
    ac_transformed_pencil_cv=1/AC_cv1__mod__equationofstate
  }
  if (AC_lpencil__mod__cdata[AC_i_cp__mod__cparam-1]) {
    ac_transformed_pencil_cp=1/AC_cp1__mod__equationofstate
  }
  if (AC_lpencil__mod__cdata[AC_i_cp1tilde__mod__cparam-1]) {
    ac_transformed_pencil_cp1tilde=AC_cp1__mod__equationofstate
  }
  if (AC_lpencil__mod__cdata[AC_i_glnmumol__mod__cparam-1]) {
    ac_transformed_pencil_glnmumol.x = 0.0
    ac_transformed_pencil_glnmumol.y = 0.0
    ac_transformed_pencil_glnmumol.z = 0.0
  }
  if(AC_ieosvars__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate || AC_ieosvars__mod__equationofstate == AC_irho_ss__mod__equationofstate) {
    if (AC_leos_isentropic__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
        ac_transformed_pencil_ss=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_gss__mod__cparam-1]) {
        ac_transformed_pencil_gss.x = 0.0
        ac_transformed_pencil_gss.y = 0.0
        ac_transformed_pencil_gss.z = 0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_hss__mod__cparam-1]) {
        ac_transformed_pencil_hss=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_del2ss__mod__cparam-1]) {
        ac_transformed_pencil_del2ss=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_del6ss__mod__cparam-1]) {
        ac_transformed_pencil_del6ss=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate*exp(AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate))
      }
    }
    else if (AC_leos_isothermal__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
        ac_transformed_pencil_ss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)
      }
      if (AC_lpencil__mod__cdata[AC_i_gss__mod__cparam-1]) {
        ac_transformed_pencil_gss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_glnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_hss__mod__cparam-1]) {
        ac_transformed_pencil_hss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_hlnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_del2ss__mod__cparam-1]) {
        ac_transformed_pencil_del2ss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_del2lnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_del6ss__mod__cparam-1]) {
        ac_transformed_pencil_del6ss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_del6lnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_rho1gpp__mod__cparam-1]) {
        ac_transformed_pencil_rho1gpp.x = ac_transformed_pencil_cs2*ac_transformed_pencil_glnrho.x
        ac_transformed_pencil_rho1gpp.y = ac_transformed_pencil_cs2*ac_transformed_pencil_glnrho.y
        ac_transformed_pencil_rho1gpp.z = ac_transformed_pencil_cs2*ac_transformed_pencil_glnrho.z
      }
    }
    else if (AC_leos_localisothermal__mod__equationofstate) {
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
        ac_transformed_pencil_ss=value(Field(AC_ieosvar2__mod__equationofstate-1))
        if (AC_lreference_state__mod__cdata) {
          ac_transformed_pencil_ss=ac_transformed_pencil_ss+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_gss__mod__cparam-1]) {
        ac_transformed_pencil_gss = gradient(Field(AC_ieosvar2__mod__equationofstate-1))
        if (AC_lreference_state__mod__cdata) {
          ac_transformed_pencil_gss.x=ac_transformed_pencil_gss.x+AC_reference_state__mod__density[vertexIdx.x][AC_iref_gs__mod__cparam-1]
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_hss__mod__cparam-1]) {
        ac_transformed_pencil_hss = hessian(Field(AC_ieosvar2__mod__equationofstate-1))
        if (AC_lreference_state__mod__cdata) {
          ac_transformed_pencil_hss[1-1][1-1]=ac_transformed_pencil_hss[1-1][1-1]+AC_reference_state__mod__density[vertexIdx.x][AC_iref_d2s__mod__cparam-1]
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_del2ss__mod__cparam-1]) {
        ac_transformed_pencil_del2ss = laplace(Field(AC_ieosvar2__mod__equationofstate-1))
        if (AC_lreference_state__mod__cdata) {
          ac_transformed_pencil_del2ss=ac_transformed_pencil_del2ss+AC_reference_state__mod__density[vertexIdx.x][AC_iref_d2s__mod__cparam-1]
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_del6ss__mod__cparam-1]) {
        ac_transformed_pencil_del6ss = del6(Field(AC_ieosvar2__mod__equationofstate-1))
        if (AC_lreference_state__mod__cdata) {
          ac_transformed_pencil_del6ss=ac_transformed_pencil_del6ss+AC_reference_state__mod__density[vertexIdx.x][AC_iref_d6s__mod__cparam-1]
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate*exp(AC_cv1__mod__equationofstate*ac_transformed_pencil_ss+AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate))
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
      ac_transformed_pencil_lntt=AC_lntt0__mod__equationofstate+AC_cv1__mod__equationofstate*ac_transformed_pencil_ss+AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)
    }
    if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
      ac_transformed_pencil_pp=(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*exp(ac_transformed_pencil_lntt+ac_transformed_pencil_lnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
      ac_transformed_pencil_ee=AC_cv__mod__equationofstate*exp(ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_yh__mod__cparam-1]) {
      ac_transformed_pencil_yh=AC_impossible__mod__cparam
    }
    if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
      ac_transformed_pencil_tt=exp(ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_tt1__mod__cparam-1]) {
      ac_transformed_pencil_tt1=exp(-ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
      ac_transformed_pencil_glntt=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_glnrho+AC_cv1__mod__equationofstate*ac_transformed_pencil_gss
    }
    if (AC_lpencil__mod__cdata[AC_i_gtt__mod__cparam-1]) {
      ac_transformed_pencil_gtt.x=ac_transformed_pencil_glntt.x*ac_transformed_pencil_tt
      ac_transformed_pencil_gtt.y=ac_transformed_pencil_glntt.y*ac_transformed_pencil_tt
      ac_transformed_pencil_gtt.z=ac_transformed_pencil_glntt.z*ac_transformed_pencil_tt
    }
    if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
      ac_transformed_pencil_del2lntt=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_del2lnrho+AC_cv1__mod__equationofstate*ac_transformed_pencil_del2ss
    }
    if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
      ac_transformed_pencil_hlntt=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_hlnrho+AC_cv1__mod__equationofstate*ac_transformed_pencil_hss
    }
  }
  else if(AC_ieosvars__mod__equationofstate == AC_ilnrho_lntt__mod__equationofstate || AC_ieosvars__mod__equationofstate == AC_irho_lntt__mod__equationofstate) {
    if (AC_leos_isentropic__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
        ac_transformed_pencil_lntt=AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)+AC_lntt0__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
        ac_transformed_pencil_glntt=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_glnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
        ac_transformed_pencil_hlntt=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_hlnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
        ac_transformed_pencil_del2lntt=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_del2lnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate*exp(AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate))
      }
    }
    else if (AC_leos_isothermal__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
        ac_transformed_pencil_lntt=AC_lntt0__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
        ac_transformed_pencil_glntt.x = 0.0
        ac_transformed_pencil_glntt.y = 0.0
        ac_transformed_pencil_glntt.z = 0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
        ac_transformed_pencil_hlntt=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
        ac_transformed_pencil_del2lntt=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate
      }
    }
    else if (AC_leos_localisothermal__mod__equationofstate) {
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
        ac_transformed_pencil_lntt=value(Field(AC_ieosvar2__mod__equationofstate-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
        ac_transformed_pencil_glntt = gradient(Field(AC_ieosvar2__mod__equationofstate-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
        ac_transformed_pencil_hlntt = hessian(Field(AC_ieosvar2__mod__equationofstate-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
        ac_transformed_pencil_del2lntt = laplace(Field(AC_ieosvar2__mod__equationofstate-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_del6lntt__mod__cparam-1]) {
        ac_transformed_pencil_del6lntt = del6(Field(AC_ieosvar2__mod__equationofstate-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cp__mod__equationofstate*exp(ac_transformed_pencil_lntt)*AC_gamma_m1__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_rho1gpp__mod__cparam-1]) {
        ac_transformed_pencil_rho1gpp.x = AC_gamma1__mod__equationofstate*ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.x+ac_transformed_pencil_glntt.x)
        ac_transformed_pencil_rho1gpp.y = AC_gamma1__mod__equationofstate*ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.y+ac_transformed_pencil_glntt.y)
        ac_transformed_pencil_rho1gpp.z = AC_gamma1__mod__equationofstate*ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.z+ac_transformed_pencil_glntt.z)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
      ac_transformed_pencil_ss=AC_cv__mod__equationofstate*(ac_transformed_pencil_lntt-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate))
    }
    if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
      ac_transformed_pencil_pp=(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*exp(ac_transformed_pencil_lntt+ac_transformed_pencil_lnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
      ac_transformed_pencil_ee=AC_cv__mod__equationofstate*exp(ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_yh__mod__cparam-1]) {
      ac_transformed_pencil_yh=AC_impossible__mod__cparam
    }
    if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
      ac_transformed_pencil_tt=exp(ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_tt1__mod__cparam-1]) {
      ac_transformed_pencil_tt1=exp(-ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_gss__mod__cparam-1]) {
      ac_transformed_pencil_gss=AC_cv__mod__equationofstate*(ac_transformed_pencil_glntt-AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_glnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_del2ss__mod__cparam-1]) {
      ac_transformed_pencil_del2ss=AC_cv__mod__equationofstate*(ac_transformed_pencil_del2lntt-AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_del2lnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_hss__mod__cparam-1]) {
      ac_transformed_pencil_hss=AC_cv__mod__equationofstate*(ac_transformed_pencil_hlntt-AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_hlnrho)
    }
    if (AC_lpencil__mod__cdata[AC_i_gtt__mod__cparam-1]) {
      ac_transformed_pencil_gtt.x=ac_transformed_pencil_tt*ac_transformed_pencil_glntt.x
      ac_transformed_pencil_gtt.y=ac_transformed_pencil_tt*ac_transformed_pencil_glntt.y
      ac_transformed_pencil_gtt.z=ac_transformed_pencil_tt*ac_transformed_pencil_glntt.z
    }
  }
  else if(AC_ieosvars__mod__equationofstate == AC_ilnrho_tt__mod__equationofstate || AC_ieosvars__mod__equationofstate == AC_irho_tt__mod__equationofstate) {
    if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
      ac_transformed_pencil_tt=value(Field(AC_ieosvar2__mod__equationofstate-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_tt1__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
      ac_transformed_pencil_tt1=1/value(Field(AC_ieosvar2__mod__equationofstate-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
      ac_transformed_pencil_lntt=log(value(Field(AC_ieosvar2__mod__equationofstate-1)))
    }
    if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
      ac_transformed_pencil_cs2=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*value(Field(AC_ieosvar2__mod__equationofstate-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_gtt__mod__cparam-1]) {
      ac_transformed_pencil_gtt = gradient(Field(AC_ieosvar2__mod__equationofstate-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
      ac_transformed_pencil_glntt.x=ac_transformed_pencil_gtt.x*ac_transformed_pencil_tt1
      ac_transformed_pencil_glntt.y=ac_transformed_pencil_gtt.y*ac_transformed_pencil_tt1
      ac_transformed_pencil_glntt.z=ac_transformed_pencil_gtt.z*ac_transformed_pencil_tt1
    }
    if (AC_lpencil__mod__cdata[AC_i_del2tt__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
      ac_transformed_pencil_del2tt = laplace(Field(AC_ieosvar2__mod__equationofstate-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
      tmp_28_29_100=0.0
      tmp_28_29_100=tmp_28_29_100+ac_transformed_pencil_glntt.x*ac_transformed_pencil_glntt.x
      tmp_28_29_100=tmp_28_29_100+ac_transformed_pencil_glntt.y*ac_transformed_pencil_glntt.y
      tmp_28_29_100=tmp_28_29_100+ac_transformed_pencil_glntt.z*ac_transformed_pencil_glntt.z
      ac_transformed_pencil_del2lntt=ac_transformed_pencil_del2tt*ac_transformed_pencil_tt1-tmp_28_29_100
    }
    if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
      ac_transformed_pencil_hlntt = hessian(Field(AC_itt__mod__cdata-1))
      ac_transformed_pencil_hlntt[1-1][1-1]=ac_transformed_pencil_hlntt[1-1][1-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.x*ac_transformed_pencil_glntt.x
      ac_transformed_pencil_hlntt[1-1][2-1]=ac_transformed_pencil_hlntt[1-1][2-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.x*ac_transformed_pencil_glntt.y
      ac_transformed_pencil_hlntt[1-1][3-1]=ac_transformed_pencil_hlntt[1-1][3-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.x*ac_transformed_pencil_glntt.z
      ac_transformed_pencil_hlntt[2-1][1-1]=ac_transformed_pencil_hlntt[2-1][1-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.y*ac_transformed_pencil_glntt.x
      ac_transformed_pencil_hlntt[2-1][2-1]=ac_transformed_pencil_hlntt[2-1][2-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.y*ac_transformed_pencil_glntt.y
      ac_transformed_pencil_hlntt[2-1][3-1]=ac_transformed_pencil_hlntt[2-1][3-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.y*ac_transformed_pencil_glntt.z
      ac_transformed_pencil_hlntt[3-1][1-1]=ac_transformed_pencil_hlntt[3-1][1-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.z*ac_transformed_pencil_glntt.x
      ac_transformed_pencil_hlntt[3-1][2-1]=ac_transformed_pencil_hlntt[3-1][2-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.z*ac_transformed_pencil_glntt.y
      ac_transformed_pencil_hlntt[3-1][3-1]=ac_transformed_pencil_hlntt[3-1][3-1]*ac_transformed_pencil_tt1-ac_transformed_pencil_glntt.z*ac_transformed_pencil_glntt.z
    }
    if (AC_lpencil__mod__cdata[AC_i_del6tt__mod__cparam-1]) {
      ac_transformed_pencil_del6tt = del6(Field(AC_ieosvar2__mod__equationofstate-1))
    }
    if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
      ac_transformed_pencil_ss=AC_cv__mod__equationofstate*(ac_transformed_pencil_lntt-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate))
    }
    if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
      ac_transformed_pencil_pp=AC_cv__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_rho*ac_transformed_pencil_tt
    }
    if (AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
      ac_transformed_pencil_ee=AC_cv__mod__equationofstate*exp(ac_transformed_pencil_lntt)
    }
  }
  else if(AC_ieosvars__mod__equationofstate == AC_ilnrho_cs2__mod__equationofstate || AC_ieosvars__mod__equationofstate == AC_irho_cs2__mod__equationofstate) {
    if (AC_leos_isentropic__mod__equationofstate) {
    }
    else if (AC_leos_isothermal__mod__equationofstate) {
      if (AC_lcs_tdep__mod__equationofstate) {
        if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
          ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate*exp(-AC_cs20_tdep_rate__mod__equationofstate*AC_t__mod__cdata)
        }
      }
      else {
        if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
          ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
        ac_transformed_pencil_lntt=AC_lntt0__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
        ac_transformed_pencil_glntt.x = 0.0
        ac_transformed_pencil_glntt.y = 0.0
        ac_transformed_pencil_glntt.z = 0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
        ac_transformed_pencil_hlntt=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
        ac_transformed_pencil_del2lntt=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
        ac_transformed_pencil_ss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)
      }
      if (AC_lpencil__mod__cdata[AC_i_del2ss__mod__cparam-1]) {
        ac_transformed_pencil_del2ss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_del2lnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_gss__mod__cparam-1]) {
        ac_transformed_pencil_gss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_glnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_hss__mod__cparam-1]) {
        ac_transformed_pencil_hss=-(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*ac_transformed_pencil_hlnrho
      }
      if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
        ac_transformed_pencil_pp=AC_gamma1__mod__equationofstate*ac_transformed_pencil_rho*AC_cs20__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_rho1gpp__mod__cparam-1]) {
        ac_transformed_pencil_rho1gpp.x = ac_transformed_pencil_cs2*ac_transformed_pencil_glnrho.x
        ac_transformed_pencil_rho1gpp.y = ac_transformed_pencil_cs2*ac_transformed_pencil_glnrho.y
        ac_transformed_pencil_rho1gpp.z = ac_transformed_pencil_cs2*ac_transformed_pencil_glnrho.z
      }
    }
    else if (AC_leos_localisothermal__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=value(Field(AC_iglobal_cs2__mod__equationofstate-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
        ac_transformed_pencil_glntt=value(F_GLOBAL_GLNTVEC)
      }
      if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
        ac_transformed_pencil_pp=ac_transformed_pencil_rho*ac_transformed_pencil_cs2
      }
    }
    else {
    }
  }
  else if(AC_ieosvars__mod__equationofstate == AC_ipp_ss__mod__equationofstate) {
    if (AC_lanelastic__mod__cparam) {
      if (AC_lanelastic_lin__mod__equationofstate) {
        ac_transformed_pencil_pp=value(Field(AC_ipp__mod__cdata-1))
        ac_transformed_pencil_ss=value(Field(AC_iss__mod__cdata-1))
        ac_transformed_pencil_ttb=AC_cs20__mod__equationofstate*AC_cp1__mod__equationofstate*exp(AC_gamma__mod__equationofstate*value(Field(AC_iss_b__mod__cdata-1))*AC_cp1__mod__equationofstate+AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_lnrho)/AC_gamma_m1__mod__equationofstate
        ac_transformed_pencil_cs2=AC_cp__mod__equationofstate*ac_transformed_pencil_ttb*AC_gamma_m1__mod__equationofstate
        ac_transformed_pencil_tt1=1./ac_transformed_pencil_ttb
        ac_transformed_pencil_rho_anel=(value(Field(AC_ipp__mod__cdata-1))/(value(Field(AC_irho_b__mod__cdata-1))*ac_transformed_pencil_cs2) - value(Field(AC_iss__mod__cdata-1))*AC_cp1__mod__equationofstate)
      }
      else {
        if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
          ac_transformed_pencil_pp=value(Field(AC_ipp__mod__cdata-1))
        }
        if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
          ac_transformed_pencil_ss=value(Field(AC_iss__mod__cdata-1))
        }
        if (AC_lpencil__mod__cdata[AC_i_rho__mod__cparam-1]) {
          ac_transformed_pencil_rho=value(Field(AC_irho__mod__cdata-1))
        }
        if (AC_lpencil__mod__cdata[AC_i_lnrho__mod__cparam-1]) {
          ac_transformed_pencil_lnrho=log(ac_transformed_pencil_rho)
        }
        if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
          ac_transformed_pencil_cs2=AC_gamma__mod__equationofstate*ac_transformed_pencil_pp/ac_transformed_pencil_rho
        }
        if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
          ac_transformed_pencil_lntt=AC_lntt0__mod__equationofstate+AC_cv1__mod__equationofstate*ac_transformed_pencil_ss+AC_gamma_m1__mod__equationofstate*(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)
        }
        if (AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
          ac_transformed_pencil_ee=AC_cv__mod__equationofstate*exp(ac_transformed_pencil_lntt)
        }
        if (AC_lpencil__mod__cdata[AC_i_yh__mod__cparam-1]) {
          ac_transformed_pencil_yh=AC_impossible__mod__cparam
        }
        if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
          ac_transformed_pencil_tt=exp(ac_transformed_pencil_lntt)
        }
        if (AC_lpencil__mod__cdata[AC_i_tt1__mod__cparam-1]) {
          ac_transformed_pencil_tt1=exp(-ac_transformed_pencil_lntt)
        }
      }
    }
    if (AC_leos_isentropic__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_ss__mod__cparam-1]) {
        ac_transformed_pencil_ss=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_lnrho__mod__cparam-1]) {
        ac_transformed_pencil_lnrho=log(AC_gamma__mod__equationofstate*ac_transformed_pencil_pp/(AC_rho0__mod__equationofstate*AC_cs20__mod__equationofstate))/AC_gamma__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_rho__mod__cparam-1]) {
        ac_transformed_pencil_rho=exp(log(AC_gamma__mod__equationofstate*ac_transformed_pencil_pp/(AC_rho0__mod__equationofstate*AC_cs20__mod__equationofstate))/AC_gamma__mod__equationofstate)
      }
      if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
        ac_transformed_pencil_tt=pow((ac_transformed_pencil_pp/AC_pp0__mod__equationofstate),(1.-AC_gamma1__mod__equationofstate))
      }
      if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
        ac_transformed_pencil_lntt=(1.-AC_gamma1__mod__equationofstate)*log(AC_gamma__mod__equationofstate*ac_transformed_pencil_pp/(AC_rho0__mod__equationofstate*AC_cs0__mod__equationofstate))
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate*pow((ac_transformed_pencil_pp/AC_pp0__mod__equationofstate),(1.-AC_gamma1__mod__equationofstate))
      }
    }
    else if (AC_leos_isothermal__mod__equationofstate) {
      if (AC_lpencil__mod__cdata[AC_i_lnrho__mod__cparam-1]) {
        ac_transformed_pencil_lnrho=log(AC_gamma__mod__equationofstate*ac_transformed_pencil_pp/(AC_cs20__mod__equationofstate*AC_rho0__mod__equationofstate))-ac_transformed_pencil_lntt
      }
      if (AC_lpencil__mod__cdata[AC_i_rho__mod__cparam-1]) {
        ac_transformed_pencil_rho=exp(ac_transformed_pencil_lnrho)
      }
      if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
        ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
        ac_transformed_pencil_lntt=AC_lntt0__mod__equationofstate
      }
      if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
        ac_transformed_pencil_glntt.x = 0.0
        ac_transformed_pencil_glntt.y = 0.0
        ac_transformed_pencil_glntt.z = 0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
        ac_transformed_pencil_hlntt=0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
        ac_transformed_pencil_del2lntt=0.0
      }
    }
    else if (AC_leos_localisothermal__mod__equationofstate) {
    }
  }
  else if(AC_ieosvars__mod__equationofstate == AC_ipp_cs2__mod__equationofstate) {
    if (AC_leos_isentropic__mod__equationofstate) {
    }
    else if (AC_leos_isothermal__mod__equationofstate) {
      if (AC_lanelastic__mod__cparam) {
        if (AC_lanelastic_lin__mod__equationofstate) {
          ac_transformed_pencil_pp=value(Field(AC_ipp__mod__cdata-1))
          ac_transformed_pencil_rho_anel=value(Field(AC_ipp__mod__cdata-1))/(value(Field(AC_irho_b__mod__cdata-1))*AC_cs20__mod__equationofstate)
        }
        else {
          ac_transformed_pencil_pp=value(Field(AC_ipp__mod__cdata-1))
        }
      }
      else {
        if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
          ac_transformed_pencil_cs2=AC_cs20__mod__equationofstate
        }
        if (AC_lpencil__mod__cdata[AC_i_lnrho__mod__cparam-1]) {
          ac_transformed_pencil_lnrho=log(ac_transformed_pencil_pp/AC_cs20__mod__equationofstate)
        }
        if (AC_lpencil__mod__cdata[AC_i_rho__mod__cparam-1]) {
          ac_transformed_pencil_rho=(ac_transformed_pencil_pp/AC_cs20__mod__equationofstate)
        }
        if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
          ac_transformed_pencil_lntt=AC_lntt0__mod__equationofstate
        }
        if (AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
          ac_transformed_pencil_glntt.x = 0.0
          ac_transformed_pencil_glntt.y = 0.0
          ac_transformed_pencil_glntt.z = 0.0
        }
        if (AC_lpencil__mod__cdata[AC_i_hlntt__mod__cparam-1]) {
          ac_transformed_pencil_hlntt=0.0
        }
        if (AC_lpencil__mod__cdata[AC_i_del2lntt__mod__cparam-1]) {
          ac_transformed_pencil_del2lntt=0.0
        }
      }
    }
    else if (AC_leos_localisothermal__mod__equationofstate) {
    }
    if (AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
      if (AC_gamma_m1__mod__equationofstate!=0.0) {
        ac_transformed_pencil_ee=(AC_gamma1__mod__equationofstate/AC_gamma_m1__mod__equationofstate)*ac_transformed_pencil_cs2
      }
      else {
        ac_transformed_pencil_ee=ac_transformed_pencil_cs2
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_yh__mod__cparam-1]) {
      ac_transformed_pencil_yh=AC_impossible__mod__cparam
    }
    if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
      ac_transformed_pencil_tt=exp(ac_transformed_pencil_lntt)
    }
    if (AC_lpencil__mod__cdata[AC_i_tt1__mod__cparam-1]) {
      ac_transformed_pencil_tt1=exp(-ac_transformed_pencil_lntt)
    }
  }
  else if(AC_ieosvars__mod__equationofstate == AC_irho_eth__mod__equationofstate || AC_ieosvars__mod__equationofstate == AC_ilnrho_eth__mod__equationofstate) {
    if (AC_lstratz__mod__cdata) {
      if (AC_lpencil__mod__cdata[AC_i_eths__mod__cparam-1]) {
        ac_transformed_pencil_eths = 1.0 + value(Field(AC_ieth__mod__cdata-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_geths__mod__cparam-1]) {
        ac_transformed_pencil_geths = gradient(Field(AC_ieth__mod__cdata-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_eth__mod__cparam-1]) {
        ac_transformed_pencil_eth = AC_eth0z__mod__equationofstate[AC_n__mod__cdata-1] * ac_transformed_pencil_eths
      }
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_eth__mod__cparam-1]) {
        ac_transformed_pencil_eth = value(Field(AC_ieth__mod__cdata-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_geth__mod__cparam-1]) {
        ac_transformed_pencil_geth = gradient(Field(AC_ieth__mod__cdata-1))
      }
      if (AC_lpencil__mod__cdata[AC_i_del2eth__mod__cparam-1]) {
        ac_transformed_pencil_del2eth = laplace(Field(AC_ieth__mod__cdata-1))
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_cs2__mod__cparam-1]) {
      ac_transformed_pencil_cs2=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_eth*ac_transformed_pencil_rho1
    }
    if (AC_lpencil__mod__cdata[AC_i_pp__mod__cparam-1]) {
      ac_transformed_pencil_pp=AC_gamma_m1__mod__equationofstate*ac_transformed_pencil_eth
    }
    if (AC_lpencil__mod__cdata[AC_i_ee__mod__cparam-1]) {
      ac_transformed_pencil_ee=ac_transformed_pencil_rho1*ac_transformed_pencil_eth
    }
    if (AC_lpencil__mod__cdata[AC_i_tt__mod__cparam-1]) {
      ac_transformed_pencil_tt=ac_transformed_pencil_cv1*ac_transformed_pencil_rho1*ac_transformed_pencil_eth
    }
    if (AC_lpencil__mod__cdata[AC_i_lntt__mod__cparam-1]) {
      ac_transformed_pencil_lntt=log(ac_transformed_pencil_tt)
    }
    if (AC_lpencil__mod__cdata[AC_i_tt1__mod__cparam-1]) {
      ac_transformed_pencil_tt1=1/ac_transformed_pencil_tt
    }
    if (AC_lpencil__mod__cdata[AC_i_gtt__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_glntt__mod__cparam-1]) {
      ac_transformed_pencil_gtt.x=ac_transformed_pencil_rho1*(ac_transformed_pencil_cv1*ac_transformed_pencil_geth.x-ac_transformed_pencil_tt*ac_transformed_pencil_grho.x)
      ac_transformed_pencil_glntt.x=ac_transformed_pencil_tt1*ac_transformed_pencil_gtt.x
      ac_transformed_pencil_gtt.y=ac_transformed_pencil_rho1*(ac_transformed_pencil_cv1*ac_transformed_pencil_geth.y-ac_transformed_pencil_tt*ac_transformed_pencil_grho.y)
      ac_transformed_pencil_glntt.y=ac_transformed_pencil_tt1*ac_transformed_pencil_gtt.y
      ac_transformed_pencil_gtt.z=ac_transformed_pencil_rho1*(ac_transformed_pencil_cv1*ac_transformed_pencil_geth.z-ac_transformed_pencil_tt*ac_transformed_pencil_grho.z)
      ac_transformed_pencil_glntt.z=ac_transformed_pencil_tt1*ac_transformed_pencil_gtt.z
    }
    if (AC_lpencil__mod__cdata[AC_i_del2tt__mod__cparam-1]) {
      ac_transformed_pencil_del2tt=ac_transformed_pencil_rho1*(ac_transformed_pencil_cv1*ac_transformed_pencil_del2eth-ac_transformed_pencil_tt*ac_transformed_pencil_del2rho-2*sum(ac_transformed_pencil_grho*ac_transformed_pencil_gtt))
    }
  }
  else {
  }
  if (AC_lcs_as_aux__mod__equationofstate || AC_lcs_as_comaux__mod__equationofstate) {
    DF_CS=sqrt(ac_transformed_pencil_cs2)
  }
  if (AC_lshock__mod__cparam) {
    if (AC_lpencil__mod__cdata[AC_i_shock__mod__cparam-1]) {
      ac_transformed_pencil_shock=0.
    }
    if (AC_lpencil__mod__cdata[AC_i_gshock__mod__cparam-1]) {
      ac_transformed_pencil_gshock.x = 0.
      ac_transformed_pencil_gshock.y = 0.
      ac_transformed_pencil_gshock.z = 0.
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_ma2__mod__cparam-1]) {
    ac_transformed_pencil_ma2=ac_transformed_pencil_u2/ac_transformed_pencil_cs2
  }
  if (AC_lpencil__mod__cdata[AC_i_ugss__mod__cparam-1]) {
    ac_transformed_pencil_ugss = dot(ac_transformed_pencil_uu,ac_transformed_pencil_gss)
    if (AC_lupw_ss__mod__energy) ac_transformed_pencil_ugss = ac_transformed_pencil_ugss - dot(abs(ac_transformed_pencil_uu),gradient_upwd(Field(AC_iss__mod__cdata-1)))
    if (AC_lreference_state__mod__cdata) {
      ac_transformed_pencil_ugss = ac_transformed_pencil_ugss + ac_transformed_pencil_uu.x*AC_reference_state__mod__density[vertexIdx.x][AC_iref_gs__mod__cparam-1]
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_uglntt__mod__cparam-1]) {
    ac_transformed_pencil_uglntt = dot(ac_transformed_pencil_uu,ac_transformed_pencil_glntt)
    if (AC_lupw_ss__mod__energy) ac_transformed_pencil_uglntt = ac_transformed_pencil_uglntt - dot(abs(ac_transformed_pencil_uu),gradient_upwd(Field(AC_iss__mod__cdata-1)))
  }
  if (AC_lpencil__mod__cdata[AC_i_sglntt__mod__cparam-1]) {
    ac_transformed_pencil_sglntt = ac_transformed_pencil_sij*ac_transformed_pencil_glntt
  }
  if (AC_lpencil__mod__cdata[AC_i_fpres__mod__cparam-1]) {
    if (AC_lfpres_from_pressure__mod__energy) {
      ac_transformed_pencil_fpres = gradient(Field(AC_ippaux__mod__energy-1))
      ac_transformed_pencil_fpres.x=-ac_transformed_pencil_rho1*ac_transformed_pencil_fpres.x
      ac_transformed_pencil_fpres.y=-ac_transformed_pencil_rho1*ac_transformed_pencil_fpres.y
      ac_transformed_pencil_fpres.z=-ac_transformed_pencil_rho1*ac_transformed_pencil_fpres.z
    }
    else {
      if (AC_leos_idealgas__mod__cparam) {
        ac_transformed_pencil_fpres.x=-ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.x + ac_transformed_pencil_glntt.x)*AC_gamma1__mod__energy
        ac_transformed_pencil_fpres.y=-ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.y + ac_transformed_pencil_glntt.y)*AC_gamma1__mod__energy
        ac_transformed_pencil_fpres.z=-ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.z + ac_transformed_pencil_glntt.z)*AC_gamma1__mod__energy
      }
      else {
        ac_transformed_pencil_fpres.x=-ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.x + ac_transformed_pencil_cp1tilde*ac_transformed_pencil_gss.x)
        ac_transformed_pencil_fpres.y=-ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.y + ac_transformed_pencil_cp1tilde*ac_transformed_pencil_gss.y)
        ac_transformed_pencil_fpres.z=-ac_transformed_pencil_cs2*(ac_transformed_pencil_glnrho.z + ac_transformed_pencil_cp1tilde*ac_transformed_pencil_gss.z)
      }
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_transprhos__mod__cparam-1] && AC_ldensity_nolog__mod__cdata) {
    if (AC_lreference_state__mod__cdata) {
      ac_transformed_pencil_transprhos = AC_impossible__mod__cparam
    }
    else {
      ac_transformed_pencil_transprhos = AC_impossible__mod__cparam
    }
  }
  if (AC_lpencil__mod__cdata[AC_i_initlnrho__mod__cparam-1] && AC_iglobal_lnrho0__mod__cdata!=0) {
    ac_transformed_pencil_initlnrho=value(Field(AC_iglobal_lnrho0__mod__cdata-1))
  }
  if (AC_lpencil__mod__cdata[AC_i_initss__mod__cparam-1] && AC_iglobal_ss0__mod__cdata!=0) {
    ac_transformed_pencil_initss=value(Field(AC_iglobal_ss0__mod__cdata-1))
  }
  if (AC_lpencil__mod__cdata[AC_i_uuadvec_gss__mod__cparam-1]) {
    ac_transformed_pencil_uuadvec_gss = dot(ac_transformed_pencil_uu_advec,ac_transformed_pencil_gss)
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
    if (AC_lhydro__mod__cparam && AC_ldensity__mod__cparam) {
      if (AC_lreduced_sound_speed__mod__density) {
        if (AC_lscale_to_cs2top__mod__density) {
          ac_transformed_pencil_advec_cs2=AC_reduce_cs2__mod__density*AC_cs2top__mod__equationofstate*dxyz_2__mod__cdata
        }
        else {
          ac_transformed_pencil_advec_cs2=AC_reduce_cs2__mod__density*ac_transformed_pencil_cs2*dxyz_2__mod__cdata
        }
      }
      else {
        ac_transformed_pencil_advec_cs2=ac_transformed_pencil_cs2*dxyz_2__mod__cdata
      }
    }
  }
  if (AC_lviscosity__mod__cparam) {
    ac_transformed_pencil_fvisc.x = 0.0
    ac_transformed_pencil_fvisc.y = 0.0
    ac_transformed_pencil_fvisc.z = 0.0
    if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
      ac_transformed_pencil_visc_heat=0.0
    }
    ldiffus_total_66_100 = AC_lfirst__mod__cdata  &&  AC_ldt__mod__cdata  ||  AC_lpencil__mod__cdata[AC_i_diffus_total__mod__cparam-1]
    ldiffus_total3_66_100 = AC_lfirst__mod__cdata  &&  AC_ldt__mod__cdata  ||  AC_lpencil__mod__cdata[AC_i_diffus_total3__mod__cparam-1]
    if (ldiffus_total_66_100 || ldiffus_total3_66_100) {
      ac_transformed_pencil_diffus_total=0.0
      ac_transformed_pencil_diffus_total2=0.0
      ac_transformed_pencil_diffus_total3=0.0
    }
    if (! AC_limplicit_viscosity__mod__viscosity  &&  AC_lvisc_simplified__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+AC_nu__mod__viscosity*ac_transformed_pencil_del2u
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        if (AC_lboussinesq__mod__cparam) {
          ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2.*AC_nu__mod__viscosity*ac_transformed_pencil_sij2
        }
        else {
          ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+AC_nu__mod__viscosity*ac_transformed_pencil_o2
        }
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+AC_nu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_non_newtonian__mod__viscosity) {
      deljskl2_66_100.x = 0.
      deljskl2_66_100.y = 0.
      deljskl2_66_100.z = 0.
      gradnu_effective_66_100=0.
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[1-1][1-1][1-1]*ac_transformed_pencil_sij[1-1][1-1] + ac_transformed_pencil_uijk[1-1][1-1][1-1]*ac_transformed_pencil_sij[1-1][1-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[1-1][2-1][1-1]*ac_transformed_pencil_sij[2-1][1-1] + ac_transformed_pencil_uijk[2-1][1-1][1-1]*ac_transformed_pencil_sij[1-1][2-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[1-1][3-1][1-1]*ac_transformed_pencil_sij[3-1][1-1] + ac_transformed_pencil_uijk[3-1][1-1][1-1]*ac_transformed_pencil_sij[1-1][3-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[2-1][1-1][1-1]*ac_transformed_pencil_sij[1-1][2-1] + ac_transformed_pencil_uijk[1-1][2-1][1-1]*ac_transformed_pencil_sij[2-1][1-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[2-1][2-1][1-1]*ac_transformed_pencil_sij[2-1][2-1] + ac_transformed_pencil_uijk[2-1][2-1][1-1]*ac_transformed_pencil_sij[2-1][2-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[2-1][3-1][1-1]*ac_transformed_pencil_sij[3-1][2-1] + ac_transformed_pencil_uijk[3-1][2-1][1-1]*ac_transformed_pencil_sij[2-1][3-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[3-1][1-1][1-1]*ac_transformed_pencil_sij[1-1][3-1] + ac_transformed_pencil_uijk[1-1][3-1][1-1]*ac_transformed_pencil_sij[3-1][1-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[3-1][2-1][1-1]*ac_transformed_pencil_sij[2-1][3-1] + ac_transformed_pencil_uijk[2-1][3-1][1-1]*ac_transformed_pencil_sij[3-1][2-1]
      deljskl2_66_100 .x = deljskl2_66_100 .x +  ac_transformed_pencil_uijk[3-1][3-1][1-1]*ac_transformed_pencil_sij[3-1][3-1] + ac_transformed_pencil_uijk[3-1][3-1][1-1]*ac_transformed_pencil_sij[3-1][3-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[1-1][1-1][2-1]*ac_transformed_pencil_sij[1-1][1-1] + ac_transformed_pencil_uijk[1-1][1-1][2-1]*ac_transformed_pencil_sij[1-1][1-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[1-1][2-1][2-1]*ac_transformed_pencil_sij[2-1][1-1] + ac_transformed_pencil_uijk[2-1][1-1][2-1]*ac_transformed_pencil_sij[1-1][2-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[1-1][3-1][2-1]*ac_transformed_pencil_sij[3-1][1-1] + ac_transformed_pencil_uijk[3-1][1-1][2-1]*ac_transformed_pencil_sij[1-1][3-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[2-1][1-1][2-1]*ac_transformed_pencil_sij[1-1][2-1] + ac_transformed_pencil_uijk[1-1][2-1][2-1]*ac_transformed_pencil_sij[2-1][1-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[2-1][2-1][2-1]*ac_transformed_pencil_sij[2-1][2-1] + ac_transformed_pencil_uijk[2-1][2-1][2-1]*ac_transformed_pencil_sij[2-1][2-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[2-1][3-1][2-1]*ac_transformed_pencil_sij[3-1][2-1] + ac_transformed_pencil_uijk[3-1][2-1][2-1]*ac_transformed_pencil_sij[2-1][3-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[3-1][1-1][2-1]*ac_transformed_pencil_sij[1-1][3-1] + ac_transformed_pencil_uijk[1-1][3-1][2-1]*ac_transformed_pencil_sij[3-1][1-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[3-1][2-1][2-1]*ac_transformed_pencil_sij[2-1][3-1] + ac_transformed_pencil_uijk[2-1][3-1][2-1]*ac_transformed_pencil_sij[3-1][2-1]
      deljskl2_66_100 .y = deljskl2_66_100 .y +  ac_transformed_pencil_uijk[3-1][3-1][2-1]*ac_transformed_pencil_sij[3-1][3-1] + ac_transformed_pencil_uijk[3-1][3-1][2-1]*ac_transformed_pencil_sij[3-1][3-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[1-1][1-1][3-1]*ac_transformed_pencil_sij[1-1][1-1] + ac_transformed_pencil_uijk[1-1][1-1][3-1]*ac_transformed_pencil_sij[1-1][1-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[1-1][2-1][3-1]*ac_transformed_pencil_sij[2-1][1-1] + ac_transformed_pencil_uijk[2-1][1-1][3-1]*ac_transformed_pencil_sij[1-1][2-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[1-1][3-1][3-1]*ac_transformed_pencil_sij[3-1][1-1] + ac_transformed_pencil_uijk[3-1][1-1][3-1]*ac_transformed_pencil_sij[1-1][3-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[2-1][1-1][3-1]*ac_transformed_pencil_sij[1-1][2-1] + ac_transformed_pencil_uijk[1-1][2-1][3-1]*ac_transformed_pencil_sij[2-1][1-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[2-1][2-1][3-1]*ac_transformed_pencil_sij[2-1][2-1] + ac_transformed_pencil_uijk[2-1][2-1][3-1]*ac_transformed_pencil_sij[2-1][2-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[2-1][3-1][3-1]*ac_transformed_pencil_sij[3-1][2-1] + ac_transformed_pencil_uijk[3-1][2-1][3-1]*ac_transformed_pencil_sij[2-1][3-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[3-1][1-1][3-1]*ac_transformed_pencil_sij[1-1][3-1] + ac_transformed_pencil_uijk[1-1][3-1][3-1]*ac_transformed_pencil_sij[3-1][1-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[3-1][2-1][3-1]*ac_transformed_pencil_sij[2-1][3-1] + ac_transformed_pencil_uijk[2-1][3-1][3-1]*ac_transformed_pencil_sij[3-1][2-1]
      deljskl2_66_100 .z = deljskl2_66_100 .z +  ac_transformed_pencil_uijk[3-1][3-1][3-1]*ac_transformed_pencil_sij[3-1][3-1] + ac_transformed_pencil_uijk[3-1][3-1][3-1]*ac_transformed_pencil_sij[3-1][3-1]
      fvisc_nnewton2_66_100.x = sum(ac_transformed_pencil_sij.row(1-1)*deljskl2_66_100)
      fvisc_nnewton2_66_100.y = sum(ac_transformed_pencil_sij.row(2-1)*deljskl2_66_100)
      fvisc_nnewton2_66_100.z = sum(ac_transformed_pencil_sij.row(3-1)*deljskl2_66_100)
      if(AC_string_enum_nnewton_type__mod__viscosity == AC_string_enum_carreau_string__mod__cparam) {
        ac_transformed_pencil_nu = AC_nu_infinity__mod__viscosity +  (AC_nu0__mod__viscosity-AC_nu_infinity__mod__viscosity)/pow((1+(AC_non_newton_lambda__mod__viscosity*AC_non_newton_lambda__mod__viscosity)*ac_transformed_pencil_sij2),((1.-AC_carreau_exponent__mod__viscosity)/2.))
        gradnu_effective_66_100 = (AC_non_newton_lambda__mod__viscosity*AC_non_newton_lambda__mod__viscosity)*0.5*(AC_carreau_exponent__mod__viscosity-1.)*  (AC_nu0__mod__viscosity-AC_nu_infinity__mod__viscosity)/pow((1+(AC_non_newton_lambda__mod__viscosity*AC_non_newton_lambda__mod__viscosity)*ac_transformed_pencil_sij2),(1.5-AC_carreau_exponent__mod__viscosity/2.))
      }
      else if(AC_string_enum_nnewton_type__mod__viscosity == AC_string_enum_step_string__mod__cparam) {
        step_vector_return_value_36_38_66_100 = 0.5*(1+tanh((ac_transformed_pencil_sij2-AC_nnewton_tscale__mod__viscosity*AC_nnewton_tscale__mod__viscosity)/(AC_nnewton_step_width__mod__viscosity+AC_tini__mod__cparam)))
        ac_transformed_pencil_nu = AC_nu0__mod__viscosity+(AC_nu_infinity__mod__viscosity-AC_nu0__mod__viscosity)*step_vector_return_value_36_38_66_100
        arg_37_38_66_100 = abs((ac_transformed_pencil_sij2-AC_nnewton_tscale__mod__viscosity*AC_nnewton_tscale__mod__viscosity)/(AC_nnewton_step_width__mod__viscosity+AC_tini__mod__cparam))
        if (abs(arg_37_38_66_100)>=8.)  {
          der_step_return_value_37_38_66_100 = 2./AC_nnewton_step_width__mod__viscosity*exp(-2.*abs(arg_37_38_66_100))
        }
        else {
          der_step_return_value_37_38_66_100 = 0.5/(AC_nnewton_step_width__mod__viscosity*cosh(arg_37_38_66_100)*cosh(arg_37_38_66_100))
        }
        gradnu_effective_66_100 = (AC_nu_infinity__mod__viscosity-AC_nu0__mod__viscosity)*der_step_return_value_37_38_66_100
      }
      else {
      }
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_nu*ac_transformed_pencil_del2u.x + gradnu_effective_66_100*fvisc_nnewton2_66_100.x
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_nu*ac_transformed_pencil_del2u.y + gradnu_effective_66_100*fvisc_nnewton2_66_100.y
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_nu*ac_transformed_pencil_del2u.z + gradnu_effective_66_100*fvisc_nnewton2_66_100.z
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+AC_nu__mod__viscosity
      }
    }
    if (AC_lvisc_rho_nu_const__mod__viscosity) {
      if (AC_lvisc_rho_nu_const_prefact__mod__viscosity) {
        murho1_66_100=AC_nu__mod__viscosity
      }
      else {
        murho1_66_100=AC_nu__mod__viscosity*ac_transformed_pencil_rho1
      }
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + murho1_66_100*(ac_transformed_pencil_del2u.x+1.0/3.0*ac_transformed_pencil_graddivu.x)
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + murho1_66_100*(ac_transformed_pencil_del2u.y+1.0/3.0*ac_transformed_pencil_graddivu.y)
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + murho1_66_100*(ac_transformed_pencil_del2u.z+1.0/3.0*ac_transformed_pencil_graddivu.z)
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*murho1_66_100*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+murho1_66_100
      }
    }
    if (AC_lvisc_rho_nu_const_bulk__mod__viscosity) {
      zetarho1_66_100=AC_zeta__mod__viscosity*ac_transformed_pencil_rho1
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+zetarho1_66_100*ac_transformed_pencil_graddivu.x
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+zetarho1_66_100*ac_transformed_pencil_graddivu.y
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+zetarho1_66_100*ac_transformed_pencil_graddivu.z
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+zetarho1_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_divu
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+zetarho1_66_100
      }
    }
    if (AC_lvisc_sqrtrho_nu_const__mod__viscosity) {
      murho1_66_100=AC_nu__mod__viscosity*sqrt(ac_transformed_pencil_rho1)
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + murho1_66_100*(ac_transformed_pencil_del2u.x+1.0/3.0*ac_transformed_pencil_graddivu.x + ac_transformed_pencil_sglnrho.x)
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + murho1_66_100*(ac_transformed_pencil_del2u.y+1.0/3.0*ac_transformed_pencil_graddivu.y + ac_transformed_pencil_sglnrho.y)
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + murho1_66_100*(ac_transformed_pencil_del2u.z+1.0/3.0*ac_transformed_pencil_graddivu.z + ac_transformed_pencil_sglnrho.z)
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*murho1_66_100*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+murho1_66_100
      }
    }
    if (AC_lvisc_mu_cspeed__mod__viscosity) {
      mutt_66_100=AC_nu__mod__viscosity*ac_transformed_pencil_rho1*exp(AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_lntt)
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + mutt_66_100*(ac_transformed_pencil_del2u.x+1.0/3.0*ac_transformed_pencil_graddivu.x+2*AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_sglntt.x)
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + mutt_66_100*(ac_transformed_pencil_del2u.y+1.0/3.0*ac_transformed_pencil_graddivu.y+2*AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_sglntt.y)
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + mutt_66_100*(ac_transformed_pencil_del2u.z+1.0/3.0*ac_transformed_pencil_graddivu.z+2*AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_sglntt.z)
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*mutt_66_100*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+mutt_66_100
      }
    }
    if (AC_lvisc_spitzer__mod__viscosity) {
      if (AC_nu_spitzer_max__mod__viscosity != 0.0) {
        tmp3_66_100=AC_nu_spitzer__mod__viscosity*ac_transformed_pencil_rho1*exp(2.5*ac_transformed_pencil_lntt)
        mutt_66_100=AC_nu_spitzer_max__mod__viscosity*tmp3_66_100/sqrt(pow(AC_nu_spitzer_max__mod__viscosity,2.)+pow(tmp3_66_100,2.))
      }
      else {
        mutt_66_100=AC_nu_spitzer__mod__viscosity*ac_transformed_pencil_rho1*exp(2.5*ac_transformed_pencil_lntt)
      }
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + mutt_66_100*(ac_transformed_pencil_del2u.x+1.0/3.0*ac_transformed_pencil_graddivu.x+5.*ac_transformed_pencil_sglntt.x)
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + mutt_66_100*(ac_transformed_pencil_del2u.y+1.0/3.0*ac_transformed_pencil_graddivu.y+5.*ac_transformed_pencil_sglntt.y)
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + mutt_66_100*(ac_transformed_pencil_del2u.z+1.0/3.0*ac_transformed_pencil_graddivu.z+5.*ac_transformed_pencil_sglntt.z)
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*mutt_66_100*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+mutt_66_100
      }
    }
    if (AC_lvisc_nu_cspeed__mod__viscosity) {
      mutt_66_100=AC_nu__mod__viscosity*exp(AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_lntt)
      if (AC_ldensity__mod__cparam) {
        ac_transformed_pencil_fvisc.x =  ac_transformed_pencil_fvisc.x + 2*mutt_66_100*ac_transformed_pencil_sglnrho.x  + mutt_66_100*(ac_transformed_pencil_del2u.x + 1./3.*ac_transformed_pencil_graddivu.x + 2*AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_sglntt.x)
        ac_transformed_pencil_fvisc.y =  ac_transformed_pencil_fvisc.y + 2*mutt_66_100*ac_transformed_pencil_sglnrho.y  + mutt_66_100*(ac_transformed_pencil_del2u.y + 1./3.*ac_transformed_pencil_graddivu.y + 2*AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_sglntt.y)
        ac_transformed_pencil_fvisc.z =  ac_transformed_pencil_fvisc.z + 2*mutt_66_100*ac_transformed_pencil_sglnrho.z  + mutt_66_100*(ac_transformed_pencil_del2u.z + 1./3.*ac_transformed_pencil_graddivu.z + 2*AC_nu_cspeed__mod__viscosity*ac_transformed_pencil_sglntt.z)
      }
      else {
        if (AC_lmeanfield_nu__mod__viscosity) {
          if (AC_meanfield_nub__mod__viscosity!=0.) {
            tmp_66_100 = mutt_66_100*ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
            ac_transformed_pencil_fvisc = ac_transformed_pencil_fvisc + 1./sqrt(1.+ac_transformed_pencil_b2/AC_meanfield_nub__mod__viscosity*AC_meanfield_nub__mod__viscosity)*ac_transformed_pencil_fvisc+tmp_66_100
          }
        }
        else {
          ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+mutt_66_100*(ac_transformed_pencil_del2u.x+1.0/3.0*ac_transformed_pencil_graddivu.x+ac_transformed_pencil_sglntt.x)
          ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+mutt_66_100*(ac_transformed_pencil_del2u.y+1.0/3.0*ac_transformed_pencil_graddivu.y+ac_transformed_pencil_sglntt.y)
          ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+mutt_66_100*(ac_transformed_pencil_del2u.z+1.0/3.0*ac_transformed_pencil_graddivu.z+ac_transformed_pencil_sglntt.z)
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*mutt_66_100*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+mutt_66_100
      }
    }
    if (AC_lvisc_nu_const__mod__viscosity) {
      if (AC_ldensity__mod__cparam) {
        fac_66_100=AC_nu__mod__viscosity
        if (AC_damp_sound__mod__viscosity!=0.) {
          fac_66_100 = fac_66_100+AC_damp_sound__mod__viscosity*abs(ac_transformed_pencil_divu)
        }
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + fac_66_100*(ac_transformed_pencil_del2u.x + 2.*ac_transformed_pencil_sglnrho.x + 1./3.*ac_transformed_pencil_graddivu.x)
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + fac_66_100*(ac_transformed_pencil_del2u.y + 2.*ac_transformed_pencil_sglnrho.y + 1./3.*ac_transformed_pencil_graddivu.y)
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + fac_66_100*(ac_transformed_pencil_del2u.z + 2.*ac_transformed_pencil_sglnrho.z + 1./3.*ac_transformed_pencil_graddivu.z)
      }
      else {
        if (AC_lmeanfield_nu__mod__viscosity) {
          if (AC_meanfield_nub__mod__viscosity!=0.) {
            ac_transformed_pencil_fvisc = ac_transformed_pencil_fvisc + 1./sqrt(1.+ac_transformed_pencil_b2/AC_meanfield_nub__mod__viscosity*AC_meanfield_nub__mod__viscosity)*ac_transformed_pencil_fvisc+AC_nu__mod__viscosity*(ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu)
          }
        }
        else {
          ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+AC_nu__mod__viscosity*(ac_transformed_pencil_del2u+1.0/3.0*ac_transformed_pencil_graddivu)
        }
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*AC_nu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+AC_nu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_tdep__mod__viscosity  ||  AC_lvisc_hyper3_simplified_tdep__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+2*AC_nu_tdep__mod__viscosity*ac_transformed_pencil_sglnrho+AC_nu_tdep__mod__viscosity*(ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu)
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*AC_nu_tdep__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+AC_nu_tdep__mod__viscosity
      }
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_tdep__mod__viscosity
      }
    }
    if (AC_lvisc_mixture__mod__viscosity) {
      sgradnu_66_100 = ac_transformed_pencil_sij*ac_transformed_pencil_gradnu
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_nu*(ac_transformed_pencil_del2u.x+1./3.*ac_transformed_pencil_graddivu.x) + 2*sgradnu_66_100.x
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_nu*(ac_transformed_pencil_del2u.y+1./3.*ac_transformed_pencil_graddivu.y) + 2*sgradnu_66_100.y
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_nu*(ac_transformed_pencil_del2u.z+1./3.*ac_transformed_pencil_graddivu.z) + 2*sgradnu_66_100.z
      if (AC_ldensity__mod__cparam) {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + 2*ac_transformed_pencil_nu*ac_transformed_pencil_sglnrho.x
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + 2*ac_transformed_pencil_nu*ac_transformed_pencil_sglnrho.y
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + 2*ac_transformed_pencil_nu*ac_transformed_pencil_sglnrho.z
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*ac_transformed_pencil_nu*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+ac_transformed_pencil_nu
      }
    }
    if (AC_lvisc_nu_profx__mod__viscosity || AC_lvisc_nu_profr__mod__viscosity) {
      if (AC_lvisc_nu_profx__mod__viscosity) {
        tmp3_66_100=AC_x__mod__cdata[vertexIdx.x]
      }
      if (AC_lvisc_nu_profr__mod__viscosity) {
        if (AC_lspherical_coords__mod__cdata || AC_lsphere_in_a_box__mod__cdata) {
          tmp3_66_100=ac_transformed_pencil_r_mn
        }
        else {
          tmp3_66_100=ac_transformed_pencil_rcyl_mn
        }
      }
      step_vector_return_value_39_66_100 = 0.5*(1+tanh((tmp3_66_100-AC_xnu__mod__viscosity)/(AC_widthnu__mod__viscosity+AC_tini__mod__cparam)))
      step_vector_return_value_40_66_100 = 0.5*(1+tanh((tmp3_66_100-AC_xnu2__mod__viscosity)/(AC_widthnu__mod__viscosity+AC_tini__mod__cparam)))
      pnu__mod__viscosity = AC_nu__mod__viscosity + (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*(step_vector_return_value_39_66_100  -  step_vector_return_value_40_66_100)
      arg_41_66_100 = abs((tmp3_66_100-AC_xnu__mod__viscosity)/(AC_widthnu__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_41_66_100)>=8.)  {
        der_step_return_value_41_66_100 = 2./AC_widthnu__mod__viscosity*exp(-2.*abs(arg_41_66_100))
      }
      else {
        der_step_return_value_41_66_100 = 0.5/(AC_widthnu__mod__viscosity*cosh(arg_41_66_100)*cosh(arg_41_66_100))
      }
      arg_42_66_100 = abs((tmp3_66_100-AC_xnu2__mod__viscosity)/(AC_widthnu__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_42_66_100)>=8.)  {
        der_step_return_value_42_66_100 = 2./AC_widthnu__mod__viscosity*exp(-2.*abs(arg_42_66_100))
      }
      else {
        der_step_return_value_42_66_100 = 0.5/(AC_widthnu__mod__viscosity*cosh(arg_42_66_100)*cosh(arg_42_66_100))
      }
      tmp4_66_100 = (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*(der_step_return_value_41_66_100-der_step_return_value_42_66_100)
      gradnu_66_100.x = 0.
      gradnu_66_100.y = 0.
      gradnu_66_100.z = 0.
      if (AC_lvisc_nu_profx__mod__viscosity || (AC_lvisc_nu_profr__mod__viscosity && (AC_lcylindrical_coords__mod__cdata || AC_lspherical_coords__mod__cdata))) {
        gradnu_66_100.x=tmp4_66_100
        gradnu_66_100.y=0
        gradnu_66_100.z=0
      }
      else if (AC_lvisc_nu_profr__mod__viscosity && AC_lcylinder_in_a_box__mod__cdata) {
        gradnu_66_100.x=tmp4_66_100*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_rcyl_mn1
        gradnu_66_100.y=tmp4_66_100*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_rcyl_mn1
      }
      else if (AC_lvisc_nu_profr__mod__viscosity && AC_lsphere_in_a_box__mod__cdata) {
        gradnu_66_100.x=tmp4_66_100*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_r_mn1
        gradnu_66_100.y=tmp4_66_100*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_r_mn1
        gradnu_66_100.z=tmp4_66_100*AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1
      }
      sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
      tmp_66_100 = pnu__mod__viscosity*2*ac_transformed_pencil_sglnrho+ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100+2*sgradnu_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*pnu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+pnu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_profr_powerlaw__mod__viscosity) {
      if (!AC_luse_nu_rmn_prof__mod__viscosity) {
        if (AC_nu_rcyl_min__mod__viscosity==AC_impossible__mod__cparam) {
          pnu__mod__viscosity = AC_nu__mod__viscosity*pow((ac_transformed_pencil_rcyl_mn/AC_xnu__mod__viscosity),(-AC_pnlaw__mod__viscosity))
        }
        else {
          pnu__mod__viscosity = AC_nu__mod__viscosity*pow((max(AC_nu_rcyl_min__mod__viscosity,ac_transformed_pencil_rcyl_mn)/AC_xnu__mod__viscosity),(-AC_pnlaw__mod__viscosity))
        }
        if (AC_lcylindrical_coords__mod__cdata) {
          gradnu_66_100.x = -AC_pnlaw__mod__viscosity*AC_nu__mod__viscosity*pow((ac_transformed_pencil_rcyl_mn/AC_xnu__mod__viscosity),(-AC_pnlaw__mod__viscosity-1))*1/AC_xnu__mod__viscosity
          gradnu_66_100.y = 0.
          gradnu_66_100.z = 0.
        }
        else if (AC_lspherical_coords__mod__cdata) {
          if (AC_nu_rcyl_min__mod__viscosity==AC_impossible__mod__cparam) {
            gradnu_66_100.x = -AC_pnlaw__mod__viscosity*AC_nu__mod__viscosity*pow(ac_transformed_pencil_rcyl_mn,(-AC_pnlaw__mod__viscosity-1))*AC_sinth__mod__cdata[AC_m__mod__cdata-1]
            gradnu_66_100.y = -AC_pnlaw__mod__viscosity*AC_nu__mod__viscosity*pow(ac_transformed_pencil_rcyl_mn,(-AC_pnlaw__mod__viscosity-1))*AC_costh__mod__cdata[AC_m__mod__cdata-1]
            gradnu_66_100.z = 0.
          }
          else {
            gradnu_66_100.x = -AC_pnlaw__mod__viscosity*AC_nu__mod__viscosity*pow(max(AC_nu_rcyl_min__mod__viscosity,ac_transformed_pencil_rcyl_mn),(-AC_pnlaw__mod__viscosity-1))*AC_sinth__mod__cdata[AC_m__mod__cdata-1]
            gradnu_66_100.y = -AC_pnlaw__mod__viscosity*AC_nu__mod__viscosity*pow(max(AC_nu_rcyl_min__mod__viscosity,ac_transformed_pencil_rcyl_mn),(-AC_pnlaw__mod__viscosity-1))*AC_costh__mod__cdata[AC_m__mod__cdata-1]
            gradnu_66_100.z = 0.
          }
        }
        else {
        }
      }
      else {
        pnu__mod__viscosity = AC_nu__mod__viscosity*pow((ac_transformed_pencil_r_mn/AC_xnu__mod__viscosity),(-AC_pnlaw__mod__viscosity))
        if (AC_lspherical_coords__mod__cdata) {
          gradnu_66_100.x = -AC_pnlaw__mod__viscosity*AC_nu__mod__viscosity*pow((ac_transformed_pencil_r_mn/AC_xnu__mod__viscosity),(-AC_pnlaw__mod__viscosity-1))*1/AC_xnu__mod__viscosity
          gradnu_66_100.y = 0.
          gradnu_66_100.z = 0.
        }
        else {
        }
      }
      sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
      tmp_66_100 = pnu__mod__viscosity*2*ac_transformed_pencil_sglnrho+ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100+2*sgradnu_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*pnu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+pnu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_profr_twosteps__mod__viscosity) {
      if (AC_lspherical_coords__mod__cdata || AC_lsphere_in_a_box__mod__cdata) {
        tmp3_66_100=ac_transformed_pencil_r_mn
      }
      else {
        tmp3_66_100=ac_transformed_pencil_rcyl_mn
      }
      step_vector_return_value_44_66_100 = 0.5*(1+tanh((tmp3_66_100-AC_xnu2__mod__viscosity)/(AC_widthnu2__mod__viscosity+AC_tini__mod__cparam)))
      prof2_66_100    = step_vector_return_value_44_66_100
      step_vector_return_value_45_66_100 = 0.5*(1+tanh((tmp3_66_100-AC_xnu__mod__viscosity)/(AC_widthnu__mod__viscosity+AC_tini__mod__cparam)))
      prof_66_100     = step_vector_return_value_45_66_100-prof2_66_100
      arg_46_66_100 = abs((tmp3_66_100-AC_xnu2__mod__viscosity)/(AC_widthnu2__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_46_66_100)>=8.)  {
        der_step_return_value_46_66_100 = 2./AC_widthnu2__mod__viscosity*exp(-2.*abs(arg_46_66_100))
      }
      else {
        der_step_return_value_46_66_100 = 0.5/(AC_widthnu2__mod__viscosity*cosh(arg_46_66_100)*cosh(arg_46_66_100))
      }
      derprof2_66_100 = der_step_return_value_46_66_100
      arg_47_66_100 = abs((tmp3_66_100-AC_xnu__mod__viscosity)/(AC_widthnu__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_47_66_100)>=8.)  {
        der_step_return_value_47_66_100 = 2./AC_widthnu__mod__viscosity*exp(-2.*abs(arg_47_66_100))
      }
      else {
        der_step_return_value_47_66_100 = 0.5/(AC_widthnu__mod__viscosity*cosh(arg_47_66_100)*cosh(arg_47_66_100))
      }
      derprof_66_100  = der_step_return_value_47_66_100-derprof2_66_100
      pnu__mod__viscosity  = AC_nu__mod__viscosity + (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*prof_66_100+(AC_nu__mod__viscosity*(AC_nu_jump2__mod__viscosity-1.))*prof2_66_100
      tmp4_66_100 = AC_nu__mod__viscosity + (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*derprof_66_100+(AC_nu__mod__viscosity*(AC_nu_jump2__mod__viscosity-1.))*derprof2_66_100
      gradnu_66_100.x = 0.
      gradnu_66_100.y = 0.
      gradnu_66_100.z = 0.
      if (AC_lvisc_nu_profx__mod__viscosity || (AC_lvisc_nu_profr_twosteps__mod__viscosity && (AC_lcylindrical_coords__mod__cdata || AC_lspherical_coords__mod__cdata))) {
        gradnu_66_100.x=tmp4_66_100
        gradnu_66_100.y=0
        gradnu_66_100.z=0
      }
      else if (AC_lvisc_nu_profr_twosteps__mod__viscosity && AC_lcylinder_in_a_box__mod__cdata) {
        gradnu_66_100.x=tmp4_66_100*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_rcyl_mn1
        gradnu_66_100.y=tmp4_66_100*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_rcyl_mn1
      }
      else if (AC_lvisc_nu_profr_twosteps__mod__viscosity && AC_lsphere_in_a_box__mod__cdata) {
        gradnu_66_100.x=tmp4_66_100*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_r_mn1
        gradnu_66_100.y=tmp4_66_100*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_r_mn1
        gradnu_66_100.z=tmp4_66_100*AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1
      }
      sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
      tmp_66_100 = pnu__mod__viscosity*2*ac_transformed_pencil_sglnrho+ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100+2*sgradnu_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*pnu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+pnu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_profy_bound__mod__viscosity) {
      if (AC_lspherical_coords__mod__cdata || AC_lsphere_in_a_box__mod__cdata) {
        tmp3_66_100=ac_transformed_pencil_r_mn
      }
      else if (AC_lcylindrical_coords__mod__cdata) {
        tmp3_66_100=ac_transformed_pencil_rcyl_mn
      }
      else {
        tmp3_66_100=1.0
      }
      tmp4_66_100    = AC_y__mod__cdata[AC_m__mod__cdata-1]
      step_vector_return_value_49_66_100 = 0.5*(1+tanh((tmp4_66_100-AC_xyz1__mod__cdata.y-3*AC_dynu__mod__viscosity)/(AC_dynu__mod__viscosity+AC_tini__mod__cparam)))
      step_vector_return_value_50_66_100 = 0.5*(1+tanh((tmp4_66_100-AC_xyz0__mod__cdata.y+3*AC_dynu__mod__viscosity)/(-AC_dynu__mod__viscosity+AC_tini__mod__cparam)))
      prof_66_100    =     step_vector_return_value_49_66_100 +     step_vector_return_value_50_66_100
      arg_51_66_100 = abs((tmp4_66_100-AC_xyz1__mod__cdata.y-3*AC_dynu__mod__viscosity)/(AC_dynu__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_51_66_100)>=8.)  {
        der_step_return_value_51_66_100 = 2./AC_dynu__mod__viscosity*exp(-2.*abs(arg_51_66_100))
      }
      else {
        der_step_return_value_51_66_100 = 0.5/(AC_dynu__mod__viscosity*cosh(arg_51_66_100)*cosh(arg_51_66_100))
      }
      arg_52_66_100 = abs((tmp4_66_100-AC_xyz0__mod__cdata.y+3*AC_dynu__mod__viscosity)/(-AC_dynu__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_52_66_100)>=8.)  {
        der_step_return_value_52_66_100 = 2./-AC_dynu__mod__viscosity*exp(-2.*abs(arg_52_66_100))
      }
      else {
        der_step_return_value_52_66_100 = 0.5/(-AC_dynu__mod__viscosity*cosh(arg_52_66_100)*cosh(arg_52_66_100))
      }
      derprof_66_100 = der_step_return_value_51_66_100 + der_step_return_value_52_66_100
      pnu__mod__viscosity  = AC_nu__mod__viscosity + (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*prof_66_100
      gradnu_66_100.x = 0.
      gradnu_66_100.y = (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*derprof_66_100/tmp3_66_100
      gradnu_66_100.z = 0.
      sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
      tmp_66_100 = pnu__mod__viscosity*2*ac_transformed_pencil_sglnrho+ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100+2*sgradnu_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*pnu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+pnu__mod__viscosity
      }
    }
    if (AC_lvisc_nut_from_magnetic__mod__viscosity) {
      pnu__mod__viscosity=AC_prm_turb__mod__viscosity*AC_etat_x__mod__magnetic_meanfield[vertexIdx.x-NGHOST_VAL]*AC_etat_y__mod__magnetic_meanfield[AC_m__mod__cdata-1]*AC_etat_z__mod__magnetic_meanfield[AC_n__mod__cdata-1]
      gradnu_66_100.x=AC_prm_turb__mod__viscosity*AC_detat_x__mod__magnetic_meanfield[vertexIdx.x-NGHOST_VAL]*AC_etat_y__mod__magnetic_meanfield[AC_m__mod__cdata-1]*AC_etat_z__mod__magnetic_meanfield[AC_n__mod__cdata-1]
      gradnu_66_100.y=AC_prm_turb__mod__viscosity*AC_etat_x__mod__magnetic_meanfield[vertexIdx.x-NGHOST_VAL]*AC_detat_y__mod__magnetic_meanfield[AC_m__mod__cdata-1]*AC_etat_z__mod__magnetic_meanfield[AC_n__mod__cdata-1]
      gradnu_66_100.z=AC_prm_turb__mod__viscosity*AC_etat_x__mod__magnetic_meanfield[vertexIdx.x-NGHOST_VAL]*AC_etat_y__mod__magnetic_meanfield[AC_m__mod__cdata-1]*AC_detat_z__mod__magnetic_meanfield[AC_n__mod__cdata-1]
      sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
      tmp_66_100 = pnu__mod__viscosity*2*ac_transformed_pencil_sglnrho+ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100+2*sgradnu_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*pnu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+pnu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_prof__mod__viscosity) {
      step_vector_return_value_53_66_100 = 0.5*(1+tanh((ac_transformed_pencil_z_mn-AC_znu__mod__viscosity)/(-AC_widthnu__mod__viscosity+AC_tini__mod__cparam)))
      pnu__mod__viscosity = AC_nu__mod__viscosity + (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*step_vector_return_value_53_66_100
      gradnu_66_100.x = 0.
      gradnu_66_100.y = 0.
      arg_54_66_100 = abs((ac_transformed_pencil_z_mn-AC_znu__mod__viscosity)/(-AC_widthnu__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_54_66_100)>=8.)  {
        der_step_return_value_54_66_100 = 2./-AC_widthnu__mod__viscosity*exp(-2.*abs(arg_54_66_100))
      }
      else {
        der_step_return_value_54_66_100 = 0.5/(-AC_widthnu__mod__viscosity*cosh(arg_54_66_100)*cosh(arg_54_66_100))
      }
      gradnu_66_100.z = (AC_nu__mod__viscosity*(AC_nu_jump__mod__viscosity-1.))*der_step_return_value_54_66_100
      sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
      tmp_66_100 = pnu__mod__viscosity*2*ac_transformed_pencil_sglnrho+ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100+2*sgradnu_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*pnu__mod__viscosity*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+pnu__mod__viscosity
      }
    }
    if (AC_lvisc_nu_shock__mod__viscosity) {
      tmp2_66_100 = ac_transformed_pencil_divu*ac_transformed_pencil_glnrho
      tmp_66_100=tmp2_66_100 + ac_transformed_pencil_graddivu
      tmp2_66_100 = AC_nu_shock__mod__viscosity*ac_transformed_pencil_shock*tmp_66_100
      tmp_66_100.x=tmp2_66_100.x+AC_nu_shock__mod__viscosity*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.x
      tmp_66_100.y=tmp2_66_100.y+AC_nu_shock__mod__viscosity*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.y
      tmp_66_100.z=tmp2_66_100.z+AC_nu_shock__mod__viscosity*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.z
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+(AC_nu_shock__mod__viscosity*ac_transformed_pencil_shock)
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1] && AC_lshock_heat__mod__cdata) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+AC_nu_shock__mod__viscosity*ac_transformed_pencil_shock*ac_transformed_pencil_divu*ac_transformed_pencil_divu
      }
    }
    if (AC_lvisc_nu_shock_profz__mod__viscosity) {
      step_vector_return_value_56_66_100 = 0.5*(1+tanh((ac_transformed_pencil_z_mn-AC_znu_shock__mod__viscosity)/(-AC_widthnu_shock__mod__viscosity+AC_tini__mod__cparam)))
      pnu_shock_66_100 = AC_nu_shock__mod__viscosity + (AC_nu_shock__mod__viscosity*(AC_nu_jump_shock__mod__viscosity-1.))*step_vector_return_value_56_66_100
      gradnu_shock_66_100.x = 0.
      gradnu_shock_66_100.y = 0.
      arg_57_66_100 = abs((ac_transformed_pencil_z_mn-AC_znu_shock__mod__viscosity)/(-AC_widthnu_shock__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_57_66_100)>=8.)  {
        der_step_return_value_57_66_100 = 2./-AC_widthnu_shock__mod__viscosity*exp(-2.*abs(arg_57_66_100))
      }
      else {
        der_step_return_value_57_66_100 = 0.5/(-AC_widthnu_shock__mod__viscosity*cosh(arg_57_66_100)*cosh(arg_57_66_100))
      }
      gradnu_shock_66_100.z = (AC_nu_shock__mod__viscosity*(AC_nu_jump_shock__mod__viscosity-1.))*der_step_return_value_57_66_100
      tmp2_66_100 = ac_transformed_pencil_divu*ac_transformed_pencil_glnrho
      tmp_66_100=tmp2_66_100 + ac_transformed_pencil_graddivu
      tmp2_66_100 = pnu_shock_66_100*ac_transformed_pencil_shock*tmp_66_100
      tmp_66_100.x=tmp2_66_100.x+pnu_shock_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.x
      tmp_66_100.y=tmp2_66_100.y+pnu_shock_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.y
      tmp_66_100.z=tmp2_66_100.z+pnu_shock_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.z
      tmp_66_100 = tmp_66_100 + ac_transformed_pencil_shock*ac_transformed_pencil_divu*gradnu_shock_66_100
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+(pnu_shock_66_100*ac_transformed_pencil_shock)
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1] && AC_lshock_heat__mod__cdata) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+pnu_shock_66_100*ac_transformed_pencil_shock*ac_transformed_pencil_divu*ac_transformed_pencil_divu
      }
    }
    if (AC_lvisc_nu_shock_profr__mod__viscosity) {
      if (AC_lspherical_coords__mod__cdata || AC_lsphere_in_a_box__mod__cdata) {
        tmp3_66_100=ac_transformed_pencil_r_mn
      }
      else {
        tmp3_66_100=ac_transformed_pencil_rcyl_mn
      }
      step_vector_return_value_59_66_100 = 0.5*(1+tanh((tmp3_66_100-AC_xnu_shock__mod__viscosity)/(AC_widthnu_shock__mod__viscosity+AC_tini__mod__cparam)))
      pnu_shock_66_100 = AC_nu_shock__mod__viscosity + (AC_nu_shock__mod__viscosity*(AC_nu_jump_shock__mod__viscosity-1.))*step_vector_return_value_59_66_100
      arg_60_66_100 = abs((tmp3_66_100-AC_xnu_shock__mod__viscosity)/(AC_widthnu_shock__mod__viscosity+AC_tini__mod__cparam))
      if (abs(arg_60_66_100)>=8.)  {
        der_step_return_value_60_66_100 = 2./AC_widthnu_shock__mod__viscosity*exp(-2.*abs(arg_60_66_100))
      }
      else {
        der_step_return_value_60_66_100 = 0.5/(AC_widthnu_shock__mod__viscosity*cosh(arg_60_66_100)*cosh(arg_60_66_100))
      }
      gradnu_shock_66_100.x = (AC_nu_shock__mod__viscosity*(AC_nu_jump_shock__mod__viscosity-1.))*der_step_return_value_60_66_100
      gradnu_shock_66_100.y = 0.
      gradnu_shock_66_100.z = 0.
      tmp2_66_100 = ac_transformed_pencil_divu*ac_transformed_pencil_glnrho
      tmp_66_100=tmp2_66_100 + ac_transformed_pencil_graddivu
      tmp2_66_100 = pnu_shock_66_100*ac_transformed_pencil_shock*tmp_66_100
      tmp_66_100.x=tmp2_66_100.x+pnu_shock_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.x
      tmp_66_100.y=tmp2_66_100.y+pnu_shock_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.y
      tmp_66_100.z=tmp2_66_100.z+pnu_shock_66_100*ac_transformed_pencil_divu*ac_transformed_pencil_gshock.z
      tmp_66_100 = tmp_66_100 + ac_transformed_pencil_shock*ac_transformed_pencil_divu*gradnu_shock_66_100
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+(pnu_shock_66_100*ac_transformed_pencil_shock)
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1] && AC_lshock_heat__mod__cdata) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+pnu_shock_66_100*ac_transformed_pencil_shock*ac_transformed_pencil_divu*ac_transformed_pencil_divu
      }
    }
    if (AC_lvisc_shock_simple__mod__viscosity) {
      tmp3_66_100 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_uij.row(1-1))
      tmp_66_100.x = tmp3_66_100 + ac_transformed_pencil_shock * ac_transformed_pencil_del2u.x
      tmp3_66_100 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_uij.row(2-1))
      tmp_66_100.y = tmp3_66_100 + ac_transformed_pencil_shock * ac_transformed_pencil_del2u.y
      tmp3_66_100 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_uij.row(3-1))
      tmp_66_100.z = tmp3_66_100 + ac_transformed_pencil_shock * ac_transformed_pencil_del2u.z
      ac_transformed_pencil_fvisc = ac_transformed_pencil_fvisc + AC_nu_shock__mod__viscosity * tmp_66_100
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total = ac_transformed_pencil_diffus_total + AC_nu_shock__mod__viscosity * ac_transformed_pencil_shock
      }
    }
    if (AC_lvisc_hyper2_simplified__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc-AC_nu_hyper2__mod__viscosity*ac_transformed_pencil_del4u
      if (AC_lfirst__mod__cdata  &&  AC_ldt__mod__cdata) {
        ac_transformed_pencil_diffus_total2=ac_transformed_pencil_diffus_total2+AC_nu_hyper2__mod__viscosity
      }
    }
    if (AC_lvisc_hyper3_simplified__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_del6u
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3__mod__viscosity
      }
    }
    if (AC_lvisc_hyper2_simplified_tdep__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc-AC_nu_tdep__mod__viscosity*ac_transformed_pencil_del4u
      if (AC_lfirst__mod__cdata  &&  AC_ldt__mod__cdata) {
        ac_transformed_pencil_diffus_total2=ac_transformed_pencil_diffus_total2+AC_nu_tdep__mod__viscosity
      }
    }
    if (AC_lvisc_hyper3_simplified_tdep__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+AC_nu_tdep__mod__viscosity*ac_transformed_pencil_del6u
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_tdep__mod__viscosity
      }
    }
    if (AC_lvisc_hyper3_polar__mod__viscosity) {
      ju_66_100=1+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.x*dline_1__mod__cdata.x
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.y*dline_1__mod__cdata.y
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.z*dline_1__mod__cdata.z
      ju_66_100=2+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.x*dline_1__mod__cdata.x
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.y*dline_1__mod__cdata.y
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.z*dline_1__mod__cdata.z
      ju_66_100=3+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.x*dline_1__mod__cdata.x
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.y*dline_1__mod__cdata.y
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*tmp3_66_100*dline_1__mod__cdata.z*dline_1__mod__cdata.z
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3__mod__viscosity*AC_pi4_1__mod__cparam*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata
      }
    }
    if (AC_lvisc_hyper3_mesh__mod__viscosity) {
      ju_66_100=1+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.x
      }
      else {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.x
      }
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.y
      }
      else {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.y
      }
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.z
      }
      else {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.z
      }
      ju_66_100=2+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.x
      }
      else {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.x
      }
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.y
      }
      else {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.y
      }
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.z
      }
      else {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.z
      }
      ju_66_100=3+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.x
      }
      else {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.x
      }
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.y
      }
      else {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.y
      }
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity * tmp3_66_100 * dline_1__mod__cdata.z
      }
      else {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.* tmp3_66_100 *dline_1__mod__cdata.z
      }
      if (ldiffus_total3_66_100) {
        if (AC_ldynamical_diffusion__mod__cdata) {
          ac_transformed_pencil_diffus_total3 = ac_transformed_pencil_diffus_total3 + AC_nu_hyper3_mesh__mod__viscosity
          advec_hypermesh_uu_66_100 = 0.0
        }
        else {
          advec_hypermesh_uu_66_100=AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata)
        }
        advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_uu_66_100*advec_hypermesh_uu_66_100
      }
    }
    if (AC_lvisc_hyper3_mesh_residual__mod__viscosity) {
      ju_66_100=1+AC_iuu__mod__cdata-1
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity * sum(ac_transformed_pencil_der6u_res.col(1-1) * dline_1__mod__cdata)
      }
      else {
        ac_transformed_pencil_fvisc.x = ac_transformed_pencil_fvisc.x + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.*sum(ac_transformed_pencil_der6u_res.col(1-1)*dline_1__mod__cdata)
      }
      ju_66_100=2+AC_iuu__mod__cdata-1
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity * sum(ac_transformed_pencil_der6u_res.col(2-1) * dline_1__mod__cdata)
      }
      else {
        ac_transformed_pencil_fvisc.y = ac_transformed_pencil_fvisc.y + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.*sum(ac_transformed_pencil_der6u_res.col(2-1)*dline_1__mod__cdata)
      }
      ju_66_100=3+AC_iuu__mod__cdata-1
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity * sum(ac_transformed_pencil_der6u_res.col(3-1) * dline_1__mod__cdata)
      }
      else {
        ac_transformed_pencil_fvisc.z = ac_transformed_pencil_fvisc.z + AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam/60.*sum(ac_transformed_pencil_der6u_res.col(3-1)*dline_1__mod__cdata)
      }
      if (ldiffus_total3_66_100) {
        if (AC_ldynamical_diffusion__mod__cdata) {
          ac_transformed_pencil_diffus_total3 = ac_transformed_pencil_diffus_total3 + AC_nu_hyper3_mesh__mod__viscosity
          advec_hypermesh_uu_66_100 = 0.0
        }
        else {
          advec_hypermesh_uu_66_100=AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata)
        }
        advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_uu_66_100*advec_hypermesh_uu_66_100
      }
    }
    if (AC_lvisc_hyper3_csmesh__mod__viscosity) {
      ju_66_100=1+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.x
      }
      else {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.x
      }
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.y
      }
      else {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.y
      }
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.z
      }
      else {
        ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.z
      }
      ju_66_100=2+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.x
      }
      else {
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.x
      }
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.y
      }
      else {
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.y
      }
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.z
      }
      else {
        ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.z
      }
      ju_66_100=3+AC_iuu__mod__cdata-1
      tmp3_66_100 = der6x_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.x
      }
      else {
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.x
      }
      tmp3_66_100 = der6y_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.y
      }
      else {
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.y
      }
      tmp3_66_100 = der6z_ignore_spacing(Field(ju_66_100-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*tmp3_66_100*dline_1__mod__cdata.z
      }
      else {
        ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)*AC_pi5_1__mod__cparam/60.*tmp3_66_100*dline_1__mod__cdata.z
      }
      if (ldiffus_total3_66_100) {
        if (AC_ldynamical_diffusion__mod__cdata) {
          ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3_mesh__mod__viscosity*sqrt(ac_transformed_pencil_cs2)
          advec_hypermesh_uu_66_100=0.0
        }
        else {
          advec_hypermesh_uu_66_100=AC_nu_hyper3_mesh__mod__viscosity*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata*ac_transformed_pencil_cs2)
        }
        advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_uu_66_100*advec_hypermesh_uu_66_100
      }
    }
    if (AC_lvisc_hyper3_rho_nu_const__mod__viscosity) {
      murho1_66_100=AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+murho1_66_100*ac_transformed_pencil_del6u.x
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+murho1_66_100*ac_transformed_pencil_del6u.y
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+murho1_66_100*ac_transformed_pencil_del6u.z
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+murho1_66_100
      }
    }
    if (AC_lvisc_hyper3_rho_nu_const_symm__mod__viscosity) {
      murho1_66_100=AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+murho1_66_100*(ac_transformed_pencil_del6u.x + ac_transformed_pencil_grad5divu.x)
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+murho1_66_100*(ac_transformed_pencil_del6u.y + ac_transformed_pencil_grad5divu.y)
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+murho1_66_100*(ac_transformed_pencil_del6u.z + ac_transformed_pencil_grad5divu.z)
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[1-1][1-1]+ac_transformed_pencil_uij5[1-1][1-1])*ac_transformed_pencil_uij[1-1][1-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[1-1][2-1]+ac_transformed_pencil_uij5[2-1][1-1])*ac_transformed_pencil_uij[1-1][2-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[1-1][3-1]+ac_transformed_pencil_uij5[3-1][1-1])*ac_transformed_pencil_uij[1-1][3-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[2-1][1-1]+ac_transformed_pencil_uij5[1-1][2-1])*ac_transformed_pencil_uij[2-1][1-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[2-1][2-1]+ac_transformed_pencil_uij5[2-1][2-1])*ac_transformed_pencil_uij[2-1][2-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[2-1][3-1]+ac_transformed_pencil_uij5[3-1][2-1])*ac_transformed_pencil_uij[2-1][3-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[3-1][1-1]+ac_transformed_pencil_uij5[1-1][3-1])*ac_transformed_pencil_uij[3-1][1-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[3-1][2-1]+ac_transformed_pencil_uij5[2-1][3-1])*ac_transformed_pencil_uij[3-1][2-1]
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat + 0.5*AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_uij5[3-1][3-1]+ac_transformed_pencil_uij5[3-1][3-1])*ac_transformed_pencil_uij[3-1][3-1]
      }
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+murho1_66_100
      }
    }
    if (AC_lvisc_hyper3_mu_const_strict__mod__viscosity) {
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1*value(Field(AC_ihypvis__mod__cdata-1+1-1))
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1*value(Field(AC_ihypvis__mod__cdata-1+2-1))
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1*value(Field(AC_ihypvis__mod__cdata-1+3-1))
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3__mod__viscosity
      }
    }
    if (AC_lvisc_hyper3_cmu_const_strt_otf__mod__viscosity) {
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1*(ac_transformed_pencil_del6u_strict.x + 1./3*ac_transformed_pencil_del4graddivu.x)
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1*(ac_transformed_pencil_del6u_strict.y + 1./3*ac_transformed_pencil_del4graddivu.y)
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1*(ac_transformed_pencil_del6u_strict.z + 1./3*ac_transformed_pencil_del4graddivu.z)
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3__mod__viscosity
      }
    }
    if (AC_lvisc_hyper3_nu_const_strict__mod__viscosity) {
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+AC_nu_hyper3__mod__viscosity*value(Field(AC_ihypvis__mod__cdata-1+1-1))
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+AC_nu_hyper3__mod__viscosity*value(Field(AC_ihypvis__mod__cdata-1+2-1))
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+AC_nu_hyper3__mod__viscosity*value(Field(AC_ihypvis__mod__cdata-1+3-1))
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3__mod__viscosity
      }
    }
    if (AC_lvisc_hyper3_rho_nu_const_aniso__mod__viscosity) {
      k1_62_66_100=AC_iuu__mod__cdata-1
      tmp_62_66_100  = del6fj(Field(k1_62_66_100+1-1), AC_nu_aniso_hyper3__mod__viscosity)
      tmp_66_100.x=tmp_62_66_100
      tmp_62_66_100  = del6fj(Field(k1_62_66_100+2-1), AC_nu_aniso_hyper3__mod__viscosity)
      tmp_66_100.y=tmp_62_66_100
      tmp_62_66_100  = del6fj(Field(k1_62_66_100+3-1), AC_nu_aniso_hyper3__mod__viscosity)
      tmp_66_100.z=tmp_62_66_100
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp_66_100.x*ac_transformed_pencil_rho1
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp_66_100.y*ac_transformed_pencil_rho1
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp_66_100.z*ac_transformed_pencil_rho1
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3 +  (AC_nu_aniso_hyper3__mod__viscosity.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x +  AC_nu_aniso_hyper3__mod__viscosity.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y +  AC_nu_aniso_hyper3__mod__viscosity.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)/dxyz_6__mod__cdata
      }
    }
    if (AC_lvisc_hyper3_nu_const_aniso__mod__viscosity) {
      k1_63_66_100=AC_iuu__mod__cdata-1
      tmp_63_66_100  = del6fj(Field(k1_63_66_100+1-1), AC_nu_aniso_hyper3__mod__viscosity)
      tmp_66_100.x=tmp_63_66_100
      tmp_63_66_100  = del6fj(Field(k1_63_66_100+2-1), AC_nu_aniso_hyper3__mod__viscosity)
      tmp_66_100.y=tmp_63_66_100
      tmp_63_66_100  = del6fj(Field(k1_63_66_100+3-1), AC_nu_aniso_hyper3__mod__viscosity)
      tmp_66_100.z=tmp_63_66_100
      tmp3_66_100=0.
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[1-1][1-1]*ac_transformed_pencil_glnrho.x*AC_nu_aniso_hyper3__mod__viscosity.x
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[1-1][2-1]*ac_transformed_pencil_glnrho.y*AC_nu_aniso_hyper3__mod__viscosity.y
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[1-1][3-1]*ac_transformed_pencil_glnrho.z*AC_nu_aniso_hyper3__mod__viscosity.z
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp_66_100.x+tmp3_66_100
      tmp3_66_100=0.
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[2-1][1-1]*ac_transformed_pencil_glnrho.x*AC_nu_aniso_hyper3__mod__viscosity.x
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[2-1][2-1]*ac_transformed_pencil_glnrho.y*AC_nu_aniso_hyper3__mod__viscosity.y
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[2-1][3-1]*ac_transformed_pencil_glnrho.z*AC_nu_aniso_hyper3__mod__viscosity.z
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp_66_100.y+tmp3_66_100
      tmp3_66_100=0.
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[3-1][1-1]*ac_transformed_pencil_glnrho.x*AC_nu_aniso_hyper3__mod__viscosity.x
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[3-1][2-1]*ac_transformed_pencil_glnrho.y*AC_nu_aniso_hyper3__mod__viscosity.y
      tmp3_66_100=tmp3_66_100+ac_transformed_pencil_uij[3-1][3-1]*ac_transformed_pencil_glnrho.z*AC_nu_aniso_hyper3__mod__viscosity.z
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp_66_100.z+tmp3_66_100
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+  (AC_nu_aniso_hyper3__mod__viscosity.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x +  AC_nu_aniso_hyper3__mod__viscosity.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y +  AC_nu_aniso_hyper3__mod__viscosity.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)/ dxyz_6__mod__cdata
      }
    }
    if (AC_lvisc_hyper3_rho_nu_const_bulk__mod__viscosity) {
      murho1_66_100=AC_nu_hyper3__mod__viscosity*ac_transformed_pencil_rho1
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+murho1_66_100*ac_transformed_pencil_del6u_bulk.x
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+murho1_66_100*ac_transformed_pencil_del6u_bulk.y
      ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+murho1_66_100*ac_transformed_pencil_del6u_bulk.z
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+murho1_66_100
      }
    }
    if (AC_lvisc_hyper3_nu_const__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+AC_nu_hyper3__mod__viscosity*(ac_transformed_pencil_del6u+ac_transformed_pencil_uij5glnrho)
      if (ldiffus_total3_66_100) {
        ac_transformed_pencil_diffus_total3=ac_transformed_pencil_diffus_total3+AC_nu_hyper3__mod__viscosity
      }
    }
    if (AC_lvisc_smag__mod__cdata) {
      if (AC_lnusmag_as_aux__mod__viscosity) {
        ac_transformed_pencil_nu_smag=value(Field(AC_inusmag__mod__cdata-1))
        gradnu_66_100 = gradient(Field(AC_inusmag__mod__cdata-1))
      }
      else {
        ac_transformed_pencil_nu_smag=pow((AC_c_smag__mod__viscosity*AC_dxmax__mod__cdata),2.)*sqrt(2.*ac_transformed_pencil_sij2)
        if (AC_lvisc_smag_ma__mod__viscosity) {
          ac_transformed_pencil_nu_smag=ac_transformed_pencil_nu_smag*(1.+pow(ac_transformed_pencil_ma2,AC_nu_smag_ma2_power__mod__viscosity))
        }
        if (AC_gamma_smag__mod__viscosity!=0.) {
          ac_transformed_pencil_nu_smag=ac_transformed_pencil_nu_smag/sqrt(1.+AC_gamma_smag__mod__viscosity*ac_transformed_pencil_sij2)
        }
      }
      tmp_66_100 = ac_transformed_pencil_nu_smag*ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu+2.*ac_transformed_pencil_sglnrho
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+tmp_66_100
      if (AC_lnusmag_as_aux__mod__viscosity) {
        sgradnu_66_100 = ac_transformed_pencil_sij*gradnu_66_100
        ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+2.*sgradnu_66_100
      }
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*ac_transformed_pencil_nu_smag*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+ac_transformed_pencil_nu_smag
      }
    }
    if (AC_lvisc_smag_simplified__mod__viscosity) {
      ac_transformed_pencil_nu_smag=pow((AC_c_smag__mod__viscosity*AC_dxmax__mod__cdata),2.)*sqrt(2*ac_transformed_pencil_sij2)
      if (AC_gamma_smag__mod__viscosity!=0.) {
        ac_transformed_pencil_nu_smag=ac_transformed_pencil_nu_smag/sqrt(1.+AC_gamma_smag__mod__viscosity*ac_transformed_pencil_sij2)
      }
      tmp2_66_100 = ac_transformed_pencil_nu_smag*ac_transformed_pencil_sglnrho
      tmp_66_100 = ac_transformed_pencil_nu_smag*ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+2*tmp2_66_100+tmp_66_100
      if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
        ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+2*ac_transformed_pencil_nu_smag*ac_transformed_pencil_sij2
      }
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+ac_transformed_pencil_nu_smag
      }
    }
    if (AC_lvisc_smag_cross_simplified__mod__viscosity) {
      ac_transformed_pencil_nu_smag=pow((AC_c_smag__mod__viscosity*AC_dxmax__mod__cdata),2.)*ac_transformed_pencil_ss12
      tmp2_66_100 = ac_transformed_pencil_nu_smag*ac_transformed_pencil_sglnrho
      tmp_66_100 = ac_transformed_pencil_nu_smag*ac_transformed_pencil_del2u+1./3.*ac_transformed_pencil_graddivu
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+2*tmp2_66_100+tmp_66_100
      if (ldiffus_total_66_100) {
        ac_transformed_pencil_diffus_total=ac_transformed_pencil_diffus_total+ac_transformed_pencil_nu_smag
      }
    }
    if (AC_lvisc_slope_limited__mod__viscosity  &&  AC_llast__mod__cdata) {
      if (AC_lviscosity_heat__mod__energy) {
        if (AC_lcylindrical_coords__mod__cdata  ||  AC_lspherical_coords__mod__cdata) {
          not_implemented("calc_slope_diff_flux")
          if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
            ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+max(0.0,tmp4_66_100)/ac_transformed_pencil_rho
          }
          not_implemented("calc_slope_diff_flux")
          if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
            ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+max(0.0,tmp4_66_100)/ac_transformed_pencil_rho
          }
          not_implemented("calc_slope_diff_flux")
          if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
            ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+max(0.0,tmp4_66_100)/ac_transformed_pencil_rho
          }
          if (AC_lcylindrical_coords__mod__cdata) {
            ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp2_66_100.x-(d_sld_flux_66_100[2-1][2-1])/AC_x__mod__cdata[vertexIdx.x]
            ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp2_66_100.y+(d_sld_flux_66_100[2-1][1-1])/AC_x__mod__cdata[vertexIdx.x]
            ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp2_66_100.z
          }
          else if(AC_lspherical_coords__mod__cdata) {
            if (AC_lsld_notensor__mod__viscosity) {
              ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp2_66_100.x
              ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp2_66_100.y
              ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp2_66_100.z
            }
            else {
              ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp2_66_100.x-(d_sld_flux_66_100[2-1][2-1]+d_sld_flux_66_100[3-1][3-1])/AC_x__mod__cdata[vertexIdx.x]
              ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp2_66_100.y+(d_sld_flux_66_100[2-1][1-1]-d_sld_flux_66_100[3-1][3-1]*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/AC_x__mod__cdata[vertexIdx.x]
              ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp2_66_100.z+(d_sld_flux_66_100[3-1][1-1]+d_sld_flux_66_100[3-1][2-1]*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/AC_x__mod__cdata[vertexIdx.x]
            }
          }
        }
        else {
          not_implemented("calc_slope_diff_flux")
          ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + tmp3_66_100
          if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
            ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+max(0.0,tmp4_66_100)/ac_transformed_pencil_rho
          }
          not_implemented("calc_slope_diff_flux")
          ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + tmp3_66_100
          if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
            ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+max(0.0,tmp4_66_100)/ac_transformed_pencil_rho
          }
          not_implemented("calc_slope_diff_flux")
          ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + tmp3_66_100
          if (AC_lpencil__mod__cdata[AC_i_visc_heat__mod__cparam-1]) {
            ac_transformed_pencil_visc_heat=ac_transformed_pencil_visc_heat+max(0.0,tmp4_66_100)/ac_transformed_pencil_rho
          }
        }
      }
      else {
        if (AC_lcylindrical_coords__mod__cdata  ||  AC_lspherical_coords__mod__cdata) {
          not_implemented("calc_slope_diff_flux")
          not_implemented("calc_slope_diff_flux")
          not_implemented("calc_slope_diff_flux")
          if (AC_lcylindrical_coords__mod__cdata) {
            ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp2_66_100.x-(d_sld_flux_66_100[2-1][2-1])/AC_x__mod__cdata[vertexIdx.x]
            ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp2_66_100.y+(d_sld_flux_66_100[2-1][1-1])/AC_x__mod__cdata[vertexIdx.x]
            ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp2_66_100.z
          }
          else if(AC_lspherical_coords__mod__cdata) {
            ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x+tmp2_66_100.x-(d_sld_flux_66_100[2-1][2-1]+d_sld_flux_66_100[3-1][3-1])/AC_x__mod__cdata[vertexIdx.x]
            ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y+tmp2_66_100.y+(d_sld_flux_66_100[2-1][1-1]-d_sld_flux_66_100[3-1][3-1]*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/AC_x__mod__cdata[vertexIdx.x]
            ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z+tmp2_66_100.z+(d_sld_flux_66_100[3-1][1-1]+d_sld_flux_66_100[3-1][2-1]*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/AC_x__mod__cdata[vertexIdx.x]
          }
        }
        else {
          not_implemented("calc_slope_diff_flux")
          ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x + tmp3_66_100
          not_implemented("calc_slope_diff_flux")
          ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + tmp3_66_100
          not_implemented("calc_slope_diff_flux")
          ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + tmp3_66_100
        }
      }
    }
    if (AC_lvisc_schur_223__mod__viscosity) {
      ac_transformed_pencil_fvisc=ac_transformed_pencil_fvisc+AC_nu__mod__viscosity*ac_transformed_pencil_del2u
      ac_transformed_pencil_fvisc.x=ac_transformed_pencil_fvisc.x-AC_nu__mod__viscosity*ac_transformed_pencil_d2uidxj[1-1][3-1]
      ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y-AC_nu__mod__viscosity*ac_transformed_pencil_d2uidxj[2-1][3-1]
    }
    if (AC_llambda_effect__mod__viscosity) {
      if (AC_lspherical_coords__mod__cdata) {
        lomega_64_66_100=ac_transformed_pencil_uu.z/(AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_x__mod__cdata[vertexIdx.x])+AC_omega__mod__cdata
        dlomega_dr_64_66_100=(AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_uij[3-1][1-1]-ac_transformed_pencil_uu.z)/(AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x])
        dlomega_dtheta_64_66_100=(ac_transformed_pencil_uij[3-1][2-1]*AC_x__mod__cdata[vertexIdx.x]-ac_transformed_pencil_uu.z*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/(AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x])
        lver_64_66_100 = -(AC_lambda_v0__mod__viscosity*AC_lv0_rprof__mod__viscosity[vertexIdx.x]+AC_lambda_v1__mod__viscosity*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_lv1_rprof__mod__viscosity[vertexIdx.x] )
        lhor_64_66_100 = -AC_lambda_h1__mod__viscosity*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_lh1_rprof__mod__viscosity[vertexIdx.x]
        dlver_dr_64_66_100 = -(AC_lambda_v0__mod__viscosity*AC_der_lv0_rprof__mod__viscosity[vertexIdx.x]+AC_lambda_v1__mod__viscosity*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_der_lv1_rprof__mod__viscosity[vertexIdx.x])
        dlhor_dtheta_64_66_100 = -AC_lambda_h1__mod__viscosity*AC_lh1_rprof__mod__viscosity[vertexIdx.x]*2.*AC_costh__mod__cdata[AC_m__mod__cdata-1]*AC_sinth__mod__cdata[AC_m__mod__cdata-1]/AC_x__mod__cdata[vertexIdx.x]
        lambda_phi_66_100 = AC_sinth__mod__cdata[AC_m__mod__cdata-1]*(lver_64_66_100*(lomega_64_66_100*ac_transformed_pencil_glnrho.x+3.*lomega_64_66_100/AC_x__mod__cdata[vertexIdx.x]+dlomega_dr_64_66_100)+lomega_64_66_100*dlver_dr_64_66_100)  +AC_costh__mod__cdata[AC_m__mod__cdata-1]*(lhor_64_66_100*(lomega_64_66_100*ac_transformed_pencil_glnrho.y  -1./AC_cotth__mod__cdata[AC_m__mod__cdata-1]*lomega_64_66_100/AC_x__mod__cdata[vertexIdx.x] + 2.*AC_cotth__mod__cdata[AC_m__mod__cdata-1]*lomega_64_66_100/AC_x__mod__cdata[vertexIdx.x]  +dlomega_dtheta_64_66_100) + lomega_64_66_100*dlhor_dtheta_64_66_100)
        if (AC_llambda_scale_with_nu__mod__viscosity) {
          ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + AC_nu__mod__viscosity*lambda_phi_66_100
        }
        else {
          ac_transformed_pencil_fvisc.z=ac_transformed_pencil_fvisc.z + lambda_phi_66_100
        }
      }
      else if (AC_lcylindrical_coords__mod__cdata) {
        lomega_65_66_100=ac_transformed_pencil_uu.y/AC_x__mod__cdata[vertexIdx.x]+AC_omega__mod__cdata
        dlomega_dr_65_66_100=(AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_uij[2-1][1-1]-ac_transformed_pencil_uu.y)/AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]
        lver_65_66_100 = -AC_lambda_v0__mod__viscosity*AC_lv0_rprof__mod__viscosity[vertexIdx.x]
        dlver_dr_65_66_100 = -AC_lambda_v0__mod__viscosity*AC_der_lv0_rprof__mod__viscosity[vertexIdx.x]
        lambda_phi_66_100 = (lver_65_66_100*(lomega_65_66_100*ac_transformed_pencil_glnrho.x+2.*lomega_65_66_100/AC_x__mod__cdata[vertexIdx.x]  +dlomega_dr_65_66_100)+lomega_65_66_100*dlver_dr_65_66_100)/AC_x__mod__cdata[vertexIdx.x]
        if (AC_llambda_scale_with_nu__mod__viscosity) {
          ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + AC_nu__mod__viscosity*lambda_phi_66_100
        }
        else {
          ac_transformed_pencil_fvisc.y=ac_transformed_pencil_fvisc.y + lambda_phi_66_100
        }
      }
      else {
      }
    }
    if (AC_lvisc_heat_as_aux__mod__viscosity) {
      DF_VISC_HEAT = ac_transformed_pencil_visc_heat
    }
    if (AC_lvisc_forc_as_aux__mod__viscosity) {
      DF_VISC_FORCVEC = ac_transformed_pencil_fvisc
    }
  }
  if (AC_lforcing_cont__mod__cdata) {
    if (AC_lpencil__mod__cdata[AC_i_fcont__mod__cparam-1]) {
      for j_68_100 in 1:AC_n_forcing_cont_max__mod__cparam+1 {
        ac_transformed_pencil_fcont[j_68_100-1].x=0.
      }
      for j_68_100 in 1:AC_n_forcing_cont_max__mod__cparam+1 {
        ac_transformed_pencil_fcont[j_68_100-1].y=0.
      }
      for j_68_100 in 1:AC_n_forcing_cont_max__mod__cparam+1 {
        ac_transformed_pencil_fcont[j_68_100-1].z=0.
      }
    }
  }
  if (AC_lmagnetic__mod__cparam) {
    if (AC_lpencil__mod__cdata[AC_i_aa__mod__cparam-1]) {
      ac_transformed_pencil_aa=value(F_AVEC)
    }
    if (AC_lpencil__mod__cdata[AC_i_a2__mod__cparam-1]) {
      ac_transformed_pencil_a2 = dot(ac_transformed_pencil_aa,ac_transformed_pencil_aa)
    }
    if (AC_lpencil__mod__cdata[AC_i_aij__mod__cparam-1]) {
      ac_transformed_pencil_aij = gradient_tensor((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_diva__mod__cparam-1]) {
      if (AC_lpencil__mod__cdata[AC_i_aij__mod__cparam-1]  &&  ! AC_lpencil_check_at_work__mod__cdata) {
        ac_transformed_pencil_diva = divergence(ac_transformed_pencil_aij)
      }
      else {
        ac_transformed_pencil_diva = divergence((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
      }
      if (AC_lcoulomb__mod__magnetic) {
        DF_DIVA=ac_transformed_pencil_diva
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_aps__mod__cparam-1]) {
      ac_transformed_pencil_aps=value(Field(AC_iaz__mod__cdata-1))*ac_transformed_pencil_rcyl_mn
    }
    if (AC_lpencil__mod__cdata[AC_i_bb__mod__cparam-1]) {
      if (AC_lbb_as_comaux__mod__magnetic) {
        ac_transformed_pencil_bb = value(F_BVEC)
      }
      else if (AC_lpencil__mod__cdata[AC_i_aij__mod__cparam-1]  &&  ! AC_lpencil_check_at_work__mod__cdata) {
        ac_transformed_pencil_bb=curl(ac_transformed_pencil_aij)
      }
      else {
        ac_transformed_pencil_bb = curl((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
      }
      ac_transformed_pencil_bbb = ac_transformed_pencil_bb
      if (! (AC_lbb_as_comaux__mod__magnetic  &&  AC_lb_ext_in_comaux__mod__magnetic)  &&  (! AC_ladd_global_field__mod__magnetic)) {
        if (AC_b_ext__mod__magnetic.x != 0.0  ||  AC_b_ext__mod__magnetic.y != 0.0  ||  AC_b_ext__mod__magnetic.z != 0.0) {
          if (AC_omega_bz_ext__mod__magnetic != 0.0) {
            if (AC_lcartesian_coords__mod__cdata  ||  AC_lbext_curvilinear__mod__magnetic) {
              c_74_81_82_100 = cos(AC_omega_bz_ext__mod__magnetic * AC_t__mod__cdata)
              s_74_81_82_100 = sin(AC_omega_bz_ext__mod__magnetic * AC_t__mod__cdata)
              b_ext_81_82_100.x = AC_b_ext__mod__magnetic.x * c_74_81_82_100 - AC_b_ext__mod__magnetic.y * s_74_81_82_100
              b_ext_81_82_100.y = AC_b_ext__mod__magnetic.x * s_74_81_82_100 + AC_b_ext__mod__magnetic.y * c_74_81_82_100
              b_ext_81_82_100.z = AC_b_ext__mod__magnetic.z
            }
            else {
            }
          }
          else if (AC_lbext_moving_layer__mod__magnetic)  {
            zposbot_74_81_82_100=AC_zbot_moving_layer__mod__magnetic + AC_t__mod__cdata*AC_speed_moving_layer__mod__magnetic
            zpostop_74_81_82_100=AC_ztop_moving_layer__mod__magnetic + AC_t__mod__cdata*AC_speed_moving_layer__mod__magnetic
            step_scalar_return_value_70_74_81_82_100 = 0.5*(1+tanh((AC_z__mod__cdata[AC_n__mod__cdata-1]-zposbot_74_81_82_100)/AC_edge_moving_layer__mod__magnetic))
            step_scalar_return_value_71_74_81_82_100 = 0.5*(1+tanh((AC_z__mod__cdata[AC_n__mod__cdata-1]-zpostop_74_81_82_100)/AC_edge_moving_layer__mod__magnetic))
            zprof_74_81_82_100 = step_scalar_return_value_70_74_81_82_100-step_scalar_return_value_71_74_81_82_100
            b_ext_81_82_100.x = AC_b_ext__mod__magnetic.x*zprof_74_81_82_100
            b_ext_81_82_100.y = AC_b_ext__mod__magnetic.y*zprof_74_81_82_100
            b_ext_81_82_100.z=AC_b_ext__mod__magnetic.z
            if (true) {
              arg_72_74_81_82_100 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-zposbot_74_81_82_100)/(AC_edge_moving_layer__mod__magnetic+AC_tini__mod__cparam))
              if (abs(arg_72_74_81_82_100)>=8.)  {
                der_step_return_value_72_74_81_82_100 = 2./AC_edge_moving_layer__mod__magnetic*exp(-2.*abs(arg_72_74_81_82_100))
              }
              else {
                der_step_return_value_72_74_81_82_100 = 0.5/(AC_edge_moving_layer__mod__magnetic*cosh(arg_72_74_81_82_100)*cosh(arg_72_74_81_82_100))
              }
              arg_73_74_81_82_100 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-zpostop_74_81_82_100)/(AC_edge_moving_layer__mod__magnetic+AC_tini__mod__cparam))
              if (abs(arg_73_74_81_82_100)>=8.)  {
                der_step_return_value_73_74_81_82_100 = 2./AC_edge_moving_layer__mod__magnetic*exp(-2.*abs(arg_73_74_81_82_100))
              }
              else {
                der_step_return_value_73_74_81_82_100 = 0.5/(AC_edge_moving_layer__mod__magnetic*cosh(arg_73_74_81_82_100)*cosh(arg_73_74_81_82_100))
              }
              zder_74_81_82_100 = der_step_return_value_72_74_81_82_100-der_step_return_value_73_74_81_82_100
              if (AC_b_ext__mod__magnetic.x!=0.) {
                j_ext_81_82_100.y =  AC_b_ext__mod__magnetic.x*zder_74_81_82_100
              }
              if (AC_b_ext__mod__magnetic.y!=0.) {
                j_ext_81_82_100.x = -AC_b_ext__mod__magnetic.y*zder_74_81_82_100
              }
            }
          }
          else {
            if (AC_lcartesian_coords__mod__cdata  ||  AC_lbext_curvilinear__mod__magnetic) {
              b_ext_81_82_100 = AC_b_ext__mod__magnetic
            }
            else if (AC_lcylindrical_coords__mod__cdata) {
              b_ext_81_82_100.x =  AC_b_ext__mod__magnetic.x * cos(AC_y__mod__cdata[AC_m__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * sin(AC_y__mod__cdata[AC_m__mod__cdata-1])
              b_ext_81_82_100.y = -AC_b_ext__mod__magnetic.x * sin(AC_y__mod__cdata[AC_m__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * cos(AC_y__mod__cdata[AC_m__mod__cdata-1])
              b_ext_81_82_100.z =  AC_b_ext__mod__magnetic.z
            }
            else if (AC_lspherical_coords__mod__cdata) {
              b_ext_81_82_100.x =  AC_b_ext__mod__magnetic.x * AC_sinth__mod__cdata[AC_m__mod__cdata-1] * cos(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * AC_sinth__mod__cdata[AC_m__mod__cdata-1] * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.z * AC_costh__mod__cdata[AC_m__mod__cdata-1]
              b_ext_81_82_100.y =  AC_b_ext__mod__magnetic.x * AC_costh__mod__cdata[AC_m__mod__cdata-1] * cos(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * AC_costh__mod__cdata[AC_m__mod__cdata-1] * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) - AC_b_ext__mod__magnetic.z * AC_sinth__mod__cdata[AC_m__mod__cdata-1]
              b_ext_81_82_100.z = -AC_b_ext__mod__magnetic.x            * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y            * cos(AC_z__mod__cdata[AC_n__mod__cdata-1])
            }
            if (true) {
              j_ext_81_82_100.x = 0.
              j_ext_81_82_100.y = 0.
              j_ext_81_82_100.z = 0.
            }
          }
        }
        else {
          b_ext_81_82_100.x = 0.
          b_ext_81_82_100.y = 0.
          b_ext_81_82_100.z = 0.
          if (true) {
            j_ext_81_82_100.x = 0.
            j_ext_81_82_100.y = 0.
            j_ext_81_82_100.z = 0.
          }
        }
        if (AC_t_bext__mod__magnetic > 0.0  &&  AC_t__mod__cdata < AC_t_bext__mod__magnetic) {
          if (AC_t__mod__cdata <= AC_t0_bext__mod__magnetic) {
            b_ext_81_82_100 = AC_b0_ext__mod__magnetic
          }
          else {
            b_ext_81_82_100 = AC_b0_ext__mod__magnetic + 0.5*(1.-cos(AC_pi__mod__cparam*(AC_t__mod__cdata-AC_t0_bext__mod__magnetic)/(AC_t_bext__mod__magnetic-AC_t0_bext__mod__magnetic)))*(b_ext_81_82_100-AC_b0_ext__mod__magnetic)
          }
          if (true) {
            j_ext_81_82_100.x = 0.
            j_ext_81_82_100.y = 0.
            j_ext_81_82_100.z = 0.
          }
        }
        if (b_ext_81_82_100.x != 0.  ||  b_ext_81_82_100.y != 0.  ||  b_ext_81_82_100.z != 0.) {
          ac_transformed_pencil_bb.x = ac_transformed_pencil_bb.x + b_ext_81_82_100.x
          ac_transformed_pencil_bb.y = ac_transformed_pencil_bb.y + b_ext_81_82_100.y
          ac_transformed_pencil_bb.z = ac_transformed_pencil_bb.z + b_ext_81_82_100.z
        }
        ac_transformed_pencil_jj.x = ac_transformed_pencil_jj.x + j_ext_81_82_100.x
        ac_transformed_pencil_jj.y = ac_transformed_pencil_jj.y + j_ext_81_82_100.y
        ac_transformed_pencil_jj.z = ac_transformed_pencil_jj.z + j_ext_81_82_100.z
      }
      if (AC_dipole_moment__mod__magnetic != 0.) {
        c_81_82_100=cos(AC_inclaa__mod__magnetic*AC_pi__mod__cparam/180)
        s_81_82_100=sin(AC_inclaa__mod__magnetic*AC_pi__mod__cparam/180)
        ac_transformed_pencil_bb.x = ac_transformed_pencil_bb.x + AC_dipole_moment__mod__magnetic*2*(c_81_82_100*AC_costh__mod__cdata[AC_m__mod__cdata-1] + s_81_82_100*AC_sinth__mod__cdata[AC_m__mod__cdata-1]*cos(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_omega_bz_ext__mod__magnetic*AC_t__mod__cdata))*ac_transformed_pencil_r_mn1*ac_transformed_pencil_r_mn1*ac_transformed_pencil_r_mn1
        ac_transformed_pencil_bb.y = ac_transformed_pencil_bb.y + AC_dipole_moment__mod__magnetic*  (c_81_82_100*AC_sinth__mod__cdata[AC_m__mod__cdata-1] - s_81_82_100*AC_costh__mod__cdata[AC_m__mod__cdata-1]*cos(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_omega_bz_ext__mod__magnetic*AC_t__mod__cdata))*ac_transformed_pencil_r_mn1*ac_transformed_pencil_r_mn1*ac_transformed_pencil_r_mn1
        ac_transformed_pencil_bb.z = ac_transformed_pencil_bb.z + AC_dipole_moment__mod__magnetic*  (             s_81_82_100*         sin(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_omega_bz_ext__mod__magnetic*AC_t__mod__cdata))*ac_transformed_pencil_r_mn1*ac_transformed_pencil_r_mn1*ac_transformed_pencil_r_mn1
      }
      if (AC_ladd_global_field__mod__magnetic) {
        if (AC_b_ext__mod__magnetic.x != 0.0  ||  AC_b_ext__mod__magnetic.y != 0.0  ||  AC_b_ext__mod__magnetic.z != 0.0) {
          if (AC_omega_bz_ext__mod__magnetic != 0.0) {
            if (AC_lcartesian_coords__mod__cdata  ||  AC_lbext_curvilinear__mod__magnetic) {
              c_75_81_82_100 = cos(AC_omega_bz_ext__mod__magnetic * AC_t__mod__cdata)
              s_75_81_82_100 = sin(AC_omega_bz_ext__mod__magnetic * AC_t__mod__cdata)
              b_ext_81_82_100.x = AC_b_ext__mod__magnetic.x * c_75_81_82_100 - AC_b_ext__mod__magnetic.y * s_75_81_82_100
              b_ext_81_82_100.y = AC_b_ext__mod__magnetic.x * s_75_81_82_100 + AC_b_ext__mod__magnetic.y * c_75_81_82_100
              b_ext_81_82_100.z = AC_b_ext__mod__magnetic.z
            }
            else {
            }
          }
          else if (AC_lbext_moving_layer__mod__magnetic)  {
            zposbot_75_81_82_100=AC_zbot_moving_layer__mod__magnetic + AC_t__mod__cdata*AC_speed_moving_layer__mod__magnetic
            zpostop_75_81_82_100=AC_ztop_moving_layer__mod__magnetic + AC_t__mod__cdata*AC_speed_moving_layer__mod__magnetic
            step_scalar_return_value_70_75_81_82_100 = 0.5*(1+tanh((AC_z__mod__cdata[AC_n__mod__cdata-1]-zposbot_75_81_82_100)/AC_edge_moving_layer__mod__magnetic))
            step_scalar_return_value_71_75_81_82_100 = 0.5*(1+tanh((AC_z__mod__cdata[AC_n__mod__cdata-1]-zpostop_75_81_82_100)/AC_edge_moving_layer__mod__magnetic))
            zprof_75_81_82_100 = step_scalar_return_value_70_75_81_82_100-step_scalar_return_value_71_75_81_82_100
            b_ext_81_82_100.x = AC_b_ext__mod__magnetic.x*zprof_75_81_82_100
            b_ext_81_82_100.y = AC_b_ext__mod__magnetic.y*zprof_75_81_82_100
            b_ext_81_82_100.z=AC_b_ext__mod__magnetic.z
            if (false) {
              arg_72_75_81_82_100 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-zposbot_75_81_82_100)/(AC_edge_moving_layer__mod__magnetic+AC_tini__mod__cparam))
              if (abs(arg_72_75_81_82_100)>=8.)  {
                der_step_return_value_72_75_81_82_100 = 2./AC_edge_moving_layer__mod__magnetic*exp(-2.*abs(arg_72_75_81_82_100))
              }
              else {
                der_step_return_value_72_75_81_82_100 = 0.5/(AC_edge_moving_layer__mod__magnetic*cosh(arg_72_75_81_82_100)*cosh(arg_72_75_81_82_100))
              }
              arg_73_75_81_82_100 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-zpostop_75_81_82_100)/(AC_edge_moving_layer__mod__magnetic+AC_tini__mod__cparam))
              if (abs(arg_73_75_81_82_100)>=8.)  {
                der_step_return_value_73_75_81_82_100 = 2./AC_edge_moving_layer__mod__magnetic*exp(-2.*abs(arg_73_75_81_82_100))
              }
              else {
                der_step_return_value_73_75_81_82_100 = 0.5/(AC_edge_moving_layer__mod__magnetic*cosh(arg_73_75_81_82_100)*cosh(arg_73_75_81_82_100))
              }
              zder_75_81_82_100 = der_step_return_value_72_75_81_82_100-der_step_return_value_73_75_81_82_100
            }
          }
          else {
            if (AC_lcartesian_coords__mod__cdata  ||  AC_lbext_curvilinear__mod__magnetic) {
              b_ext_81_82_100 = AC_b_ext__mod__magnetic
            }
            else if (AC_lcylindrical_coords__mod__cdata) {
              b_ext_81_82_100.x =  AC_b_ext__mod__magnetic.x * cos(AC_y__mod__cdata[AC_m__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * sin(AC_y__mod__cdata[AC_m__mod__cdata-1])
              b_ext_81_82_100.y = -AC_b_ext__mod__magnetic.x * sin(AC_y__mod__cdata[AC_m__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * cos(AC_y__mod__cdata[AC_m__mod__cdata-1])
              b_ext_81_82_100.z =  AC_b_ext__mod__magnetic.z
            }
            else if (AC_lspherical_coords__mod__cdata) {
              b_ext_81_82_100.x =  AC_b_ext__mod__magnetic.x * AC_sinth__mod__cdata[AC_m__mod__cdata-1] * cos(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * AC_sinth__mod__cdata[AC_m__mod__cdata-1] * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.z * AC_costh__mod__cdata[AC_m__mod__cdata-1]
              b_ext_81_82_100.y =  AC_b_ext__mod__magnetic.x * AC_costh__mod__cdata[AC_m__mod__cdata-1] * cos(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * AC_costh__mod__cdata[AC_m__mod__cdata-1] * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) - AC_b_ext__mod__magnetic.z * AC_sinth__mod__cdata[AC_m__mod__cdata-1]
              b_ext_81_82_100.z = -AC_b_ext__mod__magnetic.x            * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y            * cos(AC_z__mod__cdata[AC_n__mod__cdata-1])
            }
          }
        }
        else {
          b_ext_81_82_100.x = 0.
          b_ext_81_82_100.y = 0.
          b_ext_81_82_100.z = 0.
        }
        if (AC_t_bext__mod__magnetic > 0.0  &&  AC_t__mod__cdata < AC_t_bext__mod__magnetic) {
          if (AC_t__mod__cdata <= AC_t0_bext__mod__magnetic) {
            b_ext_81_82_100 = AC_b0_ext__mod__magnetic
          }
          else {
            b_ext_81_82_100 = AC_b0_ext__mod__magnetic + 0.5*(1.-cos(AC_pi__mod__cparam*(AC_t__mod__cdata-AC_t0_bext__mod__magnetic)/(AC_t_bext__mod__magnetic-AC_t0_bext__mod__magnetic)))*(b_ext_81_82_100-AC_b0_ext__mod__magnetic)
          }
        }
        if (AC_iglobal_ext_bx__mod__cdata!=0) {
          ac_transformed_pencil_bb.x=ac_transformed_pencil_bb.x+b_ext_81_82_100.y*value(Field(AC_iglobal_ext_bx__mod__cdata-1))+b_ext_81_82_100.x
        }
        if (AC_iglobal_ext_by__mod__cdata!=0) {
          ac_transformed_pencil_bb.y=ac_transformed_pencil_bb.y+b_ext_81_82_100.y*value(Field(AC_iglobal_ext_by__mod__cdata-1))
        }
        if (AC_iglobal_ext_bz__mod__cdata!=0) {
          ac_transformed_pencil_bb.z=ac_transformed_pencil_bb.z+b_ext_81_82_100.y*value(Field(AC_iglobal_ext_bz__mod__cdata-1))+b_ext_81_82_100.z
        }
      }
    }
    if (AC_b0_ext_z__mod__magnetic != 0.0) {
      ac_transformed_pencil_bb.z = ac_transformed_pencil_bb.z + AC_bz_stratified__mod__magnetic[AC_n__mod__cdata-1]
    }
    if (AC_lignore_bext_in_b2__mod__magnetic  ||  (!AC_luse_bext_in_b2__mod__magnetic) ) {
      if (AC_lpencil__mod__cdata[AC_i_b2__mod__cparam-1]) {
        ac_transformed_pencil_b2 = dot(ac_transformed_pencil_bbb,ac_transformed_pencil_bbb)
      }
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_b2__mod__cparam-1]) {
        ac_transformed_pencil_b2 = dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_bf2__mod__cparam-1]) {
      ac_transformed_pencil_bf2 = dot(ac_transformed_pencil_bbb,ac_transformed_pencil_bbb)
    }
    if (AC_lpencil__mod__cdata[AC_i_b21__mod__cparam-1]) {
      if (ac_transformed_pencil_b2>AC_tini__mod__cparam) {
        ac_transformed_pencil_b21=1./ac_transformed_pencil_b2
      }
      else {
        ac_transformed_pencil_b21=0.
      }
    }
    if (AC_lmagneto_friction__mod__magnetic && AC_lpencil__mod__cdata[AC_i_rho1__mod__cparam-1]) {
      ac_transformed_pencil_rho=AC_rho0__mod__equationofstate*1.0e-2+ac_transformed_pencil_b2
      ac_transformed_pencil_rho1=1./ac_transformed_pencil_rho
    }
    if (AC_lpencil__mod__cdata[AC_i_bunit__mod__cparam-1]) {
      quench_81_82_100 = 1.0/max(AC_tini__mod__cparam,sqrt(ac_transformed_pencil_b2))
      if (AC_lignore_bext_in_b2__mod__magnetic  ||  (!AC_luse_bext_in_b2__mod__magnetic) ) {
        ac_transformed_pencil_bunit.x = ac_transformed_pencil_bbb.x*quench_81_82_100
        ac_transformed_pencil_bunit.y = ac_transformed_pencil_bbb.y*quench_81_82_100
        ac_transformed_pencil_bunit.z = ac_transformed_pencil_bbb.z*quench_81_82_100
      }
      else {
        ac_transformed_pencil_bunit.x = ac_transformed_pencil_bb.x*quench_81_82_100
        ac_transformed_pencil_bunit.y = ac_transformed_pencil_bb.y*quench_81_82_100
        ac_transformed_pencil_bunit.z = ac_transformed_pencil_bb.z*quench_81_82_100
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_ab__mod__cparam-1]) {
      ac_transformed_pencil_ab = dot(ac_transformed_pencil_aa,ac_transformed_pencil_bbb)
    }
    if (AC_lpencil__mod__cdata[AC_i_ua__mod__cparam-1]) {
      ac_transformed_pencil_ua = dot(ac_transformed_pencil_uu,ac_transformed_pencil_aa)
    }
    if (AC_lpencil__mod__cdata[AC_i_uxb__mod__cparam-1]) {
      ac_transformed_pencil_uxb = cross(ac_transformed_pencil_uu,ac_transformed_pencil_bb)
      if (AC_iglobal_eext__mod__cdata.x!=0) {
        ac_transformed_pencil_uxb.x=ac_transformed_pencil_uxb.x+value(F_GLOBAL_EEXTVEC.x)
      }
      if (AC_iglobal_eext__mod__cdata.y!=0) {
        ac_transformed_pencil_uxb.y=ac_transformed_pencil_uxb.y+value(F_GLOBAL_EEXTVEC.y)
      }
      if (AC_iglobal_eext__mod__cdata.z!=0) {
        ac_transformed_pencil_uxb.z=ac_transformed_pencil_uxb.z+value(F_GLOBAL_EEXTVEC.z)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_uxbb__mod__cparam-1]) {
      ac_transformed_pencil_uxbb = cross(ac_transformed_pencil_uu,ac_transformed_pencil_bbb)
    }
    if (AC_lpencil__mod__cdata[AC_i_uga__mod__cparam-1]) {
      ac_transformed_pencil_uga = ac_transformed_pencil_aij*ac_transformed_pencil_uu
      if (AC_lupw_aa__mod__magnetic) ac_transformed_pencil_uga = ac_transformed_pencil_uga + del6_upwd((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_uuadvec_gaa__mod__cparam-1]) {
      tmp_81_82_100 = ac_transformed_pencil_aij.row(1-1)
      ac_transformed_pencil_uuadvec_gaa.x = dot(ac_transformed_pencil_uu_advec,tmp_81_82_100)
      tmp_81_82_100 = ac_transformed_pencil_aij.row(2-1)
      ac_transformed_pencil_uuadvec_gaa.y = dot(ac_transformed_pencil_uu_advec,tmp_81_82_100)
      tmp_81_82_100 = ac_transformed_pencil_aij.row(3-1)
      ac_transformed_pencil_uuadvec_gaa.z = dot(ac_transformed_pencil_uu_advec,tmp_81_82_100)
      if (AC_lcylindrical_coords__mod__cdata) {
        ac_transformed_pencil_uuadvec_gaa.x = ac_transformed_pencil_uuadvec_gaa.x - AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL]*ac_transformed_pencil_uu.y*ac_transformed_pencil_aa.y
        ac_transformed_pencil_uuadvec_gaa.y = ac_transformed_pencil_uuadvec_gaa.y + AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL]*ac_transformed_pencil_uu.y*ac_transformed_pencil_aa.x
      }
      else if (AC_lspherical_coords__mod__cdata) {
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_bij__mod__cparam-1] && AC_lpencil__mod__cdata[AC_i_del2a__mod__cparam-1]) {
      if (AC_lcartesian_coords__mod__cdata) {
        ac_transformed_pencil_bij = bij((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
        ac_transformed_pencil_del2a = laplace((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
        if (AC_lpencil__mod__cdata[AC_i_curlb__mod__cparam-1]  &&  ! AC_ljj_as_comaux__mod__magnetic) {
          ac_transformed_pencil_curlb=curl(ac_transformed_pencil_bij)
        }
      }
      else {
        not_implemented("gij_etc with more than 6 params")
        if (AC_lpencil__mod__cdata[AC_i_curlb__mod__cparam-1]  &&  ! AC_ljj_as_comaux__mod__magnetic) {
          ac_transformed_pencil_curlb=curl(ac_transformed_pencil_bij)
        }
      }
    }
    else if (AC_lpencil__mod__cdata[AC_i_bij__mod__cparam-1] && !AC_lpencil__mod__cdata[AC_i_del2a__mod__cparam-1]) {
      if (AC_lcartesian_coords__mod__cdata) {
        ac_transformed_pencil_bij = bij((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
        if (AC_lpencil__mod__cdata[AC_i_curlb__mod__cparam-1] &&  ! AC_ljj_as_comaux__mod__magnetic) {
          ac_transformed_pencil_curlb=curl(ac_transformed_pencil_bij)
        }
      }
      else {
        not_implemented("gij_etc with more than 6 params")
        if (AC_lpencil__mod__cdata[AC_i_curlb__mod__cparam-1] &&  ! AC_ljj_as_comaux__mod__magnetic) {
          ac_transformed_pencil_curlb=curl(ac_transformed_pencil_bij)
        }
      }
    }
    else if (AC_lpencil__mod__cdata[AC_i_del2a__mod__cparam-1] && !AC_lpencil__mod__cdata[AC_i_bij__mod__cparam-1]) {
      if (AC_lcartesian_coords__mod__cdata) {
        ac_transformed_pencil_del2a = laplace((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
      }
      else {
        not_implemented("gij_etc with more than 6 params")
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_bijtilde__mod__cparam-1]) {
      if (AC_lcovariant_magnetic__mod__magnetic) {
        not_implemented("bij_tilde in sub.f90")
      }
      else {
        not_implemented("bij_tilde in sub.f90")
      }
    }
    if (AC_ljj_as_comaux__mod__magnetic  &&  AC_lpencil__mod__cdata[AC_i_jj__mod__cparam-1]) {
      if (AC_lsmooth_jj__mod__magnetic) {
        ac_transformed_pencil_jj.x = gaussian_smooth(Field(AC_ijx__mod__cdata-1))
        ac_transformed_pencil_jj.y = gaussian_smooth(Field(AC_ijy__mod__cdata-1))
        ac_transformed_pencil_jj.z = gaussian_smooth(Field(AC_ijz__mod__cdata-1))
      }
      else {
        ac_transformed_pencil_jj=value(F_JVEC)
      }
    }
    if (AC_ldiamagnetism__mod__magnetic) {
      chi_diamag_78_81_82_100=AC_b2_diamag__mod__magnetic/ac_transformed_pencil_b2
      gchi_diamag_78_81_82_100 = chi_diamag_78_81_82_100/ac_transformed_pencil_b2*ac_transformed_pencil_gb22
      jj_diamag_78_81_82_100 = cross(gchi_diamag_78_81_82_100,ac_transformed_pencil_bb)
      tmp_78_81_82_100.x=jj_diamag_78_81_82_100.x+chi_diamag_78_81_82_100*ac_transformed_pencil_jj.x
      tmp_78_81_82_100.y=jj_diamag_78_81_82_100.y+chi_diamag_78_81_82_100*ac_transformed_pencil_jj.y
      tmp_78_81_82_100.z=jj_diamag_78_81_82_100.z+chi_diamag_78_81_82_100*ac_transformed_pencil_jj.z
      jj_diamag_78_81_82_100=tmp_78_81_82_100
      ac_transformed_pencil_jj=ac_transformed_pencil_jj+jj_diamag_78_81_82_100
    }
    if (AC_lpencil__mod__cdata[AC_i_jj__mod__cparam-1]  ||  AC_lpencil__mod__cdata[AC_i_jj_ohm__mod__cparam-1]) {
      if (AC_iex__mod__cdata>0) {
        if (AC_lresi_eta_tdep__mod__magnetic) {
          eta_total__mod__magnetic=AC_eta_tdep__mod__magnetic
        }
        else {
          eta_total__mod__magnetic=AC_eta__mod__magnetic
        }
        if (AC_lvacuum__mod__magnetic) {
          ac_transformed_pencil_jj.x = 0.
          ac_transformed_pencil_jj.y = 0.
          ac_transformed_pencil_jj.z = 0.
          ac_transformed_pencil_jj_ohm.x = 0.
          ac_transformed_pencil_jj_ohm.y = 0.
          ac_transformed_pencil_jj_ohm.z = 0.
        }
        else {
          ac_transformed_pencil_jj_ohm.x=(ac_transformed_pencil_el.x+ac_transformed_pencil_uxb.x)*AC_mu01__mod__cdata/eta_total__mod__magnetic
          ac_transformed_pencil_jj_ohm.y=(ac_transformed_pencil_el.y+ac_transformed_pencil_uxb.y)*AC_mu01__mod__cdata/eta_total__mod__magnetic
          ac_transformed_pencil_jj_ohm.z=(ac_transformed_pencil_el.z+ac_transformed_pencil_uxb.z)*AC_mu01__mod__cdata/eta_total__mod__magnetic
          if (AC_loverride_ee2__mod__magnetic) {
            if (AC_ladd_disp_current_from_aux__mod__magnetic) {
              if (AC_iedotx__mod__magnetic>0  &&  AC_iedotz__mod__magnetic>0) {
                ac_transformed_pencil_jj=AC_mu01__mod__cdata*ac_transformed_pencil_curlb-AC_c_light21__mod__magnetic*value(F_EDOTVEC)
              }
              else {
              }
            }
            else {
              ac_transformed_pencil_jj=AC_mu01__mod__cdata*ac_transformed_pencil_curlb
            }
          }
          else {
            ac_transformed_pencil_jj=ac_transformed_pencil_jj_ohm
          }
        }
      }
      else {
        ac_transformed_pencil_jj=AC_mu01__mod__cdata*ac_transformed_pencil_curlb
        ac_transformed_pencil_jj_ohm.x = 0.
        ac_transformed_pencil_jj_ohm.y = 0.
        ac_transformed_pencil_jj_ohm.z = 0.
      }
      if (AC_iglobal_jext__mod__cdata.x!=0) {
        ac_transformed_pencil_jj.x=ac_transformed_pencil_jj.x+value(F_GLOBAL_JEXTVEC.x)
      }
      if (AC_iglobal_jext__mod__cdata.y!=0) {
        ac_transformed_pencil_jj.y=ac_transformed_pencil_jj.y+value(F_GLOBAL_JEXTVEC.y)
      }
      if (AC_iglobal_jext__mod__cdata.z!=0) {
        ac_transformed_pencil_jj.z=ac_transformed_pencil_jj.z+value(F_GLOBAL_JEXTVEC.z)
      }
      if (AC_lj_ext__mod__magnetic) {
        if (AC_j_ext_quench__mod__magnetic!=0) {
          quench_81_82_100=1./(1.+AC_j_ext_quench__mod__magnetic*ac_transformed_pencil_b2)
          ac_transformed_pencil_jj.x=ac_transformed_pencil_jj.x-j_ext_81_82_100.x*quench_81_82_100
          ac_transformed_pencil_jj.y=ac_transformed_pencil_jj.y-j_ext_81_82_100.y*quench_81_82_100
          ac_transformed_pencil_jj.z=ac_transformed_pencil_jj.z-j_ext_81_82_100.z*quench_81_82_100
        }
        else {
          ac_transformed_pencil_jj.x=ac_transformed_pencil_jj.x-j_ext_81_82_100.x
          ac_transformed_pencil_jj.y=ac_transformed_pencil_jj.y-j_ext_81_82_100.y
          ac_transformed_pencil_jj.z=ac_transformed_pencil_jj.z-j_ext_81_82_100.z
        }
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_exa__mod__cparam-1]) {
      ac_transformed_pencil_exa = cross(-ac_transformed_pencil_uxb+AC_eta__mod__magnetic*ac_transformed_pencil_jj,ac_transformed_pencil_aa)
    }
    if (AC_lpencil__mod__cdata[AC_i_exatotal__mod__cparam-1]) {
      tmp_81_82_100.x = eta_total__mod__magnetic*ac_transformed_pencil_jj.x
      tmp_81_82_100.y = eta_total__mod__magnetic*ac_transformed_pencil_jj.y
      tmp_81_82_100.z = eta_total__mod__magnetic*ac_transformed_pencil_jj.z
      ac_transformed_pencil_exatotal = cross(-ac_transformed_pencil_uxb+tmp_81_82_100,ac_transformed_pencil_aa)
    }
    if (AC_lpencil__mod__cdata[AC_i_j2__mod__cparam-1]) {
      ac_transformed_pencil_j2 = dot(ac_transformed_pencil_jj,ac_transformed_pencil_jj)
    }
    if (AC_lpencil__mod__cdata[AC_i_jb__mod__cparam-1]) {
      ac_transformed_pencil_jb = dot(ac_transformed_pencil_jj,ac_transformed_pencil_bbb)
    }
    if (AC_lpencil__mod__cdata[AC_i_va2__mod__cparam-1]) {
      ac_transformed_pencil_va2=ac_transformed_pencil_b2*AC_mu01__mod__cdata*ac_transformed_pencil_rho1
    }
    if (AC_lpencil__mod__cdata[AC_i_etava__mod__cparam-1]) {
      if (AC_lresi_vaspeed__mod__magnetic) {
        ac_transformed_pencil_etava = AC_eta_va__mod__magnetic * sqrt(ac_transformed_pencil_va2)/AC_varms__mod__magnetic
        if (AC_va_min__mod__magnetic > 0.) {
          ac_transformed_pencil_etava = set_min_val(ac_transformed_pencil_etava,AC_va_min__mod__magnetic)
        }
      }
      else {
        ac_transformed_pencil_etava = AC_mu0__mod__cdata * AC_eta_va__mod__magnetic * AC_dxmax__mod__cdata * sqrt(ac_transformed_pencil_va2)
        if (AC_eta_min__mod__magnetic > 0.) {
          ac_transformed_pencil_etava = set_zero_below_threshold(ac_transformed_pencil_etava,AC_eta_min__mod__magnetic)
        }
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_gva__mod__cparam-1] && AC_lalfven_as_aux__mod__magnetic) {
      ac_transformed_pencil_gva = gradient(Field(AC_ialfven__mod__cdata-1))
      if (AC_lresi_vaspeed__mod__magnetic) {
        if (AC_va_min__mod__magnetic > 0.) {
          ac_transformed_pencil_gva.x = set_zero_below_threshold(ac_transformed_pencil_etava,AC_va_min__mod__magnetic)
        }
        if (AC_va_min__mod__magnetic > 0.) {
          ac_transformed_pencil_gva.y = set_zero_below_threshold(ac_transformed_pencil_etava,AC_va_min__mod__magnetic)
        }
        if (AC_va_min__mod__magnetic > 0.) {
          ac_transformed_pencil_gva.z = set_zero_below_threshold(ac_transformed_pencil_etava,AC_va_min__mod__magnetic)
        }
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_etaj__mod__cparam-1]) {
      ac_transformed_pencil_etaj = AC_mu0__mod__cdata * AC_eta_j__mod__magnetic * AC_dxmax__mod__cdata*AC_dxmax__mod__cdata * sqrt(AC_mu0__mod__cdata * ac_transformed_pencil_j2 * ac_transformed_pencil_rho1)
      if (AC_eta_min__mod__magnetic > 0.) {
        ac_transformed_pencil_etaj = set_zero_below_threshold(ac_transformed_pencil_etaj,AC_eta_min__mod__magnetic)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_etaj2__mod__cparam-1]) {
      ac_transformed_pencil_etaj2 = AC_etaj20__mod__magnetic * ac_transformed_pencil_j2 * ac_transformed_pencil_rho1
      if (AC_eta_min__mod__magnetic > 0.) {
        ac_transformed_pencil_etaj2 = set_zero_below_threshold(ac_transformed_pencil_etaj2,AC_eta_min__mod__magnetic)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_etajrho__mod__cparam-1]) {
      ac_transformed_pencil_etajrho = AC_mu0__mod__cdata * AC_eta_jrho__mod__magnetic * AC_dxmax__mod__cdata * sqrt(ac_transformed_pencil_j2) * ac_transformed_pencil_rho1
      if (AC_eta_min__mod__magnetic > 0.) {
        ac_transformed_pencil_etajrho = set_zero_below_threshold(ac_transformed_pencil_etajrho,AC_eta_min__mod__magnetic)
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_jxb__mod__cparam-1]) {
      ac_transformed_pencil_jxb = cross(ac_transformed_pencil_jj,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_cosjb__mod__cparam-1]) {
      ac_transformed_pencil_cosjb = tini_sqrt_div(ac_transformed_pencil_jb,ac_transformed_pencil_j2,ac_transformed_pencil_b2)
      if (AC_lpencil_check_at_work__mod__cdata) {
        ac_transformed_pencil_cosjb = modulo(ac_transformed_pencil_cosjb + 1.0, 2.0) - 1
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_jparallel__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_jperp__mod__cparam-1]) {
      ac_transformed_pencil_jparallel=sqrt(ac_transformed_pencil_j2)*ac_transformed_pencil_cosjb
      ac_transformed_pencil_jperp=sqrt(ac_transformed_pencil_j2)*sqrt(abs(1-ac_transformed_pencil_cosjb*ac_transformed_pencil_cosjb))
    }
    if (AC_lpencil__mod__cdata[AC_i_jxbr__mod__cparam-1]) {
      rho1_jxb_81_82_100=ac_transformed_pencil_rho1
      if (AC_rhomin_jxb__mod__magnetic>0) {
        rho1_jxb_81_82_100=min(rho1_jxb_81_82_100,1/AC_rhomin_jxb__mod__magnetic)
      }
      if (AC_va2max_jxb__mod__magnetic>0  &&  (! AC_betamin_jxb__mod__magnetic>0)) {
        rho1_jxb_81_82_100 = rho1_jxb_81_82_100 * pow((1+pow((ac_transformed_pencil_va2/AC_va2max_jxb__mod__magnetic),AC_va2power_jxb__mod__magnetic)),(-1.0/AC_va2power_jxb__mod__magnetic))
      }
      if (AC_betamin_jxb__mod__magnetic>0) {
        va2max_beta_81_82_100 = ac_transformed_pencil_cs2/AC_betamin_jxb__mod__magnetic*2.0*AC_gamma1__mod__magnetic
        if (AC_va2max_jxb__mod__magnetic > 0) {
          va2max_beta_81_82_100=min(va2max_beta_81_82_100,AC_va2max_jxb__mod__magnetic)
        }
        rho1_jxb_81_82_100 = rho1_jxb_81_82_100 * pow((1.+pow((ac_transformed_pencil_va2/va2max_beta_81_82_100),AC_va2power_jxb__mod__magnetic)),(-1.0/AC_va2power_jxb__mod__magnetic))
      }
      ac_transformed_pencil_jxbr = rho1_jxb_81_82_100*ac_transformed_pencil_jxb
    }
    if (AC_lpencil__mod__cdata[AC_i_jxbr2__mod__cparam-1]) {
      ac_transformed_pencil_jxbr2 = dot(ac_transformed_pencil_jxbr,ac_transformed_pencil_jxbr)
    }
    if (AC_lpencil__mod__cdata[AC_i_ub__mod__cparam-1]) {
      ac_transformed_pencil_ub = dot(ac_transformed_pencil_uu,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_ob__mod__cparam-1]) {
      ac_transformed_pencil_ob = dot(ac_transformed_pencil_oo,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_uj__mod__cparam-1]) {
      ac_transformed_pencil_uj = dot(ac_transformed_pencil_uu,ac_transformed_pencil_jj)
    }
    if (AC_lpencil__mod__cdata[AC_i_cosub__mod__cparam-1]) {
      ac_transformed_pencil_cosub = tini_sqrt_div(ac_transformed_pencil_ub,ac_transformed_pencil_u2,ac_transformed_pencil_b2)
      if (AC_lpencil_check__mod__cdata) {
        ac_transformed_pencil_cosub = modulo(ac_transformed_pencil_cosub + 1.0, 2.0) - 1
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_uxb2__mod__cparam-1]) {
      ac_transformed_pencil_uxb2 = dot(ac_transformed_pencil_uxb,ac_transformed_pencil_uxb)
    }
    if (AC_lpencil__mod__cdata[AC_i_uxj__mod__cparam-1]) {
      ac_transformed_pencil_uxj = cross(ac_transformed_pencil_uu,ac_transformed_pencil_jj)
    }
    if (AC_lpencil__mod__cdata[AC_i_chibp__mod__cparam-1]) {
      ac_transformed_pencil_chibp=atan2(ac_transformed_pencil_bb.y,ac_transformed_pencil_bb.x)+0.5*AC_pi__mod__cparam
    }
    if (AC_lpencil__mod__cdata[AC_i_stokesi__mod__cparam-1]) {
      ac_transformed_pencil_stokesi=pow((ac_transformed_pencil_bb.x*ac_transformed_pencil_bb.x+ac_transformed_pencil_bb.y*ac_transformed_pencil_bb.y),AC_exp_epspb__mod__magnetic)
    }
    if (AC_lncr_correlated__mod__magnetic) {
      stokesi_ncr_81_82_100=ac_transformed_pencil_stokesi*ac_transformed_pencil_b2
      if (AC_lpencil__mod__cdata[AC_i_stokesq__mod__cparam-1]) {
        ac_transformed_pencil_stokesq=-stokesi_ncr_81_82_100*cos(2.*ac_transformed_pencil_chibp)
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesu__mod__cparam-1]) {
        ac_transformed_pencil_stokesu=-stokesi_ncr_81_82_100*sin(2.*ac_transformed_pencil_chibp)
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesq1__mod__cparam-1]) {
        ac_transformed_pencil_stokesq1=+stokesi_ncr_81_82_100*sin(2.*ac_transformed_pencil_chibp)*ac_transformed_pencil_bb.z
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesu1__mod__cparam-1]) {
        ac_transformed_pencil_stokesu1=-stokesi_ncr_81_82_100*cos(2.*ac_transformed_pencil_chibp)*ac_transformed_pencil_bb.z
      }
    }
    else if (AC_lncr_anticorrelated__mod__magnetic) {
      stokesi_ncr_81_82_100=ac_transformed_pencil_stokesi/(1.+AC_ncr_quench__mod__magnetic*ac_transformed_pencil_b2)
      if (AC_lpencil__mod__cdata[AC_i_stokesq__mod__cparam-1]) {
        ac_transformed_pencil_stokesq=-stokesi_ncr_81_82_100*cos(2.*ac_transformed_pencil_chibp)
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesu__mod__cparam-1]) {
        ac_transformed_pencil_stokesu=-stokesi_ncr_81_82_100*sin(2.*ac_transformed_pencil_chibp)
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesq1__mod__cparam-1]) {
        ac_transformed_pencil_stokesq1=+stokesi_ncr_81_82_100*sin(2.*ac_transformed_pencil_chibp)*ac_transformed_pencil_bb.z
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesu1__mod__cparam-1]) {
        ac_transformed_pencil_stokesu1=-stokesi_ncr_81_82_100*cos(2.*ac_transformed_pencil_chibp)*ac_transformed_pencil_bb.z
      }
    }
    else {
      if (AC_lpencil__mod__cdata[AC_i_stokesq__mod__cparam-1]) {
        ac_transformed_pencil_stokesq=-ac_transformed_pencil_stokesi*cos(2.*ac_transformed_pencil_chibp)
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesu__mod__cparam-1]) {
        ac_transformed_pencil_stokesu=-ac_transformed_pencil_stokesi*sin(2.*ac_transformed_pencil_chibp)
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesq1__mod__cparam-1]) {
        ac_transformed_pencil_stokesq1=+ac_transformed_pencil_stokesi*sin(2.*ac_transformed_pencil_chibp)*ac_transformed_pencil_bb.z
      }
      if (AC_lpencil__mod__cdata[AC_i_stokesu1__mod__cparam-1]) {
        ac_transformed_pencil_stokesu1=-ac_transformed_pencil_stokesi*cos(2.*ac_transformed_pencil_chibp)*ac_transformed_pencil_bb.z
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_beta1__mod__cparam-1]) {
      ac_transformed_pencil_beta1=0.5*ac_transformed_pencil_b2*AC_mu01__mod__cdata/ac_transformed_pencil_pp
    }
    if (AC_lpencil__mod__cdata[AC_i_beta__mod__cparam-1]) {
      ac_transformed_pencil_beta = 2.0 * AC_mu0__mod__cdata * ac_transformed_pencil_pp / max(ac_transformed_pencil_b2, epsilon(1.0))
    }
    if (AC_lpencil__mod__cdata[AC_i_djuidjbi__mod__cparam-1]) {
      ac_transformed_pencil_djuidjbi = contract(ac_transformed_pencil_uij,ac_transformed_pencil_bij)
    }
    if (AC_lpencil__mod__cdata[AC_i_jo__mod__cparam-1]) {
      ac_transformed_pencil_jo = dot(ac_transformed_pencil_jj,ac_transformed_pencil_oo)
    }
    if (AC_lpencil__mod__cdata[AC_i_ujxb__mod__cparam-1]) {
      ac_transformed_pencil_ujxb = dot(ac_transformed_pencil_uu,ac_transformed_pencil_jxb)
    }
    if (AC_lpencil__mod__cdata[AC_i_gb22__mod__cparam-1]) {
      ac_transformed_pencil_gb22 = matmul_transpose(ac_transformed_pencil_bij,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_ugb__mod__cparam-1]) {
      ac_transformed_pencil_ugb = ac_transformed_pencil_bij*ac_transformed_pencil_uu
    }
    if (AC_lpencil__mod__cdata[AC_i_ugb22__mod__cparam-1]) {
      ac_transformed_pencil_ugb22 = dot(ac_transformed_pencil_uu,ac_transformed_pencil_gb22)
    }
    if (AC_lpencil__mod__cdata[AC_i_bdivu__mod__cparam-1]) {
      ac_transformed_pencil_bdivu.x=ac_transformed_pencil_bb.x*ac_transformed_pencil_divu
      ac_transformed_pencil_bdivu.y=ac_transformed_pencil_bb.y*ac_transformed_pencil_divu
      ac_transformed_pencil_bdivu.z=ac_transformed_pencil_bb.z*ac_transformed_pencil_divu
    }
    if (AC_lpencil__mod__cdata[AC_i_bgu__mod__cparam-1]) {
      ac_transformed_pencil_bgu = ac_transformed_pencil_uij*ac_transformed_pencil_bb
    }
    if (AC_lpencil__mod__cdata[AC_i_bgb__mod__cparam-1]) {
      ac_transformed_pencil_bgb = ac_transformed_pencil_bij*ac_transformed_pencil_bb
    }
    if (AC_lpencil__mod__cdata[AC_i_bgbp__mod__cparam-1]) {
      bbgb_81_82_100 = dot(ac_transformed_pencil_bb,ac_transformed_pencil_bgb)
      ac_transformed_pencil_bgbp = bbgb_81_82_100*ac_transformed_pencil_b21*ac_transformed_pencil_bb
    }
    if (AC_lpencil__mod__cdata[AC_i_ubgbp__mod__cparam-1]) {
      ac_transformed_pencil_ubgbp = dot(ac_transformed_pencil_uu,ac_transformed_pencil_bgbp)
    }
    if (AC_lpencil__mod__cdata[AC_i_oxuxb__mod__cparam-1]) {
      ac_transformed_pencil_oxuxb = cross(ac_transformed_pencil_oxu,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_jxbxb__mod__cparam-1]) {
      ac_transformed_pencil_jxbxb = cross(ac_transformed_pencil_jxb,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_jxbrxb__mod__cparam-1]) {
      ac_transformed_pencil_jxbrxb = cross(ac_transformed_pencil_jxbr,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_glnrhoxb__mod__cparam-1]) {
      ac_transformed_pencil_glnrhoxb = cross(ac_transformed_pencil_glnrho,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_del4a__mod__cparam-1]) {
      ac_transformed_pencil_del4a = del4((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_hjj__mod__cparam-1]) {
      ac_transformed_pencil_hjj = ac_transformed_pencil_del4a
    }
    if (AC_lpencil__mod__cdata[AC_i_hj2__mod__cparam-1]) {
      ac_transformed_pencil_hj2 = dot(ac_transformed_pencil_hjj,ac_transformed_pencil_hjj)
    }
    if (AC_lpencil__mod__cdata[AC_i_hjb__mod__cparam-1]) {
      ac_transformed_pencil_hjb = dot(ac_transformed_pencil_hjj,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_coshjb__mod__cparam-1]) {
      ac_transformed_pencil_coshjb = tini_sqrt_div_separate(ac_transformed_pencil_hjb,ac_transformed_pencil_hj2,ac_transformed_pencil_b2)
      if (AC_lpencil_check_at_work__mod__cdata) {
        ac_transformed_pencil_coshjb = modulo(ac_transformed_pencil_coshjb + 1.0, 2.0) - 1
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_hjparallel__mod__cparam-1] || AC_lpencil__mod__cdata[AC_i_hjperp__mod__cparam-1]) {
      ac_transformed_pencil_hjparallel=sqrt(ac_transformed_pencil_hj2)*ac_transformed_pencil_coshjb
      ac_transformed_pencil_hjperp=sqrt(ac_transformed_pencil_hj2)*sqrt(abs(1-ac_transformed_pencil_coshjb*ac_transformed_pencil_coshjb))
    }
    if (AC_lpencil__mod__cdata[AC_i_del6a__mod__cparam-1]) {
      ac_transformed_pencil_del6a = del6((Field3){Field(AC_iaa__mod__cdata-1), Field(AC_iaa__mod__cdata), Field(AC_iaa__mod__cdata+1)})
    }
    if (AC_lpencil__mod__cdata[AC_i_e3xa__mod__cparam-1]) {
      ac_transformed_pencil_e3xa = cross(-ac_transformed_pencil_uxb+AC_eta_hyper3__mod__magnetic*ac_transformed_pencil_del6a,ac_transformed_pencil_aa)
    }
    if (AC_lpencil__mod__cdata[AC_i_oxj__mod__cparam-1]) {
      ac_transformed_pencil_oxj = cross(ac_transformed_pencil_oo,ac_transformed_pencil_jj)
    }
    if (AC_lpencil__mod__cdata[AC_i_jij__mod__cparam-1]) {
      ac_transformed_pencil_jij[1-1][1-1]=0.5*(ac_transformed_pencil_bij[1-1][1-1]+ac_transformed_pencil_bij[1-1][1-1])
      ac_transformed_pencil_jij[2-1][1-1]=0.5*(ac_transformed_pencil_bij[2-1][1-1]+ac_transformed_pencil_bij[1-1][2-1])
      ac_transformed_pencil_jij[3-1][1-1]=0.5*(ac_transformed_pencil_bij[3-1][1-1]+ac_transformed_pencil_bij[1-1][3-1])
      ac_transformed_pencil_jij[1-1][2-1]=0.5*(ac_transformed_pencil_bij[1-1][2-1]+ac_transformed_pencil_bij[2-1][1-1])
      ac_transformed_pencil_jij[2-1][2-1]=0.5*(ac_transformed_pencil_bij[2-1][2-1]+ac_transformed_pencil_bij[2-1][2-1])
      ac_transformed_pencil_jij[3-1][2-1]=0.5*(ac_transformed_pencil_bij[3-1][2-1]+ac_transformed_pencil_bij[2-1][3-1])
      ac_transformed_pencil_jij[1-1][3-1]=0.5*(ac_transformed_pencil_bij[1-1][3-1]+ac_transformed_pencil_bij[3-1][1-1])
      ac_transformed_pencil_jij[2-1][3-1]=0.5*(ac_transformed_pencil_bij[2-1][3-1]+ac_transformed_pencil_bij[3-1][2-1])
      ac_transformed_pencil_jij[3-1][3-1]=0.5*(ac_transformed_pencil_bij[3-1][3-1]+ac_transformed_pencil_bij[3-1][3-1])
    }
    if (AC_lpencil__mod__cdata[AC_i_d6ab__mod__cparam-1]) {
      ac_transformed_pencil_d6ab = dot(ac_transformed_pencil_del6a,ac_transformed_pencil_bb)
    }
    if (AC_lpencil__mod__cdata[AC_i_sj__mod__cparam-1]) {
      ac_transformed_pencil_sj = contract(ac_transformed_pencil_sij,ac_transformed_pencil_jij)
    }
    if (AC_lpencil__mod__cdata[AC_i_ss12__mod__cparam-1]) {
      ac_transformed_pencil_ss12=sqrt(abs(ac_transformed_pencil_sj))
    }
    if (AC_lpencil__mod__cdata[AC_i_vmagfric__mod__cparam-1] && AC_numag__mod__magnetic!=0.0) {
      tmp1_81_82_100=AC_mu01__mod__cdata/(AC_numag__mod__magnetic*(AC_b0_magfric__mod__magnetic/AC_unit_magnetic__mod__cdata*AC_unit_magnetic__mod__cdata+ac_transformed_pencil_b2))
      ac_transformed_pencil_vmagfric.x=abs(ac_transformed_pencil_jxb.x)*tmp1_81_82_100
      ac_transformed_pencil_vmagfric.y=abs(ac_transformed_pencil_jxb.y)*tmp1_81_82_100
      ac_transformed_pencil_vmagfric.z=abs(ac_transformed_pencil_jxb.z)*tmp1_81_82_100
    }
    if (AC_lpencil__mod__cdata[AC_i_lam__mod__cparam-1]) {
      if (AC_lcoulomb__mod__magnetic) {
        ac_transformed_pencil_lam=value(Field(AC_ilam__mod__magnetic-1))
      }
      else {
      }
    }
    if (AC_lbb_as_aux__mod__magnetic  &&  ! AC_lbb_as_comaux__mod__magnetic) {
      DF_BVEC = ac_transformed_pencil_bb
    }
    if (AC_ljj_as_aux__mod__magnetic  &&  ! AC_ljj_as_comaux__mod__magnetic) {
      DF_JVEC = ac_transformed_pencil_jj
    }
    if (AC_ljxb_as_aux__mod__magnetic) {
      DF_JXBVEC=ac_transformed_pencil_jxb
    }
    if (AC_lpencil__mod__cdata[AC_i_bb_sph__mod__cparam-1] && AC_lbb_sph_as_aux__mod__magnetic) {
      ac_transformed_pencil_bb_sph=value(F_BB_SPHVEC)
    }
    if (AC_luxb_as_aux__mod__magnetic) {
      DF_UXBVEC = ac_transformed_pencil_uxb
    }
    if (AC_lugb_as_aux__mod__magnetic) {
      DF_UGBVEC = ac_transformed_pencil_ugb
    }
    if (AC_lbgu_as_aux__mod__magnetic) {
      DF_BGUVEC = ac_transformed_pencil_bgu
    }
    if (AC_lbdivu_as_aux__mod__magnetic) {
      DF_BDIVUVEC = ac_transformed_pencil_bdivu
    }
    if (AC_lmagn_mf__mod__cparam) {
      if (AC_lpencil__mod__cdata[AC_i_mf_emf__mod__cparam-1]) {
        ac_transformed_pencil_mf_emf.x = 0.0
        ac_transformed_pencil_mf_emf.y = 0.0
        ac_transformed_pencil_mf_emf.z = 0.0
      }
      if (AC_lpencil__mod__cdata[AC_i_mf_emfdotb__mod__cparam-1]) {
        ac_transformed_pencil_mf_emfdotb=0.0
      }
    }
    if (AC_lpencil__mod__cdata[AC_i_nu_ni1__mod__cparam-1]) {
      if(AC_string_enum_ambipolar_diffusion__mod__magnetic == AC_string_enum_constant_string__mod__cparam) {
        ac_transformed_pencil_nu_ni1=AC_nu_ni1__mod__magnetic
      }
      else if(AC_string_enum_ambipolar_diffusion__mod__magnetic == AC_string_enum_ionizationzequilibrium_string__mod__cparam) {
        ac_transformed_pencil_nu_ni1=AC_nu_ni1__mod__magnetic*sqrt(ac_transformed_pencil_rho1)
      }
      else if(AC_string_enum_ambipolar_diffusion__mod__magnetic == AC_string_enum_ionizationzyh_string__mod__cparam) {
        ac_transformed_pencil_nu_ni1=AC_nu_ni1__mod__magnetic*sqrt(ac_transformed_pencil_rho1)*(1.-ac_transformed_pencil_yh)/ac_transformed_pencil_yh
      }
      else {
      }
    }
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_lhydro__mod__cparam && AC_llorentzforce__mod__magnetic) {
        rho1_jxb_81_82_100=ac_transformed_pencil_rho1
        if (AC_rhomin_jxb__mod__magnetic>0) {
          rho1_jxb_81_82_100=min(rho1_jxb_81_82_100,1/AC_rhomin_jxb__mod__magnetic)
        }
        if (AC_va2max_jxb__mod__magnetic>0  &&  (! AC_betamin_jxb__mod__magnetic>0)) {
          rho1_jxb_81_82_100 = rho1_jxb_81_82_100 * pow((1+pow((ac_transformed_pencil_va2/AC_va2max_jxb__mod__magnetic),AC_va2power_jxb__mod__magnetic)),(-1.0/AC_va2power_jxb__mod__magnetic))
        }
        if (AC_betamin_jxb__mod__magnetic>0) {
          va2max_beta_81_82_100 = ac_transformed_pencil_cs2/AC_betamin_jxb__mod__magnetic*2.0*AC_gamma1__mod__magnetic
          if (AC_va2max_jxb__mod__magnetic > 0) {
            va2max_beta_81_82_100=min(va2max_beta_81_82_100,AC_va2max_jxb__mod__magnetic)
          }
          rho1_jxb_81_82_100 = rho1_jxb_81_82_100 * pow((1+pow((ac_transformed_pencil_va2/va2max_beta_81_82_100),AC_va2power_jxb__mod__magnetic)),(-1.0/AC_va2power_jxb__mod__magnetic))
        }
        if (AC_lboris_correction__mod__magnetic) {
          if (AC_va2max_boris__mod__magnetic>0) {
            rho1_jxb_81_82_100 = rho1_jxb_81_82_100 * pow((1+pow((ac_transformed_pencil_va2/AC_va2max_boris__mod__magnetic),2.)),(-0.5))
          }
          if (AC_cmin__mod__magnetic>0) {
            rho1_jxb_81_82_100 = rho1_jxb_81_82_100 * pow((1+pow((ac_transformed_pencil_va2/ac_transformed_pencil_clight2),2.)),(-0.5))
          }
        }
        ac_transformed_pencil_advec_va2=sum((ac_transformed_pencil_bb*dline_1__mod__cdata)*(ac_transformed_pencil_bb*dline_1__mod__cdata))*AC_mu01__mod__cdata*rho1_jxb_81_82_100
      }
      else {
        ac_transformed_pencil_advec_va2=0.
      }
      if (AC_lisotropic_advection__mod__cdata) {
        if (AC_dimensionality__mod__cparam<3) {
          ac_transformed_pencil_advec_va2=ac_transformed_pencil_va2*dxyz_2__mod__cdata
        }
      }
      if (AC_lhydro__mod__cparam && AC_hall_term__mod__magnetic!=0.0) {
        ac_transformed_pencil_advec_va2=( (ac_transformed_pencil_bb.x*dline_1__mod__cdata.x*( AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.x*AC_mu01__mod__cdata  +sqrt(AC_mu01__mod__cdata*ac_transformed_pencil_rho1 + (AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.x*AC_mu01__mod__cdata)*(AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.x*AC_mu01__mod__cdata) ) ))*(ac_transformed_pencil_bb.x*dline_1__mod__cdata.x*( AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.x*AC_mu01__mod__cdata  +sqrt(AC_mu01__mod__cdata*ac_transformed_pencil_rho1 + (AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.x*AC_mu01__mod__cdata)*(AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.x*AC_mu01__mod__cdata) ) ))  +(ac_transformed_pencil_bb.y*dline_1__mod__cdata.y*( AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.y*AC_mu01__mod__cdata  +sqrt(AC_mu01__mod__cdata*ac_transformed_pencil_rho1 + (AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.y*AC_mu01__mod__cdata)*(AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.y*AC_mu01__mod__cdata) ) ))*(ac_transformed_pencil_bb.y*dline_1__mod__cdata.y*( AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.y*AC_mu01__mod__cdata  +sqrt(AC_mu01__mod__cdata*ac_transformed_pencil_rho1 + (AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.y*AC_mu01__mod__cdata)*(AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.y*AC_mu01__mod__cdata) ) ))  +(ac_transformed_pencil_bb.z*dline_1__mod__cdata.z*( AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.z*AC_mu01__mod__cdata  +sqrt(AC_mu01__mod__cdata*ac_transformed_pencil_rho1 + (AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.z*AC_mu01__mod__cdata)*(AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.z*AC_mu01__mod__cdata) ) ))*(ac_transformed_pencil_bb.z*dline_1__mod__cdata.z*( AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.z*AC_mu01__mod__cdata  +sqrt(AC_mu01__mod__cdata*ac_transformed_pencil_rho1 + (AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.z*AC_mu01__mod__cdata)*(AC_hall_term__mod__magnetic*AC_pi__mod__cparam*dline_1__mod__cdata.z*AC_mu01__mod__cdata) ) ))  )
      }
      advec2__mod__cdata=advec2__mod__cdata+ac_transformed_pencil_advec_va2
      if (AC_lmagneto_friction__mod__magnetic) {
        tmp1_81_82_100 = dot(ac_transformed_pencil_vmagfric,ac_transformed_pencil_vmagfric)
        advec2__mod__cdata=advec2__mod__cdata + tmp1_81_82_100
      }
    }
  }
  if (AC_lgrav__mod__cparam) {
    if (AC_lpencil__mod__cdata[AC_i_gg__mod__cparam-1]) {
      ac_transformed_pencil_gg.x = AC_gravx_xpencil__mod__gravity[vertexIdx.x]
      ac_transformed_pencil_gg.y = AC_gravy_ypencil__mod__gravity[AC_m__mod__cdata-1]
      ac_transformed_pencil_gg.z = AC_gravz_zpencil__mod__gravity[AC_n__mod__cdata-1]
    }
    if (AC_lpencil__mod__cdata[AC_i_epot__mod__cparam-1]) {
      ac_transformed_pencil_epot=ac_transformed_pencil_rho*(AC_potx_xpencil__mod__gravity[vertexIdx.x]+AC_poty_ypencil__mod__gravity[AC_m__mod__cdata-1]+AC_potz_zpencil__mod__gravity[AC_n__mod__cdata-1])
    }
  }
  fmax__mod__hydro=1./AC_impossible__mod__cparam
  if (AC_ladvection_velocity__mod__hydro) {
    if (! AC_lconservative__mod__hydro  &&  ! AC_lweno_transport__mod__cdata  &&   ! AC_lno_meridional_flow__mod__hydro  &&  ! AC_lfargo_advection__mod__cdata) {
      if (AC_lschur_3d3d1d_uu__mod__hydro) {
        ugu_schur_x_131 = dot(ac_transformed_pencil_uu,ac_transformed_pencil_uij.row(1-1))
        ugu_schur_y_131 = dot(ac_transformed_pencil_uu,ac_transformed_pencil_uij.row(2-1))
        ugu_schur_z_131=ac_transformed_pencil_uu.z*ac_transformed_pencil_uij[3-1][3-1]
        DF_UX=DF_UX-ugu_schur_x_131
        DF_UY=DF_UY-ugu_schur_y_131
        DF_UZ=DF_UZ-ugu_schur_z_131
      }
      else if (AC_lschur_2d2d3d_uu__mod__hydro) {
        puij_schur_131[1-1][1-1] = ac_transformed_pencil_uij[1-1][1-1]
        puij_schur_131[2-1][1-1] = ac_transformed_pencil_uij[2-1][1-1]
        puij_schur_131[3-1][1-1] = ac_transformed_pencil_uij[3-1][1-1]
        puij_schur_131[1-1][2-1] = ac_transformed_pencil_uij[1-1][2-1]
        puij_schur_131[2-1][2-1] = ac_transformed_pencil_uij[2-1][2-1]
        puij_schur_131[3-1][2-1] = ac_transformed_pencil_uij[3-1][2-1]
        puij_schur_131[1-1][3-1] = ac_transformed_pencil_uij[1-1][3-1]
        puij_schur_131[2-1][3-1] = ac_transformed_pencil_uij[2-1][3-1]
        puij_schur_131[3-1][3-1] = ac_transformed_pencil_uij[3-1][3-1]
        puij_schur_131[1-1][3-1] = 0
        puij_schur_131[2-1][3-1] = 0
        ugu_schur_x_131 = dot(ac_transformed_pencil_uu,puij_schur_131.row(1-1))
        ugu_schur_y_131 = dot(ac_transformed_pencil_uu,puij_schur_131.row(2-1))
        ugu_schur_z_131 = dot(ac_transformed_pencil_uu,puij_schur_131.row(3-1))
        DF_UX=DF_UX-ugu_schur_x_131
        DF_UY=DF_UY-ugu_schur_y_131
        DF_UZ=DF_UZ-ugu_schur_z_131
      }
      else if (AC_lschur_2d2d1d_uu__mod__hydro) {
        puij_schur_131[1-1][1-1] = ac_transformed_pencil_uij[1-1][1-1]
        puij_schur_131[2-1][1-1] = ac_transformed_pencil_uij[2-1][1-1]
        puij_schur_131[3-1][1-1] = ac_transformed_pencil_uij[3-1][1-1]
        puij_schur_131[1-1][2-1] = ac_transformed_pencil_uij[1-1][2-1]
        puij_schur_131[2-1][2-1] = ac_transformed_pencil_uij[2-1][2-1]
        puij_schur_131[3-1][2-1] = ac_transformed_pencil_uij[3-1][2-1]
        puij_schur_131[1-1][3-1] = ac_transformed_pencil_uij[1-1][3-1]
        puij_schur_131[2-1][3-1] = ac_transformed_pencil_uij[2-1][3-1]
        puij_schur_131[3-1][3-1] = ac_transformed_pencil_uij[3-1][3-1]
        puij_schur_131[1-1][3-1] = 0
        puij_schur_131[2-1][3-1] = 0
        ugu_schur_x_131 = dot(ac_transformed_pencil_uu,puij_schur_131.row(1-1))
        ugu_schur_y_131 = dot(ac_transformed_pencil_uu,puij_schur_131.row(2-1))
        ugu_schur_z_131=ac_transformed_pencil_uu.z*ac_transformed_pencil_uij[3-1][3-1]
        DF_UX=DF_UX-ugu_schur_x_131
        DF_UY=DF_UY-ugu_schur_y_131
        DF_UZ=DF_UZ-ugu_schur_z_131
      }
      else {
        DF_UVEC=DF_UVEC-ac_transformed_pencil_ugu
      }
    }
    if (AC_ldensity__mod__cparam && AC_lconservative__mod__hydro) {
      tmp_131 = derx(Field(AC_itij__mod__hydro+0-1))
      DF_UX=DF_UX-tmp_131
      tmp_131 = dery(Field(AC_itij__mod__hydro+1-1))
      DF_UY=DF_UY-tmp_131
      tmp_131 = derz(Field(AC_itij__mod__hydro+2-1))
      DF_UZ=DF_UZ-tmp_131
      tmp_131 = dery(Field(AC_itij__mod__hydro+3-1))
      DF_UX=DF_UX-tmp_131
      tmp_131 = derz(Field(AC_itij__mod__hydro+5-1))
      DF_UX=DF_UX-tmp_131
      tmp_131 = derx(Field(AC_itij__mod__hydro+3-1))
      DF_UY=DF_UY-tmp_131
      tmp_131 = derz(Field(AC_itij__mod__hydro+4-1))
      DF_UY=DF_UY-tmp_131
      tmp_131 = derx(Field(AC_itij__mod__hydro+5-1))
      DF_UZ=DF_UZ-tmp_131
      tmp_131 = dery(Field(AC_itij__mod__hydro+4-1))
      DF_UZ=DF_UZ-tmp_131
    }
    if (AC_lweno_transport__mod__cdata) {
      DF_UX=DF_UX-(ac_transformed_pencil_transpurho.x-ac_transformed_pencil_uu.x*ac_transformed_pencil_transprho)*ac_transformed_pencil_rho1
      DF_UY=DF_UY-(ac_transformed_pencil_transpurho.y-ac_transformed_pencil_uu.y*ac_transformed_pencil_transprho)*ac_transformed_pencil_rho1
      DF_UZ=DF_UZ-(ac_transformed_pencil_transpurho.z-ac_transformed_pencil_uu.z*ac_transformed_pencil_transprho)*ac_transformed_pencil_rho1
    }
    if (AC_lno_meridional_flow__mod__hydro) {
      DF_UX=0.0
      DF_UY=0.0
      DF_UZ=DF_UZ-ac_transformed_pencil_ugu.z
    }
    if (AC_lfargo_advection__mod__cdata) {
      DF_UVEC=DF_UVEC-ac_transformed_pencil_uuadvec_guu
    }
  }
  if (AC_omega__mod__cdata!=0.) {
    if (AC_lcylindrical_coords__mod__cdata) {
      if (AC_lcoriolis_force__mod__hydro) {
        if (AC_lomega_cyl_xy__mod__hydro) {
          c2_105_131= 2*AC_omega__mod__cdata*cos(AC_y__mod__cdata[AC_m__mod__cdata-1])
          s2_105_131=-2*AC_omega__mod__cdata*sin(AC_y__mod__cdata[AC_m__mod__cdata-1])
          DF_UX=DF_UX-c2_105_131*ac_transformed_pencil_uu.z
          DF_UY=DF_UY-s2_105_131*ac_transformed_pencil_uu.z
          DF_UZ=DF_UZ+c2_105_131*ac_transformed_pencil_uu.x+s2_105_131*ac_transformed_pencil_uu.y
        }
        else {
          c2_105_131=2*AC_omega__mod__cdata
          DF_UX=DF_UX+c2_105_131*ac_transformed_pencil_uu.y
          DF_UY=DF_UY-c2_105_131*ac_transformed_pencil_uu.x
        }
      }
      if (AC_lcentrifugal_force__mod__hydro) {
        DF_UX=DF_UX+AC_x__mod__cdata[vertexIdx.x]*AC_omega__mod__cdata*AC_omega__mod__cdata
      }
    }
    else if (AC_lspherical_coords__mod__cdata) {
      if (AC_lcoriolis_force__mod__hydro) {
        c2_106_131= 2*AC_omega__mod__cdata*AC_costh__mod__cdata[AC_m__mod__cdata-1]
        s2_106_131=-2*AC_omega__mod__cdata*AC_sinth__mod__cdata[AC_m__mod__cdata-1]
      }
      if (AC_theta__mod__cdata==0.0) {
        if (AC_lcoriolis_force__mod__hydro) {
          if (AC_r_omega__mod__hydro != 0.) {
            DF_UX=DF_UX- s2_106_131*ac_transformed_pencil_uu.z              *AC_prof_om__mod__hydro[vertexIdx.x-NGHOST_VAL]
            DF_UY=DF_UY+ c2_106_131*ac_transformed_pencil_uu.z              *AC_prof_om__mod__hydro[vertexIdx.x-NGHOST_VAL]
            DF_UZ=DF_UZ-(c2_106_131*ac_transformed_pencil_uu.y-s2_106_131*ac_transformed_pencil_uu.x)*AC_prof_om__mod__hydro[vertexIdx.x-NGHOST_VAL]
          }
          else {
            DF_UX=DF_UX-s2_106_131*ac_transformed_pencil_uu.z
            DF_UY=DF_UY+c2_106_131*ac_transformed_pencil_uu.z
            DF_UZ=DF_UZ-c2_106_131*ac_transformed_pencil_uu.y+s2_106_131*ac_transformed_pencil_uu.x
          }
        }
      }
      else {
        cp2_106_131=2*AC_omega__mod__cdata*AC_cosph__mod__cdata[AC_n__mod__cdata-1]
        cs2_106_131=c2_106_131*AC_sinph__mod__cdata[AC_n__mod__cdata-1]
        ss2_106_131=s2_106_131*AC_sinph__mod__cdata[AC_n__mod__cdata-1]
        if (AC_lcoriolis_force__mod__hydro) {
          if (AC_r_omega__mod__hydro != 0.) {
            DF_UX=DF_UX+(-cs2_106_131*ac_transformed_pencil_uu.z + cp2_106_131*ac_transformed_pencil_uu.y)*AC_prof_om__mod__hydro[vertexIdx.x-NGHOST_VAL]
            DF_UY=DF_UY+(-cp2_106_131*ac_transformed_pencil_uu.x - ss2_106_131*ac_transformed_pencil_uu.z)*AC_prof_om__mod__hydro[vertexIdx.x-NGHOST_VAL]
            DF_UZ=DF_UZ+(+ss2_106_131*ac_transformed_pencil_uu.y + cs2_106_131*ac_transformed_pencil_uu.x)*AC_prof_om__mod__hydro[vertexIdx.x-NGHOST_VAL]
          }
          else {
            DF_UX=DF_UX - cs2_106_131*ac_transformed_pencil_uu.z + cp2_106_131*ac_transformed_pencil_uu.y
            DF_UY=DF_UY - cp2_106_131*ac_transformed_pencil_uu.x - ss2_106_131*ac_transformed_pencil_uu.z
            DF_UZ=DF_UZ + ss2_106_131*ac_transformed_pencil_uu.y + cs2_106_131*ac_transformed_pencil_uu.x
          }
        }
      }
      if (AC_lcentrifugal_force__mod__hydro) {
        om2_106_131=AC_amp_centforce__mod__hydro*AC_omega__mod__cdata*AC_omega__mod__cdata
        if (AC_theta__mod__cdata==0.0) {
          DF_UX=DF_UX-om2_106_131*AC_x__mod__cdata[vertexIdx.x]*AC_sinth__mod__cdata[AC_m__mod__cdata-1]
        }
        else {
        }
      }
    }
    else if (AC_lprecession__mod__hydro) {
      cent_res_107_131 = AC_mat_cent__mod__hydro*ac_transformed_pencil_rr
      cori_res_107_131 = AC_mat_cent__mod__hydro*ac_transformed_pencil_uu
      DF_UVEC = DF_UVEC + cent_res_107_131 + cori_res_107_131
    }
    else if (AC_lrotation_xaxis__mod__hydro) {
      if (AC_omega__mod__cdata != 0.  &&  AC_lcoriolis_force__mod__hydro) {
        c2_108_131= 2*AC_omega__mod__cdata*cos(AC_theta__mod__cdata*AC_pi__mod__cparam/180.)
        s2_108_131=-2*AC_omega__mod__cdata*sin(AC_theta__mod__cdata*AC_pi__mod__cparam/180.)
        DF_UX=DF_UX-s2_108_131*ac_transformed_pencil_uu.z
        DF_UY=DF_UY+c2_108_131*ac_transformed_pencil_uu.z
        DF_UZ=DF_UZ-c2_108_131*ac_transformed_pencil_uu.y+s2_108_131*ac_transformed_pencil_uu.x
      }
    }
    else {
      if (AC_omega__mod__cdata != 0.  &&  AC_theta__mod__cdata==0) {
        if (AC_lcoriolis_force__mod__hydro) {
          c2_109_131=2*AC_omega__mod__cdata
          DF_UX=DF_UX+c2_109_131*ac_transformed_pencil_uu.y
          DF_UY=DF_UY-c2_109_131*ac_transformed_pencil_uu.x
        }
        if (AC_lcentrifugal_force__mod__hydro) {
          DF_UX=DF_UX+AC_x__mod__cdata[vertexIdx.x]*AC_amp_centforce__mod__hydro*AC_omega__mod__cdata*AC_omega__mod__cdata
          DF_UY=DF_UY+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_amp_centforce__mod__hydro*AC_omega__mod__cdata*AC_omega__mod__cdata
        }
      }
      else if(AC_omega__mod__cdata != 0.) {
        if (AC_lcoriolis_force__mod__hydro) {
          c2_109_131= 2*AC_omega__mod__cdata*cos(AC_theta__mod__cdata*AC_dtor__mod__cparam)
          s2_109_131=-2*AC_omega__mod__cdata*sin(AC_theta__mod__cdata*AC_dtor__mod__cparam)
          DF_UX=DF_UX+c2_109_131*ac_transformed_pencil_uu.y
          DF_UY=DF_UY-c2_109_131*ac_transformed_pencil_uu.x+s2_109_131*ac_transformed_pencil_uu.z
          DF_UZ=DF_UZ           -s2_109_131*ac_transformed_pencil_uu.y
          if (AC_lshear_in_coriolis__mod__hydro) {
            DF_UX=DF_UX+c2_109_131*AC_sshear__mod__cdata*AC_x__mod__cdata[vertexIdx.x]
            DF_UZ=DF_UZ-s2_109_131*AC_sshear__mod__cdata*AC_x__mod__cdata[vertexIdx.x]
          }
        }
      }
    }
  }
  if (AC_lcoriolis_xdep__mod__hydro) {
    c1_110_131=-2*AC_ampl_omega__mod__hydro*sin(AC_pi__mod__cparam*((AC_x__mod__cdata[vertexIdx.x])-AC_x0__mod__cdata)/AC_lx__mod__cdata)
    c2_110_131= 2*AC_ampl_omega__mod__hydro*cos(AC_pi__mod__cparam*((AC_x__mod__cdata[vertexIdx.x])-AC_x0__mod__cdata)/AC_lx__mod__cdata)
    DF_UX=DF_UX             +c2_110_131*ac_transformed_pencil_uu.y
    DF_UY=DF_UY+c1_110_131*ac_transformed_pencil_uu.z-c2_110_131*ac_transformed_pencil_uu.x
    DF_UZ=DF_UZ-c1_110_131*ac_transformed_pencil_uu.y
  }
  if (AC_lviscosity__mod__cparam) {
    if (AC_lmagfield_nu__mod__viscosity) {
      DF_UX = DF_UX + ac_transformed_pencil_fvisc.x/(1.+ac_transformed_pencil_b2/AC_meanfield_nub__mod__viscosity*AC_meanfield_nub__mod__viscosity)
      DF_UY = DF_UY + ac_transformed_pencil_fvisc.y/(1.+ac_transformed_pencil_b2/AC_meanfield_nub__mod__viscosity*AC_meanfield_nub__mod__viscosity)
      DF_UY = DF_UY + ac_transformed_pencil_fvisc.z/(1.+ac_transformed_pencil_b2/AC_meanfield_nub__mod__viscosity*AC_meanfield_nub__mod__viscosity)
    }
    else {
      DF_UVEC = DF_UVEC + ac_transformed_pencil_fvisc
    }
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_nu__mod__viscosity = ac_transformed_pencil_diffus_total*dxyz_2__mod__cdata
      if (AC_ldynamical_diffusion__mod__cdata  &&  AC_lvisc_hyper3_mesh__mod__viscosity) {
        diffus_nu3__mod__viscosity = ac_transformed_pencil_diffus_total3 * sum(abs(dline_1__mod__cdata))
      }
      else {
        diffus_nu3__mod__viscosity = ac_transformed_pencil_diffus_total3*dxyz_6__mod__cdata
      }
      maxdiffus__mod__cdata =max(maxdiffus__mod__cdata ,diffus_nu__mod__viscosity)
      maxdiffus2__mod__cdata=max(maxdiffus2__mod__cdata,ac_transformed_pencil_diffus_total2*dxyz_4__mod__cdata)
      maxdiffus3__mod__cdata=max(maxdiffus3__mod__cdata,diffus_nu3__mod__viscosity)
    }
    if (AC_ldiagnos__mod__cdata) {
      if (AC_idiag_reshock__mod__viscosity!=0) {
        if (abs(ac_transformed_pencil_shock) > AC_tini__mod__cparam) {
          reshock_113_114_131 = dxmax_pencil__mod__cdata*sqrt(ac_transformed_pencil_u2)/(AC_nu_shock__mod__viscosity*ac_transformed_pencil_shock)
        }
        else {
          reshock_113_114_131=0.
        }
      }
      if (AC_idiag_epsk_les__mod__viscosity!=0) {
        if (AC_lvisc_smag_simplified__mod__viscosity) {
        }
        else if (AC_lvisc_smag_cross_simplified__mod__viscosity) {
        }
      }
      if (AC_idiag_sijoiojm__mod__viscosity!=0) {
        tmp_113_114_131=0.
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[1-1][1-1]*ac_transformed_pencil_oo.x*ac_transformed_pencil_oo.x
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[1-1][2-1]*ac_transformed_pencil_oo.x*ac_transformed_pencil_oo.y
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[1-1][3-1]*ac_transformed_pencil_oo.x*ac_transformed_pencil_oo.z
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[2-1][1-1]*ac_transformed_pencil_oo.y*ac_transformed_pencil_oo.x
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[2-1][2-1]*ac_transformed_pencil_oo.y*ac_transformed_pencil_oo.y
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[2-1][3-1]*ac_transformed_pencil_oo.y*ac_transformed_pencil_oo.z
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[3-1][1-1]*ac_transformed_pencil_oo.z*ac_transformed_pencil_oo.x
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[3-1][2-1]*ac_transformed_pencil_oo.z*ac_transformed_pencil_oo.y
        tmp_113_114_131=tmp_113_114_131+ac_transformed_pencil_sij[3-1][3-1]*ac_transformed_pencil_oo.z*ac_transformed_pencil_oo.z
      }
      if (AC_lmagnetic__mod__cparam) {
        if (AC_idiag_nud2uxbxm__mod__viscosity!=0 || AC_idiag_nud2uxbym__mod__viscosity!=0 || AC_idiag_nud2uxbzm__mod__viscosity!=0) {
          nud2uxb_113_114_131 = cross(ac_transformed_pencil_fvisc,ac_transformed_pencil_bb)
        }
      }
      if (AC_idiag_fviscm__mod__viscosity!=0  ||  AC_idiag_fviscrmsx__mod__viscosity!=0  ||  AC_idiag_fviscmin__mod__viscosity!=0  ||  AC_idiag_fviscmax__mod__viscosity!=0) {
        fvisc2_113_114_131 = dot(ac_transformed_pencil_fvisc,ac_transformed_pencil_fvisc)
      }
      if (AC_idiag_qfviscm__mod__viscosity!=0) {
        qfvisc_113_114_131 = dot(ac_transformed_pencil_curlo,ac_transformed_pencil_fvisc)
      }
    }
    if (AC_l1davgfirst__mod__cdata) {
      if (AC_idiag_viscforcezupmz__mod__viscosity!=0) {
        if (ac_transformed_pencil_uu.z > 0.) {
          uus_113_114_131 = ac_transformed_pencil_rho*ac_transformed_pencil_fvisc.z
        }
        else {
          uus_113_114_131=0.
        }
      }
      if (AC_idiag_viscforcezdownmz__mod__viscosity!=0) {
        if (ac_transformed_pencil_uu.z < 0.) {
          uus_113_114_131 = ac_transformed_pencil_rho*ac_transformed_pencil_fvisc.z
        }
        else {
          uus_113_114_131=0.
        }
      }
    }
    if (AC_l2davgfirst__mod__cdata) {
      if (AC_idiag_fviscmxy__mod__viscosity!=0) {
        if (AC_lvisc_sqrtrho_nu_const__mod__viscosity) {
        }
        else if (AC_lvisc_rho_nu_const__mod__viscosity) {
        }
        else if (AC_lvisc_nu_profy_bound__mod__viscosity) {
        }
        else {
        }
      }
      if (AC_idiag_fviscymxy__mod__viscosity!=0) {
        if (AC_lyang__mod__cdata) {
          fluxv_113_114_131.x=0.
          fluxv_113_114_131.y=ac_transformed_pencil_uu.x*ac_transformed_pencil_sij[1-1][2-1]+ac_transformed_pencil_uu.y*ac_transformed_pencil_sij[2-1][2-1]+ac_transformed_pencil_uu.z*ac_transformed_pencil_sij[3-1][2-1]
          fluxv_113_114_131.z=ac_transformed_pencil_uu.x*ac_transformed_pencil_sij[1-1][3-1]+ac_transformed_pencil_uu.y*ac_transformed_pencil_sij[2-1][3-1]+ac_transformed_pencil_uu.z*ac_transformed_pencil_sij[3-1][3-1]
        }
        else {
        }
      }
      if (AC_idiag_fviscrsphmphi__mod__viscosity!=0) {
        fluxv_113_114_131.x=ac_transformed_pencil_uu.x*ac_transformed_pencil_sij[1-1][1-1]+ac_transformed_pencil_uu.y*ac_transformed_pencil_sij[2-1][1-1]+ac_transformed_pencil_uu.z*ac_transformed_pencil_sij[3-1][1-1]
        fluxv_113_114_131.y=ac_transformed_pencil_uu.x*ac_transformed_pencil_sij[1-1][2-1]+ac_transformed_pencil_uu.y*ac_transformed_pencil_sij[2-1][2-1]+ac_transformed_pencil_uu.z*ac_transformed_pencil_sij[3-1][2-1]
        fluxv_113_114_131.z=ac_transformed_pencil_uu.x*ac_transformed_pencil_sij[1-1][3-1]+ac_transformed_pencil_uu.y*ac_transformed_pencil_sij[2-1][3-1]+ac_transformed_pencil_uu.z*ac_transformed_pencil_sij[3-1][3-1]
      }
    }
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata && AC_ladvection_velocity__mod__hydro) {
    maxadvec__mod__cdata=maxadvec__mod__cdata+ac_transformed_pencil_advec_uu
  }
  if (AC_ekman_friction__mod__hydro!=0) {
    if(AC_string_enum_friction_tdep__mod__hydro == AC_string_enum_nothing_string__mod__cparam) {
      frict__mod__hydro=AC_ekman_friction__mod__hydro
    }
    else if(AC_string_enum_friction_tdep__mod__hydro == AC_string_enum_linear_string__mod__cparam) {
      frict__mod__hydro=AC_ekman_friction__mod__hydro*max(min(AC_t__mod__cdata-AC_friction_tdep_toffset__mod__hydro/AC_friction_tdep_tau0__mod__hydro,1.),0.)
    }
    else if(AC_string_enum_friction_tdep__mod__hydro == AC_string_enum_inverse_string__mod__cparam) {
      frict__mod__hydro=AC_ekman_friction__mod__hydro/max(AC_t__mod__cdata,AC_friction_tdep_toffset__mod__hydro)
    }
    else if(AC_string_enum_friction_tdep__mod__hydro == AC_string_enum_current_string__mod__cparam) {
      if (AC_lmagnetic__mod__cparam) {
        frict__mod__hydro=AC_ekman_friction__mod__hydro*sqrt(ac_transformed_pencil_j2)
      }
      else {
      }
    }
    else {
    }
    tmpv_131 = frict__mod__hydro*ac_transformed_pencil_uu
    DF_UVEC=DF_UVEC-tmpv_131
  }
  if (AC_lboussinesq__mod__cparam && AC_ltemperature__mod__cparam) {
    if (AC_lsphere_in_a_box__mod__cdata) {
      ju_131=1+AC_iuu__mod__cdata-1
      DF_U_131=DF_U_131 + ac_transformed_pencil_r_mn*AC_ra__mod__hydro*AC_pr__mod__hydro*value(Field(AC_itt__mod__cdata-1))*ac_transformed_pencil_evr.x
      ju_131=2+AC_iuu__mod__cdata-1
      DF_U_131=DF_U_131 + ac_transformed_pencil_r_mn*AC_ra__mod__hydro*AC_pr__mod__hydro*value(Field(AC_itt__mod__cdata-1))*ac_transformed_pencil_evr.y
      ju_131=3+AC_iuu__mod__cdata-1
      DF_U_131=DF_U_131 + ac_transformed_pencil_r_mn*AC_ra__mod__hydro*AC_pr__mod__hydro*value(Field(AC_itt__mod__cdata-1))*ac_transformed_pencil_evr.z
    }
    else {
      DF_UZ=DF_UZ+AC_ra__mod__hydro*AC_pr__mod__hydro*value(Field(AC_itt__mod__cdata-1))
    }
  }
  if (AC_lforcing_cont_uu__mod__hydro) {
    DF_UVEC=DF_UVEC + AC_ampl_fcont_uu__mod__hydro*ac_transformed_pencil_fcont[1-1]
  }
  if (AC_tdamp__mod__hydro!=0 || AC_dampuext__mod__hydro!=0 || AC_dampuint__mod__hydro!=0) {
    if ((AC_dampu__mod__hydro != 0.)  &&  (AC_t__mod__cdata < AC_tdamp__mod__hydro)) {
      if (AC_dampu__mod__hydro > 0.0) {
        DF_UVEC = DF_UVEC - AC_fade_fact__mod__hydro*AC_dampu__mod__hydro*value(F_UVEC)
      }
      else {
        DF_UVEC = DF_UVEC + AC_fade_fact__mod__hydro*AC_dampu__mod__hydro/AC_dt__mod__cdata*value(F_UVEC)
      }
    }
    if (AC_dampuext__mod__hydro > 0.0  &&  AC_rdampext__mod__hydro != AC_impossible__mod__cparam) {
      step_vector_return_value_116_122_131 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_rdampext__mod__hydro)/(AC_wdamp__mod__hydro+AC_tini__mod__cparam)))
      pdamp_122_131 = step_vector_return_value_116_122_131
      DF_UX = DF_UX - AC_dampuext__mod__hydro*pdamp_122_131*value(Field(AC_iux__mod__cdata-1))
      DF_UY = DF_UY - AC_dampuext__mod__hydro*pdamp_122_131*value(Field(AC_iuy__mod__cdata-1))
      DF_UZ = DF_UZ - AC_dampuext__mod__hydro*pdamp_122_131*value(Field(AC_iuz__mod__cdata-1))
    }
    if (AC_dampuint__mod__hydro > 0.0  &&  AC_rdampint__mod__hydro != AC_impossible__mod__cparam) {
      step_vector_return_value_117_122_131 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_rdampint__mod__hydro)/(AC_wdamp__mod__hydro+AC_tini__mod__cparam)))
      pdamp_122_131 = 1 - step_vector_return_value_117_122_131
      DF_UX = DF_UX - AC_dampuint__mod__hydro*pdamp_122_131*value(Field(AC_iux__mod__cdata-1))
      DF_UY = DF_UY - AC_dampuint__mod__hydro*pdamp_122_131*value(Field(AC_iuy__mod__cdata-1))
      DF_UZ = DF_UZ - AC_dampuint__mod__hydro*pdamp_122_131*value(Field(AC_iuz__mod__cdata-1))
    }
    if (AC_lomega_int__mod__hydro) {
      if (AC_lcylinder_in_a_box__mod__cdata) {
        step_vector_return_value_118_122_131 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_rdampext__mod__hydro)/(AC_wdamp__mod__hydro+AC_tini__mod__cparam)))
        pdamp_122_131 = step_vector_return_value_118_122_131
      }
      else {
        step_vector_return_value_119_122_131 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_rdampext__mod__hydro)/(AC_wdamp__mod__hydro+AC_tini__mod__cparam)))
        pdamp_122_131 = step_vector_return_value_119_122_131
      }
      fext__mod__hydro.x=-AC_dampuext__mod__hydro*pdamp_122_131*value(Field(AC_iux__mod__cdata-1))
      fext__mod__hydro.y=-AC_dampuext__mod__hydro*pdamp_122_131*value(Field(AC_iuy__mod__cdata-1))
      fext__mod__hydro.z=-AC_dampuext__mod__hydro*pdamp_122_131*value(Field(AC_iuz__mod__cdata-1))
      DF_UVEC=DF_UVEC+fext__mod__hydro
      if (AC_dampuint__mod__hydro > 0.0) {
        if (AC_lcylinder_in_a_box__mod__cdata) {
          step_vector_return_value_120_122_131 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_rdampint__mod__hydro)/(AC_wdamp__mod__hydro+AC_tini__mod__cparam)))
          pdamp_122_131 = 1 - step_vector_return_value_120_122_131
        }
        else {
          step_vector_return_value_121_122_131 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_rdampint__mod__hydro)/(AC_wdamp__mod__hydro+AC_tini__mod__cparam)))
          pdamp_122_131 = 1 - step_vector_return_value_121_122_131
        }
        fint__mod__hydro.x=-AC_dampuint__mod__hydro*pdamp_122_131*(value(Field(AC_iux__mod__cdata-1))+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_omega_int__mod__hydro)
        fint__mod__hydro.y=-AC_dampuint__mod__hydro*pdamp_122_131*(value(Field(AC_iuy__mod__cdata-1))-AC_x__mod__cdata[vertexIdx.x]*AC_omega_int__mod__hydro)
        fint__mod__hydro.z=-AC_dampuint__mod__hydro*pdamp_122_131*(value(Field(AC_iuz__mod__cdata-1)))
        DF_UVEC=DF_UVEC+fint__mod__hydro
      }
    }
  }
  if (AC_tau_diffrot1__mod__hydro!=0.) {
    if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_bs04_string__mod__cparam) {
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_bs04c_string__mod__cparam) {
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_bs04c1_string__mod__cparam) {
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_bs04m_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_hp09_string__mod__cparam) {
      if (!AC_lcalc_uumeanxz__mod__hydro) {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
      else {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumxz__mod__hydro[vertexIdx.x][AC_n__mod__cdata-1][2-1]-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_sx_string__mod__cparam) {
      if (AC_lcalc_uumeanx__mod__hydro) {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumx__mod__hydro[vertexIdx.x][AC_iuy__mod__cdata-1]-AC_shearx__mod__hydro*AC_x__mod__cdata[vertexIdx.x])
      }
      else {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_shearx__mod__hydro*AC_x__mod__cdata[vertexIdx.x])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_solar_dc99_string__mod__cparam) {
      if (AC_lcalc_uumeanxy__mod__hydro) {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1])
      }
      else {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_shear_string__mod__cparam) {
      if (!AC_lcalc_uumean__mod__hydro) {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
      else {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][2-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_compression_string__mod__cparam) {
      if (!AC_lcalc_uumean__mod__hydro) {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
      else {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][3-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_remove_vertical_shear_string__mod__cparam) {
      DF_UX=value(Field(AC_iux__mod__cdata-1))-AC_uumz__mod__hydro[AC_n__mod__cdata-1][1-1]
      DF_UY=value(Field(AC_iuy__mod__cdata-1))-AC_uumz__mod__hydro[AC_n__mod__cdata-1][2-1]
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_shear_x_string__mod__cparam) {
      DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iux__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_shear_x_sinz_string__mod__cparam) {
      DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iux__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_shear_z_string__mod__cparam) {
      if (!AC_lcalc_uumean__mod__hydro) {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuy__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
      else {
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][2-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_shear_z2_string__mod__cparam) {
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumxz__mod__hydro[vertexIdx.x][AC_n__mod__cdata-1][2-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_vertical_shear_linear_string__mod__cparam) {
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumxz__mod__hydro[vertexIdx.x][AC_n__mod__cdata-1][2-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_tachocline_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*value(Field(AC_iuz__mod__cdata-1))
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_solar_simple_string__mod__cparam) {
      if (AC_lspherical_coords__mod__cdata || AC_lcartesian_coords__mod__cdata) {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1])
      }
      if (AC_ldiffrot_test__mod__hydro) {
        DF_UX = 0.
        DF_UY = 0.
        if (AC_lspherical_coords__mod__cdata || AC_lcartesian_coords__mod__cdata) {
          DF_UZ = AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1]
        }
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_radial_uniform_shear_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_breeze_string__mod__cparam) {
      if (!AC_lcalc_uumean__mod__hydro) {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
      else {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][3-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_slow_wind_string__mod__cparam) {
      if (!AC_lcalc_uumean__mod__hydro) {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(value(Field(AC_iuz__mod__cdata-1))-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
      else {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][3-1]-AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_radial_shear_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_radial_shear_damp_string__mod__cparam) {
      DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][1-1]-0.)
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][2-1]-0.)
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_damp_corona_string__mod__cparam) {
      if (AC_lspherical_coords__mod__cdata) {
        DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][1-1]-0.)
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][2-1]-0.)
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-0.)
      }
      else if (AC_lcartesian_coords__mod__cdata) {
        if (!AC_lcalc_uumeanz__mod__hydro) {
          DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*(value(Field(AC_iux__mod__cdata-1))-0.)
          DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*(value(Field(AC_iuy__mod__cdata-1))-0.)
          DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*(value(Field(AC_iuz__mod__cdata-1))-0.)
        }
        else {
          DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][1-1]-0.)
          DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][2-1]-0.)
          DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][3-1]-0.)
        }
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_damp_horiz_vel_string__mod__cparam) {
      if (AC_lcartesian_coords__mod__cdata) {
        DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*value(Field(AC_iux__mod__cdata-1))
        DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*AC_prof_amp3__mod__hydro[AC_n__mod__cdata-1]*value(Field(AC_iuy__mod__cdata-1))
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_latitudinal_shear_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_damp_jets_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*AC_prof_amp4__mod__hydro[AC_m__mod__cdata-1]*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_uzjet__mod__hydro)
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_spokezlikeznssl_string__mod__cparam) {
      local_omega_123_131=AC_profx_diffrot1__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_profy_diffrot1__mod__hydro[AC_m__mod__cdata-1]+AC_profx_diffrot2__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_profy_diffrot2__mod__hydro[AC_m__mod__cdata-1]+AC_profx_diffrot3__mod__hydro[vertexIdx.x-NGHOST_VAL]*AC_profy_diffrot3__mod__hydro[AC_m__mod__cdata-1]
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_prof_amp1__mod__hydro[vertexIdx.x-NGHOST_VAL]*local_omega_123_131*AC_sinth__mod__cdata[AC_m__mod__cdata-1])
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_uumz_profile_string__mod__cparam) {
      DF_UX=DF_UX-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][1-1]-AC_uumz_prof__mod__hydro[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1][1-1])
      DF_UY=DF_UY-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][2-1]-AC_uumz_prof__mod__hydro[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1][2-1])
      if (!AC_limpose_only_horizontal_uumz__mod__hydro) {
        DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumz__mod__hydro[AC_n__mod__cdata-1][3-1]-AC_uumz_prof__mod__hydro[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1][3-1])
      }
    }
    else if(AC_string_enum_uuprof__mod__hydro == AC_string_enum_omega_profile_string__mod__cparam) {
      DF_UZ=DF_UZ-AC_tau_diffrot1__mod__hydro*(AC_uumxy__mod__hydro[vertexIdx.x][AC_m__mod__cdata-1][3-1]-AC_omega_prof__mod__hydro[vertexIdx.x-NGHOST_VAL][AC_m__mod__cdata-AC_NGHOST__mod__cparam-1]*AC_x__mod__cdata[vertexIdx.x]*AC_sinth__mod__cdata[AC_m__mod__cdata-1])
    }
    else {
    }
  }
  if (AC_velocity_ceiling__mod__hydro!=0.) {
    neg_velocity_ceiling_124_131 = -AC_velocity_ceiling__mod__hydro
    if (AC_velocity_ceiling__mod__hydro>0.0) {
      DF_UX = set_min_val(value(Field(AC_iux__mod__cdata-1)),neg_velocity_ceiling_124_131)
      DF_UX = set_max_val(value(Field(AC_iux__mod__cdata-1)),AC_velocity_ceiling__mod__hydro)
      DF_UY = set_min_val(value(Field(AC_iuy__mod__cdata-1)),neg_velocity_ceiling_124_131)
      DF_UY = set_max_val(value(Field(AC_iuy__mod__cdata-1)),AC_velocity_ceiling__mod__hydro)
      DF_UZ = set_min_val(value(Field(AC_iuz__mod__cdata-1)),neg_velocity_ceiling_124_131)
      DF_UZ = set_max_val(value(Field(AC_iuz__mod__cdata-1)),AC_velocity_ceiling__mod__hydro)
    }
  }
  if (AC_ladv_der_as_aux__mod__cdata) {
    DF__ADV_DERVEC = ac_transformed_pencil_fpres + ac_transformed_pencil_fvisc
    if (AC_lgrav__mod__cparam) {
      DF__ADV_DERVEC = value(F__ADV_DERVEC) + ac_transformed_pencil_gg
    }
  }
  if (AC_luu_sph_as_aux__mod__hydro && AC_lsphere_in_a_box__mod__cdata) {
    DF_UU_SPHR = ac_transformed_pencil_uu.x*ac_transformed_pencil_evr.x+ac_transformed_pencil_uu.y*ac_transformed_pencil_evr.y+ac_transformed_pencil_uu.z*ac_transformed_pencil_evr.z
    DF_UU_SPHT = ac_transformed_pencil_uu.x*ac_transformed_pencil_evth.x+ac_transformed_pencil_uu.y*ac_transformed_pencil_evth.y+ac_transformed_pencil_uu.z*ac_transformed_pencil_evth.z
    DF_UU_SPHP = ac_transformed_pencil_uu.x*ac_transformed_pencil_phix+ac_transformed_pencil_uu.y*ac_transformed_pencil_phiy
  }
  if (AC_tau_damp_ruxm__mod__hydro!=0.) {
    DF_UX=DF_UX-AC_ruxm__mod__hydro*ac_transformed_pencil_rho1*AC_tau_damp_ruxm1__mod__hydro
  }
  if (AC_tau_damp_ruym__mod__hydro!=0.) {
    DF_UY=DF_UY-AC_ruym__mod__hydro*ac_transformed_pencil_rho1*AC_tau_damp_ruym1__mod__hydro
  }
  if (AC_tau_damp_ruzm__mod__hydro!=0.) {
    DF_UZ=DF_UZ-AC_ruzm__mod__hydro*ac_transformed_pencil_rho1*AC_tau_damp_ruzm1__mod__hydro
  }
  if (AC_lborder_profiles__mod__cparam) {
    ju_129_131=1+AC_iuu__mod__cdata-1
    if(AC_string_enum_borderuu__mod__hydro.x == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderuu__mod__hydro.x == AC_string_enum_0_string__mod__cparam) {
      f_target_129_131.x=0.
    }
    else if(AC_string_enum_borderuu__mod__hydro.x == AC_string_enum_constant_string__mod__cparam) {
      f_target_129_131.x = AC_uu_const__mod__hydro.x
    }
    else if(AC_string_enum_borderuu__mod__hydro.x == AC_string_enum_initialzcondition_string__mod__cparam) {
    }
    else if(AC_string_enum_borderuu__mod__hydro.x == AC_string_enum_nothing_string__mod__cparam) {
    }
    ju_129_131=2+AC_iuu__mod__cdata-1
    if(AC_string_enum_borderuu__mod__hydro.y == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderuu__mod__hydro.y == AC_string_enum_0_string__mod__cparam) {
      f_target_129_131.y=0.
    }
    else if(AC_string_enum_borderuu__mod__hydro.y == AC_string_enum_constant_string__mod__cparam) {
      f_target_129_131.y = AC_uu_const__mod__hydro.y
    }
    else if(AC_string_enum_borderuu__mod__hydro.y == AC_string_enum_initialzcondition_string__mod__cparam) {
    }
    else if(AC_string_enum_borderuu__mod__hydro.y == AC_string_enum_nothing_string__mod__cparam) {
    }
    ju_129_131=3+AC_iuu__mod__cdata-1
    if(AC_string_enum_borderuu__mod__hydro.z == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderuu__mod__hydro.z == AC_string_enum_0_string__mod__cparam) {
      f_target_129_131.z=0.
    }
    else if(AC_string_enum_borderuu__mod__hydro.z == AC_string_enum_constant_string__mod__cparam) {
      f_target_129_131.z = AC_uu_const__mod__hydro.z
    }
    else if(AC_string_enum_borderuu__mod__hydro.z == AC_string_enum_initialzcondition_string__mod__cparam) {
    }
    else if(AC_string_enum_borderuu__mod__hydro.z == AC_string_enum_nothing_string__mod__cparam) {
    }
  }
  if (AC_lschur_3d3d1d__mod__density) {
  }
  else {
    if (AC_lcontinuity_gas__mod__density) {
      if (! AC_lweno_transport__mod__cdata  &&  ! AC_lffree__mod__density  &&  ! AC_lreduced_sound_speed__mod__density  &&   AC_string_enum_ieos_profile__mod__density==AC_string_enum_nothing_string__mod__cparam  &&  ! AC_lfargo_advection__mod__cdata) {
        if (AC_ldensity_nolog__mod__cdata) {
          if (AC_lconservative__mod__hydro) {
            density_rhs_143=-ac_transformed_pencil_divss
          }
          else {
            density_rhs_143=-ac_transformed_pencil_rho*ac_transformed_pencil_divu
            if (AC_ladvection_density__mod__density) {
              density_rhs_143 = density_rhs_143 - ac_transformed_pencil_ugrho
            }
            if (AC_lrelativistic_eos__mod__density) {
              density_rhs_143=AC_fourthird__mod__cparam*density_rhs_143
            }
          }
        }
        else {
          density_rhs_143= - ac_transformed_pencil_divu
          if (AC_ladvection_density__mod__density) {
            density_rhs_143 = density_rhs_143 - ac_transformed_pencil_uglnrho
          }
          if (AC_lrelativistic_eos__mod__density && !AC_lconservative__mod__hydro) {
            if (AC_lhydro__mod__cparam) {
              tmpv_143.x=ac_transformed_pencil_uu.x*density_rhs_143
              tmpv_143.y=ac_transformed_pencil_uu.y*density_rhs_143
              tmpv_143.z=ac_transformed_pencil_uu.z*density_rhs_143
              DF_UVEC=DF_UVEC-AC_onethird__mod__cparam*tmpv_143
            }
            density_rhs_143=AC_fourthird__mod__cparam*density_rhs_143
          }
        }
      }
      else {
        density_rhs_143=0.
      }
      if (AC_lweno_transport__mod__cdata) {
        density_rhs_143= density_rhs_143 - ac_transformed_pencil_transprho
      }
      if (AC_string_enum_ieos_profile__mod__density==AC_string_enum_surface_z_string__mod__cparam) {
        if (AC_ldensity_nolog__mod__cdata) {
          density_rhs_143= density_rhs_143 - AC_profz_eos__mod__density[AC_n__mod__cdata-1]*(ac_transformed_pencil_ugrho + ac_transformed_pencil_rho*ac_transformed_pencil_divu)
          if (AC_ldensity_profile_masscons__mod__density) {
            density_rhs_143 = density_rhs_143-AC_dprofz_eos__mod__density[AC_n__mod__cdata-1]*ac_transformed_pencil_rho*ac_transformed_pencil_uu.z
          }
        }
        else {
          density_rhs_143= density_rhs_143 - AC_profz_eos__mod__density[AC_n__mod__cdata-1]*(ac_transformed_pencil_uglnrho + ac_transformed_pencil_divu)
          if (AC_ldensity_profile_masscons__mod__density) {
            density_rhs_143 = density_rhs_143 -AC_dprofz_eos__mod__density[AC_n__mod__cdata-1]*ac_transformed_pencil_uu.z
          }
        }
      }
      if (AC_lffree__mod__density) {
        if (AC_ldensity_nolog__mod__cdata) {
          density_rhs_143= density_rhs_143 - AC_profx_ffree__mod__density[vertexIdx.x-NGHOST_VAL]*AC_profy_ffree__mod__density[AC_m__mod__cdata-1]*AC_profz_ffree__mod__density[AC_n__mod__cdata-1]*(ac_transformed_pencil_ugrho + ac_transformed_pencil_rho*ac_transformed_pencil_divu)
          if (AC_ldensity_profile_masscons__mod__density) {
            density_rhs_143=density_rhs_143 - ac_transformed_pencil_rho*( AC_dprofx_ffree__mod__density[vertexIdx.x-NGHOST_VAL]   *ac_transformed_pencil_uu.x  +AC_dprofy_ffree__mod__density[AC_m__mod__cdata-1]*ac_transformed_pencil_uu.y  +AC_dprofz_ffree__mod__density[AC_n__mod__cdata-1]*ac_transformed_pencil_uu.z)
          }
        }
        else {
          density_rhs_143= density_rhs_143 - AC_profx_ffree__mod__density[vertexIdx.x-NGHOST_VAL]*(AC_profy_ffree__mod__density[AC_m__mod__cdata-1]*AC_profz_ffree__mod__density[AC_n__mod__cdata-1])*(ac_transformed_pencil_uglnrho + ac_transformed_pencil_divu)
          if (AC_ldensity_profile_masscons__mod__density) {
            density_rhs_143=density_rhs_143-AC_dprofx_ffree__mod__density[vertexIdx.x-NGHOST_VAL]   *ac_transformed_pencil_uu.x  -AC_dprofy_ffree__mod__density[AC_m__mod__cdata-1]*ac_transformed_pencil_uu.y  -AC_dprofz_ffree__mod__density[AC_n__mod__cdata-1]*ac_transformed_pencil_uu.z
          }
        }
      }
      if (AC_lreduced_sound_speed__mod__density) {
        if (AC_ldensity_nolog__mod__cdata) {
          density_rhs_143 = density_rhs_143 - AC_reduce_cs2_profx__mod__density[vertexIdx.x-NGHOST_VAL]*AC_reduce_cs2_profz__mod__density[AC_n__mod__cdata-1]*(ac_transformed_pencil_ugrho + ac_transformed_pencil_rho*ac_transformed_pencil_divu)
        }
        else {
          density_rhs_143 = density_rhs_143 - AC_reduce_cs2_profx__mod__density[vertexIdx.x-NGHOST_VAL]*AC_reduce_cs2_profz__mod__density[AC_n__mod__cdata-1]*(ac_transformed_pencil_uglnrho + ac_transformed_pencil_divu)
        }
      }
      if (AC_lfargo_advection__mod__cdata) {
        if (AC_ldensity_nolog__mod__cdata) {
          density_rhs_143 = density_rhs_143 - ac_transformed_pencil_uuadvec_grho   - ac_transformed_pencil_rho*ac_transformed_pencil_divu
        }
        else {
          density_rhs_143 = density_rhs_143 - ac_transformed_pencil_uuadvec_glnrho - ac_transformed_pencil_divu
        }
      }
      DF_LNRHO = DF_LNRHO + density_rhs_143
    }
    if (AC_lupdate_mass_source__mod__density) {
      if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_nothing_string__mod__cparam) {
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_exponential_string__mod__cparam) {
        dlnrhodt_136_143=AC_mass_source_mdot__mod__density
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_bump_string__mod__cparam) {
        dlnrhodt_136_143=(AC_mass_source_mdot__mod__density/AC_fnorm__mod__density)*exp(-0.5*(ac_transformed_pencil_r_mn/AC_mass_source_sigma__mod__density)*(ac_transformed_pencil_r_mn/AC_mass_source_sigma__mod__density))
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_bump2_string__mod__cparam) {
        dlnrhodt_136_143=AC_fprofile_z__mod__density[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_bumpr_string__mod__cparam) {
        radius2_136_143=(AC_x__mod__cdata[vertexIdx.x]-AC_xblob__mod__density[1-1])*(AC_x__mod__cdata[vertexIdx.x]-AC_xblob__mod__density[1-1])+(AC_y__mod__cdata[AC_m__mod__cdata-1]-AC_yblob__mod__density[1-1])*(AC_y__mod__cdata[AC_m__mod__cdata-1]-AC_yblob__mod__density[1-1])+(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zblob__mod__density[1-1])*(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zblob__mod__density[1-1])
        fprofile_136_143=(AC_mass_source_mdot__mod__density/AC_fnorm__mod__density)*exp(-0.5*radius2_136_143/AC_mass_source_sigma__mod__density*AC_mass_source_sigma__mod__density)
        if (AC_lmass_source_random__mod__density) {
          fran_136_143[1-1] = rand_uniform()
          fran_136_143[2-1] = rand_uniform()
          tmp_136_143=sqrt(-2*log(fran_136_143[1-1]))*sin(2*AC_pi__mod__cparam*fran_136_143[2-1])
          dlnrhodt_136_143=fprofile_136_143*cos(AC_mass_source_omega__mod__density*AC_t__mod__cdata)*tmp_136_143
        }
        else {
          dlnrhodt_136_143=fprofile_136_143*cos(AC_mass_source_omega__mod__density*AC_t__mod__cdata)
        }
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_bumpx_string__mod__cparam || AC_string_enum_mass_source_profile__mod__density == AC_string_enum_sphzstepzdown_string__mod__cparam) {
        dlnrhodt_136_143=AC_fprofile_x__mod__density[vertexIdx.x-NGHOST_VAL]
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_const_string__mod__cparam) {
        dlnrhodt_136_143=-AC_mass_source_tau1__mod__density*(value(Field(AC_ilnrho__mod__cdata-1))-AC_lnrho0__mod__equationofstate)
      }
      else if(AC_string_enum_mass_source_profile__mod__density == AC_string_enum_cylindric_string__mod__cparam) {
        step_vector_return_value_134_136_143 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_r_int__mod__cdata)/(AC_wdamp__mod__density+AC_tini__mod__cparam)))
        pdamp_136_143=1.-step_vector_return_value_134_136_143
        dlnrhodt_136_143=-AC_damplnrho_int__mod__density*pdamp_136_143*(value(Field(AC_ilnrho__mod__cdata-1))-AC_lnrho_int__mod__density)
        step_vector_return_value_135_136_143 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_r_ext__mod__cdata)/(AC_wdamp__mod__density+AC_tini__mod__cparam)))
        pdamp_136_143=step_vector_return_value_135_136_143
        dlnrhodt_136_143=dlnrhodt_136_143-AC_damplnrho_ext__mod__density*pdamp_136_143*(value(Field(AC_ilnrho__mod__cdata-1))-AC_lnrho_ext__mod__density)
      }
      else {
      }
      if (AC_ldensity_nolog__mod__cdata) {
        DF_RHO=DF_RHO+ac_transformed_pencil_rho*dlnrhodt_136_143
      }
      else {
        DF_LNRHO=DF_LNRHO+dlnrhodt_136_143
      }
      if (AC_lentropy__mod__cparam) {
        DF_SS=DF_SS+(AC_gamma1__mod__density-1.0)*dlnrhodt_136_143
      }
    }
    diffus_diffrho__mod__density=0.
    diffus_diffrho3__mod__density=0.
    fdiff_143=0.0
    ldt_up_143 = AC_lfirst__mod__cdata && AC_ldt__mod__cdata
    if (AC_ldiff_normal__mod__density) {
      if (AC_ldensity_nolog__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho__mod__density*ac_transformed_pencil_del2rho
      }
      else {
        if (AC_ldiffusion_nolog__mod__density) {
          fdiff_143 = fdiff_143 + AC_diffrho__mod__density*ac_transformed_pencil_rho1*ac_transformed_pencil_del2rho
        }
        else {
          fdiff_143 = fdiff_143 + AC_diffrho__mod__density*(ac_transformed_pencil_del2lnrho+ac_transformed_pencil_glnrho2)
        }
      }
      if (ldt_up_143) {
        diffus_diffrho__mod__density=diffus_diffrho__mod__density+AC_diffrho__mod__density
      }
    }
    if (AC_ldiff_cspeed__mod__density) {
      if (AC_ldensity_nolog__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho__mod__density*pow(ac_transformed_pencil_tt,AC_diff_cspeed__mod__density)*ac_transformed_pencil_del2rho
      }
      else {
        if (AC_ldiffusion_nolog__mod__density) {
          fdiff_143 = fdiff_143 + AC_diffrho__mod__density*pow(ac_transformed_pencil_tt,AC_diff_cspeed__mod__density)*ac_transformed_pencil_rho1*ac_transformed_pencil_del2rho
        }
        else {
          fdiff_143 = fdiff_143 + AC_diffrho__mod__density*pow(ac_transformed_pencil_tt,AC_diff_cspeed__mod__density)*(ac_transformed_pencil_del2lnrho+ac_transformed_pencil_glnrho2)
        }
      }
      if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
        diffus_diffrho__mod__density=diffus_diffrho__mod__density+AC_diffrho__mod__density
      }
    }
    if (AC_ldiff_shock__mod__density) {
      if (AC_ldensity_nolog__mod__cdata) {
        tmp_143 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_grho)
        fdiff_143 = fdiff_143 + AC_diffrho_shock__mod__density * (ac_transformed_pencil_shock * ac_transformed_pencil_del2rho + tmp_143)
      }
      else {
        if (AC_ldiffusion_nolog__mod__density) {
          tmp_143 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_grho)
          fdiff_143 = fdiff_143 + ac_transformed_pencil_rho1 * AC_diffrho_shock__mod__density * (ac_transformed_pencil_shock * ac_transformed_pencil_del2rho + tmp_143)
        }
        else {
          tmp_143 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_glnrho)
          fdiff_143 = fdiff_143 + AC_diffrho_shock__mod__density * (ac_transformed_pencil_shock * (ac_transformed_pencil_del2lnrho + ac_transformed_pencil_glnrho2) + tmp_143)
          if (AC_lanti_shockdiffusion__mod__density) {
            fdiff_143 = fdiff_143 - AC_diffrho_shock__mod__density * (ac_transformed_pencil_shock*(AC_del2lnrho_glnrho2_init_z__mod__density[AC_n__mod__cdata-1] +  2*(ac_transformed_pencil_glnrho.z-AC_dlnrhodz_init_z__mod__density[AC_n__mod__cdata-1])*AC_dlnrhodz_init_z__mod__density[AC_n__mod__cdata-1]) +  ac_transformed_pencil_gshock.z*AC_dlnrhodz_init_z__mod__density[AC_n__mod__cdata-1] )
          }
        }
      }
      if (ldt_up_143) {
        diffus_diffrho__mod__density=diffus_diffrho__mod__density+AC_diffrho_shock__mod__density*ac_transformed_pencil_shock
      }
    }
    if (AC_ldensity_slope_limited__mod__density && AC_llast__mod__cdata) {
      if (AC_ldensity_nolog__mod__cdata) {
        not_implemented("calc_slope_diff_flux")
        fdiff_143=fdiff_143+tmp_143
      }
      else {
        not_implemented("calc_slope_diff_flux")
        fdiff_143=fdiff_143+tmp_143*ac_transformed_pencil_rho1
      }
    }
    if (AC_lmassdiff_fix__mod__density && !AC_lconservative__mod__hydro) {
      if (AC_ldensity_nolog__mod__cdata) {
        tmp_143 = fdiff_143*ac_transformed_pencil_rho1
      }
      else {
        tmp_143 = fdiff_143
      }
      if (AC_lhydro__mod__cparam && (!AC_lhydro_potential__mod__cparam)) {
        DF_UX = DF_UX - ac_transformed_pencil_uu.x * tmp_143
        DF_UY = DF_UY - ac_transformed_pencil_uu.y * tmp_143
        DF_UZ = DF_UZ - ac_transformed_pencil_uu.z * tmp_143
      }
      if (AC_lentropy__mod__cparam && (!AC_pretend_lntt__mod__cdata)) {
        DF_SS = DF_SS - ac_transformed_pencil_cv*tmp_143
      }
      else if (AC_lentropy__mod__cparam && AC_pretend_lntt__mod__cdata) {
        DF_LNTT = DF_LNTT - tmp_143
      }
      else if (AC_ltemperature__mod__cparam && (! AC_ltemperature_nolog__mod__cdata)) {
        DF_LNTT = DF_LNTT - tmp_143
      }
      else if (AC_ltemperature__mod__cparam && AC_ltemperature_nolog__mod__cdata) {
        DF_TT = DF_TT - tmp_143*ac_transformed_pencil_tt
      }
      else if (AC_lthermal_energy__mod__cparam) {
        DF_ETH = DF_ETH + 0.5 * fdiff_143 * ac_transformed_pencil_u2
      }
    }
    if (AC_ldiff_hyper3__mod__density || AC_ldiff_hyper3_strict__mod__density) {
      if (AC_ldensity_nolog__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3__mod__density*ac_transformed_pencil_del6rho
      }
      else {
        if (AC_ldiffusion_nolog__mod__density) {
          fdiff_143 = fdiff_143 + AC_diffrho_hyper3__mod__density*ac_transformed_pencil_rho1*ac_transformed_pencil_del6rho
        }
      }
      if (ldt_up_143) {
        diffus_diffrho3__mod__density=diffus_diffrho3__mod__density+AC_diffrho_hyper3__mod__density
      }
    }
    if (AC_ldiff_hyper3_polar__mod__density) {
      if (AC_ldensity_nolog__mod__cdata) {
        tmp_143 = der6x_ignore_spacing(Field(AC_irho__mod__cdata-1))
      }
      else {
        tmp_143 = der6x_ignore_spacing(Field(AC_ilnrho__mod__cdata-1))
      }
      fdiff_143 = fdiff_143 + AC_diffrho_hyper3__mod__density*AC_pi4_1__mod__cparam*tmp_143*dline_1__mod__cdata.x*dline_1__mod__cdata.x
      if (AC_ldensity_nolog__mod__cdata) {
        tmp_143 = der6y_ignore_spacing(Field(AC_irho__mod__cdata-1))
      }
      else {
        tmp_143 = der6y_ignore_spacing(Field(AC_ilnrho__mod__cdata-1))
      }
      fdiff_143 = fdiff_143 + AC_diffrho_hyper3__mod__density*AC_pi4_1__mod__cparam*tmp_143*dline_1__mod__cdata.y*dline_1__mod__cdata.y
      if (AC_ldensity_nolog__mod__cdata) {
        tmp_143 = der6z_ignore_spacing(Field(AC_irho__mod__cdata-1))
      }
      else {
        tmp_143 = der6z_ignore_spacing(Field(AC_ilnrho__mod__cdata-1))
      }
      fdiff_143 = fdiff_143 + AC_diffrho_hyper3__mod__density*AC_pi4_1__mod__cparam*tmp_143*dline_1__mod__cdata.z*dline_1__mod__cdata.z
      if (ldt_up_143) {
        diffus_diffrho3__mod__density=diffus_diffrho3__mod__density+AC_diffrho_hyper3__mod__density*AC_pi4_1__mod__cparam*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata
      }
    }
    if (AC_ldiff_hyper3_mesh__mod__density) {
      tmp_143 = der6x_ignore_spacing(Field(AC_ilnrho__mod__cdata-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3_mesh__mod__density * tmp_143 * dline_1__mod__cdata.x
      }
      else {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3_mesh__mod__density*AC_pi5_1__mod__cparam/60.*tmp_143*dline_1__mod__cdata.x
      }
      tmp_143 = der6y_ignore_spacing(Field(AC_ilnrho__mod__cdata-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3_mesh__mod__density * tmp_143 * dline_1__mod__cdata.y
      }
      else {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3_mesh__mod__density*AC_pi5_1__mod__cparam/60.*tmp_143*dline_1__mod__cdata.y
      }
      tmp_143 = der6z_ignore_spacing(Field(AC_ilnrho__mod__cdata-1))
      if (AC_ldynamical_diffusion__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3_mesh__mod__density * tmp_143 * dline_1__mod__cdata.z
      }
      else {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3_mesh__mod__density*AC_pi5_1__mod__cparam/60.*tmp_143*dline_1__mod__cdata.z
      }
      if (ldt_up_143) {
        if (AC_ldynamical_diffusion__mod__cdata) {
          diffus_diffrho3__mod__density = diffus_diffrho3__mod__density + AC_diffrho_hyper3_mesh__mod__density
          advec_hypermesh_rho_143=0.
        }
        else {
          advec_hypermesh_rho_143=AC_diffrho_hyper3_mesh__mod__density*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata)
        }
        advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_rho_143*advec_hypermesh_rho_143
      }
    }
    if (AC_ldiff_hyper3_aniso__mod__density) {
      tmp_143  = del6fj(Field(AC_ilnrho__mod__cdata-1), AC_diffrho_hyper3_aniso__mod__density)
      fdiff_143 = fdiff_143 + tmp_143
      if (AC_lsubtract_init_stratification__mod__density) {
        tmp_143  = del6fj(Field(AC_iglobal_lnrho0__mod__cdata-1), AC_diffrho_hyper3_aniso__mod__density)
        fdiff_143 = fdiff_143 - tmp_143
      }
      if (ldt_up_143) {
        diffus_diffrho3__mod__density=diffus_diffrho3__mod__density +  (AC_diffrho_hyper3_aniso__mod__density.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x +  AC_diffrho_hyper3_aniso__mod__density.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y +  AC_diffrho_hyper3_aniso__mod__density.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)/dxyz_6__mod__cdata
      }
    }
    if (AC_ldiff_hyper3lnrho__mod__density  ||  AC_ldiff_hyper3lnrho_strict__mod__density) {
      if (! AC_ldensity_nolog__mod__cdata) {
        fdiff_143 = fdiff_143 + AC_diffrho_hyper3__mod__density*ac_transformed_pencil_del6lnrho
      }
      if (ldt_up_143) {
        diffus_diffrho3__mod__density=diffus_diffrho3__mod__density+AC_diffrho_hyper3__mod__density
      }
    }
    if (AC_ldensity_nolog__mod__cdata) {
      DF_RHO   = DF_RHO   + fdiff_143
    }
    else {
      DF_LNRHO = DF_LNRHO + fdiff_143
    }
    if (ldt_up_143) {
      diffus_diffrho__mod__density = diffus_diffrho__mod__density*dxyz_2__mod__cdata
      if (AC_ldynamical_diffusion__mod__cdata  &&  AC_ldiff_hyper3_mesh__mod__density) {
        diffus_diffrho3__mod__density = diffus_diffrho3__mod__density * sum(abs(dline_1__mod__cdata))
      }
      else {
        diffus_diffrho3__mod__density = diffus_diffrho3__mod__density*dxyz_6__mod__cdata
      }
      maxdiffus__mod__cdata=max(maxdiffus__mod__cdata,diffus_diffrho__mod__density)
      maxdiffus3__mod__cdata=max(maxdiffus3__mod__cdata,diffus_diffrho3__mod__density)
    }
    if (AC_lborder_profiles__mod__cparam) {
      if(AC_string_enum_borderlnrho__mod__density == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderlnrho__mod__density == AC_string_enum_0_string__mod__cparam) {
        if (AC_ldensity_nolog__mod__cdata) {
          f_target_142_143=0.
        }
        else {
          f_target_142_143=1.
        }
      }
      else if(AC_string_enum_borderlnrho__mod__density == AC_string_enum_constant_string__mod__cparam) {
        if (AC_ldensity_nolog__mod__cdata) {
          f_target_142_143=AC_rho_const__mod__density
        }
        else {
          f_target_142_143=AC_lnrho_const__mod__density
        }
      }
      else if(AC_string_enum_borderlnrho__mod__density == AC_string_enum_initialzcondition_string__mod__cparam) {
      }
      else if(AC_string_enum_borderlnrho__mod__density == AC_string_enum_nothing_string__mod__cparam) {
      }
    }
  }
  hmax__mod__energy = 1./AC_impossible__mod__cparam
  ssmax__mod__energy = 1./AC_impossible__mod__cparam
  if (AC_lhydro__mod__cparam) {
    if (AC_lpressuregradient_gas__mod__hydro) {
      DF_UVEC = DF_UVEC + ac_transformed_pencil_fpres
      if (AC_lreference_state__mod__cdata) {
        DF_UX = DF_UX + AC_reference_state__mod__density[vertexIdx.x][AC_iref_gp__mod__cparam-1]*ac_transformed_pencil_rho1
      }
    }
    if (AC_beta_glnrho_scaled__mod__density.x != 0.0  ||  AC_beta_glnrho_scaled__mod__density.y != 0.0  ||  AC_beta_glnrho_scaled__mod__density.z != 0.0) {
      DF_UX = DF_UX - ac_transformed_pencil_cs2*AC_beta_glnrho_scaled__mod__density.x
      DF_UY = DF_UY - ac_transformed_pencil_cs2*AC_beta_glnrho_scaled__mod__density.y
      DF_UZ = DF_UZ - ac_transformed_pencil_cs2*AC_beta_glnrho_scaled__mod__density.z
    }
    if (AC_tau_cor__mod__energy>0) {
      ztop_231=AC_xyz0__mod__cdata.z+AC_lxyz__mod__cdata.z
      if (AC_z__mod__cdata[AC_n__mod__cdata-1]>=AC_z_cor__mod__energy) {
        xi_231=(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_z_cor__mod__energy)/(ztop_231-AC_z_cor__mod__energy)
        profile_cor_231=xi_231*xi_231*(3-2*xi_231)
        DF_UVEC = DF_UVEC - profile_cor_231*value(F_UVEC)/AC_tau_cor__mod__energy
      }
    }
  }
  if (AC_ladvection_entropy__mod__energy) {
    if (AC_pretend_lntt__mod__cdata) {
      DF_SS = DF_SS - ac_transformed_pencil_divu*AC_gamma_m1__mod__energy-ac_transformed_pencil_uglntt
    }
    else {
      if (AC_lweno_transport__mod__cdata) {
        DF_SS=DF_SS - ac_transformed_pencil_transprhos*ac_transformed_pencil_rho1 + ac_transformed_pencil_ss*ac_transformed_pencil_rho1*ac_transformed_pencil_transprho
      }
      else if (AC_lfargo_advection__mod__cdata) {
        DF_SS = DF_SS - ac_transformed_pencil_uuadvec_gss
      }
      else {
        DF_SS = DF_SS - ac_transformed_pencil_ugss
      }
    }
  }
  if (AC_grads0_imposed__mod__energy.x!=0.) {
    DF_SS=DF_SS-AC_grads0_imposed__mod__energy.x*ac_transformed_pencil_uu.x
  }
  if (AC_grads0_imposed__mod__energy.y!=0.) {
    DF_SS=DF_SS-AC_grads0_imposed__mod__energy.y*ac_transformed_pencil_uu.y
  }
  if (AC_grads0_imposed__mod__energy.z!=0.) {
    DF_SS=DF_SS-AC_grads0_imposed__mod__energy.z*ac_transformed_pencil_uu.z
  }
  diffus_chi__mod__energy=0.
  diffus_chi3__mod__energy=0.
  if (AC_lviscosity__mod__cparam  &&  AC_lviscosity_heat__mod__energy) {
    if (AC_lentropy__mod__cparam) {
      if (AC_pretend_lntt__mod__cdata) {
        DF_SS = DF_SS + ac_transformed_pencil_cv1*ac_transformed_pencil_tt1*ac_transformed_pencil_visc_heat
      }
      else {
        DF_SS = DF_SS + ac_transformed_pencil_tt1*ac_transformed_pencil_visc_heat
      }
    }
    else if (AC_ltemperature__mod__cparam) {
      if (AC_ltemperature_nolog__mod__cdata) {
        DF_TT = DF_TT + ac_transformed_pencil_cv1*ac_transformed_pencil_visc_heat
      }
      else {
        if (AC_lno_visc_heat_zbound__mod__viscosity) {
          if (false) {
          }
          else {
            relshift_145_146_231=0.0
          }
          xi_145_146_231 = (AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_no_visc_heat_z0__mod__viscosity)/(AC_no_visc_heat_zwidth__mod__viscosity+AC_tini__mod__cparam) - relshift_145_146_231
          xi_145_146_231 = max(xi_145_146_231,-1.0)
          xi_145_146_231 = min(xi_145_146_231, 1.0)
          cubic_step_pt_return_value_145_146_231 = 0.5 + xi_145_146_231*(0.75-xi_145_146_231*xi_145_146_231*0.25)
          DF_LNTT = DF_LNTT +  ac_transformed_pencil_cv1*ac_transformed_pencil_tt1*ac_transformed_pencil_visc_heat*cubic_step_pt_return_value_145_146_231
        }
        else {
          DF_LNTT = DF_LNTT + ac_transformed_pencil_cv1*ac_transformed_pencil_tt1*ac_transformed_pencil_visc_heat
        }
      }
    }
    else if (AC_lthermal_energy__mod__cparam) {
      if (AC_lstratz__mod__cdata) {
        DF_ETH = DF_ETH + ac_transformed_pencil_rho * ac_transformed_pencil_visc_heat / AC_eth0z__mod__viscosity[AC_n__mod__cdata-1]
      }
      else {
        DF_ETH = DF_ETH + ac_transformed_pencil_rho * ac_transformed_pencil_visc_heat
      }
    }
    if (AC_ldt__mod__cdata && AC_lfirst__mod__cdata  ||  AC_ldiagnos__mod__cdata) {
      hmax__mod__energy=hmax__mod__energy+ac_transformed_pencil_visc_heat
    }
  }
  if (AC_lheatc_kprof__mod__energy) {
    if (AC_hcond0__mod__energy!=0. || AC_lread_hcond__mod__energy) {
      if (!AC_lmultilayer__mod__energy) {
        hcond__mod__energy=AC_hcond0__mod__energy
        glhc_155_231.x = 0.
        glhc_155_231.y = 0.
        glhc_155_231.z = 0.
      }
      else {
        if (AC_lgravz__mod__cdata) {
          hcond__mod__energy=AC_hcond_prof__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          glhc_155_231.z=AC_dlnhcond_prof__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          glhc_155_231.x=0.
          glhc_155_231.y=0.
        }
        else if (AC_lsphere_in_a_box__mod__cdata || AC_lcylinder_in_a_box__mod__cdata) {
          if (true && AC_lhcond_global__mod__energy) {
            hcond__mod__energy = value(Field(AC_iglobal_hcond__mod__energy-1))
            glhc_155_231= value(F_GLOBAL_GLHVEC)
          }
          else {
            if (true) {
              r_mn_153_155_231=ac_transformed_pencil_r_mn
              r_mn1_153_155_231=ac_transformed_pencil_r_mn1
            }
            else {
              r_mn_153_155_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
              r_mn1_153_155_231=1./r_mn_153_155_231
            }
            arg_148_153_155_231 = abs((r_mn_153_155_231-AC_r_bcz__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_148_153_155_231)>=8.)  {
              der_step_return_value_148_153_155_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_153_155_231))
            }
            else {
              der_step_return_value_148_153_155_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_153_155_231)*cosh(arg_148_153_155_231))
            }
            arg_149_153_155_231 = abs((r_mn_153_155_231-AC_r_ext__mod__cdata)/(AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_149_153_155_231)>=8.)  {
              der_step_return_value_149_153_155_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_153_155_231))
            }
            else {
              der_step_return_value_149_153_155_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_153_155_231)*cosh(arg_149_153_155_231))
            }
            hcond__mod__energy =  (AC_hcond1__mod__energy-1.)*der_step_return_value_148_153_155_231  +(AC_hcond2__mod__energy-1.)*der_step_return_value_149_153_155_231
            glhc_155_231.x = hcond__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_153_155_231
            glhc_155_231.y = hcond__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_153_155_231
            if (AC_lcylinder_in_a_box__mod__cdata) {
              glhc_155_231.z = 0.0
            }
            else {
              glhc_155_231.z = hcond__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_153_155_231
            }
            step_vector_return_value_150_153_155_231 = 0.5*(1+tanh((r_mn_153_155_231-AC_r_bcz__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam)))
            step_vector_return_value_151_153_155_231 = 0.5*(1+tanh((r_mn_153_155_231-AC_r_ext__mod__cdata)/(AC_widthss__mod__energy+AC_tini__mod__cparam)))
            hcond__mod__energy = 1.+(AC_hcond1__mod__energy-1.)*step_vector_return_value_150_153_155_231  +(AC_hcond2__mod__energy-1.)*step_vector_return_value_151_153_155_231
            if (true) {
              loptest_return_value_152_153_155_231=true
            }
            else if (false) {
            }
            else {
              loptest_return_value_152_153_155_231=false
            }
            if (loptest_return_value_152_153_155_231) {
              glhc_155_231.x=glhc_155_231.x/hcond__mod__energy
              glhc_155_231.y=glhc_155_231.y/hcond__mod__energy
              glhc_155_231.z=glhc_155_231.z/hcond__mod__energy
            }
            else {
              glhc_155_231 = AC_hcond0__mod__energy*glhc_155_231
            }
            hcond__mod__energy = AC_hcond0__mod__energy*hcond__mod__energy
          }
        }
        else {
          hcond__mod__energy=AC_hcond_prof__mod__energy[vertexIdx.x]
          glhc_155_231.x=AC_dlnhcond_prof__mod__energy[vertexIdx.x]
          glhc_155_231.y=0.
          glhc_155_231.z=0.
        }
      }
      glnthcond_155_231 = ac_transformed_pencil_glntt + glhc_155_231
      g2_155_231 = dot(ac_transformed_pencil_glntt,glnthcond_155_231)
      if (AC_pretend_lntt__mod__cdata) {
        thdiff_155_231 = ac_transformed_pencil_cv1*ac_transformed_pencil_rho1*hcond__mod__energy * (ac_transformed_pencil_del2lntt + g2_155_231)
        chix_155_231 = ac_transformed_pencil_rho1*hcond__mod__energy*ac_transformed_pencil_cv1
      }
      else {
        if (AC_lhcond0_density_dep__mod__energy) {
          glnrhoglnt_155_231 = dot(ac_transformed_pencil_glntt,ac_transformed_pencil_glnrho)
          thdiff_155_231 = sqrt(ac_transformed_pencil_rho1)*hcond__mod__energy * (ac_transformed_pencil_del2lntt + g2_155_231+0.5*glnrhoglnt_155_231)
          chix_155_231 = sqrt(ac_transformed_pencil_rho1)*hcond__mod__energy*ac_transformed_pencil_cv1
        }
        else {
          thdiff_155_231 = ac_transformed_pencil_rho1*hcond__mod__energy * (ac_transformed_pencil_del2lntt + g2_155_231)
          chix_155_231 = ac_transformed_pencil_rho1*hcond__mod__energy*ac_transformed_pencil_cv1
        }
      }
    }
    if (AC_chi_t__mod__energy!=0.) {
      if (!AC_lmultilayer__mod__energy) {
        chit_prof__mod__energy=1.
        gradchit_prof_155_231.x = 0.
        gradchit_prof_155_231.y = 0.
        gradchit_prof_155_231.z = 0.
      }
      else {
        if (AC_lgravz__mod__cdata) {
          chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          gradchit_prof_155_231.z=AC_dchit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          gradchit_prof_155_231.x=0.
          gradchit_prof_155_231.y=0.
        }
        else if (AC_lsphere_in_a_box__mod__cdata) {
          if (true && AC_lhcond_global__mod__energy) {
            chit_prof__mod__energy = value(Field(AC_iglobal_hcond__mod__energy-1))
            gradchit_prof_155_231= value(F_GLOBAL_GLHVEC)
          }
          else {
            if (true) {
              r_mn_154_155_231=ac_transformed_pencil_r_mn
              r_mn1_154_155_231=ac_transformed_pencil_r_mn1
            }
            else {
              r_mn_154_155_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
              r_mn1_154_155_231=1./r_mn_154_155_231
            }
            arg_148_154_155_231 = abs((r_mn_154_155_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_148_154_155_231)>=8.)  {
              der_step_return_value_148_154_155_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_154_155_231))
            }
            else {
              der_step_return_value_148_154_155_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_154_155_231)*cosh(arg_148_154_155_231))
            }
            arg_149_154_155_231 = abs((r_mn_154_155_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_149_154_155_231)>=8.)  {
              der_step_return_value_149_154_155_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_154_155_231))
            }
            else {
              der_step_return_value_149_154_155_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_154_155_231)*cosh(arg_149_154_155_231))
            }
            chit_prof__mod__energy =  (AC_chit_prof1__mod__energy-1.)*der_step_return_value_148_154_155_231  +(AC_chit_prof2__mod__energy-1.)*der_step_return_value_149_154_155_231
            gradchit_prof_155_231.x = chit_prof__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_154_155_231
            gradchit_prof_155_231.y = chit_prof__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_154_155_231
            if (AC_lcylinder_in_a_box__mod__cdata) {
              gradchit_prof_155_231.z = 0.0
            }
            else {
              gradchit_prof_155_231.z = chit_prof__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_154_155_231
            }
            step_vector_return_value_150_154_155_231 = 0.5*(1+tanh((r_mn_154_155_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam)))
            step_vector_return_value_151_154_155_231 = 0.5*(1+tanh((r_mn_154_155_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam)))
            chit_prof__mod__energy = 1.+(AC_chit_prof1__mod__energy-1.)*step_vector_return_value_150_154_155_231  +(AC_chit_prof2__mod__energy-1.)*step_vector_return_value_151_154_155_231
            if (false) {
            }
            else if (false) {
            }
            else {
              loptest_return_value_152_154_155_231=false
            }
            if (loptest_return_value_152_154_155_231) {
              gradchit_prof_155_231.x=gradchit_prof_155_231.x/chit_prof__mod__energy
              gradchit_prof_155_231.y=gradchit_prof_155_231.y/chit_prof__mod__energy
              gradchit_prof_155_231.z=gradchit_prof_155_231.z/chit_prof__mod__energy
            }
            else {
              gradchit_prof_155_231 = 1.*gradchit_prof_155_231
            }
            chit_prof__mod__energy = 1.*chit_prof__mod__energy
          }
        }
        else {
          chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[vertexIdx.x]
          gradchit_prof_155_231.x=AC_dchit_prof_stored__mod__energy[vertexIdx.x]
          gradchit_prof_155_231.y=0.
          gradchit_prof_155_231.z=0.
        }
      }
      if (AC_lcalc_ssmean__mod__energy  ||  AC_lcalc_ssmeanxy__mod__energy) {
        if (AC_lcalc_ssmean__mod__energy) {
          gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1]
          gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1]
          gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1]
          del2ss1_155_231=ac_transformed_pencil_del2ss-AC_del2ssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
        }
        else if (AC_lcalc_ssmeanxy__mod__energy) {
          gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmx__mod__energy[vertexIdx.x][1-1]
          gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmx__mod__energy[vertexIdx.x][2-1]
          gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmx__mod__energy[vertexIdx.x][3-1]
          del2ss1_155_231=ac_transformed_pencil_del2ss-AC_del2ssmx__mod__energy[vertexIdx.x-NGHOST_VAL]
        }
        if (AC_lchit_not__mod__energy) {
          g2_155_231 = dot(ac_transformed_pencil_glnrho,gss1__mod__energy)
        }
        else {
          g2_155_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss1__mod__energy)
        }
        thdiff_155_231=thdiff_155_231+AC_chi_t__mod__energy*chit_prof__mod__energy*(del2ss1_155_231+g2_155_231)
        g2_155_231 = dot(gradchit_prof_155_231,gss1__mod__energy)
        thdiff_155_231=thdiff_155_231+AC_chi_t__mod__energy*g2_155_231
      }
      else {
        if (AC_lchit_not__mod__energy) {
          g2_155_231 = dot(ac_transformed_pencil_glnrho,ac_transformed_pencil_gss)
        }
        else {
          g2_155_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
        }
        thdiff_155_231=thdiff_155_231+AC_chi_t__mod__energy*chit_prof__mod__energy*(ac_transformed_pencil_del2ss+g2_155_231)
        g2_155_231 = dot(gradchit_prof_155_231,ac_transformed_pencil_gss)
        thdiff_155_231=thdiff_155_231+AC_chi_t__mod__energy*g2_155_231
      }
      if (AC_chit_aniso__mod__energy!=0.0  &&  AC_lspherical_coords__mod__cdata) {
        sc_155_231=AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_costh__mod__cdata[AC_m__mod__cdata-1]
        c2_155_231=AC_costh__mod__cdata[AC_m__mod__cdata-1]*AC_costh__mod__cdata[AC_m__mod__cdata-1]
        s2_155_231=AC_sinth__mod__cdata[AC_m__mod__cdata-1]*AC_sinth__mod__cdata[AC_m__mod__cdata-1]
        if (AC_lchit_aniso_simplified__mod__energy) {
          tmp_155_231 = hessian(Field(AC_iss__mod__cdata-1))
          thdiff_155_231 = thdiff_155_231+AC_chit_aniso_prof__mod__energy[vertexIdx.x-NGHOST_VAL]*((1.-3.*c2_155_231)*AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL]*ac_transformed_pencil_gss.x +  (-sc_155_231*tmp_155_231[1-1][2-1])+(ac_transformed_pencil_glnrho.y+ac_transformed_pencil_glntt.y)*(-sc_155_231*ac_transformed_pencil_gss.x))
        }
        else {
          thdiff_155_231=thdiff_155_231 + ((AC_dchit_aniso_prof__mod__energy[vertexIdx.x-NGHOST_VAL]*c2_155_231+AC_chit_aniso_prof__mod__energy[vertexIdx.x-NGHOST_VAL]/AC_x__mod__cdata[vertexIdx.x])*ac_transformed_pencil_gss.x+  sc_155_231*(AC_chit_aniso_prof__mod__energy[vertexIdx.x-NGHOST_VAL]/AC_x__mod__cdata[vertexIdx.x]-AC_dchit_aniso_prof__mod__energy[vertexIdx.x-NGHOST_VAL])*ac_transformed_pencil_gss.y)
          tmp_155_231 = hessian(Field(AC_iss__mod__cdata-1))
          thdiff_155_231=thdiff_155_231+AC_chit_aniso_prof__mod__energy[vertexIdx.x-NGHOST_VAL]*  ((-sc_155_231*(tmp_155_231[1-1][2-1]+tmp_155_231[2-1][1-1])+c2_155_231*tmp_155_231[1-1][1-1]+s2_155_231*tmp_155_231[2-1][2-1])+  ((ac_transformed_pencil_glnrho.x+ac_transformed_pencil_glntt.x)*(c2_155_231*ac_transformed_pencil_gss.x-sc_155_231*ac_transformed_pencil_gss.y)+  ( ac_transformed_pencil_glnrho.y+ac_transformed_pencil_glntt.y)*(s2_155_231*ac_transformed_pencil_gss.y-sc_155_231*ac_transformed_pencil_gss.x)))
        }
      }
    }
    if (AC_hcond0__mod__energy!=0. || AC_lread_hcond__mod__energy || AC_chi_t__mod__energy!=0.) {
      DF_SS = DF_SS + thdiff_155_231
    }
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_hcond0__mod__energy!=0. || AC_lread_hcond__mod__energy) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+chix_155_231*dxyz_2__mod__cdata
      }
      if (AC_chi_t__mod__energy!=0.) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+AC_chi_t__mod__energy*chit_prof__mod__energy*dxyz_2__mod__cdata
      }
    }
  }
  if (AC_lheatc_kconst__mod__energy) {
    chix_156_231 = ac_transformed_pencil_rho1*AC_hcond_kconst__mod__energy*ac_transformed_pencil_cp1
    if (AC_chib__mod__energy!=0.) {
      chix_156_231 = chix_156_231/(1.+AC_chib__mod__energy*ac_transformed_pencil_b2)
    }
    g2_156_231 = dot(ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    if (AC_pretend_lntt__mod__cdata) {
      thdiff_156_231 = AC_gamma__mod__energy*chix_156_231 * (ac_transformed_pencil_del2lntt + g2_156_231)
    }
    else {
      thdiff_156_231 = ac_transformed_pencil_rho1*AC_hcond_kconst__mod__energy * (ac_transformed_pencil_del2lntt + g2_156_231)
    }
    DF_SS = DF_SS + thdiff_156_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi__mod__energy=diffus_chi__mod__energy+AC_gamma__mod__energy*chix_156_231*dxyz_2__mod__cdata
    }
  }
  if (AC_lheatc_sfluct__mod__energy) {
    if (AC_chi_t__mod__energy!=0.) {
      if (AC_lcalc_ssmean__mod__energy  ||  AC_lcalc_ssmeanxy__mod__energy) {
        if (AC_lcalc_ssmean__mod__energy) {
          gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1]
          gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1]
          gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1]
          del2ss1_157_231=ac_transformed_pencil_del2ss-AC_del2ssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
        }
        else if (AC_lcalc_ssmeanxy__mod__energy) {
          gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmx__mod__energy[vertexIdx.x][1-1]
          gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmx__mod__energy[vertexIdx.x][2-1]
          gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmx__mod__energy[vertexIdx.x][3-1]
          del2ss1_157_231=ac_transformed_pencil_del2ss-AC_del2ssmx__mod__energy[vertexIdx.x-NGHOST_VAL]
        }
        g2_157_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss1__mod__energy)
        thdiff_157_231=AC_chi_t__mod__energy*(del2ss1_157_231+g2_157_231)
      }
    }
    DF_SS = DF_SS + thdiff_157_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi__mod__energy=diffus_chi__mod__energy+AC_chi_t__mod__energy*dxyz_2__mod__cdata
    }
  }
  if (AC_lheatc_chiconst__mod__energy) {
    g2_159_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    if (AC_pretend_lntt__mod__cdata) {
      thdiff_159_231=AC_gamma__mod__energy*AC_chi__mod__energy*(ac_transformed_pencil_del2lntt+g2_159_231)
    }
    else {
      thdiff_159_231=AC_chi__mod__energy*ac_transformed_pencil_cp*(ac_transformed_pencil_del2lntt+g2_159_231)
    }
    if (AC_chi_t__mod__energy!=0.) {
      if (!AC_lmultilayer__mod__energy) {
        chit_prof__mod__energy=1.
        gradchit_prof_159_231.x = 0.
        gradchit_prof_159_231.y = 0.
        gradchit_prof_159_231.z = 0.
      }
      else {
        if (AC_lgravz__mod__cdata) {
          chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          gradchit_prof_159_231.z=AC_dchit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          gradchit_prof_159_231.x=0.
          gradchit_prof_159_231.y=0.
        }
        else if (AC_lsphere_in_a_box__mod__cdata) {
          if (true && AC_lhcond_global__mod__energy) {
            chit_prof__mod__energy = value(Field(AC_iglobal_hcond__mod__energy-1))
            gradchit_prof_159_231= value(F_GLOBAL_GLHVEC)
          }
          else {
            if (true) {
              r_mn_158_159_231=ac_transformed_pencil_r_mn
              r_mn1_158_159_231=ac_transformed_pencil_r_mn1
            }
            else {
              r_mn_158_159_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
              r_mn1_158_159_231=1./r_mn_158_159_231
            }
            arg_148_158_159_231 = abs((r_mn_158_159_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_148_158_159_231)>=8.)  {
              der_step_return_value_148_158_159_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_158_159_231))
            }
            else {
              der_step_return_value_148_158_159_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_158_159_231)*cosh(arg_148_158_159_231))
            }
            arg_149_158_159_231 = abs((r_mn_158_159_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_149_158_159_231)>=8.)  {
              der_step_return_value_149_158_159_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_158_159_231))
            }
            else {
              der_step_return_value_149_158_159_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_158_159_231)*cosh(arg_149_158_159_231))
            }
            chit_prof__mod__energy =  (AC_chit_prof1__mod__energy-1.)*der_step_return_value_148_158_159_231  +(AC_chit_prof2__mod__energy-1.)*der_step_return_value_149_158_159_231
            gradchit_prof_159_231.x = chit_prof__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_158_159_231
            gradchit_prof_159_231.y = chit_prof__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_158_159_231
            if (AC_lcylinder_in_a_box__mod__cdata) {
              gradchit_prof_159_231.z = 0.0
            }
            else {
              gradchit_prof_159_231.z = chit_prof__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_158_159_231
            }
            step_vector_return_value_150_158_159_231 = 0.5*(1+tanh((r_mn_158_159_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam)))
            step_vector_return_value_151_158_159_231 = 0.5*(1+tanh((r_mn_158_159_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam)))
            chit_prof__mod__energy = 1.+(AC_chit_prof1__mod__energy-1.)*step_vector_return_value_150_158_159_231  +(AC_chit_prof2__mod__energy-1.)*step_vector_return_value_151_158_159_231
            if (false) {
            }
            else if (false) {
            }
            else {
              loptest_return_value_152_158_159_231=false
            }
            if (loptest_return_value_152_158_159_231) {
              gradchit_prof_159_231.x=gradchit_prof_159_231.x/chit_prof__mod__energy
              gradchit_prof_159_231.y=gradchit_prof_159_231.y/chit_prof__mod__energy
              gradchit_prof_159_231.z=gradchit_prof_159_231.z/chit_prof__mod__energy
            }
            else {
              gradchit_prof_159_231 = 1.*gradchit_prof_159_231
            }
            chit_prof__mod__energy = 1.*chit_prof__mod__energy
          }
        }
        else {
          chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[vertexIdx.x]
          gradchit_prof_159_231.x=AC_dchit_prof_stored__mod__energy[vertexIdx.x]
          gradchit_prof_159_231.y=0.
          gradchit_prof_159_231.z=0.
        }
      }
      g2_159_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
      thdiff_159_231=thdiff_159_231+AC_chi_t__mod__energy*chit_prof__mod__energy*(ac_transformed_pencil_del2ss+g2_159_231)
      g2_159_231 = dot(gradchit_prof_159_231,ac_transformed_pencil_gss)
      thdiff_159_231=thdiff_159_231+AC_chi_t__mod__energy*g2_159_231
    }
    DF_SS=DF_SS+thdiff_159_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_leos_idealgas__mod__cparam) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_gamma__mod__energy*AC_chi__mod__energy)*dxyz_2__mod__cdata
      }
      else {
        diffus_chi__mod__energy=diffus_chi__mod__energy+AC_chi__mod__energy*dxyz_2__mod__cdata
      }
      if (AC_chi_t__mod__energy!=0.) {
        diffus_chi__mod__energy = diffus_chi__mod__energy+AC_chi_t__mod__energy*chit_prof__mod__energy*dxyz_2__mod__cdata
      }
    }
  }
  if (AC_lheatc_chi_cspeed__mod__energy) {
    thchi_160_231=AC_chi__mod__energy*exp(AC_chi_cspeed__mod__energy*ac_transformed_pencil_lntt)
    if (AC_pretend_lntt__mod__cdata) {
      g2_160_231 = dot(ac_transformed_pencil_glnrho+(1.+AC_chi_cspeed__mod__energy)*ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
      thdiff_160_231=AC_gamma__mod__energy*thchi_160_231*(ac_transformed_pencil_del2lntt+g2_160_231)
      if (AC_chi_t__mod__energy!=0.) {
        g2_160_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
        thdiff_160_231=thdiff_160_231+AC_chi_t__mod__energy*(ac_transformed_pencil_del2ss+g2_160_231)
      }
    }
    else {
      g2_160_231 = dot(ac_transformed_pencil_glnrho+(1.+AC_chi_cspeed__mod__energy)*ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
      thdiff_160_231=thchi_160_231*(ac_transformed_pencil_del2lntt+g2_160_231)*ac_transformed_pencil_cp
      if (AC_chi_t__mod__energy!=0.) {
        g2_160_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
        if (AC_chib__mod__energy==0.) {
          thdiff_160_231=thdiff_160_231+AC_chi_t__mod__energy*(ac_transformed_pencil_del2ss+g2_160_231)
        }
        else {
          thdiff_160_231=thdiff_160_231+AC_chi_t__mod__energy*(ac_transformed_pencil_del2ss+g2_160_231)/(1.+AC_chib__mod__energy*ac_transformed_pencil_b2)
        }
      }
    }
    DF_SS=DF_SS+thdiff_160_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_leos_idealgas__mod__cparam) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_gamma__mod__energy*thchi_160_231+AC_chi_t__mod__energy)*dxyz_2__mod__cdata
      }
      else {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(thchi_160_231+AC_chi_t__mod__energy)*dxyz_2__mod__cdata
      }
    }
  }
  if (AC_lheatc_sqrtrhochiconst__mod__energy) {
    rhochi_161_231=AC_chi_rho__mod__energy*sqrt(ac_transformed_pencil_rho1)
    if (AC_pretend_lntt__mod__cdata) {
      g2_161_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
      thdiff_161_231=AC_gamma__mod__energy*rhochi_161_231*(ac_transformed_pencil_del2lntt+g2_161_231)
      if (AC_chi_t__mod__energy!=0.) {
        g2_161_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
        thdiff_161_231=thdiff_161_231+AC_chi_t__mod__energy*(ac_transformed_pencil_del2ss+g2_161_231)
      }
    }
    else {
      g2_161_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
      thdiff_161_231=rhochi_161_231*(ac_transformed_pencil_del2lntt+g2_161_231)/ac_transformed_pencil_cp1
      if (AC_chi_t__mod__energy!=0.) {
        g2_161_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
        if (AC_chib__mod__energy==0.) {
          thdiff_161_231=thdiff_161_231+AC_chi_t__mod__energy*(ac_transformed_pencil_del2ss+g2_161_231)
        }
        else {
          thdiff_161_231=thdiff_161_231+AC_chi_t__mod__energy*(ac_transformed_pencil_del2ss+g2_161_231)/(1.+AC_chib__mod__energy*ac_transformed_pencil_b2)
        }
      }
    }
    DF_SS=DF_SS+thdiff_161_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_leos_idealgas__mod__cparam) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_gamma__mod__energy*rhochi_161_231+AC_chi_t__mod__energy)*dxyz_2__mod__cdata
      }
      else {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(rhochi_161_231+AC_chi_t__mod__energy)*dxyz_2__mod__cdata
      }
    }
  }
  if (AC_lheatc_shock__mod__energy || AC_lheatc_shock2__mod__energy) {
    gshockglntt_162_231 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_glntt)
    g2_162_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    if (AC_lheatc_shock__mod__energy) {
      if (AC_pretend_lntt__mod__cdata) {
        thdiff_162_231=AC_gamma__mod__energy*AC_chi_shock__mod__energy*(ac_transformed_pencil_shock*(ac_transformed_pencil_del2lnrho+g2_162_231)+gshockglntt_162_231)
      }
      else {
        if (AC_lchi_shock_density_dep__mod__energy) {
          gshockgss_162_231 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_gss)
          g2_162_231 = dot(AC_twothird__mod__cparam*ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
          thdiff_162_231=exp(-AC_onethird__mod__cparam*ac_transformed_pencil_lnrho)*AC_chi_shock__mod__energy*  (ac_transformed_pencil_shock*(exp(AC_twothird__mod__cparam*ac_transformed_pencil_lnrho)*ac_transformed_pencil_del2ss+g2_162_231)+gshockgss_162_231)
        }
        else {
          thdiff_162_231=AC_chi_shock__mod__energy*(ac_transformed_pencil_shock*(ac_transformed_pencil_del2lntt+g2_162_231)+gshockglntt_162_231)
        }
      }
    }
    if (AC_lheatc_shock2__mod__energy) {
      if (AC_pretend_lntt__mod__cdata) {
        thdiff_162_231=AC_gamma__mod__energy*AC_chi_shock2__mod__energy*(ac_transformed_pencil_shock*ac_transformed_pencil_shock*(ac_transformed_pencil_del2lnrho+g2_162_231)+gshockglntt_162_231)
      }
      else {
        if (AC_lchi_shock_density_dep__mod__energy) {
          gshockgss_162_231 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_gss)
          g2_162_231 = dot(AC_twothird__mod__cparam*ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
          thdiff_162_231=exp(-AC_onethird__mod__cparam*ac_transformed_pencil_lnrho)*AC_chi_shock2__mod__energy*  (ac_transformed_pencil_shock*ac_transformed_pencil_shock*(exp(AC_twothird__mod__cparam*ac_transformed_pencil_lnrho)*ac_transformed_pencil_del2ss+g2_162_231)+2*ac_transformed_pencil_shock*gshockgss_162_231)
        }
        else {
          thdiff_162_231=AC_chi_shock2__mod__energy*(ac_transformed_pencil_shock*ac_transformed_pencil_shock*(ac_transformed_pencil_del2lntt+g2_162_231)+2*ac_transformed_pencil_shock*gshockglntt_162_231)
        }
      }
    }
    DF_SS = DF_SS + thdiff_162_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_leos_idealgas__mod__cparam) {
        if (AC_lchi_shock_density_dep__mod__energy) {
          if (AC_lheatc_shock__mod__energy) {
            diffus_chi__mod__energy=diffus_chi__mod__energy+exp(-AC_onethird__mod__cparam*ac_transformed_pencil_lnrho)*AC_chi_shock__mod__energy*ac_transformed_pencil_shock*ac_transformed_pencil_cp1*dxyz_2__mod__cdata
          }
          if (AC_lheatc_shock2__mod__energy) {
            diffus_chi__mod__energy=diffus_chi__mod__energy+exp(-AC_onethird__mod__cparam*ac_transformed_pencil_lnrho)*AC_chi_shock2__mod__energy*ac_transformed_pencil_shock*ac_transformed_pencil_shock*ac_transformed_pencil_cp1*dxyz_2__mod__cdata
          }
        }
        else {
          if (AC_lheatc_shock__mod__energy ) {
            diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_gamma__mod__energy*AC_chi_shock__mod__energy*ac_transformed_pencil_shock)*dxyz_2__mod__cdata
          }
          if (AC_lheatc_shock2__mod__energy) {
            diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_gamma__mod__energy*AC_chi_shock2__mod__energy*ac_transformed_pencil_shock*ac_transformed_pencil_shock)*dxyz_2__mod__cdata
          }
        }
      }
      else {
        if (AC_lheatc_shock__mod__energy ) {
          diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_chi_shock__mod__energy*ac_transformed_pencil_shock)*dxyz_2__mod__cdata
        }
        if (AC_lheatc_shock2__mod__energy) {
          diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_chi_shock2__mod__energy*ac_transformed_pencil_shock*ac_transformed_pencil_shock)*dxyz_2__mod__cdata
        }
      }
    }
  }
  if (AC_lheatc_shock_profr__mod__energy) {
    step_vector_return_value_163_165_231 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_xchi_shock__mod__energy)/(AC_widthchi_shock__mod__energy+AC_tini__mod__cparam)))
    pchi_shock_165_231 = AC_chi_shock__mod__energy + AC_chi_shock__mod__energy*(AC_chi_jump_shock__mod__energy-1.)*step_vector_return_value_163_165_231
    arg_164_165_231 = abs((ac_transformed_pencil_r_mn-AC_xchi_shock__mod__energy)/(AC_widthchi_shock__mod__energy+AC_tini__mod__cparam))
    if (abs(arg_164_165_231)>=8.)  {
      der_step_return_value_164_165_231 = 2./AC_widthchi_shock__mod__energy*exp(-2.*abs(arg_164_165_231))
    }
    else {
      der_step_return_value_164_165_231 = 0.5/(AC_widthchi_shock__mod__energy*cosh(arg_164_165_231)*cosh(arg_164_165_231))
    }
    gradchi_shock_165_231.x = AC_chi_shock__mod__energy*(AC_chi_jump_shock__mod__energy-1.)*der_step_return_value_164_165_231
    gradchi_shock_165_231.y = 0.
    gradchi_shock_165_231.z = 0.
    gshockglntt_165_231 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_glntt)
    g2_165_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    gshockglntt_165_231 = dot(ac_transformed_pencil_gshock,ac_transformed_pencil_glntt)
    g2_165_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    gchiglntt_165_231 = dot(gradchi_shock_165_231,ac_transformed_pencil_glntt)
    if (AC_pretend_lntt__mod__cdata) {
      thdiff_165_231=AC_gamma__mod__energy*(pchi_shock_165_231*(ac_transformed_pencil_shock*(ac_transformed_pencil_del2lnrho+g2_165_231)+gshockglntt_165_231)+gchiglntt_165_231*ac_transformed_pencil_shock)
    }
    else {
      thdiff_165_231=pchi_shock_165_231*(ac_transformed_pencil_shock*(ac_transformed_pencil_del2lntt+g2_165_231)+gshockglntt_165_231)+gchiglntt_165_231*ac_transformed_pencil_shock
    }
    DF_SS = DF_SS + thdiff_165_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_leos_idealgas__mod__cparam) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(AC_gamma__mod__energy*pchi_shock_165_231*ac_transformed_pencil_shock)*dxyz_2__mod__cdata
      }
      else {
        diffus_chi__mod__energy=diffus_chi__mod__energy+(pchi_shock_165_231*ac_transformed_pencil_shock)*dxyz_2__mod__cdata
      }
    }
  }
  if (AC_lheatc_hyper3ss__mod__energy) {
    thdiff_166_231 = AC_chi_hyper3__mod__energy * ac_transformed_pencil_del6ss
    DF_SS = DF_SS + thdiff_166_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi3__mod__energy=diffus_chi3__mod__energy+AC_chi_hyper3__mod__energy*dxyz_6__mod__cdata
    }
  }
  if (AC_lheatc_spitzer__mod__energy) {
    bb2_168_231 = dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb)
    b1_168_231=1./max(AC_REAL_MIN,bb2_168_231)
    vkpara_168_231 = AC_kgpara__mod__energy * pow(exp(ac_transformed_pencil_lntt),3.5)
    vkperp_168_231 = AC_kgperp__mod__energy * b1_168_231*exp(2*ac_transformed_pencil_lnrho+0.5*ac_transformed_pencil_lntt)
    tmps_168_231 = 3.5 * vkpara_168_231
    gvkpara_168_231 = tmps_168_231*ac_transformed_pencil_glntt
    tmpv_168_231.x=0.
    tmpv_168_231.x=tmpv_168_231.x + ac_transformed_pencil_bb.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpv_168_231.x=tmpv_168_231.x + ac_transformed_pencil_bb.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpv_168_231.x=tmpv_168_231.x + ac_transformed_pencil_bb.z*ac_transformed_pencil_bij[3-1][1-1]
    tmpv_168_231.y=0.
    tmpv_168_231.y=tmpv_168_231.y + ac_transformed_pencil_bb.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpv_168_231.y=tmpv_168_231.y + ac_transformed_pencil_bb.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpv_168_231.y=tmpv_168_231.y + ac_transformed_pencil_bb.z*ac_transformed_pencil_bij[3-1][2-1]
    tmpv_168_231.z=0.
    tmpv_168_231.z=tmpv_168_231.z + ac_transformed_pencil_bb.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpv_168_231.z=tmpv_168_231.z + ac_transformed_pencil_bb.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpv_168_231.z=tmpv_168_231.z + ac_transformed_pencil_bb.z*ac_transformed_pencil_bij[3-1][3-1]
    tmpv2_168_231 = 2*b1_168_231*tmpv_168_231
    tmpv_168_231=2.*ac_transformed_pencil_glnrho+0.5*ac_transformed_pencil_glntt-tmpv2_168_231
    gvkperp_168_231 = vkperp_168_231*tmpv_168_231
    abs_b_167_168_231 = sqrt(dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb))
    b1_167_168_231=1./max(AC_tini__mod__cparam,abs_b_167_168_231)
    bunit_167_168_231 = b1_167_168_231*ac_transformed_pencil_bb
    del2ecr_167_168_231=0.
    del2ecr_167_168_231=del2ecr_167_168_231+ac_transformed_pencil_hlntt[1-1][1-1]
    hhh_167_168_231.x=0.
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_167_168_231.x=hhh_167_168_231.x+bunit_167_168_231.x*(ac_transformed_pencil_bij[1-1][1-1]+bunit_167_168_231.x*tmpj_167_168_231)
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_167_168_231.x=hhh_167_168_231.x+bunit_167_168_231.y*(ac_transformed_pencil_bij[1-1][2-1]+bunit_167_168_231.x*tmpj_167_168_231)
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_167_168_231.x=hhh_167_168_231.x+bunit_167_168_231.z*(ac_transformed_pencil_bij[1-1][3-1]+bunit_167_168_231.x*tmpj_167_168_231)
    del2ecr_167_168_231=del2ecr_167_168_231+ac_transformed_pencil_hlntt[2-1][2-1]
    hhh_167_168_231.y=0.
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_167_168_231.y=hhh_167_168_231.y+bunit_167_168_231.x*(ac_transformed_pencil_bij[2-1][1-1]+bunit_167_168_231.y*tmpj_167_168_231)
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_167_168_231.y=hhh_167_168_231.y+bunit_167_168_231.y*(ac_transformed_pencil_bij[2-1][2-1]+bunit_167_168_231.y*tmpj_167_168_231)
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_167_168_231.y=hhh_167_168_231.y+bunit_167_168_231.z*(ac_transformed_pencil_bij[2-1][3-1]+bunit_167_168_231.y*tmpj_167_168_231)
    del2ecr_167_168_231=del2ecr_167_168_231+ac_transformed_pencil_hlntt[3-1][3-1]
    hhh_167_168_231.z=0.
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_167_168_231.z=hhh_167_168_231.z+bunit_167_168_231.x*(ac_transformed_pencil_bij[3-1][1-1]+bunit_167_168_231.z*tmpj_167_168_231)
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_167_168_231.z=hhh_167_168_231.z+bunit_167_168_231.y*(ac_transformed_pencil_bij[3-1][2-1]+bunit_167_168_231.z*tmpj_167_168_231)
    tmpj_167_168_231=0.
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_167_168_231=tmpj_167_168_231-2.*bunit_167_168_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_167_168_231.z=hhh_167_168_231.z+bunit_167_168_231.z*(ac_transformed_pencil_bij[3-1][3-1]+bunit_167_168_231.z*tmpj_167_168_231)
    tmpv_167_168_231 = b1_167_168_231*hhh_167_168_231
    hhh2_167_168_231 = sqrt(dot(tmpv_167_168_231,tmpv_167_168_231))
    quenchfactor_167_168_231=1./max(1.,limiter_tensordiff_167_168_231*hhh2_167_168_231*AC_dxmax__mod__cdata)
    hhh_167_168_231 = quenchfactor_167_168_231*tmpv_167_168_231
    tmp_167_168_231 = dot(hhh_167_168_231,ac_transformed_pencil_glntt)
    hhh_167_168_231 = ac_transformed_pencil_hlntt*bunit_167_168_231
    tmpj_167_168_231 = dot(hhh_167_168_231,bunit_167_168_231)
    tmp_167_168_231 = tmp_167_168_231+tmpj_167_168_231
    gecr2_167_168_231=0.
    if (false) {
      tmpi_167_168_231 = dot(ac_transformed_pencil_glntt,bunit_167_168_231)
      tmp_167_168_231=tmp_167_168_231+tmpi_167_168_231*tmpi_167_168_231
      gecr2_167_168_231 = dot(ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    }
    if (true) {
      gvkpara1_167_168_231=gvkpara_168_231
    }
    else {
      gvkpara1_167_168_231.x = 0.
      gvkpara1_167_168_231.y = 0.
      gvkpara1_167_168_231.z = 0.
    }
    if (true) {
      gvkperp1_167_168_231=gvkperp_168_231
    }
    else {
      gvkperp1_167_168_231.x = 0.
      gvkperp1_167_168_231.y = 0.
      gvkperp1_167_168_231.z = 0.
    }
    tmpj_167_168_231 = dot(gvkperp1_167_168_231,ac_transformed_pencil_glntt)
    tmpi_167_168_231 = dot(bunit_167_168_231,gvkpara1_167_168_231-gvkperp1_167_168_231)
    tmpk_167_168_231 = dot(bunit_167_168_231,ac_transformed_pencil_glntt)
    tmpj_167_168_231 = tmpj_167_168_231+tmpi_167_168_231*tmpk_167_168_231
    thdiff_168_231=vkperp_168_231*(del2ecr_167_168_231+gecr2_167_168_231) + (vkpara_168_231-vkperp_168_231)*tmp_167_168_231 + tmpj_167_168_231
    thdiff_168_231 = thdiff_168_231*exp(-ac_transformed_pencil_lnrho-ac_transformed_pencil_lntt)
    DF_SS=DF_SS + thdiff_168_231
  }
  if (AC_lheatc_hubeny__mod__energy) {
    kappa0_cgs_169_231=2.0e-6
    kappa0_169_231=kappa0_cgs_169_231*AC_unit_density__mod__cdata/AC_unit_length__mod__cdata
    kappa_169_231=kappa0_169_231*ac_transformed_pencil_tt*ac_transformed_pencil_tt
    if (AC_nzgrid__mod__cparam==1) {
      tau_169_231 = 0.5*kappa_169_231*ac_transformed_pencil_rho
      a1_169_231=0.375*tau_169_231
      a2_169_231=0.433013
      a3_169_231=0.25/tau_169_231
      cooling_169_231 = 2*AC_sigmasb__mod__cdata*ac_transformed_pencil_tt*ac_transformed_pencil_tt*ac_transformed_pencil_tt*ac_transformed_pencil_tt/(a1_169_231+a2_169_231+a3_169_231)
      DF_SS=DF_SS - AC_cool_fac__mod__energy*cooling_169_231
    }
  }
  if (AC_lheatc_kramers__mod__energy) {
    k_kramers__mod__energy = AC_hcond0_kramers__mod__energy*pow(ac_transformed_pencil_rho1,(2.*AC_nkramers__mod__energy))*pow(ac_transformed_pencil_tt,(6.5*AC_nkramers__mod__energy))
    krho1_171_231 = k_kramers__mod__energy*ac_transformed_pencil_rho1
    g2_171_231 = dot(-2.*AC_nkramers__mod__energy*ac_transformed_pencil_glnrho+(6.5*AC_nkramers__mod__energy+1)*ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    g2_chi_171_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    if (AC_chimax_kramers__mod__energy>0.) {
      if (krho1_171_231 > AC_chimax_kramers__mod__energy/ac_transformed_pencil_cp1) {
        krho1_171_231 = AC_chimax_kramers__mod__energy/ac_transformed_pencil_cp1
        k_kramers__mod__energy = AC_chimax_kramers__mod__energy*ac_transformed_pencil_rho/ac_transformed_pencil_cp1
        g2_171_231 = g2_chi_171_231
      }
    }
    if (AC_chimin_kramers__mod__energy>0.) {
      if (krho1_171_231 < AC_chimin_kramers__mod__energy/ac_transformed_pencil_cp1) {
        krho1_171_231 = AC_chimin_kramers__mod__energy/ac_transformed_pencil_cp1
        k_kramers__mod__energy = AC_chimin_kramers__mod__energy*ac_transformed_pencil_rho/ac_transformed_pencil_cp1
        g2_171_231 = g2_chi_171_231
      }
    }
    thdiff_171_231 = krho1_171_231*(ac_transformed_pencil_del2lntt+g2_171_231)
    if (AC_chi_t__mod__energy!=0.0) {
      gss1__mod__energy=ac_transformed_pencil_gss
      if (AC_lcalc_ssmean__mod__energy) {
        gss1__mod__energy.x=gss1__mod__energy.x-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1]
        gss1__mod__energy.y=gss1__mod__energy.y-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1]
        gss1__mod__energy.z=gss1__mod__energy.z-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1]
        del2ss1_171_231=ac_transformed_pencil_del2ss-AC_del2ssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
      }
      else if (AC_lcalc_ssmeanxy__mod__energy) {
        gss1__mod__energy.x=gss1__mod__energy.x-AC_gssmx__mod__energy[vertexIdx.x][1-1]
        gss1__mod__energy.y=gss1__mod__energy.y-AC_gssmx__mod__energy[vertexIdx.x][2-1]
        gss1__mod__energy.z=gss1__mod__energy.z-AC_gssmx__mod__energy[vertexIdx.x][3-1]
        del2ss1_171_231=ac_transformed_pencil_del2ss-AC_del2ssmx__mod__energy[vertexIdx.x-NGHOST_VAL]
      }
      else {
        del2ss1_171_231=ac_transformed_pencil_del2ss
      }
      g2_171_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss1__mod__energy)
      if (!AC_lmultilayer__mod__energy) {
        chit_prof__mod__energy=1.
        gradchit_prof_171_231.x = 0.
        gradchit_prof_171_231.y = 0.
        gradchit_prof_171_231.z = 0.
      }
      else {
        if (AC_lgravz__mod__cdata) {
          chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          gradchit_prof_171_231.z=AC_dchit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
          gradchit_prof_171_231.x=0.
          gradchit_prof_171_231.y=0.
        }
        else if (AC_lsphere_in_a_box__mod__cdata) {
          if (true && AC_lhcond_global__mod__energy) {
            chit_prof__mod__energy = value(Field(AC_iglobal_hcond__mod__energy-1))
            gradchit_prof_171_231= value(F_GLOBAL_GLHVEC)
          }
          else {
            if (true) {
              r_mn_170_171_231=ac_transformed_pencil_r_mn
              r_mn1_170_171_231=ac_transformed_pencil_r_mn1
            }
            else {
              r_mn_170_171_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
              r_mn1_170_171_231=1./r_mn_170_171_231
            }
            arg_148_170_171_231 = abs((r_mn_170_171_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_148_170_171_231)>=8.)  {
              der_step_return_value_148_170_171_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_170_171_231))
            }
            else {
              der_step_return_value_148_170_171_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_170_171_231)*cosh(arg_148_170_171_231))
            }
            arg_149_170_171_231 = abs((r_mn_170_171_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam))
            if (abs(arg_149_170_171_231)>=8.)  {
              der_step_return_value_149_170_171_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_170_171_231))
            }
            else {
              der_step_return_value_149_170_171_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_170_171_231)*cosh(arg_149_170_171_231))
            }
            chit_prof__mod__energy =  (AC_chit_prof1__mod__energy-1.)*der_step_return_value_148_170_171_231  +(AC_chit_prof2__mod__energy-1.)*der_step_return_value_149_170_171_231
            gradchit_prof_171_231.x = chit_prof__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_170_171_231
            gradchit_prof_171_231.y = chit_prof__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_170_171_231
            if (AC_lcylinder_in_a_box__mod__cdata) {
              gradchit_prof_171_231.z = 0.0
            }
            else {
              gradchit_prof_171_231.z = chit_prof__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_170_171_231
            }
            step_vector_return_value_150_170_171_231 = 0.5*(1+tanh((r_mn_170_171_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam)))
            step_vector_return_value_151_170_171_231 = 0.5*(1+tanh((r_mn_170_171_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam)))
            chit_prof__mod__energy = 1.+(AC_chit_prof1__mod__energy-1.)*step_vector_return_value_150_170_171_231  +(AC_chit_prof2__mod__energy-1.)*step_vector_return_value_151_170_171_231
            if (false) {
            }
            else if (false) {
            }
            else {
              loptest_return_value_152_170_171_231=false
            }
            if (loptest_return_value_152_170_171_231) {
              gradchit_prof_171_231.x=gradchit_prof_171_231.x/chit_prof__mod__energy
              gradchit_prof_171_231.y=gradchit_prof_171_231.y/chit_prof__mod__energy
              gradchit_prof_171_231.z=gradchit_prof_171_231.z/chit_prof__mod__energy
            }
            else {
              gradchit_prof_171_231 = 1.*gradchit_prof_171_231
            }
            chit_prof__mod__energy = 1.*chit_prof__mod__energy
          }
        }
        else {
          chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[vertexIdx.x]
          gradchit_prof_171_231.x=AC_dchit_prof_stored__mod__energy[vertexIdx.x]
          gradchit_prof_171_231.y=0.
          gradchit_prof_171_231.z=0.
        }
      }
      thdiff_171_231=thdiff_171_231+AC_chi_t__mod__energy*chit_prof__mod__energy*(del2ss1_171_231+g2_171_231)
      g2_171_231 = dot(gradchit_prof_171_231,gss1__mod__energy)
      thdiff_171_231=thdiff_171_231+AC_chi_t__mod__energy*g2_171_231
    }
    if (AC_pretend_lntt__mod__cdata) {
      thdiff_171_231 = ac_transformed_pencil_cv1*thdiff_171_231
    }
    DF_SS = DF_SS + thdiff_171_231
    max_hdiff = max(max_hdiff,thdiff_175_231)
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi__mod__energy=diffus_chi__mod__energy+(ac_transformed_pencil_cv1*krho1_171_231+AC_chi_t__mod__energy)*dxyz_2__mod__cdata
    }
  }
  if (AC_lheatc_chit__mod__energy) {
    thdiff_175_231=0.
    if (AC_chi_t0__mod__energy!=0.) {
      if (AC_lchit_total__mod__energy  ||  AC_lchit_mean__mod__energy) {
        if (!AC_lmultilayer__mod__energy) {
          chit_prof__mod__energy=1.
          gradchit_prof_175_231.x = 0.
          gradchit_prof_175_231.y = 0.
          gradchit_prof_175_231.z = 0.
        }
        else {
          if (AC_lgravz__mod__cdata) {
            chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
            gradchit_prof_175_231.z=AC_dchit_prof_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
            gradchit_prof_175_231.x=0.
            gradchit_prof_175_231.y=0.
          }
          else if (AC_lsphere_in_a_box__mod__cdata) {
            if (true && AC_lhcond_global__mod__energy) {
              chit_prof__mod__energy = value(Field(AC_iglobal_hcond__mod__energy-1))
              gradchit_prof_175_231= value(F_GLOBAL_GLHVEC)
            }
            else {
              if (true) {
                r_mn_172_175_231=ac_transformed_pencil_r_mn
                r_mn1_172_175_231=ac_transformed_pencil_r_mn1
              }
              else {
                r_mn_172_175_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
                r_mn1_172_175_231=1./r_mn_172_175_231
              }
              arg_148_172_175_231 = abs((r_mn_172_175_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam))
              if (abs(arg_148_172_175_231)>=8.)  {
                der_step_return_value_148_172_175_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_172_175_231))
              }
              else {
                der_step_return_value_148_172_175_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_172_175_231)*cosh(arg_148_172_175_231))
              }
              arg_149_172_175_231 = abs((r_mn_172_175_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam))
              if (abs(arg_149_172_175_231)>=8.)  {
                der_step_return_value_149_172_175_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_172_175_231))
              }
              else {
                der_step_return_value_149_172_175_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_172_175_231)*cosh(arg_149_172_175_231))
              }
              chit_prof__mod__energy =  (AC_chit_prof1__mod__energy-1.)*der_step_return_value_148_172_175_231  +(AC_chit_prof2__mod__energy-1.)*der_step_return_value_149_172_175_231
              gradchit_prof_175_231.x = chit_prof__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_172_175_231
              gradchit_prof_175_231.y = chit_prof__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_172_175_231
              if (AC_lcylinder_in_a_box__mod__cdata) {
                gradchit_prof_175_231.z = 0.0
              }
              else {
                gradchit_prof_175_231.z = chit_prof__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_172_175_231
              }
              step_vector_return_value_150_172_175_231 = 0.5*(1+tanh((r_mn_172_175_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam)))
              step_vector_return_value_151_172_175_231 = 0.5*(1+tanh((r_mn_172_175_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam)))
              chit_prof__mod__energy = 1.+(AC_chit_prof1__mod__energy-1.)*step_vector_return_value_150_172_175_231  +(AC_chit_prof2__mod__energy-1.)*step_vector_return_value_151_172_175_231
              if (false) {
              }
              else if (false) {
              }
              else {
                loptest_return_value_152_172_175_231=false
              }
              if (loptest_return_value_152_172_175_231) {
                gradchit_prof_175_231.x=gradchit_prof_175_231.x/chit_prof__mod__energy
                gradchit_prof_175_231.y=gradchit_prof_175_231.y/chit_prof__mod__energy
                gradchit_prof_175_231.z=gradchit_prof_175_231.z/chit_prof__mod__energy
              }
              else {
                gradchit_prof_175_231 = 1.*gradchit_prof_175_231
              }
              chit_prof__mod__energy = 1.*chit_prof__mod__energy
            }
          }
          else {
            chit_prof__mod__energy=AC_chit_prof_stored__mod__energy[vertexIdx.x]
            gradchit_prof_175_231.x=AC_dchit_prof_stored__mod__energy[vertexIdx.x]
            gradchit_prof_175_231.y=0.
            gradchit_prof_175_231.z=0.
          }
        }
      }
      if (AC_lchit_total__mod__energy) {
        if (AC_lchit_not__mod__energy) {
          g2_175_231 = dot(ac_transformed_pencil_glnrho,ac_transformed_pencil_gss)
        }
        else {
          g2_175_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,ac_transformed_pencil_gss)
        }
        thdiff_175_231=thdiff_175_231+AC_chi_t0__mod__energy*chit_prof__mod__energy*(ac_transformed_pencil_del2ss+g2_175_231)
        g2_175_231 = dot(gradchit_prof_175_231,ac_transformed_pencil_gss)
        thdiff_175_231=thdiff_175_231+AC_chi_t0__mod__energy*g2_175_231
      }
      if (AC_lchit_mean__mod__energy  &&  (AC_lcalc_ssmean__mod__energy  ||  AC_lcalc_ssmeanxy__mod__energy)) {
        if (AC_lcalc_ssmean__mod__energy) {
          gss0__mod__energy.x=AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1]
          gss0__mod__energy.y=AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1]
          gss0__mod__energy.z=AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1]
          del2ss0_175_231=AC_del2ssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
        }
        else if (AC_lcalc_ssmeanxy__mod__energy) {
          gss0__mod__energy.x=AC_gssmx__mod__energy[vertexIdx.x][1-1]
          gss0__mod__energy.y=AC_gssmx__mod__energy[vertexIdx.x][2-1]
          gss0__mod__energy.z=AC_gssmx__mod__energy[vertexIdx.x][3-1]
          del2ss0_175_231=AC_del2ssmx__mod__energy[vertexIdx.x-NGHOST_VAL]
        }
        if (AC_lchit_not__mod__energy) {
          g2_175_231 = dot(ac_transformed_pencil_glnrho,gss0__mod__energy)
        }
        else {
          g2_175_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss0__mod__energy)
        }
        thdiff_175_231=thdiff_175_231+AC_chi_t0__mod__energy*chit_prof__mod__energy*(del2ss0_175_231+g2_175_231)
        g2_175_231 = dot(gradchit_prof_175_231,gss0__mod__energy)
        thdiff_175_231=thdiff_175_231+AC_chi_t0__mod__energy*g2_175_231
      }
    }
    if (AC_lchit_fluct__mod__energy && AC_chi_t1__mod__energy!=0.) {
      if (AC_lcalc_ssmean__mod__energy  ||  AC_lcalc_ssmeanxy__mod__energy  ||  AC_lss_running_aver__mod__energy) {
        if ((AC_lgravr__mod__cdata || AC_lgravx__mod__cdata || AC_lgravz__mod__cdata) && !(AC_lsphere_in_a_box__mod__cdata || AC_lchi_t1_noprof__mod__energy)) {
          if (!AC_lmultilayer__mod__energy) {
            gradchit_prof_fluct_175_231.x = 0.
            gradchit_prof_fluct_175_231.y = 0.
            gradchit_prof_fluct_175_231.z = 0.
          }
          else {
            if (AC_lgravz__mod__cdata) {
              chit_prof_fluct__mod__energy=AC_chit_prof_fluct_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
              gradchit_prof_fluct_175_231.z=AC_dchit_prof_fluct_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
              gradchit_prof_fluct_175_231.x=0.
              gradchit_prof_fluct_175_231.y=0.
            }
            else if (false) {
              if (false && AC_lhcond_global__mod__energy) {
              }
              else {
                if (false) {
                  r_mn_173_175_231=ac_transformed_pencil_r_mn
                  r_mn1_173_175_231=ac_transformed_pencil_r_mn1
                }
                else {
                  r_mn_173_175_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
                  r_mn1_173_175_231=1./r_mn_173_175_231
                }
                if (abs(arg_148_173_175_231)>=8.)  {
                  der_step_return_value_148_173_175_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_173_175_231))
                }
                else {
                  der_step_return_value_148_173_175_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_173_175_231)*cosh(arg_148_173_175_231))
                }
                if (abs(arg_149_173_175_231)>=8.)  {
                  der_step_return_value_149_173_175_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_173_175_231))
                }
                else {
                  der_step_return_value_149_173_175_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_173_175_231)*cosh(arg_149_173_175_231))
                }
                gradchit_prof_fluct_175_231.x = chit_prof_fluct__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_173_175_231
                gradchit_prof_fluct_175_231.y = chit_prof_fluct__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_173_175_231
                if (AC_lcylinder_in_a_box__mod__cdata) {
                  gradchit_prof_fluct_175_231.z = 0.0
                }
                else {
                  gradchit_prof_fluct_175_231.z = chit_prof_fluct__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_173_175_231
                }
                if (false) {
                }
                else if (false) {
                }
                else {
                  loptest_return_value_152_173_175_231=false
                }
                if (loptest_return_value_152_173_175_231) {
                  gradchit_prof_fluct_175_231.x=gradchit_prof_fluct_175_231.x/chit_prof_fluct__mod__energy
                  gradchit_prof_fluct_175_231.y=gradchit_prof_fluct_175_231.y/chit_prof_fluct__mod__energy
                  gradchit_prof_fluct_175_231.z=gradchit_prof_fluct_175_231.z/chit_prof_fluct__mod__energy
                }
                else {
                }
              }
            }
            else {
              chit_prof_fluct__mod__energy=AC_chit_prof_fluct_stored__mod__energy[vertexIdx.x]
              gradchit_prof_fluct_175_231.x=AC_dchit_prof_fluct_stored__mod__energy[vertexIdx.x]
              gradchit_prof_fluct_175_231.y=0.
              gradchit_prof_fluct_175_231.z=0.
            }
          }
        }
        else {
          chit_prof_fluct__mod__energy=AC_chi_t1__mod__energy
          gradchit_prof_fluct_175_231.x = 0.
          gradchit_prof_fluct_175_231.y = 0.
          gradchit_prof_fluct_175_231.z = 0.
        }
      }
      if (AC_lcalc_ssmean__mod__energy  ||  AC_lcalc_ssmeanxy__mod__energy) {
        if (AC_lcalc_ssmean__mod__energy) {
          gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1]
          gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1]
          gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1]
          del2ss1_175_231=ac_transformed_pencil_del2ss-AC_del2ssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
        }
        else if (AC_lcalc_ssmeanxy__mod__energy) {
          gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmx__mod__energy[vertexIdx.x][1-1]
          gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmx__mod__energy[vertexIdx.x][2-1]
          gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmx__mod__energy[vertexIdx.x][3-1]
          del2ss1_175_231=ac_transformed_pencil_del2ss-AC_del2ssmx__mod__energy[vertexIdx.x-NGHOST_VAL]
        }
        if (AC_lchit_not__mod__energy) {
          g2_175_231 = dot(ac_transformed_pencil_glnrho,gss1__mod__energy)
        }
        else {
          g2_175_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss1__mod__energy)
        }
        if ((AC_lgravr__mod__cdata || AC_lgravx__mod__cdata || AC_lgravz__mod__cdata) && !AC_lsphere_in_a_box__mod__cdata) {
          thdiff_175_231=thdiff_175_231+chit_prof_fluct__mod__energy*(del2ss1_175_231+g2_175_231)
          g2_175_231 = dot(gradchit_prof_fluct_175_231,gss1__mod__energy)
          thdiff_175_231=thdiff_175_231+g2_175_231
        }
      }
      if (AC_lss_running_aver__mod__energy) {
        if (AC_lrmv__mod__cdata) {
          g2_175_231 = der6x_ignore_spacing(Field(AC_iss_run_aver__mod__cdata-1))
          thdiff1_175_231 = AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam/60.*g2_175_231*dline_1__mod__cdata.x
          g2_175_231 = der6y_ignore_spacing(Field(AC_iss_run_aver__mod__cdata-1))
          thdiff1_175_231 = AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam/60.*g2_175_231*dline_1__mod__cdata.y
          g2_175_231 = der6z_ignore_spacing(Field(AC_iss_run_aver__mod__cdata-1))
          thdiff1_175_231 = AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam/60.*g2_175_231*dline_1__mod__cdata.z
          DF_SS_RUN_AVER = DF_SS_RUN_AVER + thdiff1_175_231
        }
        if (!AC_lmultilayer__mod__energy) {
          chit_prof_fluct__mod__energy=AC_chi_t1__mod__energy
          gradchit_prof_fluct_175_231.x = 0.
          gradchit_prof_fluct_175_231.y = 0.
          gradchit_prof_fluct_175_231.z = 0.
        }
        else {
          if (AC_lgravz__mod__cdata) {
            chit_prof_fluct__mod__energy=AC_chit_prof_fluct_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
            gradchit_prof_fluct_175_231.z=AC_dchit_prof_fluct_stored__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
            gradchit_prof_fluct_175_231.x=0.
            gradchit_prof_fluct_175_231.y=0.
          }
          else if (AC_lsphere_in_a_box__mod__cdata) {
            if (true && AC_lhcond_global__mod__energy) {
              chit_prof_fluct__mod__energy = value(Field(AC_iglobal_hcond__mod__energy-1))
              gradchit_prof_fluct_175_231= value(F_GLOBAL_GLHVEC)
            }
            else {
              if (true) {
                r_mn_174_175_231=ac_transformed_pencil_r_mn
                r_mn1_174_175_231=ac_transformed_pencil_r_mn1
              }
              else {
                r_mn_174_175_231=sqrt(AC_x__mod__cdata[vertexIdx.x]*AC_x__mod__cdata[vertexIdx.x]+AC_y__mod__cdata[AC_m__mod__cdata-1]*AC_y__mod__cdata[AC_m__mod__cdata-1]+AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1])
                r_mn1_174_175_231=1./r_mn_174_175_231
              }
              arg_148_174_175_231 = abs((r_mn_174_175_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam))
              if (abs(arg_148_174_175_231)>=8.)  {
                der_step_return_value_148_174_175_231 = 2./-AC_widthss__mod__energy*exp(-2.*abs(arg_148_174_175_231))
              }
              else {
                der_step_return_value_148_174_175_231 = 0.5/(-AC_widthss__mod__energy*cosh(arg_148_174_175_231)*cosh(arg_148_174_175_231))
              }
              arg_149_174_175_231 = abs((r_mn_174_175_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam))
              if (abs(arg_149_174_175_231)>=8.)  {
                der_step_return_value_149_174_175_231 = 2./AC_widthss__mod__energy*exp(-2.*abs(arg_149_174_175_231))
              }
              else {
                der_step_return_value_149_174_175_231 = 0.5/(AC_widthss__mod__energy*cosh(arg_149_174_175_231)*cosh(arg_149_174_175_231))
              }
              chit_prof_fluct__mod__energy =  (AC_chit_fluct_prof1__mod__energy-1.)*der_step_return_value_148_174_175_231  +(AC_chit_fluct_prof2__mod__energy-1.)*der_step_return_value_149_174_175_231
              gradchit_prof_fluct_175_231.x = chit_prof_fluct__mod__energy*AC_x__mod__cdata[vertexIdx.x]*r_mn1_174_175_231
              gradchit_prof_fluct_175_231.y = chit_prof_fluct__mod__energy*AC_y__mod__cdata[AC_m__mod__cdata-1]*r_mn1_174_175_231
              if (AC_lcylinder_in_a_box__mod__cdata) {
                gradchit_prof_fluct_175_231.z = 0.0
              }
              else {
                gradchit_prof_fluct_175_231.z = chit_prof_fluct__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1]*r_mn1_174_175_231
              }
              step_vector_return_value_150_174_175_231 = 0.5*(1+tanh((r_mn_174_175_231-AC_xbot__mod__energy)/(-AC_widthss__mod__energy+AC_tini__mod__cparam)))
              step_vector_return_value_151_174_175_231 = 0.5*(1+tanh((r_mn_174_175_231-AC_xtop__mod__energy)/(AC_widthss__mod__energy+AC_tini__mod__cparam)))
              chit_prof_fluct__mod__energy = 1.+(AC_chit_fluct_prof1__mod__energy-1.)*step_vector_return_value_150_174_175_231  +(AC_chit_fluct_prof2__mod__energy-1.)*step_vector_return_value_151_174_175_231
              if (false) {
              }
              else if (false) {
              }
              else {
                loptest_return_value_152_174_175_231=false
              }
              if (loptest_return_value_152_174_175_231) {
                gradchit_prof_fluct_175_231.x=gradchit_prof_fluct_175_231.x/chit_prof_fluct__mod__energy
                gradchit_prof_fluct_175_231.y=gradchit_prof_fluct_175_231.y/chit_prof_fluct__mod__energy
                gradchit_prof_fluct_175_231.z=gradchit_prof_fluct_175_231.z/chit_prof_fluct__mod__energy
              }
              else {
                gradchit_prof_fluct_175_231 = AC_chi_t1__mod__energy*gradchit_prof_fluct_175_231
              }
              chit_prof_fluct__mod__energy = AC_chi_t1__mod__energy*chit_prof_fluct__mod__energy
            }
          }
          else {
            chit_prof_fluct__mod__energy=AC_chit_prof_fluct_stored__mod__energy[vertexIdx.x]
            gradchit_prof_fluct_175_231.x=AC_dchit_prof_fluct_stored__mod__energy[vertexIdx.x]
            gradchit_prof_fluct_175_231.y=0.
            gradchit_prof_fluct_175_231.z=0.
          }
        }
        gss1__mod__energy = gradient(Field(AC_iss_run_aver__mod__cdata-1))
        gss0__mod__energy.x=ac_transformed_pencil_gss.x-gss1__mod__energy.x
        gss0__mod__energy.y=ac_transformed_pencil_gss.y-gss1__mod__energy.y
        gss0__mod__energy.z=ac_transformed_pencil_gss.z-gss1__mod__energy.z
        del2ss1_175_231 = laplace(Field(AC_iss_run_aver__mod__cdata-1))
        del2ss0_175_231=ac_transformed_pencil_del2ss-del2ss1_175_231
        if (AC_lchit_not__mod__energy) {
          g2_175_231 = dot(ac_transformed_pencil_glnrho,gss0__mod__energy)
        }
        else {
          g2_175_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss0__mod__energy)
        }
        thdiff_175_231=thdiff_175_231+chit_prof_fluct__mod__energy*(del2ss0_175_231+g2_175_231)
        g2_175_231 = dot(gradchit_prof_fluct_175_231,gss0__mod__energy)
        thdiff_175_231=thdiff_175_231+g2_175_231
      }
    }
    max_hdiff = max(max_hdiff,thdiff_175_231)
    DF_SS = DF_SS + thdiff_175_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_chi_t0__mod__energy!=0. && (AC_lchit_total__mod__energy  ||  AC_lchit_mean__mod__energy)) {
        diffus_chi__mod__energy=diffus_chi__mod__energy+AC_chi_t0__mod__energy*chit_prof__mod__energy*dxyz_2__mod__cdata
      }
      if (AC_lcalc_ssmean__mod__energy  ||  AC_lcalc_ssmeanxy__mod__energy  ||  AC_lss_running_aver__mod__energy) {
        if (AC_chi_t1__mod__energy!=0. && AC_lchit_fluct__mod__energy) {
          diffus_chi__mod__energy=diffus_chi__mod__energy+chit_prof_fluct__mod__energy*dxyz_2__mod__cdata
        }
      }
    }
  }
  if (AC_lheatc_smagorinsky__mod__energy) {
    thdiff_176_231=0.
    if (AC_lcalc_ssmean__mod__energy) {
      gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1]
      gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1]
      gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1]
      del2ss1_176_231=ac_transformed_pencil_del2ss-AC_del2ssmz__mod__energy[AC_n__mod__cdata-AC_n1__mod__cparam+1-1]
    }
    else if (AC_lcalc_ssmeanxy__mod__energy) {
      gss1__mod__energy.x=ac_transformed_pencil_gss.x-AC_gssmx__mod__energy[vertexIdx.x][1-1]
      gss1__mod__energy.y=ac_transformed_pencil_gss.y-AC_gssmx__mod__energy[vertexIdx.x][2-1]
      gss1__mod__energy.z=ac_transformed_pencil_gss.z-AC_gssmx__mod__energy[vertexIdx.x][3-1]
      del2ss1_176_231=ac_transformed_pencil_del2ss-AC_del2ssmx__mod__energy[vertexIdx.x-NGHOST_VAL]
    }
    else {
      gss1__mod__energy=ac_transformed_pencil_gss
      del2ss1_176_231=ac_transformed_pencil_del2ss
    }
    if (AC_lchit_not__mod__energy) {
      g2_176_231 = dot(ac_transformed_pencil_glnrho,gss1__mod__energy)
    }
    else {
      g2_176_231 = dot(ac_transformed_pencil_glnrho+ac_transformed_pencil_glntt,gss1__mod__energy)
    }
    thdiff_176_231=AC_pr_smag1__mod__energy*ac_transformed_pencil_nu_smag*(del2ss1_176_231+g2_176_231)
    gradnu_176_231 = gradient(Field(AC_inusmag__mod__cdata-1))
    g2_176_231 = dot(gradnu_176_231,gss1__mod__energy)
    thdiff_176_231=thdiff_176_231+AC_pr_smag1__mod__energy*g2_176_231
    chix_176_231 = AC_pr_smag1__mod__energy*ac_transformed_pencil_nu_smag
    DF_SS = DF_SS + thdiff_176_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi__mod__energy=diffus_chi__mod__energy+(ac_transformed_pencil_cv1/ac_transformed_pencil_cp1*chix_176_231)*dxyz_2__mod__cdata
    }
  }
  if (AC_lheatc_corona__mod__energy) {
    bb2_177_231 = dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb)
    b1_177_231=1./max(AC_REAL_MIN,bb2_177_231)
    vkpara_177_231 = AC_kgpara__mod__energy * pow(exp(ac_transformed_pencil_lntt),3.5)
    vkperp_177_231 = AC_kgperp__mod__energy * b1_177_231*exp(2*ac_transformed_pencil_lnrho+0.5*ac_transformed_pencil_lntt)
    tmps_177_231 = 3.5 * vkpara_177_231
    gvkpara_177_231 = tmps_177_231*ac_transformed_pencil_glntt
    tmpv_177_231.x=0.
    tmpv_177_231.x=tmpv_177_231.x + ac_transformed_pencil_bb.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpv_177_231.x=tmpv_177_231.x + ac_transformed_pencil_bb.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpv_177_231.x=tmpv_177_231.x + ac_transformed_pencil_bb.z*ac_transformed_pencil_bij[3-1][1-1]
    tmpv_177_231.y=0.
    tmpv_177_231.y=tmpv_177_231.y + ac_transformed_pencil_bb.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpv_177_231.y=tmpv_177_231.y + ac_transformed_pencil_bb.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpv_177_231.y=tmpv_177_231.y + ac_transformed_pencil_bb.z*ac_transformed_pencil_bij[3-1][2-1]
    tmpv_177_231.z=0.
    tmpv_177_231.z=tmpv_177_231.z + ac_transformed_pencil_bb.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpv_177_231.z=tmpv_177_231.z + ac_transformed_pencil_bb.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpv_177_231.z=tmpv_177_231.z + ac_transformed_pencil_bb.z*ac_transformed_pencil_bij[3-1][3-1]
    tmpv2_177_231 = 2*b1_177_231*tmpv_177_231
    tmpv_177_231=2.*ac_transformed_pencil_glnrho+0.5*ac_transformed_pencil_glntt-tmpv2_177_231
    gvkperp_177_231 = vkperp_177_231*tmpv_177_231
    abs_b_167_177_231 = sqrt(dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb))
    b1_167_177_231=1./max(AC_tini__mod__cparam,abs_b_167_177_231)
    bunit_167_177_231 = b1_167_177_231*ac_transformed_pencil_bb
    del2ecr_167_177_231=0.
    del2ecr_167_177_231=del2ecr_167_177_231+ac_transformed_pencil_hlntt[1-1][1-1]
    hhh_167_177_231.x=0.
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_167_177_231.x=hhh_167_177_231.x+bunit_167_177_231.x*(ac_transformed_pencil_bij[1-1][1-1]+bunit_167_177_231.x*tmpj_167_177_231)
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_167_177_231.x=hhh_167_177_231.x+bunit_167_177_231.y*(ac_transformed_pencil_bij[1-1][2-1]+bunit_167_177_231.x*tmpj_167_177_231)
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_167_177_231.x=hhh_167_177_231.x+bunit_167_177_231.z*(ac_transformed_pencil_bij[1-1][3-1]+bunit_167_177_231.x*tmpj_167_177_231)
    del2ecr_167_177_231=del2ecr_167_177_231+ac_transformed_pencil_hlntt[2-1][2-1]
    hhh_167_177_231.y=0.
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_167_177_231.y=hhh_167_177_231.y+bunit_167_177_231.x*(ac_transformed_pencil_bij[2-1][1-1]+bunit_167_177_231.y*tmpj_167_177_231)
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_167_177_231.y=hhh_167_177_231.y+bunit_167_177_231.y*(ac_transformed_pencil_bij[2-1][2-1]+bunit_167_177_231.y*tmpj_167_177_231)
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_167_177_231.y=hhh_167_177_231.y+bunit_167_177_231.z*(ac_transformed_pencil_bij[2-1][3-1]+bunit_167_177_231.y*tmpj_167_177_231)
    del2ecr_167_177_231=del2ecr_167_177_231+ac_transformed_pencil_hlntt[3-1][3-1]
    hhh_167_177_231.z=0.
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_167_177_231.z=hhh_167_177_231.z+bunit_167_177_231.x*(ac_transformed_pencil_bij[3-1][1-1]+bunit_167_177_231.z*tmpj_167_177_231)
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_167_177_231.z=hhh_167_177_231.z+bunit_167_177_231.y*(ac_transformed_pencil_bij[3-1][2-1]+bunit_167_177_231.z*tmpj_167_177_231)
    tmpj_167_177_231=0.
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_167_177_231=tmpj_167_177_231-2.*bunit_167_177_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_167_177_231.z=hhh_167_177_231.z+bunit_167_177_231.z*(ac_transformed_pencil_bij[3-1][3-1]+bunit_167_177_231.z*tmpj_167_177_231)
    tmpv_167_177_231 = b1_167_177_231*hhh_167_177_231
    hhh2_167_177_231 = sqrt(dot(tmpv_167_177_231,tmpv_167_177_231))
    quenchfactor_167_177_231=1./max(1.,limiter_tensordiff_167_177_231*hhh2_167_177_231*AC_dxmax__mod__cdata)
    hhh_167_177_231 = quenchfactor_167_177_231*tmpv_167_177_231
    tmp_167_177_231 = dot(hhh_167_177_231,ac_transformed_pencil_glntt)
    hhh_167_177_231 = ac_transformed_pencil_hlntt*bunit_167_177_231
    tmpj_167_177_231 = dot(hhh_167_177_231,bunit_167_177_231)
    tmp_167_177_231 = tmp_167_177_231+tmpj_167_177_231
    gecr2_167_177_231=0.
    if (false) {
      tmpi_167_177_231 = dot(ac_transformed_pencil_glntt,bunit_167_177_231)
      tmp_167_177_231=tmp_167_177_231+tmpi_167_177_231*tmpi_167_177_231
      gecr2_167_177_231 = dot(ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    }
    if (true) {
      gvkpara1_167_177_231=gvkpara_177_231
    }
    else {
      gvkpara1_167_177_231.x = 0.
      gvkpara1_167_177_231.y = 0.
      gvkpara1_167_177_231.z = 0.
    }
    if (true) {
      gvkperp1_167_177_231=gvkperp_177_231
    }
    else {
      gvkperp1_167_177_231.x = 0.
      gvkperp1_167_177_231.y = 0.
      gvkperp1_167_177_231.z = 0.
    }
    tmpj_167_177_231 = dot(gvkperp1_167_177_231,ac_transformed_pencil_glntt)
    tmpi_167_177_231 = dot(bunit_167_177_231,gvkpara1_167_177_231-gvkperp1_167_177_231)
    tmpk_167_177_231 = dot(bunit_167_177_231,ac_transformed_pencil_glntt)
    tmpj_167_177_231 = tmpj_167_177_231+tmpi_167_177_231*tmpk_167_177_231
    thdiff_177_231=vkperp_177_231*(del2ecr_167_177_231+gecr2_167_177_231) + (vkpara_177_231-vkperp_177_231)*tmp_167_177_231 + tmpj_167_177_231
    thdiff_177_231 = thdiff_177_231*exp(-ac_transformed_pencil_lnrho-ac_transformed_pencil_lntt)
    DF_SS=DF_SS + thdiff_177_231
    if (AC_z__mod__cdata[AC_n__mod__cdata-1] < AC_prof_z__mod__energy[1-1] ) {
      lnttor_178_231 = AC_prof_lnt__mod__energy[1-1]
    }
    else if (AC_z__mod__cdata[AC_n__mod__cdata-1] >= AC_prof_z__mod__energy[AC_prof_nz__mod__energy-1]) {
      lnttor_178_231 = AC_prof_lnt__mod__energy[AC_prof_nz__mod__energy-1]
    }
    else {
      for i_178_231 in 1:AC_prof_nz__mod__energy-1+1 {
        if (AC_z__mod__cdata[AC_n__mod__cdata-1] >= AC_prof_z__mod__energy[i_178_231-1]  &&  AC_z__mod__cdata[AC_n__mod__cdata-1] < AC_prof_z__mod__energy[1+i_178_231-1]) {
          lnttor_178_231 = (AC_prof_lnt__mod__energy[i_178_231-1]*(AC_prof_z__mod__energy[1+i_178_231-1] - AC_z__mod__cdata[AC_n__mod__cdata-1]) +  AC_prof_lnt__mod__energy[1+i_178_231-1]*(AC_z__mod__cdata[AC_n__mod__cdata-1] - AC_prof_z__mod__energy[i_178_231-1]) ) / (AC_prof_z__mod__energy[1+i_178_231-1]-AC_prof_z__mod__energy[i_178_231-1])
          break
        }
      }
    }
    if (AC_dt__mod__cdata!=0.0)  {
      newton_178_231 = AC_tdown__mod__energy/AC_gamma__mod__energy/AC_dt__mod__cdata*((lnttor_178_231 - ac_transformed_pencil_lntt) )
      newton_178_231 = newton_178_231 * exp(AC_allp__mod__energy*(-abs(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)))
      DF_SS = DF_SS + newton_178_231
    }
    unit_lnq_179_231=3*log(AC_unit_velocity__mod__cdata)+5*log(AC_unit_length__mod__cdata)+log(AC_unit_density__mod__cdata)
    if (AC_string_enum_unit_system__mod__cdata == AC_string_enum_cgs_string__mod__cparam) {
      unit_lnq_179_231 = unit_lnq_179_231+log(1.e13)
    }
    lntt_si_179_231 = ac_transformed_pencil_lntt + log(AC_unit_temperature__mod__cdata)
    lnneni_179_231 = 2*ac_transformed_pencil_lnrho + log(1.2) - 2*log(1.4*AC_m_p__mod__cdata)
    rtv_cool_179_231=0.
    if(AC_cool_type__mod__energy == 1) {
      imax_179_231 = 10
      lnq_179_231=0.0
      for i_179_231 in 1:imax_179_231-1+1 {
        if (( intlnt_1_179_231[i_179_231-1] <= lntt_si_179_231  ||  i_179_231==1 )  &&  lntt_si_179_231 < intlnt_1_179_231[1+i_179_231-1] ) {
          lnq_179_231=lnq_179_231 + lnh_1_179_231[i_179_231-1] + b_1_179_231[i_179_231-1]*lntt_si_179_231
        }
      }
      if (lntt_si_179_231 >= intlnt_1_179_231[imax_179_231-1] ) {
        lnq_179_231 = lnq_179_231 + lnh_1_179_231[imax_179_231-1-1] + b_1_179_231[imax_179_231-1-1]*intlnt_1_179_231[imax_179_231-1]
      }
      if (AC_pres_cutoff__mod__energy!=AC_impossible__mod__cparam) {
        rtv_cool_179_231=exp(lnneni_179_231+lnq_179_231-unit_lnq_179_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)*exp(-ac_transformed_pencil_rho*ac_transformed_pencil_cs2*AC_gamma1__mod__energy/AC_pres_cutoff__mod__energy)
      }
      else {
        rtv_cool_179_231=exp(lnneni_179_231+lnq_179_231-unit_lnq_179_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)
      }
    }
    else if(AC_cool_type__mod__energy == 2) {
      imax_179_231 = 7
      lnq_179_231=0.0
      for i_179_231 in 1:imax_179_231-1+1 {
        if (( intlnt_2_179_231[i_179_231-1] <= lntt_si_179_231  ||  i_179_231==1 )  &&  lntt_si_179_231 < intlnt_2_179_231[1+i_179_231-1] ) {
          lnq_179_231=lnq_179_231 + lnh_2_179_231[i_179_231-1] + b_2_179_231[i_179_231-1]*lntt_si_179_231
        }
      }
      if (lntt_si_179_231 >= intlnt_2_179_231[imax_179_231-1] ) {
        lnq_179_231 = lnq_179_231 + lnh_2_179_231[imax_179_231-1-1] + b_2_179_231[imax_179_231-1-1]*intlnt_2_179_231[imax_179_231-1]
      }
      if (AC_pres_cutoff__mod__energy!=AC_impossible__mod__cparam) {
        rtv_cool_179_231=exp(lnneni_179_231+lnq_179_231-unit_lnq_179_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)*exp(-ac_transformed_pencil_rho*ac_transformed_pencil_cs2*AC_gamma1__mod__energy/AC_pres_cutoff__mod__energy)
      }
      else {
        rtv_cool_179_231=exp(lnneni_179_231+lnq_179_231-unit_lnq_179_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)
      }
    }
    else if(AC_cool_type__mod__energy == 3) {
    }
    else {
      rtv_cool_179_231=0.
    }
    rtv_cool_179_231=rtv_cool_179_231 * AC_cool_rtv__mod__energy
    DF_SS = DF_SS-rtv_cool_179_231
  }
  if (AC_lheatc_tensordiffusion__mod__energy) {
    vkpara_181_231 = AC_kgpara__mod__energy
    vkperp_181_231 = AC_kgperp__mod__energy
    abs_b_180_181_231 = sqrt(dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb))
    b1_180_181_231=1./max(AC_tini__mod__cparam,abs_b_180_181_231)
    bunit_180_181_231 = b1_180_181_231*ac_transformed_pencil_bb
    del2ecr_180_181_231=0.
    del2ecr_180_181_231=del2ecr_180_181_231+ac_transformed_pencil_hlntt[1-1][1-1]
    hhh_180_181_231.x=0.
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_180_181_231.x=hhh_180_181_231.x+bunit_180_181_231.x*(ac_transformed_pencil_bij[1-1][1-1]+bunit_180_181_231.x*tmpj_180_181_231)
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_180_181_231.x=hhh_180_181_231.x+bunit_180_181_231.y*(ac_transformed_pencil_bij[1-1][2-1]+bunit_180_181_231.x*tmpj_180_181_231)
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_180_181_231.x=hhh_180_181_231.x+bunit_180_181_231.z*(ac_transformed_pencil_bij[1-1][3-1]+bunit_180_181_231.x*tmpj_180_181_231)
    del2ecr_180_181_231=del2ecr_180_181_231+ac_transformed_pencil_hlntt[2-1][2-1]
    hhh_180_181_231.y=0.
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_180_181_231.y=hhh_180_181_231.y+bunit_180_181_231.x*(ac_transformed_pencil_bij[2-1][1-1]+bunit_180_181_231.y*tmpj_180_181_231)
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_180_181_231.y=hhh_180_181_231.y+bunit_180_181_231.y*(ac_transformed_pencil_bij[2-1][2-1]+bunit_180_181_231.y*tmpj_180_181_231)
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_180_181_231.y=hhh_180_181_231.y+bunit_180_181_231.z*(ac_transformed_pencil_bij[2-1][3-1]+bunit_180_181_231.y*tmpj_180_181_231)
    del2ecr_180_181_231=del2ecr_180_181_231+ac_transformed_pencil_hlntt[3-1][3-1]
    hhh_180_181_231.z=0.
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][1-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][1-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][1-1]
    hhh_180_181_231.z=hhh_180_181_231.z+bunit_180_181_231.x*(ac_transformed_pencil_bij[3-1][1-1]+bunit_180_181_231.z*tmpj_180_181_231)
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][2-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][2-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][2-1]
    hhh_180_181_231.z=hhh_180_181_231.z+bunit_180_181_231.y*(ac_transformed_pencil_bij[3-1][2-1]+bunit_180_181_231.z*tmpj_180_181_231)
    tmpj_180_181_231=0.
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.x*ac_transformed_pencil_bij[1-1][3-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.y*ac_transformed_pencil_bij[2-1][3-1]
    tmpj_180_181_231=tmpj_180_181_231-2.*bunit_180_181_231.z*ac_transformed_pencil_bij[3-1][3-1]
    hhh_180_181_231.z=hhh_180_181_231.z+bunit_180_181_231.z*(ac_transformed_pencil_bij[3-1][3-1]+bunit_180_181_231.z*tmpj_180_181_231)
    tmpv_180_181_231 = b1_180_181_231*hhh_180_181_231
    hhh2_180_181_231 = sqrt(dot(tmpv_180_181_231,tmpv_180_181_231))
    quenchfactor_180_181_231=1./max(1.,limiter_tensordiff_180_181_231*hhh2_180_181_231*AC_dxmax__mod__cdata)
    hhh_180_181_231 = quenchfactor_180_181_231*tmpv_180_181_231
    tmp_180_181_231 = dot(hhh_180_181_231,ac_transformed_pencil_glntt)
    hhh_180_181_231 = ac_transformed_pencil_hlntt*bunit_180_181_231
    tmpj_180_181_231 = dot(hhh_180_181_231,bunit_180_181_231)
    tmp_180_181_231 = tmp_180_181_231+tmpj_180_181_231
    gecr2_180_181_231=0.
    if (true) {
      tmpi_180_181_231 = dot(ac_transformed_pencil_glntt,bunit_180_181_231)
      tmp_180_181_231=tmp_180_181_231+tmpi_180_181_231*tmpi_180_181_231
      gecr2_180_181_231 = dot(ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    }
    if (false) {
    }
    else {
      gvkpara1_180_181_231.x = 0.
      gvkpara1_180_181_231.y = 0.
      gvkpara1_180_181_231.z = 0.
    }
    if (false) {
    }
    else {
      gvkperp1_180_181_231.x = 0.
      gvkperp1_180_181_231.y = 0.
      gvkperp1_180_181_231.z = 0.
    }
    tmpj_180_181_231 = dot(gvkperp1_180_181_231,ac_transformed_pencil_glntt)
    tmpi_180_181_231 = dot(bunit_180_181_231,gvkpara1_180_181_231-gvkperp1_180_181_231)
    tmpk_180_181_231 = dot(bunit_180_181_231,ac_transformed_pencil_glntt)
    tmpj_180_181_231 = tmpj_180_181_231+tmpi_180_181_231*tmpk_180_181_231
    rhs_181_231=vkperp_181_231*(del2ecr_180_181_231+gecr2_180_181_231) + (vkpara_181_231-vkperp_181_231)*tmp_180_181_231 + tmpj_180_181_231
    if (ac_transformed_pencil_rho <= AC_REAL_MIN) {
      ac_transformed_pencil_rho1=0.0
    }
    DF_SS=DF_SS+rhs_181_231*ac_transformed_pencil_rho1
    cosbgt_181_231 = dot(ac_transformed_pencil_bb,ac_transformed_pencil_glntt)
    gt2_181_231 = dot(ac_transformed_pencil_glntt,ac_transformed_pencil_glntt)
    b2_181_231 = dot(ac_transformed_pencil_bb,ac_transformed_pencil_bb)
    if ((gt2_181_231<=AC_tini__mod__cparam) || (b2_181_231<=AC_tini__mod__cparam)) {
      cosbgt_181_231=0.
    }
    else {
      cosbgt_181_231=cosbgt_181_231/sqrt(gt2_181_231*b2_181_231)
    }
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi__mod__energy=diffus_chi__mod__energy + cosbgt_181_231*ac_transformed_pencil_cv1*AC_kgpara__mod__energy*exp(-ac_transformed_pencil_lnrho)*dxyz_2__mod__cdata
    }
  }
  if (AC_lheatc_hyper3ss_polar__mod__energy) {
    thdiff_182_231=0.
    tmp_182_231 = der6x_ignore_spacing(Field(AC_iss__mod__cdata-1))
    thdiff_182_231 = thdiff_182_231 + AC_chi_hyper3__mod__energy*AC_pi4_1__mod__cparam*tmp_182_231*dline_1__mod__cdata.x*dline_1__mod__cdata.x
    tmp_182_231 = der6y_ignore_spacing(Field(AC_iss__mod__cdata-1))
    thdiff_182_231 = thdiff_182_231 + AC_chi_hyper3__mod__energy*AC_pi4_1__mod__cparam*tmp_182_231*dline_1__mod__cdata.y*dline_1__mod__cdata.y
    tmp_182_231 = der6z_ignore_spacing(Field(AC_iss__mod__cdata-1))
    thdiff_182_231 = thdiff_182_231 + AC_chi_hyper3__mod__energy*AC_pi4_1__mod__cparam*tmp_182_231*dline_1__mod__cdata.z*dline_1__mod__cdata.z
    DF_SS = DF_SS + thdiff_182_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi3__mod__energy=diffus_chi3__mod__energy+AC_chi_hyper3__mod__energy*AC_pi4_1__mod__cparam*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata
    }
  }
  if (AC_lheatc_hyper3ss_mesh__mod__energy) {
    thdiff_183_231=0.0
    tmp_183_231 = der6x_ignore_spacing(Field(AC_iss__mod__cdata-1))
    if (AC_ldynamical_diffusion__mod__cdata) {
      thdiff_183_231 = thdiff_183_231 + AC_chi_hyper3_mesh__mod__energy * tmp_183_231 * dline_1__mod__cdata.x
    }
    else {
      thdiff_183_231 = thdiff_183_231 + AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam/60.*tmp_183_231*dline_1__mod__cdata.x
    }
    tmp_183_231 = der6y_ignore_spacing(Field(AC_iss__mod__cdata-1))
    if (AC_ldynamical_diffusion__mod__cdata) {
      thdiff_183_231 = thdiff_183_231 + AC_chi_hyper3_mesh__mod__energy * tmp_183_231 * dline_1__mod__cdata.y
    }
    else {
      thdiff_183_231 = thdiff_183_231 + AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam/60.*tmp_183_231*dline_1__mod__cdata.y
    }
    tmp_183_231 = der6z_ignore_spacing(Field(AC_iss__mod__cdata-1))
    if (AC_ldynamical_diffusion__mod__cdata) {
      thdiff_183_231 = thdiff_183_231 + AC_chi_hyper3_mesh__mod__energy * tmp_183_231 * dline_1__mod__cdata.z
    }
    else {
      thdiff_183_231 = thdiff_183_231 + AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam/60.*tmp_183_231*dline_1__mod__cdata.z
    }
    DF_SS = DF_SS + thdiff_183_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      if (AC_ldynamical_diffusion__mod__cdata) {
        diffus_chi3__mod__energy = diffus_chi3__mod__energy + AC_chi_hyper3_mesh__mod__energy * sum(abs(dline_1__mod__cdata))
        advec_hypermesh_ss_183_231 = 0.0
      }
      else {
        advec_hypermesh_ss_183_231=AC_chi_hyper3_mesh__mod__energy*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata)
      }
      advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_ss_183_231*advec_hypermesh_ss_183_231
    }
  }
  if (AC_lheatc_hyper3ss_aniso__mod__energy) {
    thdiff_184_231  = del6fj(Field(AC_iss__mod__cdata-1), AC_chi_hyper3_aniso__mod__energy)
    DF_SS = DF_SS + thdiff_184_231
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_chi3__mod__energy=diffus_chi3__mod__energy + (AC_chi_hyper3_aniso__mod__energy.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x +  AC_chi_hyper3_aniso__mod__energy.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y +  AC_chi_hyper3_aniso__mod__energy.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)
    }
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
    maxdiffus__mod__cdata=max(maxdiffus__mod__cdata,diffus_chi__mod__energy)
    maxdiffus3__mod__cdata=max(maxdiffus3__mod__cdata,diffus_chi3__mod__energy)
  }
  if (AC_lenergy_slope_limited__mod__energy && AC_llast__mod__cdata) {
    not_implemented("calc_slope_diff_flux")
    DF_SS=DF_SS+tmp1_231
  }
  if (AC_lcalc_heat_cool__mod__energy) {
    heat_213_231=0.0
    if (AC_lcooling_general__mod__energy) {
      if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_gaussianzz_string__mod__cparam) {
        prof_195_213_231=exp(-0.5*((AC_zcool__mod__energy-AC_z__mod__cdata[AC_n__mod__cdata-1])/AC_wcool__mod__energy)*((AC_zcool__mod__energy-AC_z__mod__cdata[AC_n__mod__cdata-1])/AC_wcool__mod__energy))
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_linzz_string__mod__cparam) {
        prof_195_213_231=AC_z__mod__cdata[AC_n__mod__cdata-1]/AC_wcool__mod__energy
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_sinzz_string__mod__cparam) {
        prof_195_213_231=sin(AC_z__mod__cdata[AC_n__mod__cdata-1]/AC_wcool__mod__energy)
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_surface_z_string__mod__cparam) {
        z_185_195_213_231 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool__mod__energy)/AC_wcool__mod__energy)
        t_185_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_185_195_213_231 )
        dumerfc_185_195_213_231 =  t_185_195_213_231 * exp(-z_185_195_213_231 * z_185_195_213_231 - 1.26551223 + t_185_195_213_231 *         ( 1.00002368 + t_185_195_213_231 * ( 0.37409196 + t_185_195_213_231 *            ( 0.09678418 + t_185_195_213_231 * (-0.18628806 + t_185_195_213_231 *            ( 0.27886807 + t_185_195_213_231 * (-1.13520398 + t_185_195_213_231 *            ( 1.48851587 + t_185_195_213_231 * (-0.82215223 + t_185_195_213_231 * 0.17087277 )))))))))
        if ((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool__mod__energy)/AC_wcool__mod__energy<0.0) {
          dumerfc_185_195_213_231 = 2.0 - dumerfc_185_195_213_231
        }
        erfunc_return_value_185_195_213_231 = 1.0 - dumerfc_185_195_213_231
        prof_195_213_231=0.5*(1.+erfunc_return_value_185_195_213_231)
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_surface_x_string__mod__cparam) {
        z_186_195_213_231 = abs((AC_x__mod__cdata[vertexIdx.x]-AC_rcool__mod__energy)/AC_wcool__mod__energy)
        t_186_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_186_195_213_231 )
        dumerfc_186_195_213_231 =  t_186_195_213_231 * exp(-z_186_195_213_231 * z_186_195_213_231 - 1.26551223 + t_186_195_213_231 *         ( 1.00002368 + t_186_195_213_231 * ( 0.37409196 + t_186_195_213_231 *            ( 0.09678418 + t_186_195_213_231 * (-0.18628806 + t_186_195_213_231 *            ( 0.27886807 + t_186_195_213_231 * (-1.13520398 + t_186_195_213_231 *            ( 1.48851587 + t_186_195_213_231 * (-0.82215223 + t_186_195_213_231 * 0.17087277 )))))))))
        if ((AC_x__mod__cdata[vertexIdx.x]-AC_rcool__mod__energy)/AC_wcool__mod__energy<0.0) {
          dumerfc_186_195_213_231 = 2.0 - dumerfc_186_195_213_231
        }
        erfunc_return_value_186_195_213_231 = 1.0 - dumerfc_186_195_213_231
        prof_195_213_231=0.5*(1.+erfunc_return_value_186_195_213_231)
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_twozlayer_string__mod__cparam) {
        z_187_195_213_231 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool__mod__energy )/AC_wcool__mod__energy)
        t_187_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_187_195_213_231 )
        dumerfc_187_195_213_231 =  t_187_195_213_231 * exp(-z_187_195_213_231 * z_187_195_213_231 - 1.26551223 + t_187_195_213_231 *         ( 1.00002368 + t_187_195_213_231 * ( 0.37409196 + t_187_195_213_231 *            ( 0.09678418 + t_187_195_213_231 * (-0.18628806 + t_187_195_213_231 *            ( 0.27886807 + t_187_195_213_231 * (-1.13520398 + t_187_195_213_231 *            ( 1.48851587 + t_187_195_213_231 * (-0.82215223 + t_187_195_213_231 * 0.17087277 )))))))))
        if ((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool__mod__energy )/AC_wcool__mod__energy<0.0) {
          dumerfc_187_195_213_231 = 2.0 - dumerfc_187_195_213_231
        }
        erfunc_return_value_187_195_213_231 = 1.0 - dumerfc_187_195_213_231
        prof_195_213_231 =0.5*(1.+erfunc_return_value_187_195_213_231)
        z_188_195_213_231 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool2__mod__energy)/AC_wcool2__mod__energy)
        t_188_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_188_195_213_231 )
        dumerfc_188_195_213_231 =  t_188_195_213_231 * exp(-z_188_195_213_231 * z_188_195_213_231 - 1.26551223 + t_188_195_213_231 *         ( 1.00002368 + t_188_195_213_231 * ( 0.37409196 + t_188_195_213_231 *            ( 0.09678418 + t_188_195_213_231 * (-0.18628806 + t_188_195_213_231 *            ( 0.27886807 + t_188_195_213_231 * (-1.13520398 + t_188_195_213_231 *            ( 1.48851587 + t_188_195_213_231 * (-0.82215223 + t_188_195_213_231 * 0.17087277 )))))))))
        if ((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool2__mod__energy)/AC_wcool2__mod__energy<0.0) {
          dumerfc_188_195_213_231 = 2.0 - dumerfc_188_195_213_231
        }
        erfunc_return_value_188_195_213_231 = 1.0 - dumerfc_188_195_213_231
        prof2_195_213_231=0.5*(1.+erfunc_return_value_188_195_213_231)
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_squarezwell_string__mod__cparam) {
        z_189_195_213_231 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool__mod__energy)/AC_wcool__mod__energy)
        t_189_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_189_195_213_231 )
        dumerfc_189_195_213_231 =  t_189_195_213_231 * exp(-z_189_195_213_231 * z_189_195_213_231 - 1.26551223 + t_189_195_213_231 *         ( 1.00002368 + t_189_195_213_231 * ( 0.37409196 + t_189_195_213_231 *            ( 0.09678418 + t_189_195_213_231 * (-0.18628806 + t_189_195_213_231 *            ( 0.27886807 + t_189_195_213_231 * (-1.13520398 + t_189_195_213_231 *            ( 1.48851587 + t_189_195_213_231 * (-0.82215223 + t_189_195_213_231 * 0.17087277 )))))))))
        if ((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zcool__mod__energy)/AC_wcool__mod__energy<0.0) {
          dumerfc_189_195_213_231 = 2.0 - dumerfc_189_195_213_231
        }
        erfunc_return_value_189_195_213_231 = 1.0 - dumerfc_189_195_213_231
        z_190_195_213_231 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]+AC_zcool__mod__energy)/AC_wcool__mod__energy)
        t_190_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_190_195_213_231 )
        dumerfc_190_195_213_231 =  t_190_195_213_231 * exp(-z_190_195_213_231 * z_190_195_213_231 - 1.26551223 + t_190_195_213_231 *         ( 1.00002368 + t_190_195_213_231 * ( 0.37409196 + t_190_195_213_231 *            ( 0.09678418 + t_190_195_213_231 * (-0.18628806 + t_190_195_213_231 *            ( 0.27886807 + t_190_195_213_231 * (-1.13520398 + t_190_195_213_231 *            ( 1.48851587 + t_190_195_213_231 * (-0.82215223 + t_190_195_213_231 * 0.17087277 )))))))))
        if ((AC_z__mod__cdata[AC_n__mod__cdata-1]+AC_zcool__mod__energy)/AC_wcool__mod__energy<0.0) {
          dumerfc_190_195_213_231 = 2.0 - dumerfc_190_195_213_231
        }
        erfunc_return_value_190_195_213_231 = 1.0 - dumerfc_190_195_213_231
        prof_195_213_231=1.+0.5*(erfunc_return_value_189_195_213_231-  erfunc_return_value_190_195_213_231)
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_cubic_step_string__mod__cparam) {
        ztop_195_213_231=AC_xyz0__mod__cdata.z+AC_lxyz__mod__cdata.z
        if (false) {
        }
        else {
          relshift_191_195_213_231=0.0
        }
        xi_191_195_213_231 = (AC_z__mod__cdata[AC_n__mod__cdata-1]-(ztop_195_213_231+AC_z_cor__mod__energy)/2)/((ztop_195_213_231-AC_z_cor__mod__energy)/2+AC_tini__mod__cparam) - relshift_191_195_213_231
        xi_191_195_213_231 = max(xi_191_195_213_231,-1.0)
        xi_191_195_213_231 = min(xi_191_195_213_231, 1.0)
        cubic_step_pt_return_value_191_195_213_231 = 0.5 + xi_191_195_213_231*(0.75-xi_191_195_213_231*xi_191_195_213_231*0.25)
        prof_195_213_231 = cubic_step_pt_return_value_191_195_213_231
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_cubic_step_topbot_string__mod__cparam) {
        zbot_195_213_231=AC_xyz0__mod__cdata.z
        ztop_195_213_231=AC_xyz0__mod__cdata.z+AC_lxyz__mod__cdata.z
        if (false) {
        }
        else {
          relshift_192_195_213_231=0.0
        }
        xi_192_195_213_231 = (AC_z__mod__cdata[AC_n__mod__cdata-1]-(ztop_195_213_231+AC_z_cor__mod__energy)/2)/((ztop_195_213_231-AC_z_cor__mod__energy)/2+AC_tini__mod__cparam) - relshift_192_195_213_231
        xi_192_195_213_231 = max(xi_192_195_213_231,-1.0)
        xi_192_195_213_231 = min(xi_192_195_213_231, 1.0)
        cubic_step_pt_return_value_192_195_213_231 = 0.5 + xi_192_195_213_231*(0.75-xi_192_195_213_231*xi_192_195_213_231*0.25)
        if (false) {
        }
        else {
          relshift_193_195_213_231=0.0
        }
        xi_193_195_213_231 = (AC_z__mod__cdata[AC_n__mod__cdata-1]-(zbot_195_213_231-AC_z_cor__mod__energy)/2)/((zbot_195_213_231+AC_z_cor__mod__energy)/2+AC_tini__mod__cparam) - relshift_193_195_213_231
        xi_193_195_213_231 = max(xi_193_195_213_231,-1.0)
        xi_193_195_213_231 = min(xi_193_195_213_231, 1.0)
        cubic_step_pt_return_value_193_195_213_231 = 0.5 + xi_193_195_213_231*(0.75-xi_193_195_213_231*xi_193_195_213_231*0.25)
        prof_195_213_231 = cubic_step_pt_return_value_192_195_213_231  +cubic_step_pt_return_value_193_195_213_231
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_surface_pp_string__mod__cparam) {
        z_194_195_213_231 = abs((ac_transformed_pencil_pp-AC_ppcool__mod__energy)/AC_wcool__mod__energy)
        t_194_195_213_231 = 1.0 / ( 1.0 + 0.5 * z_194_195_213_231 )
        dumerfc_194_195_213_231 =  t_194_195_213_231 * exp(-z_194_195_213_231 * z_194_195_213_231 - 1.26551223 + t_194_195_213_231 *         ( 1.00002368 + t_194_195_213_231 * ( 0.37409196 + t_194_195_213_231 *            ( 0.09678418 + t_194_195_213_231 * (-0.18628806 + t_194_195_213_231 *            ( 0.27886807 + t_194_195_213_231 * (-1.13520398 + t_194_195_213_231 *            ( 1.48851587 + t_194_195_213_231 * (-0.82215223 + t_194_195_213_231 * 0.17087277 )))))))))
        if ((ac_transformed_pencil_pp-AC_ppcool__mod__energy)/AC_wcool__mod__energy<0.0) {
          dumerfc_194_195_213_231 = 2.0 - dumerfc_194_195_213_231
        }
        erfunc_return_value_194_195_213_231 = 1.0 - dumerfc_194_195_213_231
        prof_195_213_231=0.5*(1.-erfunc_return_value_194_195_213_231)
      }
      prof_195_213_231=AC_cool__mod__energy*prof_195_213_231
      prof2_195_213_231=AC_cool2__mod__energy*prof2_195_213_231
      if(AC_string_enum_cooltype__mod__energy == AC_string_enum_constant_string__mod__cparam || AC_string_enum_cooltype__mod__energy == AC_string_enum_plain_string__mod__cparam) {
        heat_213_231=heat_213_231-prof_195_213_231
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_corona_string__mod__cparam) {
        heat_213_231=heat_213_231-prof_195_213_231*ac_transformed_pencil_cv*ac_transformed_pencil_rho*(ac_transformed_pencil_tt-AC_tt_cor__mod__energy)
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_temp_string__mod__cparam) {
        heat_213_231=heat_213_231-(AC_cool__mod__energy*ac_transformed_pencil_cs2-(AC_cool__mod__energy*AC_cs20__mod__equationofstate-prof_195_213_231*AC_cs2cool__mod__energy))/AC_cs2cool__mod__energy
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_temp2_string__mod__cparam) {
        heat_213_231=heat_213_231-prof_195_213_231*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_rho_cs2_string__mod__cparam || AC_string_enum_cooltype__mod__energy == AC_string_enum_squarezwell_string__mod__cparam) {
        heat_213_231=heat_213_231-prof_195_213_231*ac_transformed_pencil_rho*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_twozlayer_string__mod__cparam) {
        heat_213_231 = heat_213_231 - prof_195_213_231*ac_transformed_pencil_rho*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy) - prof2_195_213_231*ac_transformed_pencil_rho*(ac_transformed_pencil_cs2-AC_cs2cool2__mod__energy)
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_twozlayerzmean_string__mod__cparam) {
        heat_213_231 = heat_213_231 - prof_195_213_231*ac_transformed_pencil_rho*(AC_cs2mz__mod__energy[AC_n__mod__cdata-1]-AC_cs2cool__mod__energy) - prof2_195_213_231*ac_transformed_pencil_rho*(AC_cs2mz__mod__energy[AC_n__mod__cdata-1]-AC_cs2cool2__mod__energy)
      }
      else {
      }
    }
    if (AC_lgravz__mod__cdata  &&  (!AC_lcooling_general__mod__energy)  &&   ( (AC_luminosity__mod__energy!=0.)  ||  (AC_cool__mod__energy!=0.)  ||  AC_lheat_cool_gravz__mod__energy ) ) {
      ztop_196_213_231=AC_xyz1__mod__cdata.z
      if (AC_luminosity__mod__energy!=0.) {
        heat_213_231 = AC_profz_heat__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
        if ((AC_ttransient__mod__cdata>0)  &&  (AC_t__mod__cdata<AC_ttransient__mod__cdata)) {
          heat_213_231 = heat_213_231 * AC_t__mod__cdata*(2*AC_ttransient__mod__cdata-AC_t__mod__cdata)/AC_ttransient__mod__cdata*AC_ttransient__mod__cdata
        }
      }
      if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_gaussian_string__mod__cparam) {
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_step_string__mod__cparam) {
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_step2_string__mod__cparam) {
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_cubic_step_string__mod__cparam) {
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_surfcool_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profz_cool__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_volheat_surfcool_string__mod__cparam) {
        heat_213_231 = heat_213_231 + AC_profz_cool__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1] + AC_profz1_cool__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]
      }
      else if(AC_string_enum_cooling_profile__mod__energy == AC_string_enum_linzz_string__mod__cparam) {
      }
      if (AC_lcalc_cs2mz_mean__mod__energy  && ! AC_lheat_cool_gravz__mod__energy) {
        heat_213_231 = heat_213_231 - AC_profz_cool__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]*(AC_cs2mz__mod__energy[AC_n__mod__cdata-1]-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
      }
      else {
        if (AC_lcooling_to_cs2cool__mod__energy) {
          heat_213_231 = heat_213_231 - AC_profz_cool__mod__energy[AC_n__mod__cdata-AC_NGHOST__mod__cparam-1]*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
        }
      }
    }
    if (AC_lgravr__mod__cdata  &&  (!AC_lspherical_coords__mod__cdata)  &&   (AC_luminosity__mod__energy!=0.  ||  AC_cool__mod__energy!=0.  ||  AC_cool_int__mod__energy!=0.  ||  AC_cool_ext__mod__energy!=0) ) {
      if(AC_string_enum_heattype__mod__energy == AC_string_enum_gaussian_string__mod__cparam || AC_string_enum_heattype__mod__energy == AC_string_enum_gaussian_string__mod__cparam) {
        if (AC_nzgrid__mod__cparam == 1) {
          prof_203_213_231 = exp(-0.5*(ac_transformed_pencil_r_mn/AC_wheat__mod__energy)*(ac_transformed_pencil_r_mn/AC_wheat__mod__energy)) * pow((2*AC_pi__mod__cparam*AC_wheat__mod__energy*AC_wheat__mod__energy),(-1.))
        }
        else {
          prof_203_213_231 = exp(-0.5*(ac_transformed_pencil_r_mn/AC_wheat__mod__energy)*(ac_transformed_pencil_r_mn/AC_wheat__mod__energy)) * pow((2*AC_pi__mod__cparam*AC_wheat__mod__energy*AC_wheat__mod__energy),(-1.5))
        }
      }
      else if(AC_string_enum_heattype__mod__energy == AC_string_enum_cs2zrho_string__mod__cparam) {
        prof_203_213_231 = pow((ac_transformed_pencil_rho/AC_rho0__mod__equationofstate),AC_nheat_rho__mod__energy)*pow((ac_transformed_pencil_cs2/AC_cs20__mod__equationofstate),AC_nheat_tt__mod__energy)
      }
      else {
      }
      heat_213_231 = AC_luminosity__mod__energy*prof_203_213_231
      if (AC_lcylindrical_coords__mod__cdata) {
        step_vector_return_value_197_203_213_231 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_rcool__mod__energy)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
        prof_203_213_231 = step_vector_return_value_197_203_213_231
      }
      else {
        step_vector_return_value_198_203_213_231 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_rcool__mod__energy)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
        prof_203_213_231 = step_vector_return_value_198_203_213_231
      }
      if(AC_string_enum_cooltype__mod__energy == AC_string_enum_cs2_string__mod__cparam || AC_string_enum_cooltype__mod__energy == AC_string_enum_temp_string__mod__cparam) {
        div_cool_203_213_231 = - AC_cool__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
        heat_213_231 = heat_213_231 + div_cool_203_213_231
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_cs2zrho_string__mod__cparam || AC_string_enum_cooltype__mod__energy == AC_string_enum_tempzrho_string__mod__cparam) {
        div_cool_203_213_231 = - AC_cool__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy/ac_transformed_pencil_rho1
        heat_213_231 = heat_213_231 + div_cool_203_213_231
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_entropy_string__mod__cparam) {
        div_cool_203_213_231 =  - AC_cool__mod__energy*prof_203_213_231*(ac_transformed_pencil_ss-0.)
        heat_213_231 = heat_213_231 + div_cool_203_213_231
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_pressure_string__mod__cparam) {
        prof_203_213_231= 0.5*(1.-tanh((ac_transformed_pencil_pp-AC_ppcool__mod__energy)/AC_wpres__mod__energy))
        div_cool_203_213_231 = - AC_cool__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy/ac_transformed_pencil_rho1
        heat_213_231 = heat_213_231 + div_cool_203_213_231
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell_string__mod__cparam) {
        if (AC_deltat_poleq__mod__energy!=0.) {
          theta_profile_203_213_231=(AC_onethird__mod__cparam-(ac_transformed_pencil_rcyl_mn/ac_transformed_pencil_z_mn)*(ac_transformed_pencil_rcyl_mn/ac_transformed_pencil_z_mn))*AC_deltat_poleq__mod__energy
          step_vector_return_value_199_203_213_231 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_r_ext__mod__cdata)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
          prof_203_213_231 = step_vector_return_value_199_203_213_231
          div_cool_203_213_231 = - AC_cool_ext__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2_ext__mod__energy)/AC_cs2_ext__mod__energy*theta_profile_203_213_231
          heat_213_231 = heat_213_231 + div_cool_203_213_231
          step_vector_return_value_200_203_213_231 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_r_int__mod__cdata)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
          prof_203_213_231 = 1. - step_vector_return_value_200_203_213_231
          heat_213_231 = heat_213_231         - AC_cool_int__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2_int__mod__energy)/AC_cs2_int__mod__energy*theta_profile_203_213_231
          div_cool_203_213_231 = div_cool_203_213_231 - AC_cool_int__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2_int__mod__energy)/AC_cs2_int__mod__energy*theta_profile_203_213_231
        }
        else {
          step_vector_return_value_201_203_213_231 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_r_ext__mod__cdata)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
          prof_203_213_231 = step_vector_return_value_201_203_213_231
          div_cool_203_213_231 = - AC_cool_ext__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2_ext__mod__energy)/AC_cs2_ext__mod__energy
          heat_213_231 = heat_213_231 + div_cool_203_213_231
          step_vector_return_value_202_203_213_231 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_r_int__mod__cdata)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
          prof_203_213_231 = 1. - step_vector_return_value_202_203_213_231
          heat_213_231 = heat_213_231         - AC_cool_int__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2_int__mod__energy)/AC_cs2_int__mod__energy
          div_cool_203_213_231 = div_cool_203_213_231 - AC_cool_int__mod__energy*prof_203_213_231*(ac_transformed_pencil_cs2-AC_cs2_int__mod__energy)/AC_cs2_int__mod__energy
        }
      }
      else {
      }
    }
    if (AC_lgravx__mod__cdata  &&  AC_lspherical_coords__mod__cdata  &&  (!AC_lcooling_general__mod__energy)  &&   (AC_luminosity__mod__energy!=0.  ||  AC_cool__mod__energy!=0.)) {
      heat_213_231 = AC_profr_heat__mod__energy[vertexIdx.x-NGHOST_VAL]
      if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell2_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy-AC_cool2__mod__energy*AC_profr2_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool2__mod__energy)/AC_cs2cool2__mod__energy
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell3_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_profr2_cool__mod__energy[vertexIdx.x-NGHOST_VAL])/AC_profr2_cool__mod__energy[vertexIdx.x-NGHOST_VAL]
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell_mean_yz_string__mod__cparam) {
        if (AC_lcalc_cs2mean__mod__energy) {
          heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(AC_cs2mx__mod__energy[vertexIdx.x-NGHOST_VAL]-AC_cs2cool_x__mod__energy[vertexIdx.x-NGHOST_VAL])
        }
        else {
          heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool_x__mod__energy[vertexIdx.x-NGHOST_VAL])
        }
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell_mean_yz2_string__mod__cparam) {
        cs2_tmp_204_213_231=ac_transformed_pencil_cs2-AC_cs2cool_x__mod__energy[vertexIdx.x-NGHOST_VAL]
        if (cs2_tmp_204_213_231 < 0.) {
          cs2_tmp_204_213_231=0.
        }
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool_x__mod__energy[vertexIdx.x-NGHOST_VAL])
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shell_mean_downflow_string__mod__cparam) {
        cs2_tmp_204_213_231=ac_transformed_pencil_cs2-AC_cs2cool_x__mod__energy[vertexIdx.x-NGHOST_VAL]
        if (ac_transformed_pencil_uu.x > 0.) {
          fac_tmp_204_213_231=0.
        }
        else {
          fac_tmp_204_213_231=1.
        }
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*fac_tmp_204_213_231*(ac_transformed_pencil_cs2-AC_downflow_cs2cool_fac__mod__energy*AC_cs2cool_x__mod__energy[vertexIdx.x-NGHOST_VAL])
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_latheat_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(AC_cs2mxy__mod__energy[vertexIdx.x][vertexIdx.y]-AC_profr1_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*AC_cs2mx__mod__energy[vertexIdx.x-NGHOST_VAL])
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shellzlatheat_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(AC_cs2mxy__mod__energy[vertexIdx.x][vertexIdx.y]-AC_profr1_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*AC_cs2mx__mod__energy[vertexIdx.x-NGHOST_VAL])
        heat_213_231 = heat_213_231 - AC_cool__mod__energy*AC_profr2_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
      }
      else if(AC_string_enum_cooltype__mod__energy == AC_string_enum_shellzlatss_string__mod__cparam) {
        heat_213_231 = heat_213_231 - AC_profr_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(AC_ssmxy__mod__energy[vertexIdx.x][vertexIdx.y]-AC_profr1_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*AC_ssmx__mod__energy[vertexIdx.x+NGHOST_VAL])
        heat_213_231 = heat_213_231 - AC_cool__mod__energy*AC_profr2_cool__mod__energy[vertexIdx.x-NGHOST_VAL]*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
      }
    }
    if (AC_lconvection_gravx__mod__energy) {
      heat_213_231 = AC_profx_heat__mod__energy[vertexIdx.x-NGHOST_VAL]
      if(AC_string_enum_cooltype__mod__energy == AC_string_enum_top_layer_string__mod__cparam) {
        step_vector_return_value_205_206_213_231 = 0.5*(1+tanh((AC_x__mod__cdata[vertexIdx.x]-AC_rcool__mod__energy)/(AC_wcool__mod__energy+AC_tini__mod__cparam)))
        prof_206_213_231 = step_vector_return_value_205_206_213_231
        heat_213_231 = heat_213_231 - AC_cool__mod__energy*prof_206_213_231*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_cs2cool__mod__energy
      }
      else {
      }
    }
    if (AC_heat_gaussianz__mod__energy!=0.0) {
      heat_213_231=heat_213_231+AC_heat_gaussianz__mod__energy*exp(-0.5*AC_z__mod__cdata[AC_n__mod__cdata-1]*AC_z__mod__cdata[AC_n__mod__cdata-1]/AC_heat_gaussianz_sigma__mod__energy*AC_heat_gaussianz_sigma__mod__energy)/(sqrt(2*AC_pi__mod__cparam)*AC_heat_gaussianz_sigma__mod__energy)
    }
    if (AC_heat_gaussianblob__mod__energy!=0.0) {
      tmp_213_231 =  (AC_x__mod__cdata[vertexIdx.x]-AC_heat_gaussianblob_r0__mod__energy.x)*(AC_x__mod__cdata[vertexIdx.x]-AC_heat_gaussianblob_r0__mod__energy.x) + (AC_y__mod__cdata[AC_m__mod__cdata-1]-AC_heat_gaussianblob_r0__mod__energy.y)*(AC_y__mod__cdata[AC_m__mod__cdata-1]-AC_heat_gaussianblob_r0__mod__energy.y)  + (AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_heat_gaussianblob_r0__mod__energy.z)*(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_heat_gaussianblob_r0__mod__energy.z)
      heat_213_231=heat_213_231+AC_heat_gaussianblob__mod__energy*exp(-0.5*tmp_213_231/AC_heat_gaussianblob_sigma__mod__energy*AC_heat_gaussianblob_sigma__mod__energy)/  (sqrt(2*AC_pi__mod__cparam)*AC_heat_gaussianblob_sigma__mod__energy)*(sqrt(2*AC_pi__mod__cparam)*AC_heat_gaussianblob_sigma__mod__energy)*(sqrt(2*AC_pi__mod__cparam)*AC_heat_gaussianblob_sigma__mod__energy)
    }
    if (AC_heat_uniform__mod__energy!=0.0) {
      if (AC_zheat_uniform_range__mod__energy!=0.) {
        if (abs(AC_z__mod__cdata[AC_n__mod__cdata-1]) <= AC_zheat_uniform_range__mod__energy) {
          heat_213_231=heat_213_231+AC_heat_uniform__mod__energy
        }
      }
      else {
        heat_213_231=heat_213_231+AC_heat_uniform__mod__energy
      }
    }
    if (AC_cool_uniform__mod__energy!=0.0) {
      heat_213_231=heat_213_231-AC_cool_uniform__mod__energy*ac_transformed_pencil_rho*ac_transformed_pencil_cp*ac_transformed_pencil_tt
    }
    if (AC_cool_newton__mod__energy!=0.0) {
      if (AC_lchromospheric_cooling__mod__energy) {
        rgas_213_231=(1.0-AC_gamma1__mod__energy)/AC_cp1__mod__energy
        xi_213_231=(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_z_cor__mod__energy)/(AC_xyz1__mod__cdata.z-AC_z_cor__mod__energy)
        profile_buffer_213_231=xi_213_231*xi_213_231*(3-2*xi_213_231)
        tt_drive_213_231=(AC_cs0__mod__equationofstate*AC_cs0__mod__equationofstate*(exp(ac_transformed_pencil_cv1*ac_transformed_pencil_initss + AC_gamma_m1__mod__energy*(ac_transformed_pencil_initlnrho-AC_lnrho0__mod__equationofstate))))/(AC_gamma__mod__energy*rgas_213_231)
        if (AC_z__mod__cdata[AC_n__mod__cdata-1]>-1.0) {
          heat_213_231=heat_213_231-AC_cool_newton__mod__energy*ac_transformed_pencil_cp*ac_transformed_pencil_rho*profile_buffer_213_231*(ac_transformed_pencil_tt-tt_drive_213_231)
        }
      }
      else {
        heat_213_231=heat_213_231-AC_cool_newton__mod__energy*ac_transformed_pencil_tt*ac_transformed_pencil_tt*ac_transformed_pencil_tt*ac_transformed_pencil_tt
      }
    }
    if (AC_tau_cool__mod__energy!=0.0) {
      if (!AC_ltau_cool_variable__mod__energy) {
        if (AC_lphotoelectric_heating__mod__energy) {
          tt_drive_213_231=AC_ttref_cool__mod__energy*ac_transformed_pencil_rhop
        }
        else {
          tt_drive_213_231=AC_ttref_cool__mod__energy
        }
        if (AC_tt_floor__mod__energy != AC_impossible__mod__cparam) {
          if(tt_drive_213_231 < AC_tt_floor__mod__energy) {
            tt_drive_213_231=AC_tt_floor__mod__energy
          }
        }
        heat_213_231=heat_213_231-ac_transformed_pencil_rho*ac_transformed_pencil_cv*(ac_transformed_pencil_tt-tt_drive_213_231)/AC_tau_cool__mod__energy
      }
      else {
        rr1_211_213_231=ac_transformed_pencil_rcyl_mn1
        oo_211_213_231=pow(rr1_211_213_231,1.5)
        if (AC_lphotoelectric_heating__mod__energy) {
          tt_drive_211_213_231=AC_ttref_cool__mod__energy*pow(rr1_211_213_231,AC_tt_powerlaw__mod__energy)*ac_transformed_pencil_rhop*AC_rho01__mod__energy
        }
        else {
          tt_drive_211_213_231=AC_ttref_cool__mod__energy*pow(rr1_211_213_231,AC_tt_powerlaw__mod__energy)
        }
        if (AC_tt_floor__mod__energy != AC_impossible__mod__cparam) {
          if(tt_drive_211_213_231 < AC_tt_floor__mod__energy) {
            tt_drive_211_213_231=AC_tt_floor__mod__energy
          }
        }
        if (AC_lborder_heat_variable__mod__energy) {
          if (true) {
            relshift_209_211_213_231=1.
          }
          else {
            relshift_209_211_213_231=0.0
          }
          xi_209_211_213_231 = (AC_x__mod__cdata[vertexIdx.x]-AC_r_int__mod__cdata)/(AC_widthss__mod__energy+AC_tini__mod__cparam) - relshift_209_211_213_231
          xi_209_211_213_231 = max(xi_209_211_213_231,-1.0)
          xi_209_211_213_231 = min(xi_209_211_213_231, 1.0)
          quintic_step_mn_return_value_209_211_213_231 = 0.5 + xi_209_211_213_231*(0.9375 + xi_209_211_213_231*xi_209_211_213_231*(-0.625 + xi_209_211_213_231*xi_209_211_213_231*0.1875))
          if (true) {
            relshift_210_211_213_231=-1.
          }
          else {
            relshift_210_211_213_231=0.0
          }
          xi_210_211_213_231 = (AC_x__mod__cdata[vertexIdx.x]-AC_r_ext__mod__cdata)/(AC_widthss__mod__energy+AC_tini__mod__cparam) - relshift_210_211_213_231
          xi_210_211_213_231 = max(xi_210_211_213_231,-1.0)
          xi_210_211_213_231 = min(xi_210_211_213_231, 1.0)
          quintic_step_mn_return_value_210_211_213_231 = 0.5 + xi_210_211_213_231*(0.9375 + xi_210_211_213_231*xi_210_211_213_231*(-0.625 + xi_210_211_213_231*xi_210_211_213_231*0.1875))
          pborder_211_213_231=quintic_step_mn_return_value_209_211_213_231 -  quintic_step_mn_return_value_210_211_213_231
        }
        else {
          pborder_211_213_231=1.
        }
        heat_213_231=heat_213_231-ac_transformed_pencil_rho*ac_transformed_pencil_cv*(ac_transformed_pencil_tt-tt_drive_211_213_231)*AC_tau1_cool__mod__energy*oo_211_213_231*pborder_211_213_231
      }
    }
    if (AC_lphotoelectric_heating_radius__mod__energy) {
      if (AC_lcylindrical_coords__mod__cdata  &&  AC_nzgrid__mod__cparam==1) {
        heat_213_231=heat_213_231+AC_peh_factor__mod__energy*ac_transformed_pencil_peh*AC_dx_1__mod__cdata[vertexIdx.x]*AC_dy_1__mod__cdata[AC_m__mod__cdata-1]/ac_transformed_pencil_r_mn
      }
    }
    if (AC_tau_cool2__mod__energy!=0.0) {
      if (AC_lcalc_cs2mz_mean__mod__energy) {
        heat_213_231=heat_213_231-ac_transformed_pencil_rho*(AC_cs2mz__mod__energy[AC_n__mod__cdata-1]-AC_cs2cool__mod__energy)/AC_tau_cool2__mod__energy
      }
      else {
        heat_213_231=heat_213_231-ac_transformed_pencil_rho*(ac_transformed_pencil_cs2-AC_cs2cool__mod__energy)/AC_tau_cool2__mod__energy
      }
    }
    if (AC_tau_cor__mod__energy>0) {
      ztop_212_213_231=AC_xyz0__mod__cdata.z+AC_lxyz__mod__cdata.z
      if (AC_z__mod__cdata[AC_n__mod__cdata-1]>=AC_z_cor__mod__energy) {
        xi_212_213_231=(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_z_cor__mod__energy)/(ztop_212_213_231-AC_z_cor__mod__energy)
        profile_cor_212_213_231=xi_212_213_231*xi_212_213_231*(3-2*xi_212_213_231)
        if (AC_lcalc_cs2mz_mean__mod__energy) {
          heat_213_231=heat_213_231+profile_cor_212_213_231*(AC_tt_cor__mod__energy-AC_cs2mz__mod__energy[AC_n__mod__cdata-1]/AC_gamma_m1__mod__energy*ac_transformed_pencil_cp1)/(ac_transformed_pencil_rho1*AC_tau_cor__mod__energy*ac_transformed_pencil_cp1)
        }
        else {
          heat_213_231=heat_213_231+profile_cor_212_213_231*(AC_tt_cor__mod__energy-1/ac_transformed_pencil_tt1)/(ac_transformed_pencil_rho1*AC_tau_cor__mod__energy*ac_transformed_pencil_cp1)
        }
      }
    }
    if (AC_tauheat_buffer__mod__energy!=0.) {
      profile_buffer_213_231=0.5*(1.+tanh(AC_dheat_buffer1__mod__energy*(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_zheat_buffer__mod__energy)))
      heat_213_231=heat_213_231+profile_buffer_213_231*ac_transformed_pencil_ss*(AC_ttheat_buffer__mod__energy-1/ac_transformed_pencil_tt1)/(ac_transformed_pencil_rho1*AC_tauheat_buffer__mod__energy)
    }
    if (AC_limpose_heat_ceiling__mod__energy) {
      if(heat_213_231>AC_heat_ceiling__mod__energy) {
        heat_213_231=AC_heat_ceiling__mod__energy
      }
    }
    DF_SS = DF_SS + ac_transformed_pencil_tt1*ac_transformed_pencil_rho1*heat_213_231
    if (AC_ldt__mod__cdata) {
      if (AC_lfirst__mod__cdata) {
        hmax__mod__energy=hmax__mod__energy+heat_213_231*ac_transformed_pencil_rho1
      }
    }
    else {
      if (AC_ldiagnos__mod__cdata) {
        hmax__mod__energy=hmax__mod__energy+heat_213_231*ac_transformed_pencil_rho1
      }
    }
    if (AC_tau_cool_ss__mod__energy!=0.) {
      if (AC_lcalc_ss_volaverage__mod__energy) {
        DF_SS=DF_SS-(AC_ss_volaverage__mod__energy[1-1]-AC_ss_const__mod__energy)/AC_tau_cool_ss__mod__energy
      }
      else if (AC_lcooling_ss_mz__mod__cdata) {
        DF_SS=DF_SS-(ac_transformed_pencil_ss-AC_ss_mz__mod__energy[AC_n__mod__cdata-1])/AC_tau_cool_ss__mod__energy
      }
      else {
        DF_SS=DF_SS-(ac_transformed_pencil_ss-AC_ss_const__mod__energy)/AC_tau_cool_ss__mod__energy
      }
    }
    if (AC_tau_relax_ss__mod__energy!=0.) {
      prof_213_231=cos(AC_kz_ss__mod__energy*AC_z__mod__cdata[AC_n__mod__cdata-1])
      if (AC_lcalc_ssmean__mod__energy) {
        DF_SS=DF_SS-(AC_ssmz__mod__energy[AC_n__mod__cdata-1]-AC_ss_const__mod__energy-AC_ampl_imp_ss__mod__energy*prof_213_231)/AC_tau_relax_ss__mod__energy
      }
      else {
        DF_SS=DF_SS-(ac_transformed_pencil_ss-AC_ss_const__mod__energy-AC_ampl_imp_ss__mod__energy*prof_213_231)/AC_tau_relax_ss__mod__energy
      }
    }
  }
  if (AC_tdown__mod__energy!=0.0) {
    if (AC_z__mod__cdata[AC_n__mod__cdata-1] < AC_prof_z__mod__energy[1-1] ) {
      lnttor_214_231 = AC_prof_lnt__mod__energy[1-1]
    }
    else if (AC_z__mod__cdata[AC_n__mod__cdata-1] >= AC_prof_z__mod__energy[AC_prof_nz__mod__energy-1]) {
      lnttor_214_231 = AC_prof_lnt__mod__energy[AC_prof_nz__mod__energy-1]
    }
    else {
      for i_214_231 in 1:AC_prof_nz__mod__energy-1+1 {
        if (AC_z__mod__cdata[AC_n__mod__cdata-1] >= AC_prof_z__mod__energy[i_214_231-1]  &&  AC_z__mod__cdata[AC_n__mod__cdata-1] < AC_prof_z__mod__energy[1+i_214_231-1]) {
          lnttor_214_231 = (AC_prof_lnt__mod__energy[i_214_231-1]*(AC_prof_z__mod__energy[1+i_214_231-1] - AC_z__mod__cdata[AC_n__mod__cdata-1]) +  AC_prof_lnt__mod__energy[1+i_214_231-1]*(AC_z__mod__cdata[AC_n__mod__cdata-1] - AC_prof_z__mod__energy[i_214_231-1]) ) / (AC_prof_z__mod__energy[1+i_214_231-1]-AC_prof_z__mod__energy[i_214_231-1])
          break
        }
      }
    }
    if (AC_dt__mod__cdata!=0.0)  {
      newton_214_231 = AC_tdown__mod__energy/AC_gamma__mod__energy/AC_dt__mod__cdata*((lnttor_214_231 - ac_transformed_pencil_lntt) )
      newton_214_231 = newton_214_231 * exp(AC_allp__mod__energy*(-abs(ac_transformed_pencil_lnrho-AC_lnrho0__mod__equationofstate)))
      DF_SS = DF_SS + newton_214_231
    }
  }
  if (AC_cool_rtv__mod__energy!=0.0) {
    unit_lnq_215_231=3*log(AC_unit_velocity__mod__cdata)+5*log(AC_unit_length__mod__cdata)+log(AC_unit_density__mod__cdata)
    if (AC_string_enum_unit_system__mod__cdata == AC_string_enum_cgs_string__mod__cparam) {
      unit_lnq_215_231 = unit_lnq_215_231+log(1.e13)
    }
    lntt_si_215_231 = ac_transformed_pencil_lntt + log(AC_unit_temperature__mod__cdata)
    lnneni_215_231 = 2*ac_transformed_pencil_lnrho + log(1.2) - 2*log(1.4*AC_m_p__mod__cdata)
    rtv_cool_215_231=0.
    if(AC_cool_type__mod__energy == 1) {
      imax_215_231 = 10
      lnq_215_231=0.0
      for i_215_231 in 1:imax_215_231-1+1 {
        if (( intlnt_1_215_231[i_215_231-1] <= lntt_si_215_231  ||  i_215_231==1 )  &&  lntt_si_215_231 < intlnt_1_215_231[1+i_215_231-1] ) {
          lnq_215_231=lnq_215_231 + lnh_1_215_231[i_215_231-1] + b_1_215_231[i_215_231-1]*lntt_si_215_231
        }
      }
      if (lntt_si_215_231 >= intlnt_1_215_231[imax_215_231-1] ) {
        lnq_215_231 = lnq_215_231 + lnh_1_215_231[imax_215_231-1-1] + b_1_215_231[imax_215_231-1-1]*intlnt_1_215_231[imax_215_231-1]
      }
      if (AC_pres_cutoff__mod__energy!=AC_impossible__mod__cparam) {
        rtv_cool_215_231=exp(lnneni_215_231+lnq_215_231-unit_lnq_215_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)*exp(-ac_transformed_pencil_rho*ac_transformed_pencil_cs2*AC_gamma1__mod__energy/AC_pres_cutoff__mod__energy)
      }
      else {
        rtv_cool_215_231=exp(lnneni_215_231+lnq_215_231-unit_lnq_215_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)
      }
    }
    else if(AC_cool_type__mod__energy == 2) {
      imax_215_231 = 7
      lnq_215_231=0.0
      for i_215_231 in 1:imax_215_231-1+1 {
        if (( intlnt_2_215_231[i_215_231-1] <= lntt_si_215_231  ||  i_215_231==1 )  &&  lntt_si_215_231 < intlnt_2_215_231[1+i_215_231-1] ) {
          lnq_215_231=lnq_215_231 + lnh_2_215_231[i_215_231-1] + b_2_215_231[i_215_231-1]*lntt_si_215_231
        }
      }
      if (lntt_si_215_231 >= intlnt_2_215_231[imax_215_231-1] ) {
        lnq_215_231 = lnq_215_231 + lnh_2_215_231[imax_215_231-1-1] + b_2_215_231[imax_215_231-1-1]*intlnt_2_215_231[imax_215_231-1]
      }
      if (AC_pres_cutoff__mod__energy!=AC_impossible__mod__cparam) {
        rtv_cool_215_231=exp(lnneni_215_231+lnq_215_231-unit_lnq_215_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)*exp(-ac_transformed_pencil_rho*ac_transformed_pencil_cs2*AC_gamma1__mod__energy/AC_pres_cutoff__mod__energy)
      }
      else {
        rtv_cool_215_231=exp(lnneni_215_231+lnq_215_231-unit_lnq_215_231-ac_transformed_pencil_lntt-ac_transformed_pencil_lnrho)
      }
    }
    else if(AC_cool_type__mod__energy == 3) {
    }
    else {
      rtv_cool_215_231=0.
    }
    rtv_cool_215_231=rtv_cool_215_231 * AC_cool_rtv__mod__energy
    DF_SS = DF_SS-rtv_cool_215_231
  }
  if (AC_lprestellar_cool_iso__mod__energy) {
    if (AC_ldensity_nolog__mod__cdata) {
      if (AC_lreference_state__mod__cdata) {
        if(AC_irho_ss__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_irho_ss__mod__equationofstate) {
          if (AC_lstratz__mod__cdata) {
          }
          else if (AC_irho_ss__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate) {
            lnrho__216_219_231 = value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
          }
          else {
            lnrho__216_219_231 = log(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
          }
          if (AC_pretend_lntt__mod__cdata) {
            lntt__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
            if (false) {
              ss__216_219_231=AC_cv__mod__equationofstate*(lntt__216_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
            }
          }
          else {
            ss__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
            lntt__216_219_231=AC_lntt0__mod__equationofstate+AC_cv1__mod__equationofstate*ss__216_219_231+AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate)
          }
          ee__216_219_231=AC_cv__mod__equationofstate*exp(lntt__216_219_231)
          if (true) {
            pp__216_219_231=(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*exp(lntt__216_219_231+lnrho__216_219_231)
          }
          if (false) {
            cs2__216_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__216_219_231
          }
          cs2__216_219_231=AC_cs20__mod__equationofstate*AC_cv1__mod__equationofstate*ee__216_219_231
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_ee__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_irho_ee__mod__equationofstate) {
          ee__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
          if (AC_irho_ss__mod__equationofstate==AC_ilnrho_ee__mod__equationofstate) {
            lnrho__216_219_231=value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
            pp__216_219_231=AC_gamma_m1__mod__equationofstate*ee__216_219_231*exp(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
          }
          else {
            lnrho__216_219_231=log(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
            pp__216_219_231=AC_gamma_m1__mod__equationofstate*ee__216_219_231*value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
          }
          lntt__216_219_231=log(AC_cv1__mod__equationofstate*ee__216_219_231)
          if (false) {
            ss__216_219_231=AC_cv__mod__equationofstate*(lntt__216_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
          }
          if (false) {
            cs2__216_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__216_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_pp__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_irho_pp__mod__equationofstate) {
          pp__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
          if (AC_irho_ss__mod__equationofstate==AC_ilnrho_pp__mod__equationofstate) {
            lnrho__216_219_231=value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
            ee__216_219_231=pp__216_219_231*exp(-lnrho__216_219_231)/AC_gamma_m1__mod__equationofstate
            if (false) {
              ss__216_219_231=AC_cv__mod__equationofstate*(log(pp__216_219_231*exp(-lnrho__216_219_231)*AC_gamma__mod__equationofstate/AC_cs20__mod__equationofstate)-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
            }
          }
          else {
            lnrho__216_219_231=log(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
            ee__216_219_231=pp__216_219_231/value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]/AC_gamma_m1__mod__equationofstate
            if (false) {
              ss__216_219_231=AC_cv__mod__equationofstate*(log(pp__216_219_231/value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]*AC_gamma__mod__equationofstate/AC_cs20__mod__equationofstate)-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
            }
          }
          if (false) {
            lntt__216_219_231=log(AC_cv1__mod__equationofstate*ee__216_219_231)
          }
          if (false) {
            cs2__216_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__216_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_lntt__mod__equationofstate) {
          lnrho__216_219_231=value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
          lntt__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
          if (false) {
            ss__216_219_231=AC_cv__mod__equationofstate*(lntt__216_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__216_219_231=AC_cv__mod__equationofstate*exp(lntt__216_219_231)
          if (true) {
            pp__216_219_231=ee__216_219_231*exp(lnrho__216_219_231)*AC_gamma_m1__mod__equationofstate
          }
          if (false) {
            cs2__216_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__216_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_tt__mod__equationofstate) {
          lnrho__216_219_231=value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
          tt__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
          if (false) {
            ss__216_219_231=AC_cv__mod__equationofstate*(log(tt__216_219_231)-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__216_219_231=AC_cv__mod__equationofstate*tt__216_219_231
          if (true) {
            pp__216_219_231=ee__216_219_231*exp(lnrho__216_219_231)*AC_gamma_m1__mod__equationofstate
          }
          if (false) {
            cs2__216_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__216_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_irho_tt__mod__equationofstate) {
          lnrho__216_219_231=log(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
          tt__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
          if (false) {
            ss__216_219_231=AC_cv__mod__equationofstate*(log(tt__216_219_231)-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__216_219_231=AC_cv__mod__equationofstate*tt__216_219_231
          if (true) {
            pp__216_219_231=ee__216_219_231*value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]*AC_gamma_m1__mod__equationofstate
          }
          if (false) {
            cs2__216_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__216_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ipp_ss__mod__equationofstate) {
          pp__216_219_231=value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
          if (AC_pretend_lntt__mod__cdata) {
            lntt__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
            lnrho__216_219_231=log(pp__216_219_231)-lntt__216_219_231-log(AC_gamma_m1__mod__equationofstate*AC_cv__mod__equationofstate)
            if (false) {
              ss__216_219_231=AC_cv__mod__equationofstate*(lntt__216_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__216_219_231-AC_lnrho0__mod__equationofstate))
            }
            ee__216_219_231=AC_cv__mod__equationofstate*exp(lntt__216_219_231)
            if (false) {
              cs2__216_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__216_219_231
            }
          }
          else {
            ss__216_219_231=value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
            lnrho__216_219_231=log(pp__216_219_231)/AC_gamma__mod__equationofstate-ss__216_219_231/AC_cp__mod__equationofstate
            tt__216_219_231=pp__216_219_231/(AC_gamma_m1__mod__equationofstate*AC_cv__mod__equationofstate*exp(lnrho__216_219_231))
            if (false) {
              cs2__216_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__216_219_231
            }
            if (false) {
              ee__216_219_231=AC_cv__mod__equationofstate*tt__216_219_231
            }
            if (false) {
              lntt__216_219_231=log(tt__216_219_231)
            }
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_irho_eth__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_ilnrho_eth__mod__equationofstate) {
          if (AC_lstratz__mod__cdata) {
          }
          else {
            if (AC_ldensity_nolog__mod__cdata) {
              rho_216_219_231 = value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
              if (false) {
                lnrho__216_219_231 = log(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
              }
            }
            else {
              rho_216_219_231 = exp(value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1])
              if (false) {
                lnrho__216_219_231 = value(Field(AC_irho__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]
              }
            }
            eth_216_219_231 = value(Field(AC_iss__mod__cdata-1))+AC_reference_state__mod__density[vertexIdx.x][AC_iref_s__mod__cparam-1]
          }
          if (false || false) {
            lntt__216_219_231 = log(AC_cv1__mod__equationofstate * eth_216_219_231 / rho_216_219_231)
          }
          if (false) {
            ee__216_219_231 = eth_216_219_231 / rho_216_219_231
          }
          if (true) {
            pp__216_219_231 = AC_gamma_m1__mod__equationofstate * eth_216_219_231
          }
          if (false) {
            cs2__216_219_231 = AC_gamma__mod__equationofstate * AC_gamma_m1__mod__equationofstate * eth_216_219_231 / rho_216_219_231
          }
        }
        else {
        }
        if (true) {
          pp_219_231=pp__216_219_231
        }
      }
      else {
        if(AC_irho_ss__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_irho_ss__mod__equationofstate) {
          if (AC_lstratz__mod__cdata) {
          }
          else if (AC_irho_ss__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate) {
            lnrho__217_219_231 = value(Field(AC_irho__mod__cdata-1))
          }
          else {
            lnrho__217_219_231 = log(value(Field(AC_irho__mod__cdata-1)))
          }
          if (AC_pretend_lntt__mod__cdata) {
            lntt__217_219_231=value(Field(AC_iss__mod__cdata-1))
            if (false) {
              ss__217_219_231=AC_cv__mod__equationofstate*(lntt__217_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
            }
          }
          else {
            ss__217_219_231=value(Field(AC_iss__mod__cdata-1))
            lntt__217_219_231=AC_lntt0__mod__equationofstate+AC_cv1__mod__equationofstate*ss__217_219_231+AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate)
          }
          ee__217_219_231=AC_cv__mod__equationofstate*exp(lntt__217_219_231)
          if (true) {
            pp__217_219_231=(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*exp(lntt__217_219_231+lnrho__217_219_231)
          }
          if (false) {
            cs2__217_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__217_219_231
          }
          cs2__217_219_231=AC_cs20__mod__equationofstate*AC_cv1__mod__equationofstate*ee__217_219_231
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_ee__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_irho_ee__mod__equationofstate) {
          ee__217_219_231=value(Field(AC_iss__mod__cdata-1))
          if (AC_irho_ss__mod__equationofstate==AC_ilnrho_ee__mod__equationofstate) {
            lnrho__217_219_231=value(Field(AC_irho__mod__cdata-1))
            pp__217_219_231=AC_gamma_m1__mod__equationofstate*ee__217_219_231*exp(value(Field(AC_irho__mod__cdata-1)))
          }
          else {
            lnrho__217_219_231=log(value(Field(AC_irho__mod__cdata-1)))
            pp__217_219_231=AC_gamma_m1__mod__equationofstate*ee__217_219_231*value(Field(AC_irho__mod__cdata-1))
          }
          lntt__217_219_231=log(AC_cv1__mod__equationofstate*ee__217_219_231)
          if (false) {
            ss__217_219_231=AC_cv__mod__equationofstate*(lntt__217_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
          }
          if (false) {
            cs2__217_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__217_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_pp__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_irho_pp__mod__equationofstate) {
          pp__217_219_231=value(Field(AC_iss__mod__cdata-1))
          if (AC_irho_ss__mod__equationofstate==AC_ilnrho_pp__mod__equationofstate) {
            lnrho__217_219_231=value(Field(AC_irho__mod__cdata-1))
            ee__217_219_231=pp__217_219_231*exp(-lnrho__217_219_231)/AC_gamma_m1__mod__equationofstate
            if (false) {
              ss__217_219_231=AC_cv__mod__equationofstate*(log(pp__217_219_231*exp(-lnrho__217_219_231)*AC_gamma__mod__equationofstate/AC_cs20__mod__equationofstate)-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
            }
          }
          else {
            lnrho__217_219_231=log(value(Field(AC_irho__mod__cdata-1)))
            ee__217_219_231=pp__217_219_231/value(Field(AC_irho__mod__cdata-1))/AC_gamma_m1__mod__equationofstate
            if (false) {
              ss__217_219_231=AC_cv__mod__equationofstate*(log(pp__217_219_231/value(Field(AC_irho__mod__cdata-1))*AC_gamma__mod__equationofstate/AC_cs20__mod__equationofstate)-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
            }
          }
          if (false) {
            lntt__217_219_231=log(AC_cv1__mod__equationofstate*ee__217_219_231)
          }
          if (false) {
            cs2__217_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__217_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_lntt__mod__equationofstate) {
          lnrho__217_219_231=value(Field(AC_irho__mod__cdata-1))
          lntt__217_219_231=value(Field(AC_iss__mod__cdata-1))
          if (false) {
            ss__217_219_231=AC_cv__mod__equationofstate*(lntt__217_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__217_219_231=AC_cv__mod__equationofstate*exp(lntt__217_219_231)
          if (true) {
            pp__217_219_231=ee__217_219_231*exp(lnrho__217_219_231)*AC_gamma_m1__mod__equationofstate
          }
          if (false) {
            cs2__217_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__217_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ilnrho_tt__mod__equationofstate) {
          lnrho__217_219_231=value(Field(AC_irho__mod__cdata-1))
          tt__217_219_231=value(Field(AC_iss__mod__cdata-1))
          if (false) {
            ss__217_219_231=AC_cv__mod__equationofstate*(log(tt__217_219_231)-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__217_219_231=AC_cv__mod__equationofstate*tt__217_219_231
          if (true) {
            pp__217_219_231=ee__217_219_231*exp(lnrho__217_219_231)*AC_gamma_m1__mod__equationofstate
          }
          if (false) {
            cs2__217_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__217_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_irho_tt__mod__equationofstate) {
          lnrho__217_219_231=log(value(Field(AC_irho__mod__cdata-1)))
          tt__217_219_231=value(Field(AC_iss__mod__cdata-1))
          if (false) {
            ss__217_219_231=AC_cv__mod__equationofstate*(log(tt__217_219_231)-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__217_219_231=AC_cv__mod__equationofstate*tt__217_219_231
          if (true) {
            pp__217_219_231=ee__217_219_231*value(Field(AC_irho__mod__cdata-1))*AC_gamma_m1__mod__equationofstate
          }
          if (false) {
            cs2__217_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__217_219_231
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_ipp_ss__mod__equationofstate) {
          pp__217_219_231=value(Field(AC_irho__mod__cdata-1))
          if (AC_pretend_lntt__mod__cdata) {
            lntt__217_219_231=value(Field(AC_iss__mod__cdata-1))
            lnrho__217_219_231=log(pp__217_219_231)-lntt__217_219_231-log(AC_gamma_m1__mod__equationofstate*AC_cv__mod__equationofstate)
            if (false) {
              ss__217_219_231=AC_cv__mod__equationofstate*(lntt__217_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__217_219_231-AC_lnrho0__mod__equationofstate))
            }
            ee__217_219_231=AC_cv__mod__equationofstate*exp(lntt__217_219_231)
            if (false) {
              cs2__217_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__217_219_231
            }
          }
          else {
            ss__217_219_231=value(Field(AC_iss__mod__cdata-1))
            lnrho__217_219_231=log(pp__217_219_231)/AC_gamma__mod__equationofstate-ss__217_219_231/AC_cp__mod__equationofstate
            tt__217_219_231=pp__217_219_231/(AC_gamma_m1__mod__equationofstate*AC_cv__mod__equationofstate*exp(lnrho__217_219_231))
            if (false) {
              cs2__217_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__217_219_231
            }
            if (false) {
              ee__217_219_231=AC_cv__mod__equationofstate*tt__217_219_231
            }
            if (false) {
              lntt__217_219_231=log(tt__217_219_231)
            }
          }
        }
        else if(AC_irho_ss__mod__equationofstate == AC_irho_eth__mod__equationofstate || AC_irho_ss__mod__equationofstate == AC_ilnrho_eth__mod__equationofstate) {
          if (AC_lstratz__mod__cdata) {
          }
          else {
            if (AC_ldensity_nolog__mod__cdata) {
              rho_217_219_231 = value(Field(AC_irho__mod__cdata-1))
              if (false) {
                lnrho__217_219_231 = log(value(Field(AC_irho__mod__cdata-1)))
              }
            }
            else {
              rho_217_219_231 = exp(value(Field(AC_irho__mod__cdata-1)))
              if (false) {
                lnrho__217_219_231 = value(Field(AC_irho__mod__cdata-1))
              }
            }
            eth_217_219_231 = value(Field(AC_iss__mod__cdata-1))
          }
          if (false || false) {
            lntt__217_219_231 = log(AC_cv1__mod__equationofstate * eth_217_219_231 / rho_217_219_231)
          }
          if (false) {
            ee__217_219_231 = eth_217_219_231 / rho_217_219_231
          }
          if (true) {
            pp__217_219_231 = AC_gamma_m1__mod__equationofstate * eth_217_219_231
          }
          if (false) {
            cs2__217_219_231 = AC_gamma__mod__equationofstate * AC_gamma_m1__mod__equationofstate * eth_217_219_231 / rho_217_219_231
          }
        }
        else {
        }
        if (true) {
          pp_219_231=pp__217_219_231
        }
      }
    }
    else {
      if(AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate || AC_ilnrho_ss__mod__equationofstate == AC_irho_ss__mod__equationofstate) {
        if (AC_lstratz__mod__cdata) {
        }
        else if (AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_ss__mod__equationofstate) {
          lnrho__218_219_231 = value(Field(AC_ilnrho__mod__cdata-1))
        }
        else {
          lnrho__218_219_231 = log(value(Field(AC_ilnrho__mod__cdata-1)))
        }
        if (AC_pretend_lntt__mod__cdata) {
          lntt__218_219_231=value(Field(AC_iss__mod__cdata-1))
          if (false) {
            ss__218_219_231=AC_cv__mod__equationofstate*(lntt__218_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
          }
        }
        else {
          ss__218_219_231=value(Field(AC_iss__mod__cdata-1))
          lntt__218_219_231=AC_lntt0__mod__equationofstate+AC_cv1__mod__equationofstate*ss__218_219_231+AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate)
        }
        ee__218_219_231=AC_cv__mod__equationofstate*exp(lntt__218_219_231)
        if (true) {
          pp__218_219_231=(AC_cp__mod__equationofstate-AC_cv__mod__equationofstate)*exp(lntt__218_219_231+lnrho__218_219_231)
        }
        if (false) {
          cs2__218_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__218_219_231
        }
        cs2__218_219_231=AC_cs20__mod__equationofstate*AC_cv1__mod__equationofstate*ee__218_219_231
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_ee__mod__equationofstate || AC_ilnrho_ss__mod__equationofstate == AC_irho_ee__mod__equationofstate) {
        ee__218_219_231=value(Field(AC_iss__mod__cdata-1))
        if (AC_ilnrho_ss__mod__equationofstate==AC_ilnrho_ee__mod__equationofstate) {
          lnrho__218_219_231=value(Field(AC_ilnrho__mod__cdata-1))
          pp__218_219_231=AC_gamma_m1__mod__equationofstate*ee__218_219_231*exp(value(Field(AC_ilnrho__mod__cdata-1)))
        }
        else {
          lnrho__218_219_231=log(value(Field(AC_ilnrho__mod__cdata-1)))
          pp__218_219_231=AC_gamma_m1__mod__equationofstate*ee__218_219_231*value(Field(AC_ilnrho__mod__cdata-1))
        }
        lntt__218_219_231=log(AC_cv1__mod__equationofstate*ee__218_219_231)
        if (false) {
          ss__218_219_231=AC_cv__mod__equationofstate*(lntt__218_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
        }
        if (false) {
          cs2__218_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__218_219_231
        }
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_pp__mod__equationofstate || AC_ilnrho_ss__mod__equationofstate == AC_irho_pp__mod__equationofstate) {
        pp__218_219_231=value(Field(AC_iss__mod__cdata-1))
        if (AC_ilnrho_ss__mod__equationofstate==AC_ilnrho_pp__mod__equationofstate) {
          lnrho__218_219_231=value(Field(AC_ilnrho__mod__cdata-1))
          ee__218_219_231=pp__218_219_231*exp(-lnrho__218_219_231)/AC_gamma_m1__mod__equationofstate
          if (false) {
            ss__218_219_231=AC_cv__mod__equationofstate*(log(pp__218_219_231*exp(-lnrho__218_219_231)*AC_gamma__mod__equationofstate/AC_cs20__mod__equationofstate)-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
          }
        }
        else {
          lnrho__218_219_231=log(value(Field(AC_ilnrho__mod__cdata-1)))
          ee__218_219_231=pp__218_219_231/value(Field(AC_ilnrho__mod__cdata-1))/AC_gamma_m1__mod__equationofstate
          if (false) {
            ss__218_219_231=AC_cv__mod__equationofstate*(log(pp__218_219_231/value(Field(AC_ilnrho__mod__cdata-1))*AC_gamma__mod__equationofstate/AC_cs20__mod__equationofstate)-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
          }
        }
        if (false) {
          lntt__218_219_231=log(AC_cv1__mod__equationofstate*ee__218_219_231)
        }
        if (false) {
          cs2__218_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__218_219_231
        }
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_lntt__mod__equationofstate) {
        lnrho__218_219_231=value(Field(AC_ilnrho__mod__cdata-1))
        lntt__218_219_231=value(Field(AC_iss__mod__cdata-1))
        if (false) {
          ss__218_219_231=AC_cv__mod__equationofstate*(lntt__218_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
        }
        ee__218_219_231=AC_cv__mod__equationofstate*exp(lntt__218_219_231)
        if (true) {
          pp__218_219_231=ee__218_219_231*exp(lnrho__218_219_231)*AC_gamma_m1__mod__equationofstate
        }
        if (false) {
          cs2__218_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__218_219_231
        }
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_tt__mod__equationofstate) {
        lnrho__218_219_231=value(Field(AC_ilnrho__mod__cdata-1))
        tt__218_219_231=value(Field(AC_iss__mod__cdata-1))
        if (false) {
          ss__218_219_231=AC_cv__mod__equationofstate*(log(tt__218_219_231)-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
        }
        ee__218_219_231=AC_cv__mod__equationofstate*tt__218_219_231
        if (true) {
          pp__218_219_231=ee__218_219_231*exp(lnrho__218_219_231)*AC_gamma_m1__mod__equationofstate
        }
        if (false) {
          cs2__218_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__218_219_231
        }
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_irho_tt__mod__equationofstate) {
        lnrho__218_219_231=log(value(Field(AC_ilnrho__mod__cdata-1)))
        tt__218_219_231=value(Field(AC_iss__mod__cdata-1))
        if (false) {
          ss__218_219_231=AC_cv__mod__equationofstate*(log(tt__218_219_231)-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
        }
        ee__218_219_231=AC_cv__mod__equationofstate*tt__218_219_231
        if (true) {
          pp__218_219_231=ee__218_219_231*value(Field(AC_ilnrho__mod__cdata-1))*AC_gamma_m1__mod__equationofstate
        }
        if (false) {
          cs2__218_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__218_219_231
        }
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_ipp_ss__mod__equationofstate) {
        pp__218_219_231=value(Field(AC_ilnrho__mod__cdata-1))
        if (AC_pretend_lntt__mod__cdata) {
          lntt__218_219_231=value(Field(AC_iss__mod__cdata-1))
          lnrho__218_219_231=log(pp__218_219_231)-lntt__218_219_231-log(AC_gamma_m1__mod__equationofstate*AC_cv__mod__equationofstate)
          if (false) {
            ss__218_219_231=AC_cv__mod__equationofstate*(lntt__218_219_231-AC_lntt0__mod__equationofstate-AC_gamma_m1__mod__equationofstate*(lnrho__218_219_231-AC_lnrho0__mod__equationofstate))
          }
          ee__218_219_231=AC_cv__mod__equationofstate*exp(lntt__218_219_231)
          if (false) {
            cs2__218_219_231=AC_gamma__mod__equationofstate*AC_gamma_m1__mod__equationofstate*ee__218_219_231
          }
        }
        else {
          ss__218_219_231=value(Field(AC_iss__mod__cdata-1))
          lnrho__218_219_231=log(pp__218_219_231)/AC_gamma__mod__equationofstate-ss__218_219_231/AC_cp__mod__equationofstate
          tt__218_219_231=pp__218_219_231/(AC_gamma_m1__mod__equationofstate*AC_cv__mod__equationofstate*exp(lnrho__218_219_231))
          if (false) {
            cs2__218_219_231=AC_cp__mod__equationofstate*AC_gamma_m1__mod__equationofstate*tt__218_219_231
          }
          if (false) {
            ee__218_219_231=AC_cv__mod__equationofstate*tt__218_219_231
          }
          if (false) {
            lntt__218_219_231=log(tt__218_219_231)
          }
        }
      }
      else if(AC_ilnrho_ss__mod__equationofstate == AC_irho_eth__mod__equationofstate || AC_ilnrho_ss__mod__equationofstate == AC_ilnrho_eth__mod__equationofstate) {
        if (AC_lstratz__mod__cdata) {
        }
        else {
          if (AC_ldensity_nolog__mod__cdata) {
            rho_218_219_231 = value(Field(AC_ilnrho__mod__cdata-1))
            if (false) {
              lnrho__218_219_231 = log(value(Field(AC_ilnrho__mod__cdata-1)))
            }
          }
          else {
            rho_218_219_231 = exp(value(Field(AC_ilnrho__mod__cdata-1)))
            if (false) {
              lnrho__218_219_231 = value(Field(AC_ilnrho__mod__cdata-1))
            }
          }
          eth_218_219_231 = value(Field(AC_iss__mod__cdata-1))
        }
        if (false || false) {
          lntt__218_219_231 = log(AC_cv1__mod__equationofstate * eth_218_219_231 / rho_218_219_231)
        }
        if (false) {
          ee__218_219_231 = eth_218_219_231 / rho_218_219_231
        }
        if (true) {
          pp__218_219_231 = AC_gamma_m1__mod__equationofstate * eth_218_219_231
        }
        if (false) {
          cs2__218_219_231 = AC_gamma__mod__equationofstate * AC_gamma_m1__mod__equationofstate * eth_218_219_231 / rho_218_219_231
        }
      }
      else {
      }
      if (true) {
        pp_219_231=pp__218_219_231
      }
    }
    DF_SS = DF_SS + 0.5*pp_219_231*ac_transformed_pencil_divu
  }
  if (AC_tau_ss_exterior__mod__energy!=0.0) {
    if (AC_z__mod__cdata[AC_n__mod__cdata-1]>AC_zgrav__mod__gravity) {
      scl_221_231=1./AC_tau_ss_exterior__mod__energy
      DF_SS=DF_SS-scl_221_231*ac_transformed_pencil_ss
    }
  }
  if (AC_lborder_profiles__mod__cparam) {
    if(AC_string_enum_borderss__mod__energy == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderss__mod__energy == AC_string_enum_0_string__mod__cparam) {
      f_target_230_231=0.0
    }
    else if(AC_string_enum_borderss__mod__energy == AC_string_enum_constant_string__mod__cparam) {
      f_target_230_231=AC_ss_const__mod__energy
    }
    else if(AC_string_enum_borderss__mod__energy == AC_string_enum_initialzcondition_string__mod__cparam) {
    }
    else if(AC_string_enum_borderss__mod__energy == AC_string_enum_initialztemperature_string__mod__cparam) {
      if (AC_ldensity_nolog__mod__cdata) {
        lnrho_init_230_231 = log(rho_init_230_231)
      }
      else {
      }
      f_target_230_231 = ss_init_230_231 - AC_gamma_m1__mod__energy*AC_cv__mod__energy*(ac_transformed_pencil_lnrho-lnrho_init_230_231)
    }
    else if(AC_string_enum_borderss__mod__energy == AC_string_enum_nothing_string__mod__cparam) {
    }
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
    if (AC_lhydro__mod__cparam && AC_ldensity__mod__cparam) {
      advec_cs2__mod__cdata=ac_transformed_pencil_advec_cs2
    }
    if (AC_lthdiff_hmax__mod__energy || AC_idiag_dth__mod__energy!=0) {
      if (AC_lthdiff_hmax__mod__energy) {
        ssmax__mod__energy=max(ssmax__mod__energy,abs(DF_SS)*ac_transformed_pencil_cv1)
        dt1_max__mod__cdata=max(dt1_max__mod__cdata,ssmax__mod__energy/AC_cdts__mod__cdata)
      }
      else if (AC_lrhs_max__mod__energy) {
        dt1_max__mod__cdata=max(dt1_max__mod__cdata,abs(hmax__mod__energy/ac_transformed_pencil_ee/AC_cdts__mod__cdata))
      }
    }
    else if (AC_ldiagnos__mod__cdata && AC_idiag_tauhmin__mod__energy!=0) {
      ssmax__mod__energy=max(ssmax__mod__energy,abs(DF_SS)*ac_transformed_pencil_cv1)
    }
  }
  if (AC_lmagnetic__mod__cparam) {
    dadt_280.x = 0.
    dadt_280.y = 0.
    dadt_280.z = 0.
    fmax__mod__magnetic=1./AC_impossible__mod__cparam
    damax__mod__magnetic=1./AC_impossible__mod__cparam
    ssmax__mod__magnetic=1./AC_impossible__mod__cparam
    if (AC_b_ext__mod__magnetic.x != 0.0  ||  AC_b_ext__mod__magnetic.y != 0.0  ||  AC_b_ext__mod__magnetic.z != 0.0) {
      if (AC_omega_bz_ext__mod__magnetic != 0.0) {
        if (AC_lcartesian_coords__mod__cdata  ||  AC_lbext_curvilinear__mod__magnetic) {
          c_242_280 = cos(AC_omega_bz_ext__mod__magnetic * AC_t__mod__cdata)
          s_242_280 = sin(AC_omega_bz_ext__mod__magnetic * AC_t__mod__cdata)
          b_ext_280.x = AC_b_ext__mod__magnetic.x * c_242_280 - AC_b_ext__mod__magnetic.y * s_242_280
          b_ext_280.y = AC_b_ext__mod__magnetic.x * s_242_280 + AC_b_ext__mod__magnetic.y * c_242_280
          b_ext_280.z = AC_b_ext__mod__magnetic.z
        }
        else {
        }
      }
      else if (AC_lbext_moving_layer__mod__magnetic)  {
        zposbot_242_280=AC_zbot_moving_layer__mod__magnetic + AC_t__mod__cdata*AC_speed_moving_layer__mod__magnetic
        zpostop_242_280=AC_ztop_moving_layer__mod__magnetic + AC_t__mod__cdata*AC_speed_moving_layer__mod__magnetic
        step_scalar_return_value_70_242_280 = 0.5*(1+tanh((AC_z__mod__cdata[AC_n__mod__cdata-1]-zposbot_242_280)/AC_edge_moving_layer__mod__magnetic))
        step_scalar_return_value_71_242_280 = 0.5*(1+tanh((AC_z__mod__cdata[AC_n__mod__cdata-1]-zpostop_242_280)/AC_edge_moving_layer__mod__magnetic))
        zprof_242_280 = step_scalar_return_value_70_242_280-step_scalar_return_value_71_242_280
        b_ext_280.x = AC_b_ext__mod__magnetic.x*zprof_242_280
        b_ext_280.y = AC_b_ext__mod__magnetic.y*zprof_242_280
        b_ext_280.z=AC_b_ext__mod__magnetic.z
        if (false) {
          arg_72_242_280 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-zposbot_242_280)/(AC_edge_moving_layer__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_72_242_280)>=8.)  {
            der_step_return_value_72_242_280 = 2./AC_edge_moving_layer__mod__magnetic*exp(-2.*abs(arg_72_242_280))
          }
          else {
            der_step_return_value_72_242_280 = 0.5/(AC_edge_moving_layer__mod__magnetic*cosh(arg_72_242_280)*cosh(arg_72_242_280))
          }
          arg_73_242_280 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-zpostop_242_280)/(AC_edge_moving_layer__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_73_242_280)>=8.)  {
            der_step_return_value_73_242_280 = 2./AC_edge_moving_layer__mod__magnetic*exp(-2.*abs(arg_73_242_280))
          }
          else {
            der_step_return_value_73_242_280 = 0.5/(AC_edge_moving_layer__mod__magnetic*cosh(arg_73_242_280)*cosh(arg_73_242_280))
          }
          zder_242_280 = der_step_return_value_72_242_280-der_step_return_value_73_242_280
        }
      }
      else {
        if (AC_lcartesian_coords__mod__cdata  ||  AC_lbext_curvilinear__mod__magnetic) {
          b_ext_280 = AC_b_ext__mod__magnetic
        }
        else if (AC_lcylindrical_coords__mod__cdata) {
          b_ext_280.x =  AC_b_ext__mod__magnetic.x * cos(AC_y__mod__cdata[AC_m__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * sin(AC_y__mod__cdata[AC_m__mod__cdata-1])
          b_ext_280.y = -AC_b_ext__mod__magnetic.x * sin(AC_y__mod__cdata[AC_m__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * cos(AC_y__mod__cdata[AC_m__mod__cdata-1])
          b_ext_280.z =  AC_b_ext__mod__magnetic.z
        }
        else if (AC_lspherical_coords__mod__cdata) {
          b_ext_280.x =  AC_b_ext__mod__magnetic.x * AC_sinth__mod__cdata[AC_m__mod__cdata-1] * cos(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * AC_sinth__mod__cdata[AC_m__mod__cdata-1] * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.z * AC_costh__mod__cdata[AC_m__mod__cdata-1]
          b_ext_280.y =  AC_b_ext__mod__magnetic.x * AC_costh__mod__cdata[AC_m__mod__cdata-1] * cos(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y * AC_costh__mod__cdata[AC_m__mod__cdata-1] * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) - AC_b_ext__mod__magnetic.z * AC_sinth__mod__cdata[AC_m__mod__cdata-1]
          b_ext_280.z = -AC_b_ext__mod__magnetic.x            * sin(AC_z__mod__cdata[AC_n__mod__cdata-1]) + AC_b_ext__mod__magnetic.y            * cos(AC_z__mod__cdata[AC_n__mod__cdata-1])
        }
      }
    }
    else {
      b_ext_280.x = 0.
      b_ext_280.y = 0.
      b_ext_280.z = 0.
    }
    if (AC_t_bext__mod__magnetic > 0.0  &&  AC_t__mod__cdata < AC_t_bext__mod__magnetic) {
      if (AC_t__mod__cdata <= AC_t0_bext__mod__magnetic) {
        b_ext_280 = AC_b0_ext__mod__magnetic
      }
      else {
        b_ext_280 = AC_b0_ext__mod__magnetic + 0.5*(1.-cos(AC_pi__mod__cparam*(AC_t__mod__cdata-AC_t0_bext__mod__magnetic)/(AC_t_bext__mod__magnetic-AC_t0_bext__mod__magnetic)))*(b_ext_280-AC_b0_ext__mod__magnetic)
      }
    }
    if (AC_lhydro__mod__cparam) {
      if (!AC_lkinematic__mod__magnetic) {
        if (AC_llorentzforce__mod__magnetic) {
          if (AC_lboris_correction__mod__magnetic) {
            DF_UX=DF_UX+ac_transformed_pencil_gamma_a2*ac_transformed_pencil_jxbr.x+ (ac_transformed_pencil_ugu.x+ac_transformed_pencil_rho1gpp.x-ac_transformed_pencil_gg.x)*(1-ac_transformed_pencil_gamma_a2)- AC_mu01__mod__cdata*(ac_transformed_pencil_gamma_a2*ac_transformed_pencil_gamma_a2*ac_transformed_pencil_rho1/ac_transformed_pencil_clight2)*  (ac_transformed_pencil_bb.x*ac_transformed_pencil_bb.x*(ac_transformed_pencil_ugu.x+ac_transformed_pencil_rho1gpp.x-ac_transformed_pencil_gg.x)+ ac_transformed_pencil_bb.x*ac_transformed_pencil_bb.y*(ac_transformed_pencil_ugu.y+ac_transformed_pencil_rho1gpp.y-ac_transformed_pencil_gg.y)+ ac_transformed_pencil_bb.x*ac_transformed_pencil_bb.z*(ac_transformed_pencil_ugu.z+ac_transformed_pencil_rho1gpp.z-ac_transformed_pencil_gg.z))
            DF_UY=DF_UY+ac_transformed_pencil_gamma_a2*ac_transformed_pencil_jxbr.y+ (ac_transformed_pencil_ugu.y+ac_transformed_pencil_rho1gpp.y-ac_transformed_pencil_gg.y)*(1-ac_transformed_pencil_gamma_a2)- AC_mu01__mod__cdata*(ac_transformed_pencil_gamma_a2*ac_transformed_pencil_gamma_a2*ac_transformed_pencil_rho1/ac_transformed_pencil_clight2)*  (ac_transformed_pencil_bb.y*ac_transformed_pencil_bb.y*(ac_transformed_pencil_ugu.y+ac_transformed_pencil_rho1gpp.y-ac_transformed_pencil_gg.y)+ ac_transformed_pencil_bb.y*ac_transformed_pencil_bb.x*(ac_transformed_pencil_ugu.x+ac_transformed_pencil_rho1gpp.x-ac_transformed_pencil_gg.x)+ ac_transformed_pencil_bb.y*ac_transformed_pencil_bb.z*(ac_transformed_pencil_ugu.z+ac_transformed_pencil_rho1gpp.z-ac_transformed_pencil_gg.z))
            DF_UZ=DF_UZ+ac_transformed_pencil_gamma_a2*ac_transformed_pencil_jxbr.z+ (ac_transformed_pencil_ugu.z+ac_transformed_pencil_rho1gpp.z-ac_transformed_pencil_gg.z)*(1-ac_transformed_pencil_gamma_a2)- AC_mu01__mod__cdata*(ac_transformed_pencil_gamma_a2*ac_transformed_pencil_gamma_a2*ac_transformed_pencil_rho1/ac_transformed_pencil_clight2)*  (ac_transformed_pencil_bb.z*ac_transformed_pencil_bb.z*(ac_transformed_pencil_ugu.z+ac_transformed_pencil_rho1gpp.z-ac_transformed_pencil_gg.z)+ ac_transformed_pencil_bb.z*ac_transformed_pencil_bb.x*(ac_transformed_pencil_ugu.x+ac_transformed_pencil_rho1gpp.x-ac_transformed_pencil_gg.x)+ ac_transformed_pencil_bb.z*ac_transformed_pencil_bb.y*(ac_transformed_pencil_ugu.y+ac_transformed_pencil_rho1gpp.y-ac_transformed_pencil_gg.y))
          }
          else if (AC_llorentz_rhoref__mod__magnetic) {
            DF_UVEC=DF_UVEC+ac_transformed_pencil_jxb*AC_rhoref1__mod__magnetic
          }
          else {
            if (AC_lrelativistic_eos__mod__density) {
              tmp1_280 = dot(ac_transformed_pencil_uu,ac_transformed_pencil_jxbr)
              DF_LNRHO=DF_LNRHO+tmp1_280
              DF_UVEC=DF_UVEC+0.75*ac_transformed_pencil_jxbr
            }
            else {
              if (AC_iphiuu__mod__cdata==0) {
                if (AC_lconservative__mod__hydro) {
                  DF_UVEC=DF_UVEC+ac_transformed_pencil_jxb
                }
                else {
                  if (AC_lignore_1rho_in_lorentz__mod__magnetic) {
                    DF_UVEC=DF_UVEC+ac_transformed_pencil_jxb
                  }
                  else {
                    DF_UVEC=DF_UVEC+ac_transformed_pencil_jxbr
                  }
                }
              }
              else {
                DF_PHIUU=DF_PHIUU-0.5*(ac_transformed_pencil_b2-AC_b_ext2__mod__magnetic)
              }
            }
          }
        }
      }
    }
    if (AC_iex__mod__cdata==0 || AC_loverride_ee__mod__magnetic) {
      fres__mod__magnetic.x = 0.
      fres__mod__magnetic.y = 0.
      fres__mod__magnetic.z = 0.
      eta_total__mod__magnetic=0.
      diffus_eta2__mod__magnetic=0.
      diffus_eta3__mod__magnetic=0.
      if (AC_lresi_eta_const__mod__magnetic) {
        if (! AC_limplicit_resistivity__mod__magnetic) {
          if (AC_lweyl_gauge__mod__magnetic) {
            fres__mod__magnetic = fres__mod__magnetic - AC_eta__mod__magnetic * AC_mu0__mod__cdata * ac_transformed_pencil_jj
          }
          else {
            fres__mod__magnetic = fres__mod__magnetic + AC_eta__mod__magnetic * ac_transformed_pencil_del2a
          }
          if (AC_ladd_efield__mod__magnetic) {
            tanhx2_280 = tanh( AC_x__mod__cdata[vertexIdx.x] )*tanh( AC_x__mod__cdata[vertexIdx.x] )
            del2aa_ini_280 = AC_ampl_efield__mod__magnetic*(-2 + 8*tanhx2_280 - 6*tanhx2_280*tanhx2_280 )
            fres__mod__magnetic.z = fres__mod__magnetic.z - AC_eta__mod__magnetic*AC_mu0__mod__cdata*del2aa_ini_280
          }
          eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta__mod__magnetic
        }
      }
      if (AC_lresi_eta_tdep__mod__magnetic) {
        if (AC_lresi_eta_ztdep__mod__magnetic) {
          if (AC_lweyl_gauge__mod__magnetic) {
            fres__mod__magnetic = fres__mod__magnetic                 -AC_eta_tdep__mod__magnetic* AC_feta_ztdep__mod__magnetic[AC_n__mod__cdata-1]    *AC_mu0__mod__cdata*ac_transformed_pencil_jj
          }
          else {
            fres__mod__magnetic = fres__mod__magnetic+AC_eta_tdep__mod__magnetic*ac_transformed_pencil_del2a-AC_eta_tdep__mod__magnetic*(AC_feta_ztdep__mod__magnetic[AC_n__mod__cdata-1]-1.)*AC_mu0__mod__cdata*ac_transformed_pencil_jj
          }
        }
        else {
          if (AC_lweyl_gauge__mod__magnetic) {
            fres__mod__magnetic = fres__mod__magnetic - AC_eta_tdep__mod__magnetic * AC_mu0__mod__cdata * ac_transformed_pencil_jj
          }
          else {
            fres__mod__magnetic = fres__mod__magnetic + AC_eta_tdep__mod__magnetic * ac_transformed_pencil_del2a
          }
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta_tdep__mod__magnetic
      }
      if (AC_lresi_zdep__mod__magnetic) {
        if (! AC_limplicit_resistivity__mod__magnetic) {
          if (AC_lweyl_gauge__mod__magnetic) {
            fres__mod__magnetic = fres__mod__magnetic - AC_eta_z__mod__magnetic[AC_n__mod__cdata-1] * AC_mu0__mod__cdata * ac_transformed_pencil_jj
          }
          else {
            fres__mod__magnetic.x = fres__mod__magnetic.x + AC_eta_z__mod__magnetic[AC_n__mod__cdata-1] * ac_transformed_pencil_del2a.x
            fres__mod__magnetic.y = fres__mod__magnetic.y + AC_eta_z__mod__magnetic[AC_n__mod__cdata-1] * ac_transformed_pencil_del2a.y
            fres__mod__magnetic.z = fres__mod__magnetic.z + AC_eta_z__mod__magnetic[AC_n__mod__cdata-1] * ac_transformed_pencil_del2a.z
            fres__mod__magnetic.z = fres__mod__magnetic.z + AC_geta_z__mod__magnetic[AC_n__mod__cdata-1] * ac_transformed_pencil_diva
          }
          eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta_z__mod__magnetic[AC_n__mod__cdata-1]
        }
        else {
          fres__mod__magnetic.z = fres__mod__magnetic.z + AC_geta_z__mod__magnetic[AC_n__mod__cdata-1] * ac_transformed_pencil_diva
          if (AC_lfirst__mod__cdata  &&  AC_ldt__mod__cdata) {
            maxadvec__mod__cdata = maxadvec__mod__cdata + abs(AC_geta_z__mod__magnetic[AC_n__mod__cdata-1]) * AC_dz_1__mod__cdata[AC_n__mod__cdata-1]
          }
        }
      }
      if (AC_lresi_sqrtrhoeta_const__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1) * (ac_transformed_pencil_del2a.x-0.5*ac_transformed_pencil_diva*ac_transformed_pencil_glnrho.x)
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1) * (ac_transformed_pencil_del2a.y-0.5*ac_transformed_pencil_diva*ac_transformed_pencil_glnrho.y)
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1) * (ac_transformed_pencil_del2a.z-0.5*ac_transformed_pencil_diva*ac_transformed_pencil_glnrho.z)
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta__mod__magnetic*sqrt(ac_transformed_pencil_rho1)
      }
      if (AC_lresi_eta_aniso__mod__magnetic) {
        cosalp_280=cos(AC_alp_aniso__mod__magnetic*AC_dtor__mod__cparam)
        sinalp_280=sin(AC_alp_aniso__mod__magnetic*AC_dtor__mod__cparam)
        if (AC_eta1_aniso_r__mod__magnetic==0.) {
          prof_280=AC_eta1_aniso__mod__magnetic
        }
        else {
          step_vector_return_value_243_280 = 0.5*(1+tanh((AC_x__mod__cdata[vertexIdx.x]-AC_eta1_aniso_r__mod__magnetic)/(AC_eta1_aniso_d__mod__magnetic+AC_tini__mod__cparam)))
          prof_280=AC_eta1_aniso__mod__magnetic*(1.-step_vector_return_value_243_280)
        }
        if (AC_lquench_eta_aniso__mod__magnetic) {
          prof_280=prof_280/(1.+AC_quench_aniso__mod__magnetic*AC_arms__mod__magnetic)
        }
        fres__mod__magnetic.x=fres__mod__magnetic.x-prof_280*cosalp_280*(cosalp_280*ac_transformed_pencil_jj.x+sinalp_280*ac_transformed_pencil_jj.y)
        fres__mod__magnetic.y=fres__mod__magnetic.y-prof_280*sinalp_280*(cosalp_280*ac_transformed_pencil_jj.x+sinalp_280*ac_transformed_pencil_jj.y)
        eta_total__mod__magnetic=eta_total__mod__magnetic+abs(AC_eta1_aniso__mod__magnetic)
      }
      if (AC_lresi_etass__mod__magnetic) {
        etass_280=AC_alphassm__mod__magnetic*ac_transformed_pencil_cs2/omegass_280
        fres__mod__magnetic.x=fres__mod__magnetic.x-etass_280*ac_transformed_pencil_jj.x
        fres__mod__magnetic.y=fres__mod__magnetic.y-etass_280*ac_transformed_pencil_jj.y
        fres__mod__magnetic.z=fres__mod__magnetic.z-etass_280*ac_transformed_pencil_jj.z
        eta_total__mod__magnetic=eta_total__mod__magnetic+etass_280
      }
      if (AC_lresi_xydep__mod__magnetic) {
        fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1]*ac_transformed_pencil_del2a.x+AC_geta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1][1-1]*ac_transformed_pencil_diva
        fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1]*ac_transformed_pencil_del2a.y+AC_geta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1][2-1]*ac_transformed_pencil_diva
        fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1]*ac_transformed_pencil_del2a.z+AC_geta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1][3-1]*ac_transformed_pencil_diva
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_xy__mod__magnetic[vertexIdx.x][AC_m__mod__cdata-1]
      }
      if (AC_lresi_xdep__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x = fres__mod__magnetic.x - AC_eta_x__mod__magnetic[vertexIdx.x] * AC_mu0__mod__cdata * ac_transformed_pencil_jj.x
          fres__mod__magnetic.y = fres__mod__magnetic.y - AC_eta_x__mod__magnetic[vertexIdx.x] * AC_mu0__mod__cdata * ac_transformed_pencil_jj.y
          fres__mod__magnetic.z = fres__mod__magnetic.z - AC_eta_x__mod__magnetic[vertexIdx.x] * AC_mu0__mod__cdata * ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_x__mod__magnetic[vertexIdx.x]*ac_transformed_pencil_del2a.x
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_x__mod__magnetic[vertexIdx.x]*ac_transformed_pencil_del2a.y
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_x__mod__magnetic[vertexIdx.x]*ac_transformed_pencil_del2a.z
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_geta_x__mod__magnetic[vertexIdx.x]*ac_transformed_pencil_diva
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_x__mod__magnetic[vertexIdx.x]
      }
      if (AC_lresi_rdep__mod__magnetic) {
        if(AC_string_enum_rdep_profile__mod__magnetic == AC_string_enum_step_string__mod__cparam) {
          tmp1_254_280=ac_transformed_pencil_r_mn
          step_vector_return_value_244_254_280 = 0.5*(1+tanh((tmp1_254_280-AC_eta_r0__mod__magnetic)/(-AC_eta_rwidth__mod__magnetic+AC_tini__mod__cparam)))
          eta_r__mod__magnetic = AC_eta__mod__magnetic + AC_eta__mod__magnetic*(AC_eta_jump__mod__magnetic-1.)*step_vector_return_value_244_254_280
          arg_245_254_280 = abs((tmp1_254_280-AC_eta_r0__mod__magnetic)/(-AC_eta_rwidth__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_245_254_280)>=8.)  {
            der_step_return_value_245_254_280 = 2./-AC_eta_rwidth__mod__magnetic*exp(-2.*abs(arg_245_254_280))
          }
          else {
            der_step_return_value_245_254_280 = 0.5/(-AC_eta_rwidth__mod__magnetic*cosh(arg_245_254_280)*cosh(arg_245_254_280))
          }
          tmp2_254_280 = AC_eta__mod__magnetic*(AC_eta_jump__mod__magnetic-1.)*der_step_return_value_245_254_280
          geta_r__mod__magnetic.x=tmp2_254_280*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_r_mn1
          geta_r__mod__magnetic.y=tmp2_254_280*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_r_mn1
          geta_r__mod__magnetic.z=tmp2_254_280*AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1
        }
        else if(AC_string_enum_rdep_profile__mod__magnetic == AC_string_enum_two_step_string__mod__cparam || AC_string_enum_rdep_profile__mod__magnetic == AC_string_enum_twozstep_string__mod__cparam) {
          step_vector_return_value_246_254_280 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_eta_r0__mod__magnetic)/(AC_eta_rwidth0__mod__magnetic+AC_tini__mod__cparam)))
          step_vector_return_value_247_254_280 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_eta_r1__mod__magnetic)/(AC_eta_rwidth1__mod__magnetic+AC_tini__mod__cparam)))
          eta_r__mod__magnetic = AC_eta__mod__magnetic + AC_eta__mod__magnetic*(AC_eta_jump__mod__magnetic - 1.)*  (step_vector_return_value_246_254_280 - step_vector_return_value_247_254_280)
          arg_248_254_280 = abs((ac_transformed_pencil_r_mn-AC_eta_r0__mod__magnetic)/(AC_eta_rwidth0__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_248_254_280)>=8.)  {
            der_step_return_value_248_254_280 = 2./AC_eta_rwidth0__mod__magnetic*exp(-2.*abs(arg_248_254_280))
          }
          else {
            der_step_return_value_248_254_280 = 0.5/(AC_eta_rwidth0__mod__magnetic*cosh(arg_248_254_280)*cosh(arg_248_254_280))
          }
          arg_249_254_280 = abs((ac_transformed_pencil_r_mn-AC_eta_r1__mod__magnetic)/(AC_eta_rwidth1__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_249_254_280)>=8.)  {
            der_step_return_value_249_254_280 = 2./AC_eta_rwidth1__mod__magnetic*exp(-2.*abs(arg_249_254_280))
          }
          else {
            der_step_return_value_249_254_280 = 0.5/(AC_eta_rwidth1__mod__magnetic*cosh(arg_249_254_280)*cosh(arg_249_254_280))
          }
          tmp1_254_280 = AC_eta__mod__magnetic*(AC_eta_jump__mod__magnetic-1.)*(  der_step_return_value_248_254_280 - der_step_return_value_249_254_280)
          geta_r__mod__magnetic.x=tmp1_254_280*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_r_mn1
          geta_r__mod__magnetic.y=tmp1_254_280*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_r_mn1
          geta_r__mod__magnetic.z=tmp1_254_280*AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1
        }
        else if(AC_string_enum_rdep_profile__mod__magnetic == AC_string_enum_two_step2_string__mod__cparam || AC_string_enum_rdep_profile__mod__magnetic == AC_string_enum_twozstep2_string__mod__cparam) {
          step_vector_return_value_250_254_280 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_eta_r1__mod__magnetic)/(AC_eta_rwidth1__mod__magnetic+AC_tini__mod__cparam)))
          prof1_254_280    = step_vector_return_value_250_254_280
          step_vector_return_value_251_254_280 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_eta_r0__mod__magnetic)/(AC_eta_rwidth0__mod__magnetic+AC_tini__mod__cparam)))
          prof0_254_280    = step_vector_return_value_251_254_280 - prof1_254_280
          arg_252_254_280 = abs((ac_transformed_pencil_r_mn-AC_eta_r1__mod__magnetic)/(AC_eta_rwidth1__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_252_254_280)>=8.)  {
            der_step_return_value_252_254_280 = 2./AC_eta_rwidth1__mod__magnetic*exp(-2.*abs(arg_252_254_280))
          }
          else {
            der_step_return_value_252_254_280 = 0.5/(AC_eta_rwidth1__mod__magnetic*cosh(arg_252_254_280)*cosh(arg_252_254_280))
          }
          derprof1_254_280 = der_step_return_value_252_254_280
          arg_253_254_280 = abs((ac_transformed_pencil_r_mn-AC_eta_r0__mod__magnetic)/(AC_eta_rwidth0__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_253_254_280)>=8.)  {
            der_step_return_value_253_254_280 = 2./AC_eta_rwidth0__mod__magnetic*exp(-2.*abs(arg_253_254_280))
          }
          else {
            der_step_return_value_253_254_280 = 0.5/(AC_eta_rwidth0__mod__magnetic*cosh(arg_253_254_280)*cosh(arg_253_254_280))
          }
          derprof0_254_280 = der_step_return_value_253_254_280 - derprof1_254_280
          eta_r__mod__magnetic = AC_eta__mod__magnetic + (AC_eta__mod__magnetic*(AC_eta_jump0__mod__magnetic-1.))*prof0_254_280 + (AC_eta__mod__magnetic*(AC_eta_jump1__mod__magnetic-1.))*prof1_254_280
          tmp1_254_280  = AC_eta__mod__magnetic + (AC_eta__mod__magnetic*(AC_eta_jump0__mod__magnetic-1.))*derprof0_254_280 + (AC_eta__mod__magnetic*(AC_eta_jump1__mod__magnetic-1.))*derprof1_254_280
          geta_r__mod__magnetic.x=tmp1_254_280*AC_x__mod__cdata[vertexIdx.x]*ac_transformed_pencil_r_mn1
          geta_r__mod__magnetic.y=tmp1_254_280*AC_y__mod__cdata[AC_m__mod__cdata-1]*ac_transformed_pencil_r_mn1
          geta_r__mod__magnetic.z=tmp1_254_280*AC_z__mod__cdata[AC_n__mod__cdata-1]*ac_transformed_pencil_r_mn1
        }
        fres__mod__magnetic.x=fres__mod__magnetic.x+eta_r__mod__magnetic*ac_transformed_pencil_del2a.x+geta_r__mod__magnetic.x*ac_transformed_pencil_diva
        fres__mod__magnetic.y=fres__mod__magnetic.y+eta_r__mod__magnetic*ac_transformed_pencil_del2a.y+geta_r__mod__magnetic.y*ac_transformed_pencil_diva
        fres__mod__magnetic.z=fres__mod__magnetic.z+eta_r__mod__magnetic*ac_transformed_pencil_del2a.z+geta_r__mod__magnetic.z*ac_transformed_pencil_diva
        eta_total__mod__magnetic=eta_total__mod__magnetic+eta_r__mod__magnetic
      }
      if (AC_lresi_ydep__mod__magnetic) {
        fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_y__mod__magnetic[AC_m__mod__cdata-1]*ac_transformed_pencil_del2a.x
        fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_y__mod__magnetic[AC_m__mod__cdata-1]*ac_transformed_pencil_del2a.y
        fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_y__mod__magnetic[AC_m__mod__cdata-1]*ac_transformed_pencil_del2a.z
        if (AC_lspherical_coords__mod__cdata) {
          fres__mod__magnetic.y=fres__mod__magnetic.y+ac_transformed_pencil_r_mn1*AC_geta_y__mod__magnetic[AC_m__mod__cdata-1]*ac_transformed_pencil_diva
        }
        else {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_geta_y__mod__magnetic[AC_m__mod__cdata-1]*ac_transformed_pencil_diva
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_y__mod__magnetic[AC_m__mod__cdata-1]
      }
      if (AC_lresi_hyper2__mod__magnetic) {
        fres__mod__magnetic=fres__mod__magnetic+AC_eta_hyper2__mod__magnetic*ac_transformed_pencil_del4a
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta2__mod__magnetic=diffus_eta2__mod__magnetic+AC_eta_hyper2__mod__magnetic
        }
      }
      if (AC_lresi_hyper3__mod__magnetic) {
        fres__mod__magnetic=fres__mod__magnetic+AC_eta_hyper3__mod__magnetic*ac_transformed_pencil_del6a
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta3__mod__magnetic=diffus_eta3__mod__magnetic+AC_eta_hyper3__mod__magnetic
        }
      }
      if (AC_lresi_hyper2_tdep__mod__magnetic) {
        fres__mod__magnetic=fres__mod__magnetic-AC_eta_tdep__mod__magnetic*ac_transformed_pencil_del4a
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta2__mod__magnetic=diffus_eta2__mod__magnetic+AC_eta_tdep__mod__magnetic
        }
      }
      if (AC_lresi_hyper3_tdep__mod__magnetic) {
        fres__mod__magnetic=fres__mod__magnetic+AC_eta_tdep__mod__magnetic*ac_transformed_pencil_del6a
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta3__mod__magnetic=diffus_eta3__mod__magnetic+AC_eta_tdep__mod__magnetic
        }
      }
      if (AC_lresi_hyper3_polar__mod__magnetic) {
        ju_280=1+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.x*dline_1__mod__cdata.x
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.y*dline_1__mod__cdata.y
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.z*dline_1__mod__cdata.z
        ju_280=2+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.x*dline_1__mod__cdata.x
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.y*dline_1__mod__cdata.y
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.z*dline_1__mod__cdata.z
        ju_280=3+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.x*dline_1__mod__cdata.x
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.y*dline_1__mod__cdata.y
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*tmp1_280*dline_1__mod__cdata.z*dline_1__mod__cdata.z
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta3__mod__magnetic=diffus_eta3__mod__magnetic+AC_eta_hyper3__mod__magnetic*AC_pi4_1__mod__cparam*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata*dxmin_pencil__mod__cdata
        }
      }
      if (AC_lresi_hyper3_mesh__mod__magnetic) {
        ju_280=1+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.x = fres__mod__magnetic.x + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.x
        }
        else {
          fres__mod__magnetic.x = fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.x
        }
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.x = fres__mod__magnetic.x + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.y
        }
        else {
          fres__mod__magnetic.x = fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.y
        }
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.x = fres__mod__magnetic.x + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.z
        }
        else {
          fres__mod__magnetic.x = fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.z
        }
        ju_280=2+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.y = fres__mod__magnetic.y + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.x
        }
        else {
          fres__mod__magnetic.y = fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.x
        }
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.y = fres__mod__magnetic.y + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.y
        }
        else {
          fres__mod__magnetic.y = fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.y
        }
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.y = fres__mod__magnetic.y + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.z
        }
        else {
          fres__mod__magnetic.y = fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.z
        }
        ju_280=3+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.z = fres__mod__magnetic.z + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.x
        }
        else {
          fres__mod__magnetic.z = fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.x
        }
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.z = fres__mod__magnetic.z + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.y
        }
        else {
          fres__mod__magnetic.z = fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.y
        }
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.z = fres__mod__magnetic.z + AC_eta_hyper3_mesh__mod__magnetic * tmp1_280 * dline_1__mod__cdata.z
        }
        else {
          fres__mod__magnetic.z = fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.z
        }
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          if (AC_ldynamical_diffusion__mod__cdata) {
            diffus_eta3__mod__magnetic = diffus_eta3__mod__magnetic + AC_eta_hyper3_mesh__mod__magnetic
            advec_hypermesh_aa_280 = 0.0
          }
          else {
            advec_hypermesh_aa_280=AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata)
          }
          advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_aa_280*advec_hypermesh_aa_280
        }
      }
      if (AC_lresi_hyper3_csmesh__mod__magnetic) {
        ju_280=1+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.x
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.x
        }
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.y
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.y
        }
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.z
        }
        ju_280=2+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.x
        }
        else {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.x
        }
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.y
        }
        else {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.y
        }
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.z
        }
        else {
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.z
        }
        ju_280=3+AC_iaa__mod__cdata-1
        tmp1_280 = der6x_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.x
        }
        else {
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.x
        }
        tmp1_280 = der6y_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.y
        }
        else {
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.y
        }
        tmp1_280 = der6z_ignore_spacing(Field(ju_280-1))
        if (AC_ldynamical_diffusion__mod__cdata) {
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * tmp1_280*dline_1__mod__cdata.z
        }
        else {
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2) * AC_pi5_1__mod__cparam/60.*tmp1_280*dline_1__mod__cdata.z
        }
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          if (AC_ldynamical_diffusion__mod__cdata) {
            diffus_eta3__mod__magnetic=diffus_eta3__mod__magnetic+AC_eta_hyper3_mesh__mod__magnetic*sqrt(ac_transformed_pencil_cs2)
            advec_hypermesh_aa_280=0.0
          }
          else {
            advec_hypermesh_aa_280=AC_eta_hyper3_mesh__mod__magnetic*AC_pi5_1__mod__cparam*sqrt(dxyz_2__mod__cdata*ac_transformed_pencil_cs2)
          }
          advec2_hypermesh__mod__cdata=advec2_hypermesh__mod__cdata+advec_hypermesh_aa_280*advec_hypermesh_aa_280
        }
      }
      if (AC_lresi_hyper3_strict__mod__magnetic) {
        fres__mod__magnetic=fres__mod__magnetic+AC_eta_hyper3__mod__magnetic*value(F_HYPREVEC)
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta3__mod__magnetic=diffus_eta3__mod__magnetic+AC_eta_hyper3__mod__magnetic
        }
      }
      if (AC_lresi_hyper3_aniso__mod__magnetic) {
        k1_255_280=AC_iaa__mod__cdata-1
        tmp_255_280  = del6fj(Field(k1_255_280+1-1), AC_eta_aniso_hyper3__mod__magnetic)
        tmp2_280.x=tmp_255_280
        tmp_255_280  = del6fj(Field(k1_255_280+2-1), AC_eta_aniso_hyper3__mod__magnetic)
        tmp2_280.y=tmp_255_280
        tmp_255_280  = del6fj(Field(k1_255_280+3-1), AC_eta_aniso_hyper3__mod__magnetic)
        tmp2_280.z=tmp_255_280
        fres__mod__magnetic=fres__mod__magnetic+tmp2_280
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          diffus_eta3__mod__magnetic=diffus_eta3__mod__magnetic +  (AC_eta_aniso_hyper3__mod__magnetic.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x*dline_1__mod__cdata.x +  AC_eta_aniso_hyper3__mod__magnetic.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y*dline_1__mod__cdata.y +  AC_eta_aniso_hyper3__mod__magnetic.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z*dline_1__mod__cdata.z)/dxyz_6__mod__cdata
        }
      }
      if (AC_lresi_shell__mod__magnetic) {
        eta_r_264_280=0.
        if (AC_eta_int__mod__magnetic > 0.) {
          d_int_264_280 = AC_eta_int__mod__magnetic - AC_eta__mod__magnetic
        }
        else {
          d_int_264_280 = 0.
        }
        if (AC_eta_ext__mod__magnetic > 0.) {
          d_ext_264_280 = AC_eta_ext__mod__magnetic - AC_eta__mod__magnetic
        }
        else {
          d_ext_264_280 = 0.
        }
        if (AC_lcylinder_in_a_box__mod__cdata || AC_lcylindrical_coords__mod__cdata) {
          step_vector_return_value_256_264_280 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_r_int__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam)))
          prof_264_280=step_vector_return_value_256_264_280
          eta_mn_280=d_int_264_280*(1-prof_264_280)
          step_vector_return_value_257_264_280 = 0.5*(1+tanh((ac_transformed_pencil_rcyl_mn-AC_r_ext__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam)))
          prof_264_280=step_vector_return_value_257_264_280
          eta_mn_280=AC_eta__mod__magnetic+eta_mn_280+d_ext_264_280*prof_264_280
          arg_258_264_280 = abs((ac_transformed_pencil_rcyl_mn-AC_r_int__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_258_264_280)>=8.)  {
            der_step_return_value_258_264_280 = 2./AC_wresistivity__mod__magnetic*exp(-2.*abs(arg_258_264_280))
          }
          else {
            der_step_return_value_258_264_280 = 0.5/(AC_wresistivity__mod__magnetic*cosh(arg_258_264_280)*cosh(arg_258_264_280))
          }
          prof_264_280=der_step_return_value_258_264_280
          eta_r_264_280=-d_int_264_280*prof_264_280
          arg_259_264_280 = abs((ac_transformed_pencil_rcyl_mn-AC_r_ext__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_259_264_280)>=8.)  {
            der_step_return_value_259_264_280 = 2./AC_wresistivity__mod__magnetic*exp(-2.*abs(arg_259_264_280))
          }
          else {
            der_step_return_value_259_264_280 = 0.5/(AC_wresistivity__mod__magnetic*cosh(arg_259_264_280)*cosh(arg_259_264_280))
          }
          prof_264_280=der_step_return_value_259_264_280
          eta_r_264_280=eta_r_264_280+d_ext_264_280*prof_264_280
          geta_280.x=ac_transformed_pencil_evr.x*eta_r_264_280
          geta_280.y=ac_transformed_pencil_evr.y*eta_r_264_280
          geta_280.z=ac_transformed_pencil_evr.z*eta_r_264_280
        }
        else if (AC_lsphere_in_a_box__mod__cdata || AC_lspherical_coords__mod__cdata) {
          step_vector_return_value_260_264_280 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_r_int__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam)))
          prof_264_280=step_vector_return_value_260_264_280
          eta_mn_280=d_int_264_280*(1-prof_264_280)
          step_vector_return_value_261_264_280 = 0.5*(1+tanh((ac_transformed_pencil_r_mn-AC_r_ext__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam)))
          prof_264_280=step_vector_return_value_261_264_280
          eta_mn_280=AC_eta__mod__magnetic+eta_mn_280+d_ext_264_280*prof_264_280
          arg_262_264_280 = abs((ac_transformed_pencil_r_mn-AC_r_int__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_262_264_280)>=8.)  {
            der_step_return_value_262_264_280 = 2./AC_wresistivity__mod__magnetic*exp(-2.*abs(arg_262_264_280))
          }
          else {
            der_step_return_value_262_264_280 = 0.5/(AC_wresistivity__mod__magnetic*cosh(arg_262_264_280)*cosh(arg_262_264_280))
          }
          prof_264_280=der_step_return_value_262_264_280
          eta_r_264_280=-d_int_264_280*prof_264_280
          arg_263_264_280 = abs((ac_transformed_pencil_r_mn-AC_r_ext__mod__cdata)/(AC_wresistivity__mod__magnetic+AC_tini__mod__cparam))
          if (abs(arg_263_264_280)>=8.)  {
            der_step_return_value_263_264_280 = 2./AC_wresistivity__mod__magnetic*exp(-2.*abs(arg_263_264_280))
          }
          else {
            der_step_return_value_263_264_280 = 0.5/(AC_wresistivity__mod__magnetic*cosh(arg_263_264_280)*cosh(arg_263_264_280))
          }
          prof_264_280=der_step_return_value_263_264_280
          eta_r_264_280=eta_r_264_280+d_ext_264_280*prof_264_280
          geta_280.x=ac_transformed_pencil_evr.x*eta_r_264_280
          geta_280.y=ac_transformed_pencil_evr.y*eta_r_264_280
          geta_280.z=ac_transformed_pencil_evr.z*eta_r_264_280
        }
        else {
        }
        fres__mod__magnetic.x=fres__mod__magnetic.x+eta_mn_280*ac_transformed_pencil_del2a.x+geta_280.x*ac_transformed_pencil_diva
        fres__mod__magnetic.y=fres__mod__magnetic.y+eta_mn_280*ac_transformed_pencil_del2a.y+geta_280.y*ac_transformed_pencil_diva
        fres__mod__magnetic.z=fres__mod__magnetic.z+eta_mn_280*ac_transformed_pencil_del2a.z+geta_280.z*ac_transformed_pencil_diva
        eta_total__mod__magnetic=eta_total__mod__magnetic+eta_mn_280
      }
      if (AC_lresi_eta_shock__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_shock__mod__magnetic*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.x+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.x)
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_shock__mod__magnetic*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.y+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.y)
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_shock__mod__magnetic*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.z+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.z)
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock
      }
      if (AC_lresi_eta_shock2__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_shock2__mod__magnetic*ac_transformed_pencil_shock*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_shock2__mod__magnetic*ac_transformed_pencil_shock*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_shock2__mod__magnetic*ac_transformed_pencil_shock*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_shock2__mod__magnetic*(ac_transformed_pencil_shock*ac_transformed_pencil_shock*ac_transformed_pencil_del2a.x+2*ac_transformed_pencil_shock*ac_transformed_pencil_diva*ac_transformed_pencil_gshock.x)
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_shock2__mod__magnetic*(ac_transformed_pencil_shock*ac_transformed_pencil_shock*ac_transformed_pencil_del2a.y+2*ac_transformed_pencil_shock*ac_transformed_pencil_diva*ac_transformed_pencil_gshock.y)
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_shock2__mod__magnetic*(ac_transformed_pencil_shock*ac_transformed_pencil_shock*ac_transformed_pencil_del2a.z+2*ac_transformed_pencil_shock*ac_transformed_pencil_diva*ac_transformed_pencil_gshock.z)
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_shock2__mod__magnetic*ac_transformed_pencil_shock*ac_transformed_pencil_shock
      }
      if (AC_lresi_eta_shock_profz__mod__magnetic) {
        step_vector_return_value_265_280 = 0.5*(1+tanh((ac_transformed_pencil_z_mn-AC_eta_zshock__mod__magnetic)/(-AC_eta_width_shock__mod__magnetic+AC_tini__mod__cparam)))
        peta_shock_280 = AC_eta_shock__mod__magnetic + AC_eta_shock_jump1__mod__magnetic*step_vector_return_value_265_280
        gradeta_shock_280.x = 0.
        gradeta_shock_280.y = 0.
        arg_266_280 = abs((ac_transformed_pencil_z_mn-AC_eta_zshock__mod__magnetic)/(-AC_eta_width_shock__mod__magnetic+AC_tini__mod__cparam))
        if (abs(arg_266_280)>=8.)  {
          der_step_return_value_266_280 = 2./-AC_eta_width_shock__mod__magnetic*exp(-2.*abs(arg_266_280))
        }
        else {
          der_step_return_value_266_280 = 0.5/(-AC_eta_width_shock__mod__magnetic*cosh(arg_266_280)*cosh(arg_266_280))
        }
        gradeta_shock_280.z = AC_eta_shock_jump1__mod__magnetic*der_step_return_value_266_280
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-peta_shock_280*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-peta_shock_280*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-peta_shock_280*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+  peta_shock_280*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.x+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.x)+ac_transformed_pencil_diva*ac_transformed_pencil_shock*gradeta_shock_280.x
          fres__mod__magnetic.y=fres__mod__magnetic.y+  peta_shock_280*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.y+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.y)+ac_transformed_pencil_diva*ac_transformed_pencil_shock*gradeta_shock_280.y
          fres__mod__magnetic.z=fres__mod__magnetic.z+  peta_shock_280*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.z+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.z)+ac_transformed_pencil_diva*ac_transformed_pencil_shock*gradeta_shock_280.z
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+peta_shock_280*ac_transformed_pencil_shock
      }
      if (AC_lresi_eta_shock_profr__mod__magnetic) {
        if (AC_lspherical_coords__mod__cdata || AC_lsphere_in_a_box__mod__cdata) {
          tmp1_280=ac_transformed_pencil_r_mn
        }
        else {
          tmp1_280=ac_transformed_pencil_rcyl_mn
        }
        step_vector_return_value_267_280 = 0.5*(1+tanh((tmp1_280-AC_eta_xshock__mod__magnetic)/(AC_eta_width_shock__mod__magnetic+AC_tini__mod__cparam)))
        peta_shock_280 = AC_eta_shock__mod__magnetic + AC_eta_shock_jump1__mod__magnetic*step_vector_return_value_267_280
        arg_268_280 = abs((tmp1_280-AC_eta_xshock__mod__magnetic)/(AC_eta_width_shock__mod__magnetic+AC_tini__mod__cparam))
        if (abs(arg_268_280)>=8.)  {
          der_step_return_value_268_280 = 2./AC_eta_width_shock__mod__magnetic*exp(-2.*abs(arg_268_280))
        }
        else {
          der_step_return_value_268_280 = 0.5/(AC_eta_width_shock__mod__magnetic*cosh(arg_268_280)*cosh(arg_268_280))
        }
        gradeta_shock_280.x = AC_eta_shock_jump1__mod__magnetic*der_step_return_value_268_280
        gradeta_shock_280.y = 0.
        gradeta_shock_280.z = 0.
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-peta_shock_280*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-peta_shock_280*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-peta_shock_280*ac_transformed_pencil_shock*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x + peta_shock_280*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.x+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.x)+  ac_transformed_pencil_diva*ac_transformed_pencil_shock*gradeta_shock_280.x
          fres__mod__magnetic.y=fres__mod__magnetic.y + peta_shock_280*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.y+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.y)+  ac_transformed_pencil_diva*ac_transformed_pencil_shock*gradeta_shock_280.y
          fres__mod__magnetic.z=fres__mod__magnetic.z + peta_shock_280*(ac_transformed_pencil_shock*ac_transformed_pencil_del2a.z+ac_transformed_pencil_diva*ac_transformed_pencil_gshock.z)+  ac_transformed_pencil_diva*ac_transformed_pencil_shock*gradeta_shock_280.z
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+peta_shock_280*ac_transformed_pencil_shock
      }
      if (AC_lresi_eta_shock_perp__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock_perp*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock_perp*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock_perp*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+ AC_eta_shock__mod__magnetic*(ac_transformed_pencil_shock_perp*ac_transformed_pencil_del2a.x+ac_transformed_pencil_diva*ac_transformed_pencil_gshock_perp.x)
          fres__mod__magnetic.y=fres__mod__magnetic.y+ AC_eta_shock__mod__magnetic*(ac_transformed_pencil_shock_perp*ac_transformed_pencil_del2a.y+ac_transformed_pencil_diva*ac_transformed_pencil_gshock_perp.y)
          fres__mod__magnetic.z=fres__mod__magnetic.z+ AC_eta_shock__mod__magnetic*(ac_transformed_pencil_shock_perp*ac_transformed_pencil_del2a.z+ac_transformed_pencil_diva*ac_transformed_pencil_gshock_perp.z)
        }
        eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_shock__mod__magnetic*ac_transformed_pencil_shock_perp
      }
      if (AC_lresi_etava__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x = fres__mod__magnetic.x - ac_transformed_pencil_etava * ac_transformed_pencil_jj.x
          fres__mod__magnetic.y = fres__mod__magnetic.y - ac_transformed_pencil_etava * ac_transformed_pencil_jj.y
          fres__mod__magnetic.z = fres__mod__magnetic.z - ac_transformed_pencil_etava * ac_transformed_pencil_jj.z
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + ac_transformed_pencil_etava
      }
      if (AC_lresi_vaspeed__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x = fres__mod__magnetic.x - ac_transformed_pencil_etava * ac_transformed_pencil_jj.x
          fres__mod__magnetic.y = fres__mod__magnetic.y - ac_transformed_pencil_etava * ac_transformed_pencil_jj.y
          fres__mod__magnetic.z = fres__mod__magnetic.z - ac_transformed_pencil_etava * ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x = fres__mod__magnetic.x + AC_mu0__mod__cdata * ac_transformed_pencil_etava * ac_transformed_pencil_del2a.x + AC_eta_va__mod__magnetic/AC_varms__mod__magnetic * ac_transformed_pencil_diva * ac_transformed_pencil_gva.x
          fres__mod__magnetic.y = fres__mod__magnetic.y + AC_mu0__mod__cdata * ac_transformed_pencil_etava * ac_transformed_pencil_del2a.y + AC_eta_va__mod__magnetic/AC_varms__mod__magnetic * ac_transformed_pencil_diva * ac_transformed_pencil_gva.y
          fres__mod__magnetic.z = fres__mod__magnetic.z + AC_mu0__mod__cdata * ac_transformed_pencil_etava * ac_transformed_pencil_del2a.z + AC_eta_va__mod__magnetic/AC_varms__mod__magnetic * ac_transformed_pencil_diva * ac_transformed_pencil_gva.z
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + ac_transformed_pencil_etava
      }
      if (AC_lresi_etaj__mod__magnetic) {
        fres__mod__magnetic.x = fres__mod__magnetic.x - ac_transformed_pencil_etaj * ac_transformed_pencil_jj.x
        fres__mod__magnetic.y = fres__mod__magnetic.y - ac_transformed_pencil_etaj * ac_transformed_pencil_jj.y
        fres__mod__magnetic.z = fres__mod__magnetic.z - ac_transformed_pencil_etaj * ac_transformed_pencil_jj.z
        eta_total__mod__magnetic = eta_total__mod__magnetic + ac_transformed_pencil_etaj
      }
      if (AC_lresi_etaj2__mod__magnetic) {
        fres__mod__magnetic.x = fres__mod__magnetic.x - ac_transformed_pencil_etaj2 * ac_transformed_pencil_jj.x
        fres__mod__magnetic.y = fres__mod__magnetic.y - ac_transformed_pencil_etaj2 * ac_transformed_pencil_jj.y
        fres__mod__magnetic.z = fres__mod__magnetic.z - ac_transformed_pencil_etaj2 * ac_transformed_pencil_jj.z
        eta_total__mod__magnetic = eta_total__mod__magnetic + ac_transformed_pencil_etaj2
      }
      if (AC_lresi_etajrho__mod__magnetic) {
        fres__mod__magnetic.x = fres__mod__magnetic.x - ac_transformed_pencil_etajrho * ac_transformed_pencil_jj.x
        fres__mod__magnetic.y = fres__mod__magnetic.y - ac_transformed_pencil_etajrho * ac_transformed_pencil_jj.y
        fres__mod__magnetic.z = fres__mod__magnetic.z - ac_transformed_pencil_etajrho * ac_transformed_pencil_jj.z
        eta_total__mod__magnetic = eta_total__mod__magnetic + ac_transformed_pencil_etajrho
      }
      if (AC_lresi_smagorinsky__mod__magnetic) {
        if (!AC_lweyl_gauge__mod__magnetic) {
          if (AC_letasmag_as_aux__mod__magnetic) {
            eta_smag__mod__magnetic=pow((AC_d_smag__mod__magnetic*AC_dxmax__mod__cdata),2.)*sqrt(ac_transformed_pencil_j2)
            fres__mod__magnetic = eta_smag__mod__magnetic+AC_eta__mod__magnetic*ac_transformed_pencil_del2a
            geta_280 = gradient(Field(AC_ietasmag__mod__cdata-1))
            fres__mod__magnetic.x=fres__mod__magnetic.x+geta_280.x*ac_transformed_pencil_diva
            fres__mod__magnetic.y=fres__mod__magnetic.y+geta_280.y*ac_transformed_pencil_diva
            fres__mod__magnetic.z=fres__mod__magnetic.z+geta_280.z*ac_transformed_pencil_diva
          }
          else {
            eta_smag__mod__magnetic=pow((AC_d_smag__mod__magnetic*AC_dxmax__mod__cdata),2.)*sqrt(ac_transformed_pencil_j2)
            fres__mod__magnetic = eta_smag__mod__magnetic+AC_eta__mod__magnetic*ac_transformed_pencil_del2a
          }
        }
        else {
          eta_smag__mod__magnetic=pow((AC_d_smag__mod__magnetic*AC_dxmax__mod__cdata),2.)*sqrt(ac_transformed_pencil_j2)
          fres__mod__magnetic.x=fres__mod__magnetic.x-eta_smag__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-eta_smag__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-eta_smag__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
      }
      if (AC_lresi_smagorinsky_nusmag__mod__magnetic) {
        eta_smag__mod__magnetic=AC_pm_smag1__mod__magnetic*ac_transformed_pencil_nu_smag
        fres__mod__magnetic = eta_smag__mod__magnetic+AC_eta__mod__magnetic*ac_transformed_pencil_del2a
        geta_280 = gradient(Field(AC_inusmag__mod__cdata-1))
        fres__mod__magnetic.x=fres__mod__magnetic.x+AC_pm_smag1__mod__magnetic*geta_280.x*ac_transformed_pencil_diva
        fres__mod__magnetic.y=fres__mod__magnetic.y+AC_pm_smag1__mod__magnetic*geta_280.y*ac_transformed_pencil_diva
        fres__mod__magnetic.z=fres__mod__magnetic.z+AC_pm_smag1__mod__magnetic*geta_280.z*ac_transformed_pencil_diva
      }
      if (AC_lresi_smagorinsky_cross__mod__magnetic) {
        sign_jo_280=1.
        if (ac_transformed_pencil_jo < 0) {
          sign_jo_280=-1.
        }
        eta_smag__mod__magnetic=pow((AC_d_smag__mod__magnetic*AC_dxmax__mod__cdata),2.)*sign_jo_280*sqrt(ac_transformed_pencil_jo*sign_jo_280)
        fres__mod__magnetic = eta_smag__mod__magnetic+AC_eta__mod__magnetic*ac_transformed_pencil_del2a
      }
      if (AC_lresi_smagorinsky__mod__magnetic  ||  AC_lresi_smagorinsky_nusmag__mod__magnetic  ||  AC_lresi_smagorinsky_cross__mod__magnetic) {
        eta_total__mod__magnetic = eta_total__mod__magnetic + eta_smag__mod__magnetic
      }
      if (AC_lresi_anomalous__mod__magnetic) {
        vdrift_280=sqrt(sum(ac_transformed_pencil_jj*ac_transformed_pencil_jj))*ac_transformed_pencil_rho1
        if (AC_lweyl_gauge__mod__magnetic) {
          if (AC_eta_anom_thresh__mod__magnetic!=0) {
            if (AC_eta_anom__mod__magnetic*vdrift_280 > AC_eta_anom_thresh__mod__magnetic*AC_vcrit_anom__mod__magnetic) {
              fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_anom_thresh__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
            }
            else {
              fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
            }
          }
          else {
            if (vdrift_280>AC_vcrit_anom__mod__magnetic) {
              fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
            }
          }
          if (AC_eta_anom_thresh__mod__magnetic!=0) {
            if (AC_eta_anom__mod__magnetic*vdrift_280 > AC_eta_anom_thresh__mod__magnetic*AC_vcrit_anom__mod__magnetic) {
              fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_anom_thresh__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
            }
            else {
              fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
            }
          }
          else {
            if (vdrift_280>AC_vcrit_anom__mod__magnetic) {
              fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
            }
          }
          if (AC_eta_anom_thresh__mod__magnetic!=0) {
            if (AC_eta_anom__mod__magnetic*vdrift_280 > AC_eta_anom_thresh__mod__magnetic*AC_vcrit_anom__mod__magnetic) {
              fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_anom_thresh__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
            }
            else {
              fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
            }
          }
          else {
            if (vdrift_280>AC_vcrit_anom__mod__magnetic) {
              fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
            }
          }
        }
        else {
        }
        if (AC_eta_anom_thresh__mod__magnetic!=0) {
          if (AC_eta_anom__mod__magnetic*vdrift_280 > AC_eta_anom_thresh__mod__magnetic*AC_vcrit_anom__mod__magnetic) {
            eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_anom_thresh__mod__magnetic
          }
          else {
            eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic
          }
        }
        else {
          if (vdrift_280>AC_vcrit_anom__mod__magnetic) {
            eta_total__mod__magnetic=eta_total__mod__magnetic+AC_eta_anom__mod__magnetic*vdrift_280/AC_vcrit_anom__mod__magnetic
          }
        }
      }
      if (AC_lresi_spitzer__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)*(ac_transformed_pencil_del2a.x-1.5*ac_transformed_pencil_diva*ac_transformed_pencil_glntt.x)
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)*(ac_transformed_pencil_del2a.y-1.5*ac_transformed_pencil_diva*ac_transformed_pencil_glntt.y)
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)*(ac_transformed_pencil_del2a.z-1.5*ac_transformed_pencil_diva*ac_transformed_pencil_glntt.z)
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta_spitzer__mod__magnetic*exp(-1.5*ac_transformed_pencil_lntt)
      }
      if (AC_lresi_cspeed__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)*(ac_transformed_pencil_del2a.x+0.5*ac_transformed_pencil_diva*ac_transformed_pencil_glntt.x)
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)*(ac_transformed_pencil_del2a.y+0.5*ac_transformed_pencil_diva*ac_transformed_pencil_glntt.y)
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)*(ac_transformed_pencil_del2a.z+0.5*ac_transformed_pencil_diva*ac_transformed_pencil_glntt.z)
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta__mod__magnetic*exp(AC_eta_cspeed__mod__magnetic*ac_transformed_pencil_lntt)
      }
      if (AC_lresi_eta_proptouz__mod__magnetic) {
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*ac_transformed_pencil_uu.z*AC_mu0__mod__cdata*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*ac_transformed_pencil_uu.z*AC_mu0__mod__cdata*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*ac_transformed_pencil_uu.z*AC_mu0__mod__cdata*ac_transformed_pencil_jj.z
        }
        else {
          fres__mod__magnetic.x=fres__mod__magnetic.x+AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*(ac_transformed_pencil_uu.z*ac_transformed_pencil_del2a.x+ac_transformed_pencil_uij[3-1][1-1]*ac_transformed_pencil_diva)
          fres__mod__magnetic.y=fres__mod__magnetic.y+AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*(ac_transformed_pencil_uu.z*ac_transformed_pencil_del2a.y+ac_transformed_pencil_uij[3-1][2-1]*ac_transformed_pencil_diva)
          fres__mod__magnetic.z=fres__mod__magnetic.z+AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*(ac_transformed_pencil_uu.z*ac_transformed_pencil_del2a.z+ac_transformed_pencil_uij[3-1][3-1]*ac_transformed_pencil_diva)
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta__mod__magnetic*AC_ampl_eta_uz__mod__magnetic*ac_transformed_pencil_uu.z
      }
      if (AC_lresi_magfield__mod__magnetic) {
        eta_bb_280=AC_eta__mod__magnetic/(1.+AC_etab__mod__magnetic*ac_transformed_pencil_bb.y*ac_transformed_pencil_bb.y)
        if (AC_lweyl_gauge__mod__magnetic) {
          fres__mod__magnetic.x=fres__mod__magnetic.x-AC_mu0__mod__cdata*eta_bb_280*ac_transformed_pencil_jj.x
          fres__mod__magnetic.y=fres__mod__magnetic.y-AC_mu0__mod__cdata*eta_bb_280*ac_transformed_pencil_jj.y
          fres__mod__magnetic.z=fres__mod__magnetic.z-AC_mu0__mod__cdata*eta_bb_280*ac_transformed_pencil_jj.z
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + eta_bb_280
      }
      if (AC_eta_aniso_bb__mod__magnetic!=0.0) {
        if (ac_transformed_pencil_b2==0.) {
          tmp1_280=0.
        }
        else {
          tmp1_280=AC_eta_aniso_bb__mod__magnetic/ac_transformed_pencil_b2
        }
        if (AC_lquench_eta_aniso__mod__magnetic) {
          tmp1_280=tmp1_280/(1.+AC_quench_aniso__mod__magnetic*AC_arms__mod__magnetic)
        }
        ju_280=1-1+AC_iaa__mod__cdata
        DF_U_280=DF_U_280-tmp1_280*ac_transformed_pencil_jb*ac_transformed_pencil_bb.x
        ju_280=2-1+AC_iaa__mod__cdata
        DF_U_280=DF_U_280-tmp1_280*ac_transformed_pencil_jb*ac_transformed_pencil_bb.y
        ju_280=3-1+AC_iaa__mod__cdata
        DF_U_280=DF_U_280-tmp1_280*ac_transformed_pencil_jb*ac_transformed_pencil_bb.z
        eta_total__mod__magnetic = eta_total__mod__magnetic + AC_eta_aniso_bb__mod__magnetic
      }
      if (AC_lambipolar_diffusion__mod__magnetic) {
        ju_280=1-1+AC_iaa__mod__cdata
        DF_U_280=DF_U_280+ac_transformed_pencil_nu_ni1*ac_transformed_pencil_jxbrxb.x
        ju_280=2-1+AC_iaa__mod__cdata
        DF_U_280=DF_U_280+ac_transformed_pencil_nu_ni1*ac_transformed_pencil_jxbrxb.y
        ju_280=3-1+AC_iaa__mod__cdata
        DF_U_280=DF_U_280+ac_transformed_pencil_nu_ni1*ac_transformed_pencil_jxbrxb.z
        if (AC_lentropy__mod__cparam  &&  AC_lneutralion_heat__mod__magnetic) {
          if (AC_pretend_lntt__mod__cdata) {
            DF_SS = DF_SS + ac_transformed_pencil_cv1*ac_transformed_pencil_tt1*ac_transformed_pencil_nu_ni1*ac_transformed_pencil_jxbr2
          }
          else {
            DF_SS = DF_SS + ac_transformed_pencil_tt1*ac_transformed_pencil_nu_ni1*ac_transformed_pencil_jxbr2
          }
        }
        else if (AC_ltemperature__mod__cparam  &&  AC_lneutralion_heat__mod__magnetic) {
          DF_LNTT = DF_LNTT + ac_transformed_pencil_cv1*ac_transformed_pencil_tt1*ac_transformed_pencil_nu_ni1*ac_transformed_pencil_jxbr2
        }
        eta_total__mod__magnetic = eta_total__mod__magnetic + ac_transformed_pencil_nu_ni1*ac_transformed_pencil_va2
      }
      if (AC_lmean_friction__mod__magnetic) {
      }
      else if (AC_llocal_friction__mod__magnetic) {
        dadt_280 = dadt_280-AC_llambda_aa__mod__magnetic*ac_transformed_pencil_aa
      }
      if (AC_lmagnetic_slope_limited__mod__magnetic && AC_llast__mod__cdata) {
        if (AC_lsld_bb__mod__magnetic) {
          not_implemented("calc_slope_diff_flux")
          not_implemented("calc_slope_diff_flux")
          not_implemented("calc_slope_diff_flux")
          tmp2_280.x= (-d_sld_flux_280[2-1][3-1] + d_sld_flux_280[3-1][2-1])*AC_fac_sld_magn__mod__magnetic
          tmp2_280.y= (-d_sld_flux_280[3-1][1-1] + d_sld_flux_280[1-1][3-1])*AC_fac_sld_magn__mod__magnetic
          tmp2_280.z= (-d_sld_flux_280[1-1][2-1] + d_sld_flux_280[2-1][1-1])*AC_fac_sld_magn__mod__magnetic
          fres__mod__magnetic=fres__mod__magnetic + tmp2_280
        }
        else {
          if (AC_lcylindrical_coords__mod__cdata  ||  AC_lspherical_coords__mod__cdata) {
            not_implemented("calc_slope_diff_flux")
            not_implemented("calc_slope_diff_flux")
            not_implemented("calc_slope_diff_flux")
            if (AC_lcylindrical_coords__mod__cdata) {
              fres__mod__magnetic.x=fres__mod__magnetic.x+tmp2_280.x-(d_sld_flux_280[2-1][2-1])/AC_x__mod__cdata[vertexIdx.x]
              fres__mod__magnetic.y=fres__mod__magnetic.y+tmp2_280.y+(d_sld_flux_280[2-1][1-1])/AC_x__mod__cdata[vertexIdx.x]
              fres__mod__magnetic.z=fres__mod__magnetic.z+tmp2_280.z
            }
            else if(AC_lspherical_coords__mod__cdata) {
              fres__mod__magnetic.x=fres__mod__magnetic.x+tmp2_280.x-(d_sld_flux_280[2-1][2-1]+d_sld_flux_280[3-1][3-1])/AC_x__mod__cdata[vertexIdx.x]
              fres__mod__magnetic.y=fres__mod__magnetic.y+tmp2_280.y+(d_sld_flux_280[2-1][1-1]-d_sld_flux_280[3-1][3-1]*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/AC_x__mod__cdata[vertexIdx.x]
              fres__mod__magnetic.z=fres__mod__magnetic.z+tmp2_280.z+(d_sld_flux_280[3-1][1-1]+d_sld_flux_280[3-1][2-1]*AC_cotth__mod__cdata[AC_m__mod__cdata-1])/AC_x__mod__cdata[vertexIdx.x]
            }
          }
          else {
            not_implemented("calc_slope_diff_flux")
            not_implemented("calc_slope_diff_flux")
            not_implemented("calc_slope_diff_flux")
            fres__mod__magnetic=fres__mod__magnetic+tmp2_280
          }
        }
        if (AC_lohmic_heat__mod__magnetic) {
          tmp1_280 = dot(tmp2_280,ac_transformed_pencil_jj)
          if (AC_lentropy__mod__cparam) {
            if (AC_pretend_lntt__mod__cdata) {
              DF_SS = DF_SS + ac_transformed_pencil_cv1*max(0.0,tmp1_280)*ac_transformed_pencil_rho1*ac_transformed_pencil_tt1
            }
            else {
              DF_SS = DF_SS + max(0.0,tmp1_280)*ac_transformed_pencil_rho1*ac_transformed_pencil_tt1
            }
          }
          else if (AC_ltemperature__mod__cparam) {
            if (AC_ltemperature_nolog__mod__cdata) {
              DF_TT   = DF_TT + ac_transformed_pencil_cv1*max(0.0,tmp1_280)*ac_transformed_pencil_rho1
            }
            else {
              DF_LNTT = DF_LNTT + ac_transformed_pencil_cv1*max(0.0,tmp1_280)*ac_transformed_pencil_rho1*ac_transformed_pencil_tt1
            }
          }
          else if (AC_lthermal_energy__mod__cparam) {
            DF_ETH = DF_ETH + max(0.0,tmp1_280)
          }
        }
      }
      if (AC_lno_ohmic_heat_bound_z__mod__magnetic && AC_lohmic_heat__mod__magnetic) {
        if (false) {
        }
        else {
          relshift_270_280=0.0
        }
        xi_270_280 = (AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_no_ohmic_heat_z0__mod__magnetic)/(AC_no_ohmic_heat_zwidth__mod__magnetic+AC_tini__mod__cparam) - relshift_270_280
        xi_270_280 = max(xi_270_280,-1.0)
        xi_270_280 = min(xi_270_280, 1.0)
        cubic_step_pt_return_value_270_280 = 0.5 + xi_270_280*(0.75-xi_270_280*xi_270_280*0.25)
        eta_heat_280=eta_total__mod__magnetic*cubic_step_pt_return_value_270_280
      }
      else {
        eta_heat_280=eta_total__mod__magnetic
      }
      if (!AC_lkinematic__mod__magnetic && AC_lohmic_heat__mod__magnetic) {
        if (AC_lentropy__mod__cparam) {
          if (AC_pretend_lntt__mod__cdata) {
            DF_SS = DF_SS + ac_transformed_pencil_cv1*eta_heat_280*AC_mu0__mod__cdata*ac_transformed_pencil_j2*ac_transformed_pencil_rho1*ac_transformed_pencil_tt1
          }
          else {
            DF_SS = DF_SS + eta_heat_280*AC_mu0__mod__cdata*ac_transformed_pencil_j2*ac_transformed_pencil_rho1*ac_transformed_pencil_tt1
          }
        }
        else if (AC_ltemperature__mod__cparam) {
          if (AC_ltemperature_nolog__mod__cdata) {
            DF_TT   = DF_TT + ac_transformed_pencil_cv1*eta_heat_280*AC_mu0__mod__cdata*ac_transformed_pencil_j2*ac_transformed_pencil_rho1
          }
          else {
            DF_LNTT = DF_LNTT + ac_transformed_pencil_cv1*eta_heat_280*AC_mu0__mod__cdata*ac_transformed_pencil_j2*ac_transformed_pencil_rho1*ac_transformed_pencil_tt1
          }
        }
        else if (AC_lthermal_energy__mod__cparam) {
          DF_ETH = DF_ETH + eta_heat_280*AC_mu0__mod__cdata*ac_transformed_pencil_j2
        }
      }
      if (AC_lfrozen_bb_bot__mod__magnetic.x && AC_lfirst_proc_z__mod__cdata && AC_n__mod__cdata==AC_n1__mod__cparam) {
        fres__mod__magnetic.x=0.
      }
      if (AC_lfrozen_bb_top__mod__magnetic.x && AC_llast_proc_z__mod__cdata && AC_n__mod__cdata==AC_n2__mod__cdata) {
        fres__mod__magnetic.x=0.
      }
      if (AC_lfrozen_bb_bot__mod__magnetic.y && AC_lfirst_proc_z__mod__cdata && AC_n__mod__cdata==AC_n1__mod__cparam) {
        fres__mod__magnetic.y=0.
      }
      if (AC_lfrozen_bb_top__mod__magnetic.y && AC_llast_proc_z__mod__cdata && AC_n__mod__cdata==AC_n2__mod__cdata) {
        fres__mod__magnetic.y=0.
      }
      if (AC_lfrozen_bb_bot__mod__magnetic.z && AC_lfirst_proc_z__mod__cdata && AC_n__mod__cdata==AC_n1__mod__cparam) {
        fres__mod__magnetic.z=0.
      }
      if (AC_lfrozen_bb_top__mod__magnetic.z && AC_llast_proc_z__mod__cdata && AC_n__mod__cdata==AC_n2__mod__cdata) {
        fres__mod__magnetic.z=0.
      }
      if (!AC_lupw_aa__mod__magnetic) {
        if (AC_linduction__mod__magnetic) {
          if (AC_ladvective_gauge__mod__magnetic) {
            if (b_ext_280.x != 0.  ||  b_ext_280.y != 0.  ||  b_ext_280.z != 0.) {
              ujiaj_280 = cross(ac_transformed_pencil_uu,b_ext_280)
            }
            else {
              if (AC_lfargo_advection__mod__cdata) {
                ajiuj_280.x = 0.
                ajiuj_280.y = 0.
                ajiuj_280.z = 0.
              }
              else {
                ujiaj_280.x = 0.
                ujiaj_280.y = 0.
                ujiaj_280.z = 0.
              }
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.x=ajiuj_280.x+ac_transformed_pencil_uu.x*ac_transformed_pencil_aij[1-1][1-1]
            }
            else {
              ujiaj_280.x=ujiaj_280.x+ac_transformed_pencil_aa.x*ac_transformed_pencil_uij[1-1][1-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.x=ajiuj_280.x+ac_transformed_pencil_uu.y*ac_transformed_pencil_aij[2-1][1-1]
            }
            else {
              ujiaj_280.x=ujiaj_280.x+ac_transformed_pencil_aa.y*ac_transformed_pencil_uij[2-1][1-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.x=ajiuj_280.x+ac_transformed_pencil_uu.z*ac_transformed_pencil_aij[3-1][1-1]
            }
            else {
              ujiaj_280.x=ujiaj_280.x+ac_transformed_pencil_aa.z*ac_transformed_pencil_uij[3-1][1-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.y=ajiuj_280.y+ac_transformed_pencil_uu.x*ac_transformed_pencil_aij[1-1][2-1]
            }
            else {
              ujiaj_280.y=ujiaj_280.y+ac_transformed_pencil_aa.x*ac_transformed_pencil_uij[1-1][2-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.y=ajiuj_280.y+ac_transformed_pencil_uu.y*ac_transformed_pencil_aij[2-1][2-1]
            }
            else {
              ujiaj_280.y=ujiaj_280.y+ac_transformed_pencil_aa.y*ac_transformed_pencil_uij[2-1][2-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.y=ajiuj_280.y+ac_transformed_pencil_uu.z*ac_transformed_pencil_aij[3-1][2-1]
            }
            else {
              ujiaj_280.y=ujiaj_280.y+ac_transformed_pencil_aa.z*ac_transformed_pencil_uij[3-1][2-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.z=ajiuj_280.z+ac_transformed_pencil_uu.x*ac_transformed_pencil_aij[1-1][3-1]
            }
            else {
              ujiaj_280.z=ujiaj_280.z+ac_transformed_pencil_aa.x*ac_transformed_pencil_uij[1-1][3-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.z=ajiuj_280.z+ac_transformed_pencil_uu.y*ac_transformed_pencil_aij[2-1][3-1]
            }
            else {
              ujiaj_280.z=ujiaj_280.z+ac_transformed_pencil_aa.y*ac_transformed_pencil_uij[2-1][3-1]
            }
            if (AC_lfargo_advection__mod__cdata) {
              ajiuj_280.z=ajiuj_280.z+ac_transformed_pencil_uu.z*ac_transformed_pencil_aij[3-1][3-1]
            }
            else {
              ujiaj_280.z=ujiaj_280.z+ac_transformed_pencil_aa.z*ac_transformed_pencil_uij[3-1][3-1]
            }
            if (AC_lcylindrical_coords__mod__cdata) {
              if (AC_lfargo_advection__mod__cdata) {
                ajiuj_280.y = ajiuj_280.y + (ac_transformed_pencil_aa.x*ac_transformed_pencil_uu.y - ac_transformed_pencil_aa.y*ac_transformed_pencil_uu.x)*AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL]
              }
              else {
                ujiaj_280.y = ujiaj_280.y + (ac_transformed_pencil_uu.x*ac_transformed_pencil_aa.y - ac_transformed_pencil_uu.y*ac_transformed_pencil_aa.x)*AC_rcyl_mn1__mod__cdata[vertexIdx.x-NGHOST_VAL]
              }
            }
            else if (AC_lspherical_coords__mod__cdata) {
              ujiaj_280.y = ujiaj_280.y + (ac_transformed_pencil_uu.x*ac_transformed_pencil_aa.y - ac_transformed_pencil_uu.y*ac_transformed_pencil_aa.x)*AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL]
              ujiaj_280.z = ujiaj_280.z + (ac_transformed_pencil_uu.x*ac_transformed_pencil_aa.z          -  ac_transformed_pencil_uu.z*ac_transformed_pencil_aa.x          +  ac_transformed_pencil_uu.y*ac_transformed_pencil_aa.z*AC_cotth__mod__cdata[AC_m__mod__cdata-1] -  ac_transformed_pencil_uu.z*ac_transformed_pencil_aa.z*AC_cotth__mod__cdata[AC_m__mod__cdata-1])*AC_r1_mn__mod__cdata[vertexIdx.x-NGHOST_VAL]
            }
            if (!AC_lfargo_advection__mod__cdata) {
              dadt_280 = dadt_280-ac_transformed_pencil_uga-ujiaj_280+fres__mod__magnetic
            }
            else {
              dadt_280 = dadt_280-ac_transformed_pencil_uuadvec_gaa+ajiuj_280+fres__mod__magnetic
            }
          }
          else if (AC_ladvective_gauge2__mod__magnetic) {
            if (AC_lua_as_aux__mod__magnetic) {
              gua_280 = gradient(Field(AC_iua__mod__magnetic-1))
              dadt_280 = dadt_280 + ac_transformed_pencil_uxb+fres__mod__magnetic-gua_280
            }
            else {
            }
          }
          else {
            dadt_280 = dadt_280+ ac_transformed_pencil_uxb+fres__mod__magnetic
          }
          if (AC_lnoinduction__mod__magnetic) {
            dadt_280 = dadt_280 - ac_transformed_pencil_uxb
          }
        }
      }
      else {
        if (b_ext_280.x != 0.  ||  b_ext_280.y != 0.  ||  b_ext_280.z != 0.) {
          uxb_upw_280 = cross(ac_transformed_pencil_uu,b_ext_280)
        }
        else {
          uxb_upw_280.x = 0.
          uxb_upw_280.y = 0.
          uxb_upw_280.z = 0.
        }
        if (AC_ladvective_gauge__mod__magnetic) {
          ujiaj_280.x = 0.
          ujiaj_280.y = 0.
          ujiaj_280.z = 0.
          ujiaj_280.x=ujiaj_280.x+ac_transformed_pencil_aa.x*ac_transformed_pencil_uij[1-1][1-1]
          ujiaj_280.x=ujiaj_280.x+ac_transformed_pencil_aa.y*ac_transformed_pencil_uij[2-1][1-1]
          ujiaj_280.x=ujiaj_280.x+ac_transformed_pencil_aa.z*ac_transformed_pencil_uij[3-1][1-1]
          uxb_upw_280.x=uxb_upw_280.x-ac_transformed_pencil_uga.x-ujiaj_280.x
          ujiaj_280.y=ujiaj_280.y+ac_transformed_pencil_aa.x*ac_transformed_pencil_uij[1-1][2-1]
          ujiaj_280.y=ujiaj_280.y+ac_transformed_pencil_aa.y*ac_transformed_pencil_uij[2-1][2-1]
          ujiaj_280.y=ujiaj_280.y+ac_transformed_pencil_aa.z*ac_transformed_pencil_uij[3-1][2-1]
          uxb_upw_280.y=uxb_upw_280.y-ac_transformed_pencil_uga.y-ujiaj_280.y
          ujiaj_280.z=ujiaj_280.z+ac_transformed_pencil_aa.x*ac_transformed_pencil_uij[1-1][3-1]
          ujiaj_280.z=ujiaj_280.z+ac_transformed_pencil_aa.y*ac_transformed_pencil_uij[2-1][3-1]
          ujiaj_280.z=ujiaj_280.z+ac_transformed_pencil_aa.z*ac_transformed_pencil_uij[3-1][3-1]
          uxb_upw_280.z=uxb_upw_280.z-ac_transformed_pencil_uga.z-ujiaj_280.z
        }
        else {
          if (1!=1) {
            uxb_upw_280.x=uxb_upw_280.x+ac_transformed_pencil_uu.x*(ac_transformed_pencil_aij[1-1][1-1]-ac_transformed_pencil_aij[1-1][1-1])
          }
          if (2!=1) {
            uxb_upw_280.x=uxb_upw_280.x+ac_transformed_pencil_uu.y*(ac_transformed_pencil_aij[2-1][1-1]-ac_transformed_pencil_aij[1-1][2-1])
          }
          if (3!=1) {
            uxb_upw_280.x=uxb_upw_280.x+ac_transformed_pencil_uu.z*(ac_transformed_pencil_aij[3-1][1-1]-ac_transformed_pencil_aij[1-1][3-1])
          }
          msk_271_280=0
          if (true) {
            if ( 1>=1  &&  1 <=3 ) {
              msk_271_280=1
            }
          }
          del6f_upwind_271_280 = del6_upwd_masked(Field(AC_iaa__mod__cdata+1-1-1), msk_271_280)
          if (msk_271_280>0) {
            uxb_upw_280.x = uxb_upw_280.x+del6f_upwind_271_280
          }
          else {
            uxb_upw_280.x = uxb_upw_280.x-del6f_upwind_271_280
          }
          if (1!=2) {
            uxb_upw_280.y=uxb_upw_280.y+ac_transformed_pencil_uu.x*(ac_transformed_pencil_aij[1-1][2-1]-ac_transformed_pencil_aij[2-1][1-1])
          }
          if (2!=2) {
            uxb_upw_280.y=uxb_upw_280.y+ac_transformed_pencil_uu.y*(ac_transformed_pencil_aij[2-1][2-1]-ac_transformed_pencil_aij[2-1][2-1])
          }
          if (3!=2) {
            uxb_upw_280.y=uxb_upw_280.y+ac_transformed_pencil_uu.z*(ac_transformed_pencil_aij[3-1][2-1]-ac_transformed_pencil_aij[2-1][3-1])
          }
          msk_271_280=0
          if (true) {
            if ( 2>=1  &&  2 <=3 ) {
              msk_271_280=2
            }
          }
          del6f_upwind_271_280 = del6_upwd_masked(Field(AC_iaa__mod__cdata+2-1-1), msk_271_280)
          if (msk_271_280>0) {
            uxb_upw_280.y = uxb_upw_280.y+del6f_upwind_271_280
          }
          else {
            uxb_upw_280.y = uxb_upw_280.y-del6f_upwind_271_280
          }
          if (1!=3) {
            uxb_upw_280.z=uxb_upw_280.z+ac_transformed_pencil_uu.x*(ac_transformed_pencil_aij[1-1][3-1]-ac_transformed_pencil_aij[3-1][1-1])
          }
          if (2!=3) {
            uxb_upw_280.z=uxb_upw_280.z+ac_transformed_pencil_uu.y*(ac_transformed_pencil_aij[2-1][3-1]-ac_transformed_pencil_aij[3-1][2-1])
          }
          if (3!=3) {
            uxb_upw_280.z=uxb_upw_280.z+ac_transformed_pencil_uu.z*(ac_transformed_pencil_aij[3-1][3-1]-ac_transformed_pencil_aij[3-1][3-1])
          }
          msk_271_280=0
          if (true) {
            if ( 3>=1  &&  3 <=3 ) {
              msk_271_280=3
            }
          }
          del6f_upwind_271_280 = del6_upwd_masked(Field(AC_iaa__mod__cdata+3-1-1), msk_271_280)
          if (msk_271_280>0) {
            uxb_upw_280.z = uxb_upw_280.z+del6f_upwind_271_280
          }
          else {
            uxb_upw_280.z = uxb_upw_280.z-del6f_upwind_271_280
          }
        }
        if (AC_linduction__mod__magnetic) {
          dadt_280= dadt_280 + uxb_upw_280 + fres__mod__magnetic
        }
      }
      if(AC_limp_alpha__mod__magnetic) {
        if (abs(AC_z__mod__cdata[AC_n__mod__cdata-1])<=AC_imp_halpha__mod__magnetic/2) {
          dadt_280 = dadt_280+AC_imp_alpha0__mod__magnetic*sin(AC_pi__mod__cparam*AC_z__mod__cdata[AC_n__mod__cdata-1]/AC_imp_halpha__mod__magnetic)*ac_transformed_pencil_bb
        }
        else {
          dadt_280 = dadt_280+sign(AC_imp_alpha0__mod__magnetic,AC_z__mod__cdata[AC_n__mod__cdata-1])*exp(-((2*AC_z__mod__cdata[AC_n__mod__cdata-1]-sign(AC_imp_halpha__mod__magnetic,AC_z__mod__cdata[AC_n__mod__cdata-1]))/AC_imp_halpha__mod__magnetic)*((2*AC_z__mod__cdata[AC_n__mod__cdata-1]-sign(AC_imp_halpha__mod__magnetic,AC_z__mod__cdata[AC_n__mod__cdata-1]))/AC_imp_halpha__mod__magnetic))*ac_transformed_pencil_bb
        }
      }
      if (AC_hall_term__mod__magnetic!=0.0) {
        if(AC_string_enum_ihall_term__mod__magnetic == AC_string_enum_const_string__mod__cparam) {
          hall_term__280=AC_hall_term__mod__magnetic
        }
        else if(AC_string_enum_ihall_term__mod__magnetic == AC_string_enum_tzdep_string__mod__cparam) {
          hall_term__280=AC_hall_term__mod__magnetic*pow(max(AC_t__mod__cdata,AC_hall_tdep_t0__mod__magnetic),AC_hall_tdep_exponent__mod__magnetic)
        }
        else if(AC_string_enum_ihall_term__mod__magnetic == AC_string_enum_zzdep_string__mod__cparam) {
          hall_term__280=AC_hall_term__mod__magnetic/pow((1.-(AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_xyz1__mod__cdata.z)/AC_hhall__mod__magnetic),AC_hall_zdep_exponent__mod__magnetic)
        }
        dadt_280=dadt_280-hall_term__280*ac_transformed_pencil_jxb
        if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
          advec_hall_280=sum(abs(ac_transformed_pencil_uu-hall_term__280*ac_transformed_pencil_jj)*dline_1__mod__cdata)
          advec2__mod__cdata=advec2__mod__cdata+advec_hall_280*advec_hall_280
        }
      }
      if (AC_battery_term__mod__magnetic!=0.0) {
        dadt_280 = dadt_280-AC_battery_term__mod__magnetic*ac_transformed_pencil_fpres
      }
      if (AC_lambipolar_strong_coupling__mod__magnetic && AC_tauad__mod__magnetic!=0.0) {
        dadt_280=dadt_280+AC_tauad__mod__magnetic*ac_transformed_pencil_jxbxb
        eta_total__mod__magnetic = eta_total__mod__magnetic + AC_tauad__mod__magnetic*AC_mu01__mod__cdata*ac_transformed_pencil_b2
      }
      if (AC_lmagneto_friction__mod__magnetic && (!AC_lhydro__mod__cparam) && AC_numag__mod__magnetic!=0.0) {
        tmp1_280=AC_mu01__mod__cdata/(AC_numag__mod__magnetic*(AC_b0_magfric__mod__magnetic/AC_unit_magnetic__mod__cdata*AC_unit_magnetic__mod__cdata+ac_transformed_pencil_b2))
        dadt_280.x = dadt_280.x + ac_transformed_pencil_jxbxb.x*tmp1_280
        dadt_280.y = dadt_280.y + ac_transformed_pencil_jxbxb.y*tmp1_280
        dadt_280.z = dadt_280.z + ac_transformed_pencil_jxbxb.z*tmp1_280
        if (! AC_linduction__mod__magnetic) {
          dadt_280 = dadt_280 + fres__mod__magnetic
        }
      }
      if (AC_height_eta__mod__magnetic!=0.0) {
        if (AC_lhalox__mod__magnetic) {
          tmp_280 = (AC_x__mod__cdata[AC_nx__mod__cparam-1]/AC_height_eta__mod__magnetic)*(AC_x__mod__cdata[AC_nx__mod__cparam-1]/AC_height_eta__mod__magnetic)
          eta_out1_280 = AC_eta_out__mod__magnetic*(1.0-exp(-tmp_280*tmp_280*tmp_280*tmp_280*tmp_280*tmp_280/max(1.0-tmp_280,1.0e-5)))-AC_eta__mod__magnetic
        }
        else {
          z_272_280 = abs((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_height_eta__mod__magnetic)/AC_eta_zwidth__mod__magnetic)
          t_272_280 = 1.0 / ( 1.0 + 0.5 * z_272_280 )
          dumerfc_272_280 =  t_272_280 * exp(-z_272_280 * z_272_280 - 1.26551223 + t_272_280 *         ( 1.00002368 + t_272_280 * ( 0.37409196 + t_272_280 *            ( 0.09678418 + t_272_280 * (-0.18628806 + t_272_280 *            ( 0.27886807 + t_272_280 * (-1.13520398 + t_272_280 *            ( 1.48851587 + t_272_280 * (-0.82215223 + t_272_280 * 0.17087277 )))))))))
          if ((AC_z__mod__cdata[AC_n__mod__cdata-1]-AC_height_eta__mod__magnetic)/AC_eta_zwidth__mod__magnetic<0.0) {
            dumerfc_272_280 = 2.0 - dumerfc_272_280
          }
          erfunc_return_value_272_280 = 1.0 - dumerfc_272_280
          eta_out1_280=(AC_eta_out__mod__magnetic-AC_eta__mod__magnetic)*0.5*(1.+erfunc_return_value_272_280)
        }
        dadt_280 = dadt_280-(eta_out1_280*AC_mu0__mod__cdata)*ac_transformed_pencil_jj
        eta_total__mod__magnetic = eta_total__mod__magnetic + eta_out1_280*AC_mu0__mod__cdata
      }
      if (AC_ekman_friction_aa__mod__magnetic!=0) {
        DF_AVEC=DF_AVEC-AC_ekman_friction_aa__mod__magnetic*ac_transformed_pencil_aa
      }
      if (AC_lforcing_cont_aa__mod__magnetic) {
        dadt_280=dadt_280+ AC_ampl_fcont_aa__mod__magnetic*ac_transformed_pencil_fcont[AC_iforcing_cont_aa__mod__magnetic-1]
      }
      if (AC_tau_aa_exterior__mod__magnetic!=0.0) {
        if (AC_z__mod__cdata[AC_n__mod__cdata-1]>AC_zgrav__mod__gravity) {
          scl_274_280=1./AC_tau_aa_exterior__mod__magnetic
          DF_AX=DF_AX-scl_274_280*value(Field(AC_iax__mod__cdata-1))
          DF_AY=DF_AY-scl_274_280*value(Field(AC_iay__mod__cdata-1))
          DF_AZ=DF_AZ-scl_274_280*value(Field(AC_iaz__mod__cdata-1))
        }
      }
      if (AC_tau_relprof__mod__magnetic!=0.0) {
        if (AC_la_relprof_global__mod__magnetic) {
          dadt_280= dadt_280-(ac_transformed_pencil_aa-value(F_GLOBAL_EXT_AVEC))*AC_tau_relprof1__mod__magnetic
        }
        else {
          dadt_280.x= dadt_280.x-(ac_transformed_pencil_aa.x-AC_a_relprof__mod__magnetic[vertexIdx.x-NGHOST_VAL][AC_m__mod__cdata-AC_m1__mod__cparam+1-1][AC_n__mod__cdata-AC_n1__mod__cparam+1-1][1-1])*AC_tau_relprof1__mod__magnetic
          dadt_280.y= dadt_280.y-(ac_transformed_pencil_aa.x-AC_a_relprof__mod__magnetic[vertexIdx.x-NGHOST_VAL][AC_m__mod__cdata-AC_m1__mod__cparam+1-1][AC_n__mod__cdata-AC_n1__mod__cparam+1-1][2-1])*AC_tau_relprof1__mod__magnetic
          dadt_280.z= dadt_280.z-(ac_transformed_pencil_aa.x-AC_a_relprof__mod__magnetic[vertexIdx.x-NGHOST_VAL][AC_m__mod__cdata-AC_m1__mod__cparam+1-1][AC_n__mod__cdata-AC_n1__mod__cparam+1-1][3-1])*AC_tau_relprof1__mod__magnetic
        }
      }
      if (AC_lborder_profiles__mod__cparam) {
        ju_278_280=1+AC_iaa__mod__cdata-1
        if(AC_string_enum_borderaa__mod__magnetic.x == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderaa__mod__magnetic.x == AC_string_enum_0_string__mod__cparam) {
          f_target_278_280.x=0.
        }
        else if(AC_string_enum_borderaa__mod__magnetic.x == AC_string_enum_initialzcondition_string__mod__cparam) {
        }
        else if(AC_string_enum_borderaa__mod__magnetic.x == AC_string_enum_nothing_string__mod__cparam) {
        }
        ju_278_280=2+AC_iaa__mod__cdata-1
        if(AC_string_enum_borderaa__mod__magnetic.y == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderaa__mod__magnetic.y == AC_string_enum_0_string__mod__cparam) {
          f_target_278_280.y=0.
        }
        else if(AC_string_enum_borderaa__mod__magnetic.y == AC_string_enum_initialzcondition_string__mod__cparam) {
        }
        else if(AC_string_enum_borderaa__mod__magnetic.y == AC_string_enum_nothing_string__mod__cparam) {
        }
        ju_278_280=3+AC_iaa__mod__cdata-1
        if(AC_string_enum_borderaa__mod__magnetic.z == AC_string_enum_zero_string__mod__cparam || AC_string_enum_borderaa__mod__magnetic.z == AC_string_enum_0_string__mod__cparam) {
          f_target_278_280.z=0.
        }
        else if(AC_string_enum_borderaa__mod__magnetic.z == AC_string_enum_initialzcondition_string__mod__cparam) {
        }
        else if(AC_string_enum_borderaa__mod__magnetic.z == AC_string_enum_nothing_string__mod__cparam) {
        }
      }
      if (AC_lee_as_aux__mod__magnetic) {
        DF_EVEC=-dadt_280
      }
      if (AC_lbb_sph_as_aux__mod__magnetic && AC_lsphere_in_a_box__mod__cdata) {
        DF_BB_SPHR = ac_transformed_pencil_bb.x*ac_transformed_pencil_evr.x+ac_transformed_pencil_bb.y*ac_transformed_pencil_evr.y+ac_transformed_pencil_bb.z*ac_transformed_pencil_evr.z
        DF_BB_SPHT = ac_transformed_pencil_bb.x*ac_transformed_pencil_evth.x+ac_transformed_pencil_bb.y*ac_transformed_pencil_evth.y+ac_transformed_pencil_bb.z*ac_transformed_pencil_evth.z
        DF_BB_SPHP = ac_transformed_pencil_bb.x*ac_transformed_pencil_phix+ac_transformed_pencil_bb.y*ac_transformed_pencil_phiy
      }
      DF_AVEC=DF_AVEC+dadt_280
    }
    if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata) {
      diffus_eta__mod__magnetic =eta_total__mod__magnetic *dxyz_2__mod__cdata
      diffus_eta2__mod__magnetic=diffus_eta2__mod__magnetic*dxyz_4__mod__cdata
      if (AC_ldynamical_diffusion__mod__cdata  &&  AC_lresi_hyper3_mesh__mod__magnetic) {
        diffus_eta3__mod__magnetic = diffus_eta3__mod__magnetic * sum(dline_1__mod__cdata)
      }
      else {
        diffus_eta3__mod__magnetic = diffus_eta3__mod__magnetic*dxyz_6__mod__cdata
      }
      if (AC_lpole__mod__cdata.y  &&  AC_lcoarse__mod__cdata) {
        if (AC_lfirst_proc_y__mod__cdata  &&  AC_m__mod__cdata<AC_m1__mod__cparam+1.5*AC_ncoarse__mod__cdata  &&  AC_m__mod__cdata>=AC_m1__mod__cparam) {
          nphi_280 = max(mod(int(AC_ncoarse__mod__cdata/(AC_m__mod__cdata-AC_m1__mod__cparam+1)),AC_ncoarse__mod__cdata+1),1)
        }
        else if (AC_llast_proc_y__mod__cdata  &&  AC_m__mod__cdata>AC_m2__mod__cdata-1.5*AC_ncoarse__mod__cdata  &&  AC_m__mod__cdata<=AC_m2__mod__cdata) {
          nphi_280 = max(mod(int(AC_ncoarse__mod__cdata/(AC_m2__mod__cdata-AC_m__mod__cdata+1)),AC_ncoarse__mod__cdata+1),1)
        }
        else {
          nphi_280 = 1
        }
        diffus_eta__mod__magnetic =diffus_eta__mod__magnetic /nphi_280*nphi_280
        diffus_eta2__mod__magnetic=diffus_eta2__mod__magnetic/nphi_280*nphi_280*nphi_280*nphi_280
        if (!(AC_ldynamical_diffusion__mod__cdata  &&  AC_lresi_hyper3_mesh__mod__magnetic)) {
          diffus_eta3__mod__magnetic = diffus_eta3__mod__magnetic/nphi_280*nphi_280*nphi_280*nphi_280*nphi_280*nphi_280
        }
      }
      maxdiffus__mod__cdata=max(maxdiffus__mod__cdata,diffus_eta__mod__magnetic)
      maxdiffus2__mod__cdata=max(maxdiffus2__mod__cdata,diffus_eta2__mod__magnetic)
      maxdiffus3__mod__cdata=max(maxdiffus3__mod__cdata,diffus_eta3__mod__magnetic)
    }
  }
  if (AC_lgrav__mod__cparam) {
    if (AC_lhydro__mod__cparam) {
      if (AC_lboussinesq_grav__mod__gravity) {
        if (AC_lentropy__mod__cparam) {
          if (AC_lgravx_gas__mod__cdata) {
            DF_UX=DF_UX+ac_transformed_pencil_ss*ac_transformed_pencil_gg.x
          }
          if (AC_lgravy_gas__mod__cdata) {
            DF_UY=DF_UY+ac_transformed_pencil_ss*ac_transformed_pencil_gg.y
          }
          if (AC_lgravz_gas__mod__cdata) {
            DF_UZ=DF_UZ+ac_transformed_pencil_ss*ac_transformed_pencil_gg.z
          }
        }
      }
      else if (AC_lanelastic__mod__cparam) {
        if (AC_lgravx_gas__mod__cdata) {
          DF_UX=DF_UX+ac_transformed_pencil_gg.x*ac_transformed_pencil_rho_anel
        }
        if (AC_lgravy_gas__mod__cdata) {
          DF_UY=DF_UY+ac_transformed_pencil_gg.y*ac_transformed_pencil_rho_anel
        }
        if (AC_lgravz_gas__mod__cdata) {
          DF_UZ=DF_UZ+ac_transformed_pencil_gg.z*(-ac_transformed_pencil_ss)
        }
      }
      else {
        if (AC_lgravx_gas__mod__cdata) {
          gg_293.x=ac_transformed_pencil_gg.x
        }
        if (AC_lgravy_gas__mod__cdata) {
          gg_293.y=ac_transformed_pencil_gg.y
        }
        if (AC_lgravz_gas__mod__cdata) {
          gg_293.z=ac_transformed_pencil_gg.z
        }
        if (AC_lreference_state__mod__cdata) {
          refac_293=1.-AC_reference_state__mod__density[vertexIdx.x][AC_iref_rho__mod__cparam-1]*ac_transformed_pencil_rho1
          if (AC_lgravx_gas__mod__cdata) {
            gg_293.x=gg_293.x*refac_293
          }
          if (AC_lgravy_gas__mod__cdata) {
            gg_293.y=gg_293.y*refac_293
          }
          if (AC_lgravz_gas__mod__cdata) {
            gg_293.z=gg_293.z*refac_293
          }
        }
        if (AC_lxyzdependence__mod__gravity) {
          if (AC_lgravx_gas__mod__cdata) {
            DF_UX=DF_UX+gg_293.x*AC_zdep__mod__gravity[AC_n__mod__cdata-1]
          }
          if (AC_lgravy_gas__mod__cdata) {
            DF_UY=DF_UY+gg_293.y
          }
          if (AC_lgravz_gas__mod__cdata) {
            DF_UZ=DF_UZ+gg_293.z*AC_xdep__mod__gravity[vertexIdx.x]
          }
        }
        else {
          if (AC_lgravx_gas__mod__cdata) {
            DF_UX=DF_UX+gg_293.x
          }
          if (AC_lgravy_gas__mod__cdata) {
            DF_UY=DF_UY+gg_293.y
          }
          if (AC_lgravz_gas__mod__cdata) {
            DF_UZ=DF_UZ+gg_293.z
          }
        }
      }
    }
    if (AC_ldustvelocity__mod__cparam) {
      for k_293 in 1:AC_ndustspec__mod__cparam+1 {
        if (AC_lgravx_dust__mod__cdata) {
          DF_DUST_VELOCITY[k_293].x = DF_DUST_VELOCITY[k_293].x + ac_transformed_pencil_gg.x
        }
        if (AC_lgravy_dust__mod__cdata) {
          DF_DUST_VELOCITY[k_293].y = DF_DUST_VELOCITY[k_293].y + ac_transformed_pencil_gg.y
        }
        if (AC_lgravz_dust__mod__cdata) {
          DF_DUST_VELOCITY[k_293].z = DF_DUST_VELOCITY[k_293].z + ac_transformed_pencil_gg.z
        }
      }
    }
    if (AC_lneutralvelocity__mod__cparam) {
      DF_UNVEC = DF_UNVEC + ac_transformed_pencil_gg
    }
  }
  if (AC_lfirst__mod__cdata && AC_ldt__mod__cdata && (!AC_ldt_paronly__mod__cdata)) {
    advec2__mod__cdata=advec2__mod__cdata+advec_cs2__mod__cdata
    if (AC_lenergy__mod__cparam || AC_ldensity__mod__cparam || AC_lmagnetic__mod__cparam || AC_lradiation__mod__cparam || AC_lneutralvelocity__mod__cparam || AC_lcosmicray__mod__cparam ||   (AC_ltestfield_z__mod__cparam && AC_iuutest__mod__cdata>0)) {
      maxadvec__mod__cdata=maxadvec__mod__cdata+sqrt(advec2__mod__cdata)
    }
    if (AC_ldensity__mod__cparam || AC_lviscosity__mod__cparam || AC_lmagnetic__mod__cparam || AC_lenergy__mod__cparam || AC_ldustvelocity__mod__cparam || AC_ldustdensity__mod__cparam) {
      maxadvec__mod__cdata=maxadvec__mod__cdata+sqrt(advec2_hypermesh__mod__cdata)
    }
    dt1_advec_306 = maxadvec__mod__cdata/AC_cdt__mod__cdata
    dt1_diffus_306 = maxdiffus__mod__cdata/AC_cdtv__mod__cdata + maxdiffus2__mod__cdata/AC_cdtv2__mod__cdata + maxdiffus3__mod__cdata/AC_cdtv3__mod__cdata
    dt1_src_306 = maxsrc__mod__cdata/AC_cdtsrc__mod__cdata
    dt1_max_loc_306 = sqrt(dt1_advec_306*dt1_advec_306 + dt1_diffus_306*dt1_diffus_306 + dt1_src_306*dt1_src_306)
    if (AC_ldustdensity__mod__cparam) {
      dt1_max_loc_306 = max(dt1_max_loc_306,AC_reac_dust__mod__cdata[vertexIdx.x-NGHOST_VAL]/AC_cdtc__mod__cdata)
    }
    if (AC_lchemistry__mod__cparam  &&  !AC_llsode__mod__cdata) {
      dt1_max_loc_306 = max(dt1_max_loc_306,AC_reac_chem__mod__cdata[vertexIdx.x-NGHOST_VAL]/AC_cdtc__mod__cdata)
    }
    if (AC_lpolymer__mod__cparam) {
      dt1_max_loc_306 = max(dt1_max_loc_306,1./(AC_trelax_poly__mod__cdata*AC_cdt_poly__mod__cdata))
    }
    if (any_AC(AC_lfreeze_varint__mod__cdata,AC_mcom__mod__cparam)) {
      if (AC_lcylinder_in_a_box__mod__cdata || AC_lcylindrical_coords__mod__cdata) {
        if (ac_transformed_pencil_rcyl_mn<=AC_rfreeze_int__mod__cdata) {
          dt1_max_loc_306=0.
          maxadvec__mod__cdata=0.
          maxdiffus__mod__cdata=0.
          maxdiffus2__mod__cdata=0.
          maxdiffus3__mod__cdata=0.
        }
      }
      else {
        if (ac_transformed_pencil_r_mn<=AC_rfreeze_int__mod__cdata) {
          dt1_max_loc_306=0.
          maxadvec__mod__cdata=0.
          maxdiffus__mod__cdata=0.
          maxdiffus2__mod__cdata=0.
          maxdiffus3__mod__cdata=0.
        }
      }
    }
    if (any_AC(AC_lfreeze_varext__mod__cdata,AC_mcom__mod__cparam)) {
      if (AC_lcylinder_in_a_box__mod__cdata || AC_lcylindrical_coords__mod__cdata) {
        if (ac_transformed_pencil_rcyl_mn>=AC_rfreeze_ext__mod__cdata) {
          dt1_max_loc_306=0.
          maxadvec__mod__cdata=0.
          maxdiffus__mod__cdata=0.
          maxdiffus2__mod__cdata=0.
          maxdiffus3__mod__cdata=0.
        }
      }
      else {
        if (ac_transformed_pencil_r_mn>=AC_rfreeze_ext__mod__cdata) {
          dt1_max_loc_306=0.
          maxadvec__mod__cdata=0.
          maxdiffus__mod__cdata=0.
          maxdiffus2__mod__cdata=0.
          maxdiffus3__mod__cdata=0.
        }
      }
    }
    if (any_AC(AC_lfreeze_varsquare__mod__cdata,AC_mcom__mod__cparam) && AC_y__mod__cdata[AC_m__mod__cdata-1]>AC_yfreeze_square__mod__cdata) {
      if (AC_x__mod__cdata[vertexIdx.x]>AC_xfreeze_square__mod__cdata) {
        dt1_max_loc_306=0.
        maxadvec__mod__cdata=0.
        maxdiffus__mod__cdata=0.
        maxdiffus2__mod__cdata=0.
        maxdiffus3__mod__cdata=0.
      }
    }
  }
  if (AC_lanelastic__mod__cparam) {
    DF_RHX   = ac_transformed_pencil_rho*DF_UX
    DF_RHY = ac_transformed_pencil_rho*DF_UY
    DF_RHZ = ac_transformed_pencil_rho*DF_UZ
    DF_UVEC = df_iuu_pencil + DF_UVEC
  }
  write(TEST_1,max_hdiff)
  write(TEST_2,ac_transformed_pencil_del2lntt)
  write(TEST_3,ac_transformed_pencil_del2lnrho)
  write(TEST_4,ac_transformed_pencil_visc_heat)
  write(TEST_5,DF_SS)
}

#include "taskgraph.h"
